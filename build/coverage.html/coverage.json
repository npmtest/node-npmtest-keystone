{"/home/travis/build/npmtest/node-npmtest-keystone/test.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/test.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":1,"12":1,"13":1,"14":1,"15":2,"16":2,"17":2,"18":2,"19":1,"20":1,"21":2,"22":2,"23":2,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":2,"40":2,"41":1,"42":2,"43":2,"44":1,"45":2,"46":2,"47":1,"48":2,"49":2,"50":1,"51":1,"52":1,"53":1,"54":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[1,1],"5":[1,1],"6":[1,1],"7":[1,1],"8":[1,1],"9":[1,1],"10":[1,1,1],"11":[1,1],"12":[1,1],"13":[1,1],"14":[1,1],"15":[1,1],"16":[1,1],"17":[1,1]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":1,"7":1,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}},"4":{"name":"(anonymous_4)","line":61,"loc":{"start":{"line":61,"column":5},"end":{"line":61,"column":17}}},"5":{"name":"(anonymous_5)","line":82,"loc":{"start":{"line":82,"column":5},"end":{"line":82,"column":17}}},"6":{"name":"(anonymous_6)","line":91,"loc":{"start":{"line":91,"column":77},"end":{"line":94,"column":10}}},"7":{"name":"(anonymous_7)","line":112,"loc":{"start":{"line":112,"column":83},"end":{"line":115,"column":10}},"skip":true},"8":{"name":"(anonymous_8)","line":123,"loc":{"start":{"line":123,"column":77},"end":{"line":126,"column":10}},"skip":true},"9":{"name":"(anonymous_9)","line":139,"loc":{"start":{"line":139,"column":12},"end":{"line":139,"column":40}},"skip":true},"10":{"name":"(anonymous_10)","line":147,"loc":{"start":{"line":147,"column":77},"end":{"line":150,"column":10}},"skip":true},"11":{"name":"(anonymous_11)","line":158,"loc":{"start":{"line":158,"column":83},"end":{"line":161,"column":10}},"skip":true},"12":{"name":"(anonymous_12)","line":169,"loc":{"start":{"line":169,"column":79},"end":{"line":172,"column":10}},"skip":true},"13":{"name":"(anonymous_13)","line":180,"loc":{"start":{"line":180,"column":75},"end":{"line":183,"column":10}},"skip":true}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":195,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":56,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":40,"column":8},"end":{"line":53,"column":9}},"11":{"start":{"line":43,"column":12},"end":{"line":46,"column":14}},"12":{"start":{"line":47,"column":12},"end":{"line":47,"column":18}},"13":{"start":{"line":50,"column":12},"end":{"line":51,"column":33}},"14":{"start":{"line":52,"column":12},"end":{"line":52,"column":18}},"15":{"start":{"line":55,"column":8},"end":{"line":55,"column":35}},"16":{"start":{"line":61,"column":4},"end":{"line":63,"column":9}},"17":{"start":{"line":62,"column":8},"end":{"line":62,"column":15}},"18":{"start":{"line":64,"column":4},"end":{"line":77,"column":5}},"19":{"start":{"line":70,"column":8},"end":{"line":70,"column":14}},"20":{"start":{"line":76,"column":8},"end":{"line":76,"column":14}},"21":{"start":{"line":82,"column":4},"end":{"line":84,"column":9}},"22":{"start":{"line":83,"column":8},"end":{"line":83,"column":15}},"23":{"start":{"line":85,"column":4},"end":{"line":194,"column":5}},"24":{"start":{"line":91,"column":8},"end":{"line":99,"column":10}},"25":{"start":{"line":98,"column":12},"end":{"line":98,"column":35}},"26":{"start":{"line":102,"column":8},"end":{"line":104,"column":63}},"27":{"start":{"line":105,"column":8},"end":{"line":105,"column":14}},"28":{"start":{"line":112,"column":8},"end":{"line":121,"column":10},"skip":true},"29":{"start":{"line":119,"column":12},"end":{"line":119,"column":55},"skip":true},"30":{"start":{"line":120,"column":12},"end":{"line":120,"column":48},"skip":true},"31":{"start":{"line":123,"column":8},"end":{"line":136,"column":10},"skip":true},"32":{"start":{"line":130,"column":12},"end":{"line":130,"column":76},"skip":true},"33":{"start":{"line":131,"column":12},"end":{"line":131,"column":73},"skip":true},"34":{"start":{"line":132,"column":12},"end":{"line":132,"column":74},"skip":true},"35":{"start":{"line":133,"column":12},"end":{"line":133,"column":79},"skip":true},"36":{"start":{"line":134,"column":12},"end":{"line":134,"column":25},"skip":true},"37":{"start":{"line":135,"column":12},"end":{"line":135,"column":45},"skip":true},"38":{"start":{"line":138,"column":8},"end":{"line":145,"column":14},"skip":true},"39":{"start":{"line":143,"column":16},"end":{"line":143,"column":29},"skip":true},"40":{"start":{"line":144,"column":16},"end":{"line":144,"column":55},"skip":true},"41":{"start":{"line":147,"column":8},"end":{"line":156,"column":10},"skip":true},"42":{"start":{"line":154,"column":12},"end":{"line":154,"column":25},"skip":true},"43":{"start":{"line":155,"column":12},"end":{"line":155,"column":45},"skip":true},"44":{"start":{"line":158,"column":8},"end":{"line":167,"column":10},"skip":true},"45":{"start":{"line":165,"column":12},"end":{"line":165,"column":25},"skip":true},"46":{"start":{"line":166,"column":12},"end":{"line":166,"column":48},"skip":true},"47":{"start":{"line":169,"column":8},"end":{"line":178,"column":10},"skip":true},"48":{"start":{"line":176,"column":12},"end":{"line":176,"column":25},"skip":true},"49":{"start":{"line":177,"column":12},"end":{"line":177,"column":46},"skip":true},"50":{"start":{"line":180,"column":8},"end":{"line":189,"column":10},"skip":true},"51":{"start":{"line":187,"column":12},"end":{"line":187,"column":94},"skip":true},"52":{"start":{"line":188,"column":12},"end":{"line":188,"column":48},"skip":true},"53":{"start":{"line":192,"column":8},"end":{"line":192,"column":35},"skip":true},"54":{"start":{"line":193,"column":8},"end":{"line":193,"column":14},"skip":true}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":40,"type":"switch","locations":[{"start":{"line":42,"column":8},"end":{"line":47,"column":18}},{"start":{"line":49,"column":8},"end":{"line":52,"column":18}}]},"5":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":16},"end":{"line":44,"column":44}},{"start":{"line":44,"column":48},"end":{"line":44,"column":66}}]},"6":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":21},"end":{"line":50,"column":49}},{"start":{"line":50,"column":53},"end":{"line":50,"column":72}}]},"7":{"line":64,"type":"switch","locations":[{"start":{"line":69,"column":4},"end":{"line":70,"column":14}},{"start":{"line":75,"column":4},"end":{"line":76,"column":14}}]},"8":{"line":85,"type":"switch","locations":[{"start":{"line":90,"column":4},"end":{"line":105,"column":14}},{"start":{"line":111,"column":4},"end":{"line":193,"column":14},"skip":true}]},"9":{"line":91,"type":"binary-expr","locations":[{"start":{"line":91,"column":42},"end":{"line":91,"column":73}},{"start":{"line":91,"column":77},"end":{"line":99,"column":9}}]},"10":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":18},"end":{"line":102,"column":32}},{"start":{"line":103,"column":12},"end":{"line":103,"column":53}},{"start":{"line":104,"column":12},"end":{"line":104,"column":61}}]},"11":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":45},"end":{"line":112,"column":79},"skip":true},{"start":{"line":112,"column":83},"end":{"line":121,"column":9},"skip":true}]},"12":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":42},"end":{"line":123,"column":73},"skip":true},{"start":{"line":123,"column":77},"end":{"line":136,"column":9},"skip":true}]},"13":{"line":138,"type":"binary-expr","locations":[{"start":{"line":138,"column":48},"end":{"line":138,"column":85},"skip":true},{"start":{"line":139,"column":12},"end":{"line":145,"column":13},"skip":true}]},"14":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":42},"end":{"line":147,"column":73},"skip":true},{"start":{"line":147,"column":77},"end":{"line":156,"column":9},"skip":true}]},"15":{"line":158,"type":"binary-expr","locations":[{"start":{"line":158,"column":45},"end":{"line":158,"column":79},"skip":true},{"start":{"line":158,"column":83},"end":{"line":167,"column":9},"skip":true}]},"16":{"line":169,"type":"binary-expr","locations":[{"start":{"line":169,"column":43},"end":{"line":169,"column":75},"skip":true},{"start":{"line":169,"column":79},"end":{"line":178,"column":9},"skip":true}]},"17":{"line":180,"type":"binary-expr","locations":[{"start":{"line":180,"column":41},"end":{"line":180,"column":71},"skip":true},{"start":{"line":180,"column":75},"end":{"line":189,"column":9},"skip":true}]}},"code":["/* istanbul instrument in package npmtest_keystone */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - init-before","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        switch (local.modeJs) {","        // re-init local from window.local","        case 'browser':","            local = local.global.utility2.objectSetDefault(","                local.global.utility2_rollup || local.global.local,","                local.global.utility2","            );","            break;","        // re-init local from example.js","        case 'node':","            local = (local.global.utility2_rollup || require('utility2'))","                .requireReadme();","            break;","        }","        // export local","        local.global.local = local;","    }());","","","","    // run shared js-env code - function","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - function","    case 'browser':","        break;","","","","    // run node js-env code - function","    case 'node':","        break;","    }","","","","    // run shared js-env code - init-after","    (function () {","        return;","    }());","    switch (local.modeJs) {","","","","    // run browser js-env code - init-after","    case 'browser':","        local.testCase_browser_nullCase = local.testCase_browser_nullCase || function (","            options,","            onError","        ) {","        /*","         * this function will test browsers's null-case handling-behavior-behavior","         */","            onError(null, options);","        };","","        // run tests","        local.nop(local.modeTest &&","            document.querySelector('#testRunButton1') &&","            document.querySelector('#testRunButton1').click());","        break;","","","","    // run node js-env code - init-after","    /* istanbul ignore next */","    case 'node':","        local.testCase_buildApidoc_default = local.testCase_buildApidoc_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApidoc's default handling-behavior-behavior","         */","            options = { modulePathList: module.paths };","            local.buildApidoc(options, onError);","        };","","        local.testCase_buildApp_default = local.testCase_buildApp_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildApp's default handling-behavior-behavior","         */","            local.testCase_buildReadme_default(options, local.onErrorThrow);","            local.testCase_buildLib_default(options, local.onErrorThrow);","            local.testCase_buildTest_default(options, local.onErrorThrow);","            local.testCase_buildCustomOrg_default(options, local.onErrorThrow);","            options = [];","            local.buildApp(options, onError);","        };","","        local.testCase_buildCustomOrg_default = local.testCase_buildCustomOrg_default ||","            function (options, onError) {","            /*","             * this function will test buildCustomOrg's default handling-behavior","             */","                options = {};","                local.buildCustomOrg(options, onError);","            };","","        local.testCase_buildLib_default = local.testCase_buildLib_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildLib's default handling-behavior","         */","            options = {};","            local.buildLib(options, onError);","        };","","        local.testCase_buildReadme_default = local.testCase_buildReadme_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildReadme's default handling-behavior-behavior","         */","            options = {};","            local.buildReadme(options, onError);","        };","","        local.testCase_buildTest_default = local.testCase_buildTest_default || function (","            options,","            onError","        ) {","        /*","         * this function will test buildTest's default handling-behavior","         */","            options = {};","            local.buildTest(options, onError);","        };","","        local.testCase_webpage_default = local.testCase_webpage_default || function (","            options,","            onError","        ) {","        /*","         * this function will test webpage's default handling-behavior","         */","            options = { modeCoverageMerge: true, url: local.serverLocalHost + '?modeTest=1' };","            local.browserTest(options, onError);","        };","","        // run test-server","        local.testRunServer(local);","        break;","    }","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"40":2,"43":1,"47":1,"50":1,"52":1,"55":2,"61":2,"62":2,"64":2,"70":1,"76":1,"82":2,"83":2,"85":2,"91":1,"98":1,"102":1,"105":1,"112":1,"119":1,"120":1,"123":1,"130":1,"131":1,"132":1,"133":1,"134":1,"135":1,"138":1,"143":2,"144":2,"147":1,"154":2,"155":2,"158":1,"165":2,"166":2,"169":1,"176":2,"177":2,"180":1,"187":1,"188":1,"192":1,"193":1}},"/home/travis/build/npmtest/node-npmtest-keystone/lib.npmtest_keystone.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/lib.npmtest_keystone.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":1,"15":1,"16":1},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1]},"f":{"1":2,"2":2,"3":2},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":1},"end":{"line":12,"column":13}}},"2":{"name":"(anonymous_2)","line":19,"loc":{"start":{"line":19,"column":5},"end":{"line":19,"column":17}}},"3":{"name":"(anonymous_3)","line":23,"loc":{"start":{"line":23,"column":24},"end":{"line":23,"column":36}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":53,"column":5}},"2":{"start":{"line":14,"column":4},"end":{"line":14,"column":14}},"3":{"start":{"line":19,"column":4},"end":{"line":52,"column":9}},"4":{"start":{"line":21,"column":8},"end":{"line":21,"column":19}},"5":{"start":{"line":23,"column":8},"end":{"line":35,"column":13}},"6":{"start":{"line":24,"column":12},"end":{"line":34,"column":13}},"7":{"start":{"line":25,"column":16},"end":{"line":28,"column":30}},"8":{"start":{"line":30,"column":16},"end":{"line":33,"column":27}},"9":{"start":{"line":37,"column":8},"end":{"line":39,"column":21}},"10":{"start":{"line":41,"column":8},"end":{"line":41,"column":54}},"11":{"start":{"line":43,"column":8},"end":{"line":43,"column":53}},"12":{"start":{"line":45,"column":8},"end":{"line":51,"column":9}},"13":{"start":{"line":46,"column":12},"end":{"line":46,"column":59}},"14":{"start":{"line":48,"column":12},"end":{"line":48,"column":35}},"15":{"start":{"line":49,"column":12},"end":{"line":49,"column":49}},"16":{"start":{"line":50,"column":12},"end":{"line":50,"column":43}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":23},"end":{"line":25,"column":62}},{"start":{"line":26,"column":20},"end":{"line":26,"column":70}},{"start":{"line":27,"column":20},"end":{"line":27,"column":71}},{"start":{"line":28,"column":20},"end":{"line":28,"column":29}}]},"2":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":23},"end":{"line":30,"column":37}},{"start":{"line":31,"column":20},"end":{"line":31,"column":61}},{"start":{"line":32,"column":20},"end":{"line":32,"column":70}},{"start":{"line":33,"column":20},"end":{"line":33,"column":26}}]},"3":{"line":37,"type":"cond-expr","locations":[{"start":{"line":38,"column":14},"end":{"line":38,"column":20}},{"start":{"line":39,"column":14},"end":{"line":39,"column":20}}]},"4":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":16},"end":{"line":41,"column":44}},{"start":{"line":41,"column":48},"end":{"line":41,"column":53}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":8}},{"start":{"line":45,"column":8},"end":{"line":45,"column":8}}]}},"code":["/* istanbul instrument in package npmtest_keystone */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - init-before","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || local;","        // init lib","        local.local = local.npmtest_keystone = local;","        // init exports","        if (local.modeJs === 'browser') {","            local.global.utility2_npmtest_keystone = local;","        } else {","            module.exports = local;","            module.exports.__dirname = __dirname;","            module.exports.module = module;","        }","    }());","}());",""],"l":{"12":2,"14":2,"19":2,"21":2,"23":2,"24":2,"25":2,"30":1,"37":2,"41":2,"43":2,"45":2,"46":1,"48":1,"49":1,"50":1}},"/home/travis/build/npmtest/node-npmtest-keystone/example.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/example.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":1,"9":2,"10":2,"11":2,"12":2,"13":1,"14":2,"15":2,"16":2,"17":2,"18":2,"19":0,"20":2,"21":1,"22":1,"23":1,"24":1,"25":1,"26":0,"27":0,"28":1,"29":1,"30":2,"31":0,"32":0,"33":0,"34":1,"35":2,"36":2,"37":3,"38":3,"39":3,"40":3,"41":0,"42":3,"43":3,"44":3,"45":1,"46":3,"47":1,"48":1,"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":0,"58":1,"59":6,"60":6,"61":1,"62":2,"63":0,"64":2,"65":1,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0},"b":{"1":[2,1,1,1],"2":[1,1,1,1],"3":[1,1],"4":[2,2],"5":[1,1],"6":[1,1],"7":[2,0],"8":[2,1,1,1,1,1],"9":[0,2,0],"10":[1,1],"11":[2,1,1],"12":[1,0],"13":[0,2],"14":[2,0,0,0,0,0,0],"15":[0,3],"16":[3,0],"17":[1,1],"18":[0,1],"19":[1,2,0,2],"20":[1,0],"21":[1,1],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":3,"8":3,"9":3,"10":1,"11":6,"12":0},"fnMap":{"1":{"name":"(anonymous_1)","line":26,"loc":{"start":{"line":26,"column":1},"end":{"line":26,"column":13}}},"2":{"name":"(anonymous_2)","line":33,"loc":{"start":{"line":33,"column":5},"end":{"line":33,"column":17}}},"3":{"name":"(anonymous_3)","line":37,"loc":{"start":{"line":37,"column":24},"end":{"line":37,"column":36}}},"4":{"name":"(anonymous_4)","line":69,"loc":{"start":{"line":69,"column":31},"end":{"line":69,"column":48}},"skip":true},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":26},"end":{"line":78,"column":45}},"skip":true},"6":{"name":"(anonymous_6)","line":123,"loc":{"start":{"line":123,"column":33},"end":{"line":123,"column":48}},"skip":true},"7":{"name":"(anonymous_7)","line":125,"loc":{"start":{"line":125,"column":27},"end":{"line":125,"column":39}},"skip":true},"8":{"name":"(anonymous_8)","line":133,"loc":{"start":{"line":133,"column":59},"end":{"line":133,"column":74}},"skip":true},"9":{"name":"(anonymous_9)","line":143,"loc":{"start":{"line":143,"column":45},"end":{"line":143,"column":62}},"skip":true},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":73},"end":{"line":144,"column":92}},"skip":true},"11":{"name":"(anonymous_11)","line":272,"loc":{"start":{"line":272,"column":51},"end":{"line":272,"column":77}},"skip":true},"12":{"name":"(anonymous_12)","line":315,"loc":{"start":{"line":315,"column":32},"end":{"line":315,"column":61}},"skip":true}},"statementMap":{"1":{"start":{"line":26,"column":0},"end":{"line":326,"column":5}},"2":{"start":{"line":28,"column":4},"end":{"line":28,"column":14}},"3":{"start":{"line":33,"column":4},"end":{"line":60,"column":9}},"4":{"start":{"line":35,"column":8},"end":{"line":35,"column":19}},"5":{"start":{"line":37,"column":8},"end":{"line":49,"column":13}},"6":{"start":{"line":38,"column":12},"end":{"line":48,"column":13}},"7":{"start":{"line":39,"column":16},"end":{"line":42,"column":30}},"8":{"start":{"line":44,"column":16},"end":{"line":47,"column":27}},"9":{"start":{"line":51,"column":8},"end":{"line":53,"column":21}},"10":{"start":{"line":55,"column":8},"end":{"line":57,"column":45}},"11":{"start":{"line":59,"column":8},"end":{"line":59,"column":35}},"12":{"start":{"line":61,"column":4},"end":{"line":325,"column":5}},"13":{"start":{"line":69,"column":8},"end":{"line":121,"column":10},"skip":true},"14":{"start":{"line":70,"column":12},"end":{"line":88,"column":13},"skip":true},"15":{"start":{"line":76,"column":16},"end":{"line":87,"column":19},"skip":true},"16":{"start":{"line":79,"column":20},"end":{"line":86,"column":21},"skip":true},"17":{"start":{"line":82,"column":24},"end":{"line":82,"column":43},"skip":true},"18":{"start":{"line":83,"column":24},"end":{"line":83,"column":30},"skip":true},"19":{"start":{"line":85,"column":24},"end":{"line":85,"column":49},"skip":true},"20":{"start":{"line":89,"column":12},"end":{"line":107,"column":13},"skip":true},"21":{"start":{"line":92,"column":16},"end":{"line":102,"column":17},"skip":true},"22":{"start":{"line":93,"column":20},"end":{"line":93,"column":86},"skip":true},"23":{"start":{"line":94,"column":20},"end":{"line":95,"column":45},"skip":true},"24":{"start":{"line":96,"column":20},"end":{"line":96,"column":42},"skip":true},"25":{"start":{"line":97,"column":20},"end":{"line":97,"column":48},"skip":true},"26":{"start":{"line":100,"column":20},"end":{"line":100,"column":85},"skip":true},"27":{"start":{"line":101,"column":20},"end":{"line":101,"column":96},"skip":true},"28":{"start":{"line":103,"column":16},"end":{"line":103,"column":22},"skip":true},"29":{"start":{"line":106,"column":16},"end":{"line":106,"column":22},"skip":true},"30":{"start":{"line":108,"column":12},"end":{"line":120,"column":13},"skip":true},"31":{"start":{"line":114,"column":16},"end":{"line":119,"column":17},"skip":true},"32":{"start":{"line":116,"column":20},"end":{"line":116,"column":78},"skip":true},"33":{"start":{"line":118,"column":20},"end":{"line":118,"column":47},"skip":true},"34":{"start":{"line":123,"column":8},"end":{"line":141,"column":11},"skip":true},"35":{"start":{"line":124,"column":12},"end":{"line":124,"column":54},"skip":true},"36":{"start":{"line":125,"column":12},"end":{"line":140,"column":14},"skip":true},"37":{"start":{"line":126,"column":16},"end":{"line":126,"column":28},"skip":true},"38":{"start":{"line":127,"column":16},"end":{"line":127,"column":69},"skip":true},"39":{"start":{"line":128,"column":16},"end":{"line":128,"column":75},"skip":true},"40":{"start":{"line":129,"column":16},"end":{"line":131,"column":17},"skip":true},"41":{"start":{"line":130,"column":20},"end":{"line":130,"column":27},"skip":true},"42":{"start":{"line":133,"column":16},"end":{"line":137,"column":36},"skip":true},"43":{"start":{"line":134,"column":20},"end":{"line":136,"column":55},"skip":true},"44":{"start":{"line":139,"column":16},"end":{"line":139,"column":57},"skip":true},"45":{"start":{"line":143,"column":8},"end":{"line":147,"column":11},"skip":true},"46":{"start":{"line":144,"column":12},"end":{"line":146,"column":15},"skip":true},"47":{"start":{"line":145,"column":16},"end":{"line":145,"column":70},"skip":true},"48":{"start":{"line":149,"column":8},"end":{"line":149,"column":31},"skip":true},"49":{"start":{"line":150,"column":8},"end":{"line":150,"column":14},"skip":true},"50":{"start":{"line":158,"column":8},"end":{"line":158,"column":31},"skip":true},"51":{"start":{"line":160,"column":8},"end":{"line":160,"column":33},"skip":true},"52":{"start":{"line":161,"column":8},"end":{"line":161,"column":37},"skip":true},"53":{"start":{"line":162,"column":8},"end":{"line":162,"column":35},"skip":true},"54":{"start":{"line":164,"column":8},"end":{"line":164,"column":50},"skip":true},"55":{"start":{"line":166,"column":8},"end":{"line":256,"column":2},"skip":true},"56":{"start":{"line":258,"column":8},"end":{"line":286,"column":9},"skip":true},"57":{"start":{"line":259,"column":12},"end":{"line":269,"column":14},"skip":true},"58":{"start":{"line":271,"column":12},"end":{"line":285,"column":19},"skip":true},"59":{"start":{"line":274,"column":20},"end":{"line":274,"column":35},"skip":true},"60":{"start":{"line":275,"column":20},"end":{"line":284,"column":21},"skip":true},"61":{"start":{"line":277,"column":24},"end":{"line":277,"column":64},"skip":true},"62":{"start":{"line":279,"column":24},"end":{"line":279,"column":40},"skip":true},"63":{"start":{"line":281,"column":24},"end":{"line":281,"column":40},"skip":true},"64":{"start":{"line":283,"column":24},"end":{"line":283,"column":39},"skip":true},"65":{"start":{"line":288,"column":8},"end":{"line":290,"column":9},"skip":true},"66":{"start":{"line":289,"column":12},"end":{"line":289,"column":18},"skip":true},"67":{"start":{"line":291,"column":8},"end":{"line":293,"column":54},"skip":true},"68":{"start":{"line":296,"column":8},"end":{"line":301,"column":37},"skip":true},"69":{"start":{"line":303,"column":8},"end":{"line":303,"column":82},"skip":true},"70":{"start":{"line":306,"column":8},"end":{"line":308,"column":9},"skip":true},"71":{"start":{"line":307,"column":12},"end":{"line":307,"column":82},"skip":true},"72":{"start":{"line":310,"column":8},"end":{"line":312,"column":9},"skip":true},"73":{"start":{"line":311,"column":12},"end":{"line":311,"column":18},"skip":true},"74":{"start":{"line":313,"column":8},"end":{"line":313,"column":54},"skip":true},"75":{"start":{"line":314,"column":8},"end":{"line":314,"column":69},"skip":true},"76":{"start":{"line":315,"column":8},"end":{"line":323,"column":36},"skip":true},"77":{"start":{"line":316,"column":12},"end":{"line":316,"column":61},"skip":true},"78":{"start":{"line":317,"column":12},"end":{"line":320,"column":13},"skip":true},"79":{"start":{"line":318,"column":16},"end":{"line":318,"column":75},"skip":true},"80":{"start":{"line":319,"column":16},"end":{"line":319,"column":23},"skip":true},"81":{"start":{"line":321,"column":12},"end":{"line":321,"column":38},"skip":true},"82":{"start":{"line":322,"column":12},"end":{"line":322,"column":27},"skip":true},"83":{"start":{"line":324,"column":8},"end":{"line":324,"column":14},"skip":true}},"branchMap":{"1":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":23},"end":{"line":39,"column":62}},{"start":{"line":40,"column":20},"end":{"line":40,"column":70}},{"start":{"line":41,"column":20},"end":{"line":41,"column":71}},{"start":{"line":42,"column":20},"end":{"line":42,"column":29}}]},"2":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":23},"end":{"line":44,"column":37}},{"start":{"line":45,"column":20},"end":{"line":45,"column":61}},{"start":{"line":46,"column":20},"end":{"line":46,"column":70}},{"start":{"line":47,"column":20},"end":{"line":47,"column":26}}]},"3":{"line":51,"type":"cond-expr","locations":[{"start":{"line":52,"column":14},"end":{"line":52,"column":20}},{"start":{"line":53,"column":14},"end":{"line":53,"column":20}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":16},"end":{"line":55,"column":44}},{"start":{"line":55,"column":49},"end":{"line":57,"column":43}}]},"5":{"line":55,"type":"cond-expr","locations":[{"start":{"line":56,"column":14},"end":{"line":56,"column":52}},{"start":{"line":57,"column":14},"end":{"line":57,"column":43}}]},"6":{"line":61,"type":"switch","locations":[{"start":{"line":68,"column":4},"end":{"line":150,"column":14},"skip":true},{"start":{"line":156,"column":4},"end":{"line":324,"column":14},"skip":true}]},"7":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true},{"start":{"line":70,"column":12},"end":{"line":70,"column":12},"skip":true}]},"8":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":16},"end":{"line":70,"column":22},"skip":true},{"start":{"line":70,"column":27},"end":{"line":70,"column":32},"skip":true},{"start":{"line":71,"column":20},"end":{"line":71,"column":39},"skip":true},{"start":{"line":72,"column":20},"end":{"line":72,"column":49},"skip":true},{"start":{"line":73,"column":20},"end":{"line":73,"column":58},"skip":true},{"start":{"line":74,"column":20},"end":{"line":74,"column":69},"skip":true}]},"9":{"line":79,"type":"switch","locations":[{"start":{"line":80,"column":20},"end":{"line":80,"column":33},"skip":true},{"start":{"line":81,"column":20},"end":{"line":83,"column":30},"skip":true},{"start":{"line":84,"column":20},"end":{"line":85,"column":49},"skip":true}]},"10":{"line":89,"type":"switch","locations":[{"start":{"line":90,"column":12},"end":{"line":103,"column":22},"skip":true},{"start":{"line":105,"column":12},"end":{"line":106,"column":22},"skip":true}]},"11":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":20},"end":{"line":89,"column":25},"skip":true},{"start":{"line":89,"column":29},"end":{"line":89,"column":48},"skip":true},{"start":{"line":89,"column":52},"end":{"line":89,"column":74},"skip":true}]},"12":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true},{"start":{"line":92,"column":16},"end":{"line":92,"column":16},"skip":true}]},"13":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true},{"start":{"line":108,"column":12},"end":{"line":108,"column":12},"skip":true}]},"14":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":16},"end":{"line":108,"column":61},"skip":true},{"start":{"line":108,"column":66},"end":{"line":108,"column":72},"skip":true},{"start":{"line":108,"column":77},"end":{"line":108,"column":82},"skip":true},{"start":{"line":109,"column":20},"end":{"line":109,"column":39},"skip":true},{"start":{"line":110,"column":20},"end":{"line":110,"column":49},"skip":true},{"start":{"line":111,"column":20},"end":{"line":111,"column":58},"skip":true},{"start":{"line":112,"column":20},"end":{"line":112,"column":68},"skip":true}]},"15":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true},{"start":{"line":129,"column":16},"end":{"line":129,"column":16},"skip":true}]},"16":{"line":134,"type":"cond-expr","locations":[{"start":{"line":135,"column":26},"end":{"line":135,"column":29},"skip":true},{"start":{"line":136,"column":26},"end":{"line":136,"column":54},"skip":true}]},"17":{"line":164,"type":"binary-expr","locations":[{"start":{"line":164,"column":27},"end":{"line":164,"column":43},"skip":true},{"start":{"line":164,"column":47},"end":{"line":164,"column":49},"skip":true}]},"18":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true},{"start":{"line":258,"column":8},"end":{"line":258,"column":8},"skip":true}]},"19":{"line":275,"type":"switch","locations":[{"start":{"line":276,"column":20},"end":{"line":277,"column":64},"skip":true},{"start":{"line":278,"column":20},"end":{"line":279,"column":40},"skip":true},{"start":{"line":280,"column":20},"end":{"line":281,"column":40},"skip":true},{"start":{"line":282,"column":20},"end":{"line":283,"column":39},"skip":true}]},"20":{"line":288,"type":"if","locations":[{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true},{"start":{"line":288,"column":8},"end":{"line":288,"column":8},"skip":true}]},"21":{"line":288,"type":"binary-expr","locations":[{"start":{"line":288,"column":12},"end":{"line":288,"column":40},"skip":true},{"start":{"line":288,"column":44},"end":{"line":288,"column":67},"skip":true}]},"22":{"line":292,"type":"binary-expr","locations":[{"start":{"line":292,"column":12},"end":{"line":292,"column":50},"skip":true},{"start":{"line":293,"column":12},"end":{"line":293,"column":53},"skip":true}]},"23":{"line":297,"type":"binary-expr","locations":[{"start":{"line":297,"column":12},"end":{"line":297,"column":66},"skip":true},{"start":{"line":298,"column":12},"end":{"line":301,"column":36},"skip":true}]},"24":{"line":303,"type":"binary-expr","locations":[{"start":{"line":303,"column":43},"end":{"line":303,"column":75},"skip":true},{"start":{"line":303,"column":79},"end":{"line":303,"column":81},"skip":true}]},"25":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":8},"end":{"line":306,"column":8},"skip":true},{"start":{"line":306,"column":8},"end":{"line":306,"column":8},"skip":true}]},"26":{"line":310,"type":"if","locations":[{"start":{"line":310,"column":8},"end":{"line":310,"column":8},"skip":true},{"start":{"line":310,"column":8},"end":{"line":310,"column":8},"skip":true}]},"27":{"line":313,"type":"binary-expr","locations":[{"start":{"line":313,"column":27},"end":{"line":313,"column":43},"skip":true},{"start":{"line":313,"column":47},"end":{"line":313,"column":53},"skip":true}]},"28":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":12},"end":{"line":317,"column":12},"skip":true},{"start":{"line":317,"column":12},"end":{"line":317,"column":12},"skip":true}]}},"code":["/*","example.js","","quickstart example","","instruction","    1. save this script as example.js","    2. run the shell command:","        $ npm install npmtest-keystone && PORT=8081 node example.js","    3. play with the browser-demo on http://127.0.0.1:8081","*/","","","","/* istanbul instrument in package npmtest_keystone */","/*jslint","    bitwise: true,","    browser: true,","    maxerr: 8,","    maxlen: 96,","    node: true,","    nomen: true,","    regexp: true,","    stupid: true","*/","(function () {","    'use strict';","    var local;","","","","    // run shared js-env code - init-before","    (function () {","        // init local","        local = {};","        // init modeJs","        local.modeJs = (function () {","            try {","                return typeof navigator.userAgent === 'string' &&","                    typeof document.querySelector('body') === 'object' &&","                    typeof XMLHttpRequest.prototype.open === 'function' &&","                    'browser';","            } catch (errorCaughtBrowser) {","                return module.exports &&","                    typeof process.versions.node === 'string' &&","                    typeof require('http').createServer === 'function' &&","                    'node';","            }","        }());","        // init global","        local.global = local.modeJs === 'browser'","            ? window","            : global;","        // init utility2_rollup","        local = local.global.utility2_rollup || (local.modeJs === 'browser'","            ? local.global.utility2_npmtest_keystone","            : global.utility2_moduleExports);","        // export local","        local.global.local = local;","    }());","    switch (local.modeJs) {","","","","    // init-after","    // run browser js-env code - init-after","    /* istanbul ignore next */","    case 'browser':","        local.testRunBrowser = function (event) {","            if (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('onreset'))) {","                // reset output","                Array.from(","                    document.querySelectorAll('body > .resettable')","                ).forEach(function (element) {","                    switch (element.tagName) {","                    case 'INPUT':","                    case 'TEXTAREA':","                        element.value = '';","                        break;","                    default:","                        element.textContent = '';","                    }","                });","            }","            switch (event && event.currentTarget && event.currentTarget.id) {","            case 'testRunButton1':","                // show tests","                if (document.querySelector('#testReportDiv1').style.display === 'none') {","                    document.querySelector('#testReportDiv1').style.display = 'block';","                    document.querySelector('#testRunButton1').textContent =","                        'hide internal test';","                    local.modeTest = true;","                    local.testRunDefault(local);","                // hide tests","                } else {","                    document.querySelector('#testReportDiv1').style.display = 'none';","                    document.querySelector('#testRunButton1').textContent = 'run internal test';","                }","                break;","            // custom-case","            default:","                break;","            }","            if (document.querySelector('#inputTextareaEval1') && (!event || (event &&","                    event.currentTarget &&","                    event.currentTarget.className &&","                    event.currentTarget.className.includes &&","                    event.currentTarget.className.includes('oneval')))) {","                // try to eval input-code","                try {","                    /*jslint evil: true*/","                    eval(document.querySelector('#inputTextareaEval1').value);","                } catch (errorCaught) {","                    console.error(errorCaught);","                }","            }","        };","        // log stderr and stdout to #outputTextareaStdout1","        ['error', 'log'].forEach(function (key) {","            console[key + '_original'] = console[key];","            console[key] = function () {","                var element;","                console[key + '_original'].apply(console, arguments);","                element = document.querySelector('#outputTextareaStdout1');","                if (!element) {","                    return;","                }","                // append text to #outputTextareaStdout1","                element.value += Array.from(arguments).map(function (arg) {","                    return typeof arg === 'string'","                        ? arg","                        : JSON.stringify(arg, null, 4);","                }).join(' ') + '\\n';","                // scroll textarea to bottom","                element.scrollTop = element.scrollHeight;","            };","        });","        // init event-handling","        ['change', 'click', 'keyup'].forEach(function (event) {","            Array.from(document.querySelectorAll('.on' + event)).forEach(function (element) {","                element.addEventListener(event, local.testRunBrowser);","            });","        });","        // run tests","        local.testRunBrowser();","        break;","","","","    // run node js-env code - init-after","    /* istanbul ignore next */","    case 'node':","        // export local","        module.exports = local;","        // require modules","        local.fs = require('fs');","        local.http = require('http');","        local.url = require('url');","        // init assets","        local.assetsDict = local.assetsDict || {};","        /* jslint-ignore-begin */","        local.assetsDict['/assets.index.template.html'] = '\\","<!doctype html>\\n\\","<html lang=\"en\">\\n\\","<head>\\n\\","<meta charset=\"UTF-8\">\\n\\","<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\\n\\","<title>{{env.npm_package_name}} (v{{env.npm_package_version}})</title>\\n\\","<style>\\n\\","/*csslint\\n\\","    box-sizing: false,\\n\\","    universal-selector: false\\n\\","*/\\n\\","* {\\n\\","    box-sizing: border-box;\\n\\","}\\n\\","body {\\n\\","    background: #dde;\\n\\","    font-family: Arial, Helvetica, sans-serif;\\n\\","    margin: 2rem;\\n\\","}\\n\\","body > * {\\n\\","    margin-bottom: 1rem;\\n\\","}\\n\\",".utility2FooterDiv {\\n\\","    margin-top: 20px;\\n\\","    text-align: center;\\n\\","}\\n\\","</style>\\n\\","<style>\\n\\","/*csslint\\n\\","*/\\n\\","textarea {\\n\\","    font-family: monospace;\\n\\","    height: 10rem;\\n\\","    width: 100%;\\n\\","}\\n\\","textarea[readonly] {\\n\\","    background: #ddd;\\n\\","}\\n\\","</style>\\n\\","</head>\\n\\","<body>\\n\\","<!-- utility2-comment\\n\\","<div id=\"ajaxProgressDiv1\" style=\"background: #d00; height: 2px; left: 0; margin: 0; padding: 0; position: fixed; top: 0; transition: background 0.5s, width 1.5s; width: 25%;\"></div>\\n\\","utility2-comment -->\\n\\","<h1>\\n\\","<!-- utility2-comment\\n\\","    <a\\n\\","        {{#if env.npm_package_homepage}}\\n\\","        href=\"{{env.npm_package_homepage}}\"\\n\\","        {{/if env.npm_package_homepage}}\\n\\","        target=\"_blank\"\\n\\","    >\\n\\","utility2-comment -->\\n\\","        {{env.npm_package_name}} (v{{env.npm_package_version}})\\n\\","<!-- utility2-comment\\n\\","    </a>\\n\\","utility2-comment -->\\n\\","</h1>\\n\\","<h3>{{env.npm_package_description}}</h3>\\n\\","<!-- utility2-comment\\n\\","<h4><a download href=\"assets.app.js\">download standalone app</a></h4>\\n\\","<button class=\"onclick onreset\" id=\"testRunButton1\">run internal test</button><br>\\n\\","<div id=\"testReportDiv1\" style=\"display: none;\"></div>\\n\\","utility2-comment -->\\n\\","\\n\\","\\n\\","\\n\\","<label>stderr and stdout</label>\\n\\","<textarea class=\"resettable\" id=\"outputTextareaStdout1\" readonly></textarea>\\n\\","<!-- utility2-comment\\n\\","{{#if isRollup}}\\n\\","<script src=\"assets.app.js\"></script>\\n\\","{{#unless isRollup}}\\n\\","utility2-comment -->\\n\\","<script src=\"assets.utility2.rollup.js\"></script>\\n\\","<script src=\"jsonp.utility2._stateInit?callback=window.utility2._stateInit\"></script>\\n\\","<script src=\"assets.npmtest_keystone.rollup.js\"></script>\\n\\","<script src=\"assets.example.js\"></script>\\n\\","<script src=\"assets.test.js\"></script>\\n\\","<!-- utility2-comment\\n\\","{{/if isRollup}}\\n\\","utility2-comment -->\\n\\","<div class=\"utility2FooterDiv\">\\n\\","    [ this app was created with\\n\\","    <a href=\"https://github.com/kaizhu256/node-utility2\" target=\"_blank\">utility2</a>\\n\\","    ]\\n\\","</div>\\n\\","</body>\\n\\","</html>\\n\\","';","        /* jslint-ignore-end */","        if (local.templateRender) {","            local.assetsDict['/'] = local.templateRender(","                local.assetsDict['/assets.index.template.html'],","                {","                    env: local.objectSetDefault(local.env, {","                        npm_package_description: 'the greatest app in the world!',","                        npm_package_name: 'my-app',","                        npm_package_nameAlias: 'my_app',","                        npm_package_version: '0.0.1'","                    })","                }","            );","        } else {","            local.assetsDict['/'] = local.assetsDict['/assets.index.template.html']","                .replace((/\\{\\{env\\.(\\w+?)\\}\\}/g), function (match0, match1) {","                    // jslint-hack","                    String(match0);","                    switch (match1) {","                    case 'npm_package_description':","                        return 'the greatest app in the world!';","                    case 'npm_package_name':","                        return 'my-app';","                    case 'npm_package_nameAlias':","                        return 'my_app';","                    case 'npm_package_version':","                        return '0.0.1';","                    }","                });","        }","        // run the cli","        if (local.global.utility2_rollup || module !== require.main) {","            break;","        }","        local.assetsDict['/assets.example.js'] =","            local.assetsDict['/assets.example.js'] ||","            local.fs.readFileSync(__filename, 'utf8');","        // bug-workaround - long $npm_package_buildCustomOrg","        /* jslint-ignore-begin */","        local.assetsDict['/assets.npmtest_keystone.rollup.js'] =","            local.assetsDict['/assets.npmtest_keystone.rollup.js'] ||","            local.fs.readFileSync(","                local.npmtest_keystone.__dirname + '/lib.npmtest_keystone.js',","                'utf8'","            ).replace((/^#!/), '//');","        /* jslint-ignore-end */","        local.assetsDict['/favicon.ico'] = local.assetsDict['/favicon.ico'] || '';","        // if $npm_config_timeout_exit exists,","        // then exit this process after $npm_config_timeout_exit ms","        if (Number(process.env.npm_config_timeout_exit)) {","            setTimeout(process.exit, Number(process.env.npm_config_timeout_exit));","        }","        // start server","        if (local.global.utility2_serverHttp1) {","            break;","        }","        process.env.PORT = process.env.PORT || '8081';","        console.error('server starting on port ' + process.env.PORT);","        local.http.createServer(function (request, response) {","            request.urlParsed = local.url.parse(request.url);","            if (local.assetsDict[request.urlParsed.pathname] !== undefined) {","                response.end(local.assetsDict[request.urlParsed.pathname]);","                return;","            }","            response.statusCode = 404;","            response.end();","        }).listen(process.env.PORT);","        break;","    }","}());",""],"l":{"26":2,"28":2,"33":2,"35":2,"37":2,"38":2,"39":2,"44":1,"51":2,"55":2,"59":2,"61":2,"69":1,"70":2,"76":2,"79":2,"82":2,"83":2,"85":1,"89":2,"92":1,"93":1,"94":1,"96":1,"97":1,"100":1,"101":1,"103":1,"106":1,"108":2,"114":1,"116":1,"118":1,"123":1,"124":2,"125":2,"126":3,"127":3,"128":3,"129":3,"130":1,"133":3,"134":3,"139":3,"143":1,"144":3,"145":1,"149":1,"150":1,"158":1,"160":1,"161":1,"162":1,"164":1,"166":1,"258":1,"259":1,"271":1,"274":6,"275":6,"277":1,"279":2,"281":1,"283":2,"288":1,"289":1,"291":1,"296":1,"303":1,"306":1,"307":1,"310":1,"311":1,"313":1,"314":1,"315":1,"316":1,"317":1,"318":1,"319":1,"321":1,"322":1,"324":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"26":1,"27":1,"28":1,"29":1,"30":1,"31":1,"32":1,"33":1,"34":1,"35":1,"36":1,"37":1,"38":1,"39":1,"40":0,"41":1,"42":0,"43":1,"44":0,"45":1,"46":1,"47":1,"48":0,"49":0,"50":0,"51":0,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":0,"70":0,"71":1,"72":1,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":1,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":1,"105":1,"106":0,"107":0,"108":0,"109":1,"110":1},"b":{"1":[1,0],"2":[1,0],"3":[1,0],"4":[1,1,1],"5":[1,1],"6":[0,1],"7":[1,1],"8":[1,1],"9":[0,1],"10":[1,0,0],"11":[0,1],"12":[1,0],"13":[0,1],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0]},"f":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"(anonymous_1)","line":14,"loc":{"start":{"line":14,"column":18},"end":{"line":14,"column":38}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":15},"end":{"line":26,"column":26}}},"3":{"name":"(anonymous_3)","line":96,"loc":{"start":{"line":96,"column":33},"end":{"line":96,"column":48}}},"4":{"name":"(anonymous_4)","line":129,"loc":{"start":{"line":129,"column":28},"end":{"line":129,"column":42}}},"5":{"name":"(anonymous_5)","line":168,"loc":{"start":{"line":168,"column":28},"end":{"line":168,"column":46}}},"6":{"name":"(anonymous_6)","line":172,"loc":{"start":{"line":172,"column":16},"end":{"line":172,"column":35}}},"7":{"name":"(anonymous_7)","line":176,"loc":{"start":{"line":176,"column":35},"end":{"line":176,"column":50}}},"8":{"name":"(anonymous_8)","line":206,"loc":{"start":{"line":206,"column":34},"end":{"line":206,"column":53}}},"9":{"name":"(anonymous_9)","line":208,"loc":{"start":{"line":208,"column":30},"end":{"line":208,"column":43}}},"10":{"name":"(anonymous_10)","line":212,"loc":{"start":{"line":212,"column":33},"end":{"line":212,"column":46}}},"11":{"name":"(anonymous_11)","line":229,"loc":{"start":{"line":229,"column":33},"end":{"line":229,"column":53}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":33}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":23}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":42}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":38}},"7":{"start":{"line":14,"column":0},"end":{"line":18,"column":61}},"8":{"start":{"line":15,"column":1},"end":{"line":15,"column":39}},"9":{"start":{"line":16,"column":1},"end":{"line":16,"column":13}},"10":{"start":{"line":17,"column":1},"end":{"line":17,"column":29}},"11":{"start":{"line":26,"column":0},"end":{"line":91,"column":2}},"12":{"start":{"line":27,"column":1},"end":{"line":27,"column":155}},"13":{"start":{"line":28,"column":1},"end":{"line":28,"column":17}},"14":{"start":{"line":29,"column":1},"end":{"line":29,"column":17}},"15":{"start":{"line":30,"column":1},"end":{"line":40,"column":3}},"16":{"start":{"line":41,"column":1},"end":{"line":41,"column":22}},"17":{"start":{"line":44,"column":1},"end":{"line":44,"column":24}},"18":{"start":{"line":47,"column":1},"end":{"line":47,"column":56}},"19":{"start":{"line":49,"column":1},"end":{"line":49,"column":73}},"20":{"start":{"line":50,"column":1},"end":{"line":50,"column":89}},"21":{"start":{"line":51,"column":1},"end":{"line":51,"column":40}},"22":{"start":{"line":53,"column":1},"end":{"line":53,"column":34}},"23":{"start":{"line":54,"column":1},"end":{"line":54,"column":44}},"24":{"start":{"line":55,"column":1},"end":{"line":55,"column":66}},"25":{"start":{"line":56,"column":1},"end":{"line":56,"column":42}},"26":{"start":{"line":57,"column":1},"end":{"line":57,"column":44}},"27":{"start":{"line":59,"column":1},"end":{"line":59,"column":54}},"28":{"start":{"line":60,"column":1},"end":{"line":60,"column":79}},"29":{"start":{"line":62,"column":1},"end":{"line":62,"column":88}},"30":{"start":{"line":63,"column":1},"end":{"line":63,"column":91}},"31":{"start":{"line":64,"column":1},"end":{"line":64,"column":62}},"32":{"start":{"line":65,"column":1},"end":{"line":65,"column":60}},"33":{"start":{"line":66,"column":1},"end":{"line":66,"column":66}},"34":{"start":{"line":67,"column":1},"end":{"line":67,"column":50}},"35":{"start":{"line":68,"column":1},"end":{"line":68,"column":46}},"36":{"start":{"line":69,"column":1},"end":{"line":69,"column":64}},"37":{"start":{"line":70,"column":1},"end":{"line":70,"column":60}},"38":{"start":{"line":71,"column":1},"end":{"line":71,"column":62}},"39":{"start":{"line":73,"column":1},"end":{"line":75,"column":2}},"40":{"start":{"line":74,"column":2},"end":{"line":74,"column":146}},"41":{"start":{"line":77,"column":1},"end":{"line":79,"column":2}},"42":{"start":{"line":78,"column":2},"end":{"line":78,"column":122}},"43":{"start":{"line":81,"column":1},"end":{"line":84,"column":2}},"44":{"start":{"line":83,"column":2},"end":{"line":83,"column":38}},"45":{"start":{"line":87,"column":1},"end":{"line":90,"column":3}},"46":{"start":{"line":93,"column":0},"end":{"line":93,"column":62}},"47":{"start":{"line":96,"column":0},"end":{"line":104,"column":2}},"48":{"start":{"line":97,"column":1},"end":{"line":97,"column":44}},"49":{"start":{"line":99,"column":1},"end":{"line":101,"column":2}},"50":{"start":{"line":100,"column":2},"end":{"line":100,"column":32}},"51":{"start":{"line":103,"column":1},"end":{"line":103,"column":60}},"52":{"start":{"line":107,"column":0},"end":{"line":107,"column":83}},"53":{"start":{"line":108,"column":0},"end":{"line":108,"column":59}},"54":{"start":{"line":109,"column":0},"end":{"line":109,"column":67}},"55":{"start":{"line":110,"column":0},"end":{"line":110,"column":77}},"56":{"start":{"line":111,"column":0},"end":{"line":111,"column":61}},"57":{"start":{"line":112,"column":0},"end":{"line":112,"column":53}},"58":{"start":{"line":113,"column":0},"end":{"line":113,"column":59}},"59":{"start":{"line":114,"column":0},"end":{"line":114,"column":53}},"60":{"start":{"line":115,"column":0},"end":{"line":115,"column":55}},"61":{"start":{"line":116,"column":0},"end":{"line":116,"column":75}},"62":{"start":{"line":117,"column":0},"end":{"line":117,"column":61}},"63":{"start":{"line":118,"column":0},"end":{"line":118,"column":57}},"64":{"start":{"line":119,"column":0},"end":{"line":119,"column":57}},"65":{"start":{"line":120,"column":0},"end":{"line":120,"column":55}},"66":{"start":{"line":121,"column":0},"end":{"line":121,"column":71}},"67":{"start":{"line":124,"column":0},"end":{"line":126,"column":2}},"68":{"start":{"line":129,"column":0},"end":{"line":133,"column":2}},"69":{"start":{"line":130,"column":1},"end":{"line":132,"column":2}},"70":{"start":{"line":131,"column":2},"end":{"line":131,"column":65}},"71":{"start":{"line":140,"column":0},"end":{"line":140,"column":57}},"72":{"start":{"line":143,"column":0},"end":{"line":143,"column":40}},"73":{"start":{"line":144,"column":0},"end":{"line":144,"column":48}},"74":{"start":{"line":145,"column":0},"end":{"line":145,"column":51}},"75":{"start":{"line":146,"column":0},"end":{"line":146,"column":29}},"76":{"start":{"line":147,"column":0},"end":{"line":147,"column":38}},"77":{"start":{"line":148,"column":0},"end":{"line":148,"column":38}},"78":{"start":{"line":150,"column":0},"end":{"line":150,"column":44}},"79":{"start":{"line":151,"column":0},"end":{"line":153,"column":2}},"80":{"start":{"line":154,"column":0},"end":{"line":154,"column":23}},"81":{"start":{"line":168,"column":0},"end":{"line":199,"column":2}},"82":{"start":{"line":170,"column":1},"end":{"line":170,"column":63}},"83":{"start":{"line":172,"column":1},"end":{"line":196,"column":3}},"84":{"start":{"line":174,"column":2},"end":{"line":174,"column":20}},"85":{"start":{"line":176,"column":2},"end":{"line":193,"column":5}},"86":{"start":{"line":178,"column":3},"end":{"line":179,"column":30}},"87":{"start":{"line":182,"column":3},"end":{"line":191,"column":4}},"88":{"start":{"line":183,"column":4},"end":{"line":183,"column":38}},"89":{"start":{"line":186,"column":4},"end":{"line":186,"column":33}},"90":{"start":{"line":187,"column":4},"end":{"line":187,"column":40}},"91":{"start":{"line":188,"column":4},"end":{"line":190,"column":5}},"92":{"start":{"line":189,"column":5},"end":{"line":189,"column":38}},"93":{"start":{"line":195,"column":2},"end":{"line":195,"column":18}},"94":{"start":{"line":198,"column":1},"end":{"line":198,"column":30}},"95":{"start":{"line":206,"column":0},"end":{"line":219,"column":2}},"96":{"start":{"line":207,"column":1},"end":{"line":207,"column":17}},"97":{"start":{"line":208,"column":1},"end":{"line":218,"column":4}},"98":{"start":{"line":209,"column":2},"end":{"line":211,"column":3}},"99":{"start":{"line":210,"column":3},"end":{"line":210,"column":17}},"100":{"start":{"line":212,"column":2},"end":{"line":217,"column":5}},"101":{"start":{"line":213,"column":3},"end":{"line":215,"column":4}},"102":{"start":{"line":214,"column":4},"end":{"line":214,"column":18}},"103":{"start":{"line":216,"column":3},"end":{"line":216,"column":43}},"104":{"start":{"line":228,"column":0},"end":{"line":228,"column":32}},"105":{"start":{"line":229,"column":0},"end":{"line":234,"column":2}},"106":{"start":{"line":230,"column":1},"end":{"line":233,"column":2}},"107":{"start":{"line":231,"column":2},"end":{"line":231,"column":70}},"108":{"start":{"line":232,"column":2},"end":{"line":232,"column":71}},"109":{"start":{"line":242,"column":0},"end":{"line":242,"column":53}},"110":{"start":{"line":246,"column":0},"end":{"line":246,"column":44}}},"branchMap":{"1":{"line":18,"type":"cond-expr","locations":[{"start":{"line":18,"column":19},"end":{"line":18,"column":41}},{"start":{"line":18,"column":44},"end":{"line":18,"column":59}}]},"2":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":17},"end":{"line":47,"column":37}},{"start":{"line":47,"column":41},"end":{"line":47,"column":54}}]},"3":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":18},"end":{"line":49,"column":34}},{"start":{"line":49,"column":38},"end":{"line":49,"column":71}}]},"4":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":18},"end":{"line":50,"column":34}},{"start":{"line":50,"column":38},"end":{"line":50,"column":52}},{"start":{"line":50,"column":56},"end":{"line":50,"column":87}}]},"5":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":22},"end":{"line":55,"column":42}},{"start":{"line":55,"column":46},"end":{"line":55,"column":64}}]},"6":{"line":60,"type":"cond-expr","locations":[{"start":{"line":60,"column":65},"end":{"line":60,"column":69}},{"start":{"line":60,"column":72},"end":{"line":60,"column":77}}]},"7":{"line":62,"type":"binary-expr","locations":[{"start":{"line":62,"column":29},"end":{"line":62,"column":56}},{"start":{"line":62,"column":60},"end":{"line":62,"column":86}}]},"8":{"line":63,"type":"binary-expr","locations":[{"start":{"line":63,"column":30},"end":{"line":63,"column":58}},{"start":{"line":63,"column":62},"end":{"line":63,"column":89}}]},"9":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},{"start":{"line":73,"column":1},"end":{"line":73,"column":1}}]},"10":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":5},"end":{"line":73,"column":26}},{"start":{"line":73,"column":30},"end":{"line":73,"column":48}},{"start":{"line":73,"column":52},"end":{"line":73,"column":73}}]},"11":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},{"start":{"line":77,"column":1},"end":{"line":77,"column":1}}]},"12":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":5},"end":{"line":77,"column":38}},{"start":{"line":77,"column":42},"end":{"line":77,"column":78}}]},"13":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},{"start":{"line":81,"column":1},"end":{"line":81,"column":1}}]},"14":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},{"start":{"line":99,"column":1},"end":{"line":99,"column":1}}]},"15":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},{"start":{"line":130,"column":1},"end":{"line":130,"column":1}}]},"16":{"line":182,"type":"if","locations":[{"start":{"line":182,"column":3},"end":{"line":182,"column":3}},{"start":{"line":182,"column":3},"end":{"line":182,"column":3}}]},"17":{"line":188,"type":"if","locations":[{"start":{"line":188,"column":4},"end":{"line":188,"column":4}},{"start":{"line":188,"column":4},"end":{"line":188,"column":4}}]},"18":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":2},"end":{"line":209,"column":2}},{"start":{"line":209,"column":2},"end":{"line":209,"column":2}}]},"19":{"line":213,"type":"if","locations":[{"start":{"line":213,"column":3},"end":{"line":213,"column":3}},{"start":{"line":213,"column":3},"end":{"line":213,"column":3}}]},"20":{"line":230,"type":"if","locations":[{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},{"start":{"line":230,"column":1},"end":{"line":230,"column":1}}]}},"code":["var _ = require('underscore');","var express = require('express');","var fs = require('fs');","var grappling = require('grappling-hook');","var path = require('path');","var utils = require('keystone-utils');","","/**"," * Don't use process.cwd() as it breaks module encapsulation"," * Instead, let's use module.parent if it's present, or the module itself if there is no parent (probably testing keystone directly if that's the case)"," * This way, the consuming app/module can be an embedded node_module and path resolutions will still work"," * (process.cwd() breaks module encapsulation if the consuming app/module is itself a node_module)"," */","var moduleRoot = (function(_rootPath) {","\tvar parts = _rootPath.split(path.sep);","\tparts.pop(); //get rid of /node_modules from the end of the path","\treturn parts.join(path.sep);","})(module.parent ? module.parent.paths[0] : module.paths[0]);","","","/**"," * Keystone Class"," *"," * @api public"," */","var Keystone = function() {","\tgrappling.mixin(this).allowHooks('pre:static', 'pre:bodyparser', 'pre:session', 'pre:routes', 'pre:render', 'updates', 'signout', 'signin', 'pre:logger');","\tthis.lists = {};","\tthis.paths = {};","\tthis._options = {","\t\t'name': 'Keystone',","\t\t'brand': 'Keystone',","\t\t'compress': true,","\t\t'headless': false,","\t\t'logger': ':method :url :status :response-time ms',","\t\t'auto update': false,","\t\t'model prefix': null,","\t\t'module root': moduleRoot,","\t\t'frame guard': 'sameorigin'","\t};","\tthis._redirects = {};","","\t// expose express","\tthis.express = express;","","\t// init environment defaults","\tthis.set('env', process.env.NODE_ENV || 'development');","","\tthis.set('port', process.env.PORT || process.env.OPENSHIFT_NODEJS_PORT);","\tthis.set('host', process.env.HOST || process.env.IP || process.env.OPENSHIFT_NODEJS_IP);","\tthis.set('listen', process.env.LISTEN);","","\tthis.set('ssl', process.env.SSL);","\tthis.set('ssl port', process.env.SSL_PORT);","\tthis.set('ssl host', process.env.SSL_HOST || process.env.SSL_IP);","\tthis.set('ssl key', process.env.SSL_KEY);","\tthis.set('ssl cert', process.env.SSL_CERT);","","\tthis.set('cookie secret', process.env.COOKIE_SECRET);","\tthis.set('cookie signin', (this.get('env') === 'development') ? true : false);","","\tthis.set('embedly api key', process.env.EMBEDLY_API_KEY || process.env.EMBEDLY_APIKEY);","\tthis.set('mandrill api key', process.env.MANDRILL_API_KEY || process.env.MANDRILL_APIKEY);","\tthis.set('mandrill username', process.env.MANDRILL_USERNAME);","\tthis.set('google api key', process.env.GOOGLE_BROWSER_KEY);","\tthis.set('google server api key', process.env.GOOGLE_SERVER_KEY);","\tthis.set('ga property', process.env.GA_PROPERTY);","\tthis.set('ga domain', process.env.GA_DOMAIN);","\tthis.set('chartbeat property', process.env.CHARTBEAT_PROPERTY);","\tthis.set('chartbeat domain', process.env.CHARTBEAT_DOMAIN);","\tthis.set('allowed ip ranges', process.env.ALLOWED_IP_RANGES);","","\tif (process.env.S3_BUCKET && process.env.S3_KEY && process.env.S3_SECRET) {","\t\tthis.set('s3 config', { bucket: process.env.S3_BUCKET, key: process.env.S3_KEY, secret: process.env.S3_SECRET, region: process.env.S3_REGION });","\t}","","\tif (process.env.AZURE_STORAGE_ACCOUNT && process.env.AZURE_STORAGE_ACCESS_KEY) {","\t\tthis.set('azurefile config', { account: process.env.AZURE_STORAGE_ACCOUNT, key: process.env.AZURE_STORAGE_ACCESS_KEY });","\t}","","\tif (process.env.CLOUDINARY_URL) {","\t\t// process.env.CLOUDINARY_URL is processed by the cloudinary package when this is set","\t\tthis.set('cloudinary config', true);","\t}","","\t// Attach middleware packages, bound to this instance","\tthis.middleware = {","\t\tapi: require('./lib/middleware/api')(this),","\t\tcors: require('./lib/middleware/cors')(this)","\t};","};","","_.extend(Keystone.prototype, require('./lib/core/options')());","","","Keystone.prototype.prefixModel = function (key) {","\tvar modelPrefix = this.get('model prefix');","","\tif (modelPrefix) {","\t\tkey = modelPrefix + '_' + key;","\t}","","\treturn require('mongoose/lib/utils').toCollectionName(key);","};","","/* Attach core functionality to Keystone.prototype */","Keystone.prototype.bindEmailTestRoutes = require('./lib/core/bindEmailTestRoutes');","Keystone.prototype.connect = require('./lib/core/connect');","Keystone.prototype.createItems = require('./lib/core/createItems');","Keystone.prototype.getOrphanedLists = require('./lib/core/getOrphanedLists');","Keystone.prototype.importer = require('./lib/core/importer');","Keystone.prototype.init = require('./lib/core/init');","Keystone.prototype.initNav = require('./lib/core/initNav');","Keystone.prototype.list = require('./lib/core/list');","Keystone.prototype.mount = require('./lib/core/mount');","Keystone.prototype.populateRelated = require('./lib/core/populateRelated');","Keystone.prototype.redirect = require('./lib/core/redirect');","Keystone.prototype.render = require('./lib/core/render');","Keystone.prototype.routes = require('./lib/core/routes');","Keystone.prototype.start = require('./lib/core/start');","Keystone.prototype.wrapHTMLError = require('./lib/core/wrapHTMLError');","","/* Expose Admin UI App */","Keystone.prototype.adminApp = {","\tstaticRouter: require('./admin/app/static')","};","","/* Legacy Attach Mechanisms */","Keystone.prototype.static = function(app) {","\tif (!this.get('headless')) {","\t\tapp.use('/keystone', Keystone.prototype.adminApp.staticRouter);","\t}","};","","/**"," * The exports object is an instance of Keystone."," *"," * @api public"," */","var keystone = module.exports = exports = new Keystone();","","// Expose modules and Classes","keystone.Email = require('./lib/email');","keystone.Field = require('./fields/types/Type');","keystone.Field.Types = require('./lib/fieldTypes');","keystone.Keystone = Keystone;","keystone.List = require('./lib/list');","keystone.View = require('./lib/view');","","keystone.content = require('./lib/content');","keystone.security = {","\tcsrf: require('./lib/security/csrf')","};","keystone.utils = utils;","","/**"," * returns all .js modules (recursively) in the path specified, relative"," * to the module root (where the keystone project is being consumed from)."," *"," * ####Example:"," *"," *     var models = keystone.import('models');"," *"," * @param {String} dirname"," * @api public"," */","","Keystone.prototype.import = function(dirname) {","","\tvar initialPath = path.join(this.get('module root'), dirname);","","\tvar doImport = function(fromPath) {","","\t\tvar imported = {};","","\t\tfs.readdirSync(fromPath).forEach(function(name) {","","\t\t\tvar fsPath = path.join(fromPath, name),","\t\t\tinfo = fs.statSync(fsPath);","","\t\t\t// recur","\t\t\tif (info.isDirectory()) {","\t\t\t\timported[name] = doImport(fsPath);","\t\t\t} else {","\t\t\t\t// only import files that we can `require`","\t\t\t\tvar ext = path.extname(name);","\t\t\t\tvar base = path.basename(name, ext);","\t\t\t\tif (require.extensions[ext]) {","\t\t\t\t\timported[base] = require(fsPath);","\t\t\t\t}","\t\t\t}","","\t\t});","","\t\treturn imported;","\t};","","\treturn doImport(initialPath);","};","","","/**"," * Applies Application updates"," */","","Keystone.prototype.applyUpdates = function(callback) {","\tvar self = this;","\tself.callHook('pre:updates', function(err){","\t\tif(err){","\t\t\tcallback(err);","\t\t}","\t\trequire('./lib/updates').apply(function(err){","\t\t\tif(err){","\t\t\t\tcallback(err);","\t\t\t}","\t\t\tself.callHook('post:updates', callback);","\t\t});","\t});","};","","","/**"," * Logs a configuration error to the console"," *"," * @api public"," */","","Keystone.prototype.console = {};","Keystone.prototype.console.err = function(type, msg) {","\tif (keystone.get('logger')) {","\t\tvar dashes = '\\n------------------------------------------------\\n';","\t\tconsole.log(dashes + 'KeystoneJS: ' + type + ':\\n\\n' + msg + dashes);","\t}","};","","/**"," * Keystone version"," *"," * @api public"," */","","keystone.version = require('./package.json').version;","","","// Expose Modules","keystone.session = require('./lib/session');",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"14":1,"15":1,"16":1,"17":1,"26":1,"27":1,"28":1,"29":1,"30":1,"41":1,"44":1,"47":1,"49":1,"50":1,"51":1,"53":1,"54":1,"55":1,"56":1,"57":1,"59":1,"60":1,"62":1,"63":1,"64":1,"65":1,"66":1,"67":1,"68":1,"69":1,"70":1,"71":1,"73":1,"74":0,"77":1,"78":0,"81":1,"83":0,"87":1,"93":1,"96":1,"97":0,"99":0,"100":0,"103":0,"107":1,"108":1,"109":1,"110":1,"111":1,"112":1,"113":1,"114":1,"115":1,"116":1,"117":1,"118":1,"119":1,"120":1,"121":1,"124":1,"129":1,"130":0,"131":0,"140":1,"143":1,"144":1,"145":1,"146":1,"147":1,"148":1,"150":1,"151":1,"154":1,"168":1,"170":0,"172":0,"174":0,"176":0,"178":0,"182":0,"183":0,"186":0,"187":0,"188":0,"189":0,"195":0,"198":0,"206":1,"207":0,"208":0,"209":0,"210":0,"212":0,"213":0,"214":0,"216":0,"228":1,"229":1,"230":0,"231":0,"232":0,"242":1,"246":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/index.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":50}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":50}}},"branchMap":{},"code":["exports = module.exports = require('./lib/index');","exports.htmlStringify = require('html-stringify');",""],"l":{"1":1,"2":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/index.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":253,"12":253,"13":253,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":0,"21":0,"22":1,"23":0,"24":0,"25":1,"26":0,"27":1,"28":0,"29":1,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":1,"37":0,"38":1,"39":0,"40":1,"41":0,"42":1,"43":0,"44":1,"45":0,"46":0,"47":0,"48":0,"49":1,"50":0,"51":0,"52":0,"53":0,"54":0,"55":1,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":1,"67":1,"68":0,"69":0,"70":0,"71":1,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":1,"80":1,"81":0,"82":1,"83":0,"84":0,"85":0,"86":0,"87":0,"88":1,"89":0,"90":0,"91":0,"92":0,"93":0,"94":1,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":1,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":1,"118":0,"119":0,"120":0,"121":0,"122":0,"123":1,"124":0,"125":1,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":1,"138":0,"139":0,"140":0,"141":0,"142":0,"143":1,"144":0,"145":0,"146":0,"147":0,"148":0,"149":1,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":1,"161":0,"162":1,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":1,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":1,"177":0,"178":0,"179":1,"180":0,"181":0,"182":0,"183":0,"184":0,"185":1,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":1,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":1,"218":0,"219":1,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":1,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":1,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":1,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":1,"261":0,"262":1,"263":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0],"87":[0,0],"88":[0,0],"89":[0,0],"90":[0,0],"91":[0,0],"92":[0,0],"93":[0,0],"94":[0,0],"95":[0,0],"96":[0,0],"97":[0,0],"98":[0,0],"99":[0,0],"100":[0,0],"101":[0,0]},"f":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0},"fnMap":{"1":{"name":"(anonymous_1)","line":25,"loc":{"start":{"line":25,"column":1},"end":{"line":25,"column":13}}},"2":{"name":"compact","line":43,"loc":{"start":{"line":43,"column":0},"end":{"line":43,"column":22}}},"3":{"name":"(anonymous_3)","line":44,"loc":{"start":{"line":44,"column":19},"end":{"line":44,"column":31}}},"4":{"name":"deepClone","line":49,"loc":{"start":{"line":49,"column":0},"end":{"line":49,"column":24}}},"5":{"name":"isFunction","line":62,"loc":{"start":{"line":62,"column":38},"end":{"line":62,"column":64}}},"6":{"name":"isObject","line":74,"loc":{"start":{"line":74,"column":34},"end":{"line":74,"column":58}}},"7":{"name":"isValidObjectId","line":86,"loc":{"start":{"line":86,"column":48},"end":{"line":86,"column":79}}},"8":{"name":"isArray","line":103,"loc":{"start":{"line":103,"column":32},"end":{"line":103,"column":55}}},"9":{"name":"isDate","line":115,"loc":{"start":{"line":115,"column":30},"end":{"line":115,"column":52}}},"10":{"name":"isString","line":127,"loc":{"start":{"line":127,"column":34},"end":{"line":127,"column":58}}},"11":{"name":"isNumber","line":139,"loc":{"start":{"line":139,"column":34},"end":{"line":139,"column":58}}},"12":{"name":"isEmail","line":153,"loc":{"start":{"line":153,"column":32},"end":{"line":153,"column":55}}},"13":{"name":"isDataURL","line":165,"loc":{"start":{"line":165,"column":36},"end":{"line":165,"column":61}}},"14":{"name":"options","line":180,"loc":{"start":{"line":180,"column":32},"end":{"line":180,"column":65}}},"15":{"name":"(anonymous_15)","line":183,"loc":{"start":{"line":183,"column":26},"end":{"line":183,"column":41}}},"16":{"name":"optionsMap","line":199,"loc":{"start":{"line":199,"column":38},"end":{"line":199,"column":81}}},"17":{"name":"(anonymous_17)","line":218,"loc":{"start":{"line":218,"column":15},"end":{"line":218,"column":26}}},"18":{"name":"defer","line":227,"loc":{"start":{"line":227,"column":16},"end":{"line":227,"column":36}}},"19":{"name":"(anonymous_19)","line":229,"loc":{"start":{"line":229,"column":18},"end":{"line":229,"column":30}}},"20":{"name":"bindMethods","line":242,"loc":{"start":{"line":242,"column":40},"end":{"line":242,"column":74}}},"21":{"name":"number","line":276,"loc":{"start":{"line":276,"column":30},"end":{"line":276,"column":52}}},"22":{"name":"escapeRegExp","line":288,"loc":{"start":{"line":288,"column":42},"end":{"line":288,"column":70}}},"23":{"name":"escapeString","line":302,"loc":{"start":{"line":302,"column":42},"end":{"line":302,"column":70}}},"24":{"name":"stripDiacritics","line":316,"loc":{"start":{"line":316,"column":48},"end":{"line":316,"column":79}}},"25":{"name":"transliterate","line":334,"loc":{"start":{"line":334,"column":44},"end":{"line":334,"column":73}}},"26":{"name":"slug","line":362,"loc":{"start":{"line":362,"column":26},"end":{"line":362,"column":60}}},"27":{"name":"singular","line":379,"loc":{"start":{"line":379,"column":34},"end":{"line":379,"column":58}}},"28":{"name":"plural","line":396,"loc":{"start":{"line":396,"column":30},"end":{"line":396,"column":62}}},"29":{"name":"upcase","line":420,"loc":{"start":{"line":420,"column":30},"end":{"line":420,"column":52}}},"30":{"name":"downcase","line":434,"loc":{"start":{"line":434,"column":34},"end":{"line":434,"column":58}}},"31":{"name":"titlecase","line":448,"loc":{"start":{"line":448,"column":36},"end":{"line":448,"column":61}}},"32":{"name":"camelcase","line":470,"loc":{"start":{"line":470,"column":36},"end":{"line":470,"column":65}}},"33":{"name":"decodeHTMLEntities","line":482,"loc":{"start":{"line":482,"column":54},"end":{"line":482,"column":88}}},"34":{"name":"(anonymous_34)","line":485,"loc":{"start":{"line":485,"column":37},"end":{"line":485,"column":59}}},"35":{"name":"encodeHTMLEntities","line":498,"loc":{"start":{"line":498,"column":54},"end":{"line":498,"column":88}}},"36":{"name":"(anonymous_36)","line":501,"loc":{"start":{"line":501,"column":40},"end":{"line":501,"column":57}}},"37":{"name":"stringify","line":515,"loc":{"start":{"line":515,"column":36},"end":{"line":515,"column":61}}},"38":{"name":"(anonymous_38)","line":516,"loc":{"start":{"line":516,"column":67},"end":{"line":516,"column":80}}},"39":{"name":"textToHTML","line":529,"loc":{"start":{"line":529,"column":38},"end":{"line":529,"column":64}}},"40":{"name":"htmlToText","line":556,"loc":{"start":{"line":556,"column":38},"end":{"line":556,"column":64}}},"41":{"name":"cropString","line":593,"loc":{"start":{"line":593,"column":38},"end":{"line":593,"column":95}}},"42":{"name":"cropHTMLString","line":619,"loc":{"start":{"line":619,"column":46},"end":{"line":619,"column":107}}},"43":{"name":"keyToLabel","line":631,"loc":{"start":{"line":631,"column":38},"end":{"line":631,"column":64}}},"44":{"name":"keyToPath","line":655,"loc":{"start":{"line":655,"column":36},"end":{"line":655,"column":69}}},"45":{"name":"keyToProperty","line":674,"loc":{"start":{"line":674,"column":44},"end":{"line":674,"column":81}}},"46":{"name":"calculateDistance","line":698,"loc":{"start":{"line":698,"column":52},"end":{"line":698,"column":96}}},"47":{"name":"kmBetween","line":717,"loc":{"start":{"line":717,"column":20},"end":{"line":717,"column":56}}},"48":{"name":"milesBetween","line":730,"loc":{"start":{"line":730,"column":23},"end":{"line":730,"column":62}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":12,"column":28}},"2":{"start":{"line":13,"column":0},"end":{"line":13,"column":29}},"3":{"start":{"line":15,"column":0},"end":{"line":15,"column":10}},"4":{"start":{"line":16,"column":0},"end":{"line":18,"column":13}},"5":{"start":{"line":17,"column":1},"end":{"line":17,"column":26}},"6":{"start":{"line":21,"column":0},"end":{"line":21,"column":45}},"7":{"start":{"line":22,"column":0},"end":{"line":22,"column":25}},"8":{"start":{"line":23,"column":0},"end":{"line":23,"column":28}},"9":{"start":{"line":25,"column":0},"end":{"line":32,"column":5}},"10":{"start":{"line":26,"column":1},"end":{"line":30,"column":2}},"11":{"start":{"line":27,"column":2},"end":{"line":27,"column":49}},"12":{"start":{"line":28,"column":2},"end":{"line":28,"column":27}},"13":{"start":{"line":29,"column":2},"end":{"line":29,"column":34}},"14":{"start":{"line":31,"column":1},"end":{"line":31,"column":68}},"15":{"start":{"line":35,"column":0},"end":{"line":35,"column":41}},"16":{"start":{"line":37,"column":0},"end":{"line":37,"column":55}},"17":{"start":{"line":40,"column":0},"end":{"line":40,"column":21}},"18":{"start":{"line":41,"column":0},"end":{"line":41,"column":24}},"19":{"start":{"line":43,"column":0},"end":{"line":47,"column":1}},"20":{"start":{"line":44,"column":1},"end":{"line":46,"column":4}},"21":{"start":{"line":45,"column":2},"end":{"line":45,"column":13}},"22":{"start":{"line":49,"column":0},"end":{"line":52,"column":1}},"23":{"start":{"line":50,"column":1},"end":{"line":50,"column":17}},"24":{"start":{"line":51,"column":1},"end":{"line":51,"column":40}},"25":{"start":{"line":62,"column":0},"end":{"line":64,"column":2}},"26":{"start":{"line":63,"column":1},"end":{"line":63,"column":34}},"27":{"start":{"line":74,"column":0},"end":{"line":76,"column":2}},"28":{"start":{"line":75,"column":1},"end":{"line":75,"column":66}},"29":{"start":{"line":86,"column":0},"end":{"line":93,"column":2}},"30":{"start":{"line":87,"column":1},"end":{"line":87,"column":22}},"31":{"start":{"line":88,"column":1},"end":{"line":92,"column":2}},"32":{"start":{"line":89,"column":2},"end":{"line":89,"column":36}},"33":{"start":{"line":91,"column":2},"end":{"line":91,"column":15}},"34":{"start":{"line":103,"column":0},"end":{"line":105,"column":2}},"35":{"start":{"line":104,"column":1},"end":{"line":104,"column":27}},"36":{"start":{"line":115,"column":0},"end":{"line":117,"column":2}},"37":{"start":{"line":116,"column":1},"end":{"line":116,"column":64}},"38":{"start":{"line":127,"column":0},"end":{"line":129,"column":2}},"39":{"start":{"line":128,"column":1},"end":{"line":128,"column":32}},"40":{"start":{"line":139,"column":0},"end":{"line":141,"column":2}},"41":{"start":{"line":140,"column":1},"end":{"line":140,"column":32}},"42":{"start":{"line":153,"column":0},"end":{"line":155,"column":2}},"43":{"start":{"line":154,"column":1},"end":{"line":154,"column":157}},"44":{"start":{"line":165,"column":0},"end":{"line":169,"column":2}},"45":{"start":{"line":166,"column":1},"end":{"line":166,"column":43}},"46":{"start":{"line":166,"column":30},"end":{"line":166,"column":43}},"47":{"start":{"line":167,"column":1},"end":{"line":167,"column":152}},"48":{"start":{"line":168,"column":1},"end":{"line":168,"column":36}},"49":{"start":{"line":180,"column":0},"end":{"line":187,"column":2}},"50":{"start":{"line":181,"column":1},"end":{"line":181,"column":27}},"51":{"start":{"line":182,"column":1},"end":{"line":182,"column":17}},"52":{"start":{"line":183,"column":1},"end":{"line":185,"column":4}},"53":{"start":{"line":184,"column":2},"end":{"line":184,"column":27}},"54":{"start":{"line":186,"column":1},"end":{"line":186,"column":17}},"55":{"start":{"line":199,"column":0},"end":{"line":213,"column":2}},"56":{"start":{"line":200,"column":1},"end":{"line":203,"column":2}},"57":{"start":{"line":201,"column":2},"end":{"line":201,"column":19}},"58":{"start":{"line":202,"column":2},"end":{"line":202,"column":23}},"59":{"start":{"line":204,"column":1},"end":{"line":204,"column":14}},"60":{"start":{"line":205,"column":1},"end":{"line":211,"column":2}},"61":{"start":{"line":206,"column":2},"end":{"line":206,"column":52}},"62":{"start":{"line":207,"column":2},"end":{"line":209,"column":3}},"63":{"start":{"line":208,"column":3},"end":{"line":208,"column":26}},"64":{"start":{"line":210,"column":2},"end":{"line":210,"column":27}},"65":{"start":{"line":212,"column":1},"end":{"line":212,"column":12}},"66":{"start":{"line":218,"column":0},"end":{"line":218,"column":29}},"67":{"start":{"line":227,"column":0},"end":{"line":230,"column":2}},"68":{"start":{"line":228,"column":1},"end":{"line":228,"column":53}},"69":{"start":{"line":229,"column":1},"end":{"line":229,"column":57}},"70":{"start":{"line":229,"column":32},"end":{"line":229,"column":53}},"71":{"start":{"line":242,"column":0},"end":{"line":252,"column":2}},"72":{"start":{"line":243,"column":1},"end":{"line":243,"column":16}},"73":{"start":{"line":244,"column":1},"end":{"line":250,"column":2}},"74":{"start":{"line":245,"column":2},"end":{"line":249,"column":3}},"75":{"start":{"line":246,"column":3},"end":{"line":246,"column":39}},"76":{"start":{"line":247,"column":9},"end":{"line":249,"column":3}},"77":{"start":{"line":248,"column":3},"end":{"line":248,"column":47}},"78":{"start":{"line":251,"column":1},"end":{"line":251,"column":14}},"79":{"start":{"line":263,"column":0},"end":{"line":263,"column":63}},"80":{"start":{"line":276,"column":0},"end":{"line":278,"column":2}},"81":{"start":{"line":277,"column":1},"end":{"line":277,"column":59}},"82":{"start":{"line":288,"column":0},"end":{"line":292,"column":2}},"83":{"start":{"line":289,"column":1},"end":{"line":289,"column":47}},"84":{"start":{"line":289,"column":26},"end":{"line":289,"column":47}},"85":{"start":{"line":290,"column":1},"end":{"line":290,"column":46}},"86":{"start":{"line":290,"column":36},"end":{"line":290,"column":46}},"87":{"start":{"line":291,"column":1},"end":{"line":291,"column":67}},"88":{"start":{"line":302,"column":0},"end":{"line":306,"column":2}},"89":{"start":{"line":303,"column":1},"end":{"line":303,"column":47}},"90":{"start":{"line":303,"column":26},"end":{"line":303,"column":47}},"91":{"start":{"line":304,"column":1},"end":{"line":304,"column":46}},"92":{"start":{"line":304,"column":36},"end":{"line":304,"column":46}},"93":{"start":{"line":305,"column":1},"end":{"line":305,"column":39}},"94":{"start":{"line":316,"column":0},"end":{"line":325,"column":2}},"95":{"start":{"line":317,"column":1},"end":{"line":317,"column":47}},"96":{"start":{"line":317,"column":26},"end":{"line":317,"column":47}},"97":{"start":{"line":318,"column":1},"end":{"line":318,"column":46}},"98":{"start":{"line":318,"column":36},"end":{"line":318,"column":46}},"99":{"start":{"line":319,"column":1},"end":{"line":319,"column":14}},"100":{"start":{"line":320,"column":1},"end":{"line":323,"column":2}},"101":{"start":{"line":321,"column":2},"end":{"line":321,"column":24}},"102":{"start":{"line":322,"column":2},"end":{"line":322,"column":31}},"103":{"start":{"line":324,"column":1},"end":{"line":324,"column":21}},"104":{"start":{"line":334,"column":0},"end":{"line":348,"column":2}},"105":{"start":{"line":335,"column":1},"end":{"line":335,"column":47}},"106":{"start":{"line":335,"column":26},"end":{"line":335,"column":47}},"107":{"start":{"line":336,"column":1},"end":{"line":336,"column":46}},"108":{"start":{"line":336,"column":36},"end":{"line":336,"column":46}},"109":{"start":{"line":337,"column":1},"end":{"line":337,"column":14}},"110":{"start":{"line":339,"column":1},"end":{"line":339,"column":54}},"111":{"start":{"line":340,"column":1},"end":{"line":340,"column":54}},"112":{"start":{"line":342,"column":1},"end":{"line":346,"column":2}},"113":{"start":{"line":343,"column":2},"end":{"line":343,"column":25}},"114":{"start":{"line":344,"column":2},"end":{"line":344,"column":63}},"115":{"start":{"line":345,"column":2},"end":{"line":345,"column":83}},"116":{"start":{"line":347,"column":1},"end":{"line":347,"column":21}},"117":{"start":{"line":362,"column":0},"end":{"line":369,"column":2}},"118":{"start":{"line":363,"column":1},"end":{"line":365,"column":2}},"119":{"start":{"line":364,"column":2},"end":{"line":364,"column":38}},"120":{"start":{"line":366,"column":1},"end":{"line":366,"column":25}},"121":{"start":{"line":367,"column":1},"end":{"line":367,"column":18}},"122":{"start":{"line":368,"column":1},"end":{"line":368,"column":74}},"123":{"start":{"line":379,"column":0},"end":{"line":381,"column":2}},"124":{"start":{"line":380,"column":1},"end":{"line":380,"column":33}},"125":{"start":{"line":396,"column":0},"end":{"line":410,"column":2}},"126":{"start":{"line":397,"column":1},"end":{"line":399,"column":2}},"127":{"start":{"line":398,"column":2},"end":{"line":398,"column":34}},"128":{"start":{"line":400,"column":1},"end":{"line":400,"column":37}},"129":{"start":{"line":400,"column":29},"end":{"line":400,"column":37}},"130":{"start":{"line":401,"column":1},"end":{"line":403,"column":2}},"131":{"start":{"line":402,"column":2},"end":{"line":402,"column":29}},"132":{"start":{"line":404,"column":1},"end":{"line":408,"column":2}},"133":{"start":{"line":405,"column":2},"end":{"line":405,"column":24}},"134":{"start":{"line":406,"column":8},"end":{"line":408,"column":2}},"135":{"start":{"line":407,"column":2},"end":{"line":407,"column":36}},"136":{"start":{"line":409,"column":1},"end":{"line":409,"column":52}},"137":{"start":{"line":420,"column":0},"end":{"line":424,"column":2}},"138":{"start":{"line":421,"column":1},"end":{"line":421,"column":47}},"139":{"start":{"line":421,"column":26},"end":{"line":421,"column":47}},"140":{"start":{"line":422,"column":1},"end":{"line":422,"column":46}},"141":{"start":{"line":422,"column":36},"end":{"line":422,"column":46}},"142":{"start":{"line":423,"column":1},"end":{"line":423,"column":57}},"143":{"start":{"line":434,"column":0},"end":{"line":438,"column":2}},"144":{"start":{"line":435,"column":1},"end":{"line":435,"column":47}},"145":{"start":{"line":435,"column":26},"end":{"line":435,"column":47}},"146":{"start":{"line":436,"column":1},"end":{"line":436,"column":46}},"147":{"start":{"line":436,"column":36},"end":{"line":436,"column":46}},"148":{"start":{"line":437,"column":1},"end":{"line":437,"column":57}},"149":{"start":{"line":448,"column":0},"end":{"line":459,"column":2}},"150":{"start":{"line":449,"column":1},"end":{"line":449,"column":47}},"151":{"start":{"line":449,"column":26},"end":{"line":449,"column":47}},"152":{"start":{"line":450,"column":1},"end":{"line":450,"column":46}},"153":{"start":{"line":450,"column":36},"end":{"line":450,"column":46}},"154":{"start":{"line":451,"column":1},"end":{"line":451,"column":47}},"155":{"start":{"line":452,"column":1},"end":{"line":452,"column":34}},"156":{"start":{"line":453,"column":1},"end":{"line":457,"column":2}},"157":{"start":{"line":454,"column":2},"end":{"line":456,"column":3}},"158":{"start":{"line":455,"column":3},"end":{"line":455,"column":31}},"159":{"start":{"line":458,"column":1},"end":{"line":458,"column":33}},"160":{"start":{"line":470,"column":0},"end":{"line":472,"column":2}},"161":{"start":{"line":471,"column":1},"end":{"line":471,"column":37}},"162":{"start":{"line":482,"column":0},"end":{"line":488,"column":2}},"163":{"start":{"line":483,"column":1},"end":{"line":483,"column":47}},"164":{"start":{"line":483,"column":26},"end":{"line":483,"column":47}},"165":{"start":{"line":484,"column":1},"end":{"line":484,"column":46}},"166":{"start":{"line":484,"column":36},"end":{"line":484,"column":46}},"167":{"start":{"line":485,"column":1},"end":{"line":487,"column":4}},"168":{"start":{"line":486,"column":2},"end":{"line":486,"column":142}},"169":{"start":{"line":498,"column":0},"end":{"line":504,"column":2}},"170":{"start":{"line":499,"column":1},"end":{"line":499,"column":47}},"171":{"start":{"line":499,"column":26},"end":{"line":499,"column":47}},"172":{"start":{"line":500,"column":1},"end":{"line":500,"column":46}},"173":{"start":{"line":500,"column":36},"end":{"line":500,"column":46}},"174":{"start":{"line":501,"column":1},"end":{"line":503,"column":4}},"175":{"start":{"line":502,"column":2},"end":{"line":502,"column":44}},"176":{"start":{"line":515,"column":0},"end":{"line":519,"column":2}},"177":{"start":{"line":516,"column":1},"end":{"line":518,"column":4}},"178":{"start":{"line":517,"column":2},"end":{"line":517,"column":67}},"179":{"start":{"line":529,"column":0},"end":{"line":533,"column":2}},"180":{"start":{"line":530,"column":1},"end":{"line":530,"column":47}},"181":{"start":{"line":530,"column":26},"end":{"line":530,"column":47}},"182":{"start":{"line":531,"column":1},"end":{"line":531,"column":46}},"183":{"start":{"line":531,"column":36},"end":{"line":531,"column":46}},"184":{"start":{"line":532,"column":1},"end":{"line":532,"column":55}},"185":{"start":{"line":556,"column":0},"end":{"line":574,"column":2}},"186":{"start":{"line":557,"column":1},"end":{"line":557,"column":47}},"187":{"start":{"line":557,"column":26},"end":{"line":557,"column":47}},"188":{"start":{"line":558,"column":1},"end":{"line":558,"column":46}},"189":{"start":{"line":558,"column":36},"end":{"line":558,"column":46}},"190":{"start":{"line":560,"column":1},"end":{"line":560,"column":30}},"191":{"start":{"line":562,"column":1},"end":{"line":562,"column":35}},"192":{"start":{"line":564,"column":1},"end":{"line":564,"column":35}},"193":{"start":{"line":566,"column":1},"end":{"line":566,"column":52}},"194":{"start":{"line":568,"column":1},"end":{"line":568,"column":35}},"195":{"start":{"line":570,"column":1},"end":{"line":570,"column":37}},"196":{"start":{"line":572,"column":1},"end":{"line":572,"column":37}},"197":{"start":{"line":573,"column":1},"end":{"line":573,"column":32}},"198":{"start":{"line":593,"column":0},"end":{"line":612,"column":2}},"199":{"start":{"line":594,"column":1},"end":{"line":594,"column":47}},"200":{"start":{"line":594,"column":26},"end":{"line":594,"column":47}},"201":{"start":{"line":595,"column":1},"end":{"line":595,"column":46}},"202":{"start":{"line":595,"column":36},"end":{"line":595,"column":46}},"203":{"start":{"line":596,"column":1},"end":{"line":599,"column":2}},"204":{"start":{"line":597,"column":2},"end":{"line":597,"column":25}},"205":{"start":{"line":598,"column":2},"end":{"line":598,"column":16}},"206":{"start":{"line":600,"column":1},"end":{"line":600,"column":19}},"207":{"start":{"line":601,"column":1},"end":{"line":601,"column":38}},"208":{"start":{"line":601,"column":27},"end":{"line":601,"column":38}},"209":{"start":{"line":602,"column":1},"end":{"line":602,"column":21}},"210":{"start":{"line":603,"column":1},"end":{"line":609,"column":2}},"211":{"start":{"line":604,"column":2},"end":{"line":604,"column":29}},"212":{"start":{"line":605,"column":2},"end":{"line":605,"column":29}},"213":{"start":{"line":606,"column":2},"end":{"line":608,"column":3}},"214":{"start":{"line":607,"column":3},"end":{"line":607,"column":28}},"215":{"start":{"line":610,"column":1},"end":{"line":610,"column":33}},"216":{"start":{"line":611,"column":1},"end":{"line":611,"column":65}},"217":{"start":{"line":619,"column":0},"end":{"line":621,"column":2}},"218":{"start":{"line":620,"column":1},"end":{"line":620,"column":79}},"219":{"start":{"line":631,"column":0},"end":{"line":644,"column":2}},"220":{"start":{"line":632,"column":1},"end":{"line":632,"column":47}},"221":{"start":{"line":632,"column":26},"end":{"line":632,"column":47}},"222":{"start":{"line":633,"column":1},"end":{"line":633,"column":46}},"223":{"start":{"line":633,"column":36},"end":{"line":633,"column":46}},"224":{"start":{"line":634,"column":1},"end":{"line":634,"column":47}},"225":{"start":{"line":635,"column":1},"end":{"line":635,"column":50}},"226":{"start":{"line":636,"column":1},"end":{"line":636,"column":50}},"227":{"start":{"line":637,"column":1},"end":{"line":637,"column":62}},"228":{"start":{"line":638,"column":1},"end":{"line":642,"column":2}},"229":{"start":{"line":639,"column":2},"end":{"line":641,"column":3}},"230":{"start":{"line":640,"column":3},"end":{"line":640,"column":31}},"231":{"start":{"line":643,"column":1},"end":{"line":643,"column":33}},"232":{"start":{"line":655,"column":0},"end":{"line":663,"column":2}},"233":{"start":{"line":656,"column":1},"end":{"line":656,"column":47}},"234":{"start":{"line":656,"column":26},"end":{"line":656,"column":47}},"235":{"start":{"line":657,"column":1},"end":{"line":657,"column":46}},"236":{"start":{"line":657,"column":36},"end":{"line":657,"column":46}},"237":{"start":{"line":658,"column":1},"end":{"line":658,"column":46}},"238":{"start":{"line":659,"column":1},"end":{"line":661,"column":2}},"239":{"start":{"line":660,"column":2},"end":{"line":660,"column":71}},"240":{"start":{"line":662,"column":1},"end":{"line":662,"column":24}},"241":{"start":{"line":674,"column":0},"end":{"line":685,"column":2}},"242":{"start":{"line":675,"column":1},"end":{"line":675,"column":47}},"243":{"start":{"line":675,"column":26},"end":{"line":675,"column":47}},"244":{"start":{"line":676,"column":1},"end":{"line":676,"column":46}},"245":{"start":{"line":676,"column":36},"end":{"line":676,"column":46}},"246":{"start":{"line":677,"column":1},"end":{"line":677,"column":46}},"247":{"start":{"line":678,"column":1},"end":{"line":680,"column":2}},"248":{"start":{"line":679,"column":2},"end":{"line":679,"column":71}},"249":{"start":{"line":681,"column":1},"end":{"line":683,"column":2}},"250":{"start":{"line":682,"column":2},"end":{"line":682,"column":30}},"251":{"start":{"line":684,"column":1},"end":{"line":684,"column":23}},"252":{"start":{"line":698,"column":0},"end":{"line":706,"column":2}},"253":{"start":{"line":699,"column":1},"end":{"line":699,"column":52}},"254":{"start":{"line":700,"column":1},"end":{"line":700,"column":52}},"255":{"start":{"line":701,"column":1},"end":{"line":701,"column":40}},"256":{"start":{"line":702,"column":1},"end":{"line":702,"column":40}},"257":{"start":{"line":703,"column":1},"end":{"line":703,"column":125}},"258":{"start":{"line":704,"column":1},"end":{"line":704,"column":56}},"259":{"start":{"line":705,"column":1},"end":{"line":705,"column":10}},"260":{"start":{"line":717,"column":0},"end":{"line":719,"column":2}},"261":{"start":{"line":718,"column":1},"end":{"line":718,"column":54}},"262":{"start":{"line":730,"column":0},"end":{"line":732,"column":2}},"263":{"start":{"line":731,"column":1},"end":{"line":731,"column":57}}},"branchMap":{"1":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":7},"end":{"line":50,"column":10}},{"start":{"line":50,"column":14},"end":{"line":50,"column":16}}]},"2":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},{"start":{"line":88,"column":1},"end":{"line":88,"column":1}}]},"3":{"line":88,"type":"binary-expr","locations":[{"start":{"line":88,"column":5},"end":{"line":88,"column":15}},{"start":{"line":88,"column":19},"end":{"line":88,"column":29}}]},"4":{"line":166,"type":"if","locations":[{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},{"start":{"line":166,"column":1},"end":{"line":166,"column":1}}]},"5":{"line":181,"type":"binary-expr","locations":[{"start":{"line":181,"column":12},"end":{"line":181,"column":20}},{"start":{"line":181,"column":24},"end":{"line":181,"column":26}}]},"6":{"line":182,"type":"binary-expr","locations":[{"start":{"line":182,"column":7},"end":{"line":182,"column":10}},{"start":{"line":182,"column":14},"end":{"line":182,"column":16}}]},"7":{"line":200,"type":"if","locations":[{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},{"start":{"line":200,"column":1},"end":{"line":200,"column":1}}]},"8":{"line":200,"type":"binary-expr","locations":[{"start":{"line":200,"column":5},"end":{"line":200,"column":27}},{"start":{"line":200,"column":31},"end":{"line":200,"column":60}}]},"9":{"line":206,"type":"cond-expr","locations":[{"start":{"line":206,"column":26},"end":{"line":206,"column":42}},{"start":{"line":206,"column":45},"end":{"line":206,"column":51}}]},"10":{"line":207,"type":"if","locations":[{"start":{"line":207,"column":2},"end":{"line":207,"column":2}},{"start":{"line":207,"column":2},"end":{"line":207,"column":2}}]},"11":{"line":245,"type":"if","locations":[{"start":{"line":245,"column":2},"end":{"line":245,"column":2}},{"start":{"line":245,"column":2},"end":{"line":245,"column":2}}]},"12":{"line":247,"type":"if","locations":[{"start":{"line":247,"column":9},"end":{"line":247,"column":9}},{"start":{"line":247,"column":9},"end":{"line":247,"column":9}}]},"13":{"line":289,"type":"if","locations":[{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},{"start":{"line":289,"column":1},"end":{"line":289,"column":1}}]},"14":{"line":289,"type":"binary-expr","locations":[{"start":{"line":289,"column":5},"end":{"line":289,"column":8}},{"start":{"line":289,"column":12},"end":{"line":289,"column":24}}]},"15":{"line":290,"type":"if","locations":[{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},{"start":{"line":290,"column":1},"end":{"line":290,"column":1}}]},"16":{"line":290,"type":"binary-expr","locations":[{"start":{"line":290,"column":5},"end":{"line":290,"column":19}},{"start":{"line":290,"column":23},"end":{"line":290,"column":34}}]},"17":{"line":303,"type":"if","locations":[{"start":{"line":303,"column":1},"end":{"line":303,"column":1}},{"start":{"line":303,"column":1},"end":{"line":303,"column":1}}]},"18":{"line":303,"type":"binary-expr","locations":[{"start":{"line":303,"column":5},"end":{"line":303,"column":8}},{"start":{"line":303,"column":12},"end":{"line":303,"column":24}}]},"19":{"line":304,"type":"if","locations":[{"start":{"line":304,"column":1},"end":{"line":304,"column":1}},{"start":{"line":304,"column":1},"end":{"line":304,"column":1}}]},"20":{"line":304,"type":"binary-expr","locations":[{"start":{"line":304,"column":5},"end":{"line":304,"column":19}},{"start":{"line":304,"column":23},"end":{"line":304,"column":34}}]},"21":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":1},"end":{"line":317,"column":1}},{"start":{"line":317,"column":1},"end":{"line":317,"column":1}}]},"22":{"line":317,"type":"binary-expr","locations":[{"start":{"line":317,"column":5},"end":{"line":317,"column":8}},{"start":{"line":317,"column":12},"end":{"line":317,"column":24}}]},"23":{"line":318,"type":"if","locations":[{"start":{"line":318,"column":1},"end":{"line":318,"column":1}},{"start":{"line":318,"column":1},"end":{"line":318,"column":1}}]},"24":{"line":318,"type":"binary-expr","locations":[{"start":{"line":318,"column":5},"end":{"line":318,"column":19}},{"start":{"line":318,"column":23},"end":{"line":318,"column":34}}]},"25":{"line":322,"type":"binary-expr","locations":[{"start":{"line":322,"column":11},"end":{"line":322,"column":24}},{"start":{"line":322,"column":28},"end":{"line":322,"column":29}}]},"26":{"line":335,"type":"if","locations":[{"start":{"line":335,"column":1},"end":{"line":335,"column":1}},{"start":{"line":335,"column":1},"end":{"line":335,"column":1}}]},"27":{"line":335,"type":"binary-expr","locations":[{"start":{"line":335,"column":5},"end":{"line":335,"column":8}},{"start":{"line":335,"column":12},"end":{"line":335,"column":24}}]},"28":{"line":336,"type":"if","locations":[{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},{"start":{"line":336,"column":1},"end":{"line":336,"column":1}}]},"29":{"line":336,"type":"binary-expr","locations":[{"start":{"line":336,"column":5},"end":{"line":336,"column":19}},{"start":{"line":336,"column":23},"end":{"line":336,"column":34}}]},"30":{"line":345,"type":"cond-expr","locations":[{"start":{"line":345,"column":55},"end":{"line":345,"column":69}},{"start":{"line":345,"column":72},"end":{"line":345,"column":81}}]},"31":{"line":345,"type":"binary-expr","locations":[{"start":{"line":345,"column":12},"end":{"line":345,"column":26}},{"start":{"line":345,"column":30},"end":{"line":345,"column":51}}]},"32":{"line":363,"type":"if","locations":[{"start":{"line":363,"column":1},"end":{"line":363,"column":1}},{"start":{"line":363,"column":1},"end":{"line":363,"column":1}}]},"33":{"line":366,"type":"binary-expr","locations":[{"start":{"line":366,"column":11},"end":{"line":366,"column":18}},{"start":{"line":366,"column":22},"end":{"line":366,"column":24}}]},"34":{"line":367,"type":"binary-expr","locations":[{"start":{"line":367,"column":7},"end":{"line":367,"column":10}},{"start":{"line":367,"column":14},"end":{"line":367,"column":17}}]},"35":{"line":397,"type":"if","locations":[{"start":{"line":397,"column":1},"end":{"line":397,"column":1}},{"start":{"line":397,"column":1},"end":{"line":397,"column":1}}]},"36":{"line":400,"type":"if","locations":[{"start":{"line":400,"column":1},"end":{"line":400,"column":1}},{"start":{"line":400,"column":1},"end":{"line":400,"column":1}}]},"37":{"line":401,"type":"if","locations":[{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},{"start":{"line":401,"column":1},"end":{"line":401,"column":1}}]},"38":{"line":404,"type":"if","locations":[{"start":{"line":404,"column":1},"end":{"line":404,"column":1}},{"start":{"line":404,"column":1},"end":{"line":404,"column":1}}]},"39":{"line":406,"type":"if","locations":[{"start":{"line":406,"column":8},"end":{"line":406,"column":8}},{"start":{"line":406,"column":8},"end":{"line":406,"column":8}}]},"40":{"line":409,"type":"cond-expr","locations":[{"start":{"line":409,"column":23},"end":{"line":409,"column":25}},{"start":{"line":409,"column":28},"end":{"line":409,"column":30}}]},"41":{"line":421,"type":"if","locations":[{"start":{"line":421,"column":1},"end":{"line":421,"column":1}},{"start":{"line":421,"column":1},"end":{"line":421,"column":1}}]},"42":{"line":421,"type":"binary-expr","locations":[{"start":{"line":421,"column":5},"end":{"line":421,"column":8}},{"start":{"line":421,"column":12},"end":{"line":421,"column":24}}]},"43":{"line":422,"type":"if","locations":[{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},{"start":{"line":422,"column":1},"end":{"line":422,"column":1}}]},"44":{"line":422,"type":"binary-expr","locations":[{"start":{"line":422,"column":5},"end":{"line":422,"column":19}},{"start":{"line":422,"column":23},"end":{"line":422,"column":34}}]},"45":{"line":435,"type":"if","locations":[{"start":{"line":435,"column":1},"end":{"line":435,"column":1}},{"start":{"line":435,"column":1},"end":{"line":435,"column":1}}]},"46":{"line":435,"type":"binary-expr","locations":[{"start":{"line":435,"column":5},"end":{"line":435,"column":8}},{"start":{"line":435,"column":12},"end":{"line":435,"column":24}}]},"47":{"line":436,"type":"if","locations":[{"start":{"line":436,"column":1},"end":{"line":436,"column":1}},{"start":{"line":436,"column":1},"end":{"line":436,"column":1}}]},"48":{"line":436,"type":"binary-expr","locations":[{"start":{"line":436,"column":5},"end":{"line":436,"column":19}},{"start":{"line":436,"column":23},"end":{"line":436,"column":34}}]},"49":{"line":449,"type":"if","locations":[{"start":{"line":449,"column":1},"end":{"line":449,"column":1}},{"start":{"line":449,"column":1},"end":{"line":449,"column":1}}]},"50":{"line":449,"type":"binary-expr","locations":[{"start":{"line":449,"column":5},"end":{"line":449,"column":8}},{"start":{"line":449,"column":12},"end":{"line":449,"column":24}}]},"51":{"line":450,"type":"if","locations":[{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},{"start":{"line":450,"column":1},"end":{"line":450,"column":1}}]},"52":{"line":450,"type":"binary-expr","locations":[{"start":{"line":450,"column":5},"end":{"line":450,"column":19}},{"start":{"line":450,"column":23},"end":{"line":450,"column":34}}]},"53":{"line":454,"type":"if","locations":[{"start":{"line":454,"column":2},"end":{"line":454,"column":2}},{"start":{"line":454,"column":2},"end":{"line":454,"column":2}}]},"54":{"line":454,"type":"binary-expr","locations":[{"start":{"line":454,"column":6},"end":{"line":454,"column":14}},{"start":{"line":454,"column":18},"end":{"line":454,"column":47}}]},"55":{"line":483,"type":"if","locations":[{"start":{"line":483,"column":1},"end":{"line":483,"column":1}},{"start":{"line":483,"column":1},"end":{"line":483,"column":1}}]},"56":{"line":483,"type":"binary-expr","locations":[{"start":{"line":483,"column":5},"end":{"line":483,"column":8}},{"start":{"line":483,"column":12},"end":{"line":483,"column":24}}]},"57":{"line":484,"type":"if","locations":[{"start":{"line":484,"column":1},"end":{"line":484,"column":1}},{"start":{"line":484,"column":1},"end":{"line":484,"column":1}}]},"58":{"line":484,"type":"binary-expr","locations":[{"start":{"line":484,"column":5},"end":{"line":484,"column":19}},{"start":{"line":484,"column":23},"end":{"line":484,"column":34}}]},"59":{"line":486,"type":"cond-expr","locations":[{"start":{"line":486,"column":46},"end":{"line":486,"column":63}},{"start":{"line":486,"column":66},"end":{"line":486,"column":140}}]},"60":{"line":486,"type":"cond-expr","locations":[{"start":{"line":486,"column":83},"end":{"line":486,"column":110}},{"start":{"line":486,"column":113},"end":{"line":486,"column":140}}]},"61":{"line":499,"type":"if","locations":[{"start":{"line":499,"column":1},"end":{"line":499,"column":1}},{"start":{"line":499,"column":1},"end":{"line":499,"column":1}}]},"62":{"line":499,"type":"binary-expr","locations":[{"start":{"line":499,"column":5},"end":{"line":499,"column":8}},{"start":{"line":499,"column":12},"end":{"line":499,"column":24}}]},"63":{"line":500,"type":"if","locations":[{"start":{"line":500,"column":1},"end":{"line":500,"column":1}},{"start":{"line":500,"column":1},"end":{"line":500,"column":1}}]},"64":{"line":500,"type":"binary-expr","locations":[{"start":{"line":500,"column":5},"end":{"line":500,"column":19}},{"start":{"line":500,"column":23},"end":{"line":500,"column":34}}]},"65":{"line":530,"type":"if","locations":[{"start":{"line":530,"column":1},"end":{"line":530,"column":1}},{"start":{"line":530,"column":1},"end":{"line":530,"column":1}}]},"66":{"line":530,"type":"binary-expr","locations":[{"start":{"line":530,"column":5},"end":{"line":530,"column":8}},{"start":{"line":530,"column":12},"end":{"line":530,"column":24}}]},"67":{"line":531,"type":"if","locations":[{"start":{"line":531,"column":1},"end":{"line":531,"column":1}},{"start":{"line":531,"column":1},"end":{"line":531,"column":1}}]},"68":{"line":531,"type":"binary-expr","locations":[{"start":{"line":531,"column":5},"end":{"line":531,"column":19}},{"start":{"line":531,"column":23},"end":{"line":531,"column":34}}]},"69":{"line":557,"type":"if","locations":[{"start":{"line":557,"column":1},"end":{"line":557,"column":1}},{"start":{"line":557,"column":1},"end":{"line":557,"column":1}}]},"70":{"line":557,"type":"binary-expr","locations":[{"start":{"line":557,"column":5},"end":{"line":557,"column":8}},{"start":{"line":557,"column":12},"end":{"line":557,"column":24}}]},"71":{"line":558,"type":"if","locations":[{"start":{"line":558,"column":1},"end":{"line":558,"column":1}},{"start":{"line":558,"column":1},"end":{"line":558,"column":1}}]},"72":{"line":558,"type":"binary-expr","locations":[{"start":{"line":558,"column":5},"end":{"line":558,"column":19}},{"start":{"line":558,"column":23},"end":{"line":558,"column":34}}]},"73":{"line":594,"type":"if","locations":[{"start":{"line":594,"column":1},"end":{"line":594,"column":1}},{"start":{"line":594,"column":1},"end":{"line":594,"column":1}}]},"74":{"line":594,"type":"binary-expr","locations":[{"start":{"line":594,"column":5},"end":{"line":594,"column":8}},{"start":{"line":594,"column":12},"end":{"line":594,"column":24}}]},"75":{"line":595,"type":"if","locations":[{"start":{"line":595,"column":1},"end":{"line":595,"column":1}},{"start":{"line":595,"column":1},"end":{"line":595,"column":1}}]},"76":{"line":595,"type":"binary-expr","locations":[{"start":{"line":595,"column":5},"end":{"line":595,"column":19}},{"start":{"line":595,"column":23},"end":{"line":595,"column":34}}]},"77":{"line":596,"type":"if","locations":[{"start":{"line":596,"column":1},"end":{"line":596,"column":1}},{"start":{"line":596,"column":1},"end":{"line":596,"column":1}}]},"78":{"line":601,"type":"if","locations":[{"start":{"line":601,"column":1},"end":{"line":601,"column":1}},{"start":{"line":601,"column":1},"end":{"line":601,"column":1}}]},"79":{"line":603,"type":"if","locations":[{"start":{"line":603,"column":1},"end":{"line":603,"column":1}},{"start":{"line":603,"column":1},"end":{"line":603,"column":1}}]},"80":{"line":606,"type":"if","locations":[{"start":{"line":606,"column":2},"end":{"line":606,"column":2}},{"start":{"line":606,"column":2},"end":{"line":606,"column":2}}]},"81":{"line":606,"type":"binary-expr","locations":[{"start":{"line":606,"column":6},"end":{"line":606,"column":10}},{"start":{"line":606,"column":14},"end":{"line":606,"column":25}}]},"82":{"line":611,"type":"cond-expr","locations":[{"start":{"line":611,"column":46},"end":{"line":611,"column":58}},{"start":{"line":611,"column":61},"end":{"line":611,"column":64}}]},"83":{"line":611,"type":"binary-expr","locations":[{"start":{"line":611,"column":9},"end":{"line":611,"column":32}},{"start":{"line":611,"column":36},"end":{"line":611,"column":42}}]},"84":{"line":632,"type":"if","locations":[{"start":{"line":632,"column":1},"end":{"line":632,"column":1}},{"start":{"line":632,"column":1},"end":{"line":632,"column":1}}]},"85":{"line":632,"type":"binary-expr","locations":[{"start":{"line":632,"column":5},"end":{"line":632,"column":8}},{"start":{"line":632,"column":12},"end":{"line":632,"column":24}}]},"86":{"line":633,"type":"if","locations":[{"start":{"line":633,"column":1},"end":{"line":633,"column":1}},{"start":{"line":633,"column":1},"end":{"line":633,"column":1}}]},"87":{"line":633,"type":"binary-expr","locations":[{"start":{"line":633,"column":5},"end":{"line":633,"column":19}},{"start":{"line":633,"column":23},"end":{"line":633,"column":34}}]},"88":{"line":639,"type":"if","locations":[{"start":{"line":639,"column":2},"end":{"line":639,"column":2}},{"start":{"line":639,"column":2},"end":{"line":639,"column":2}}]},"89":{"line":639,"type":"binary-expr","locations":[{"start":{"line":639,"column":6},"end":{"line":639,"column":14}},{"start":{"line":639,"column":18},"end":{"line":639,"column":47}}]},"90":{"line":656,"type":"if","locations":[{"start":{"line":656,"column":1},"end":{"line":656,"column":1}},{"start":{"line":656,"column":1},"end":{"line":656,"column":1}}]},"91":{"line":656,"type":"binary-expr","locations":[{"start":{"line":656,"column":5},"end":{"line":656,"column":8}},{"start":{"line":656,"column":12},"end":{"line":656,"column":24}}]},"92":{"line":657,"type":"if","locations":[{"start":{"line":657,"column":1},"end":{"line":657,"column":1}},{"start":{"line":657,"column":1},"end":{"line":657,"column":1}}]},"93":{"line":657,"type":"binary-expr","locations":[{"start":{"line":657,"column":5},"end":{"line":657,"column":19}},{"start":{"line":657,"column":23},"end":{"line":657,"column":34}}]},"94":{"line":659,"type":"if","locations":[{"start":{"line":659,"column":1},"end":{"line":659,"column":1}},{"start":{"line":659,"column":1},"end":{"line":659,"column":1}}]},"95":{"line":659,"type":"binary-expr","locations":[{"start":{"line":659,"column":5},"end":{"line":659,"column":17}},{"start":{"line":659,"column":21},"end":{"line":659,"column":27}}]},"96":{"line":675,"type":"if","locations":[{"start":{"line":675,"column":1},"end":{"line":675,"column":1}},{"start":{"line":675,"column":1},"end":{"line":675,"column":1}}]},"97":{"line":675,"type":"binary-expr","locations":[{"start":{"line":675,"column":5},"end":{"line":675,"column":8}},{"start":{"line":675,"column":12},"end":{"line":675,"column":24}}]},"98":{"line":676,"type":"if","locations":[{"start":{"line":676,"column":1},"end":{"line":676,"column":1}},{"start":{"line":676,"column":1},"end":{"line":676,"column":1}}]},"99":{"line":676,"type":"binary-expr","locations":[{"start":{"line":676,"column":5},"end":{"line":676,"column":19}},{"start":{"line":676,"column":23},"end":{"line":676,"column":34}}]},"100":{"line":678,"type":"if","locations":[{"start":{"line":678,"column":1},"end":{"line":678,"column":1}},{"start":{"line":678,"column":1},"end":{"line":678,"column":1}}]},"101":{"line":678,"type":"binary-expr","locations":[{"start":{"line":678,"column":5},"end":{"line":678,"column":17}},{"start":{"line":678,"column":21},"end":{"line":678,"column":27}}]}},"code":["/* eslint no-unused-vars:0 */","","// Credits:","// ========","//","// Some utils borrowed from / inspired by mongoose/utils.js","// see https://github.com/LearnBoost/mongoose","//","// HTML Entity encode / decode is based on code in node-html-to-text","// see https://github.com/werk85/node-html-to-text","","var _slug = require('slug');","var inflect = require('i')();","","var limax;","try {","\tlimax = require('limax');","} catch(e) {}","","// HTML Entities for Text <> HTML conversion","var htmlEntities = require('./htmlEntities');","var htmlEntitiesMap = {};","var htmlEntitiesRegExp = '';","","(function () {","\tfor (var i in htmlEntities) {","\t\tvar ent = String.fromCharCode(htmlEntities[i]);","\t\thtmlEntitiesMap[ent] = i;","\t\thtmlEntitiesRegExp += '|' + ent;","\t}","\thtmlEntitiesRegExp = new RegExp(htmlEntitiesRegExp.substr(1), 'g');","})();","","// Diacritics support","var diacritics = require('./diacritics');","// Cyrillic transliteration","var transliteration = require('./transliteration.cyr');","","// Constants for distance calculation","var RADIUS_KM = 6371;","var RADIUS_MILES = 3959;","","function compact(arr) {","\treturn arr.filter(function(v) {","\t\treturn !!v;","\t});","}","","function deepClone(obj) {","\tobj = obj || {};","\treturn JSON.parse(JSON.stringify(obj));","}","","/**"," * Determines if `arg` is a function."," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isFunction = exports.isFunction = function isFunction (arg) {","\treturn typeof arg === 'function';","};","","/**"," * Determines if `arg` is an object."," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isObject = exports.isObject = function isObject (arg) {","\treturn Object.prototype.toString.call(arg) === '[object Object]';","};","","/**"," * Determines if `arg` looks like a valid mongo ObjectId"," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isValidObjectId = exports.isValidObjectId = function isValidObjectId (arg) {","\tvar len = arg.length;","\tif (len === 12 || len === 24) {","\t\treturn /^[0-9a-fA-F]+$/.test(arg);","\t} else {","\t\treturn false;","\t}","};","","/**"," * Determines if `arg` is an array."," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isArray = exports.isArray = function isArray (arg) {","\treturn Array.isArray(arg);","};","","/**"," * Determines if `arg` is a date."," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isDate = exports.isDate = function isDate (arg) {","\treturn Object.prototype.toString.call(arg) === '[object Date]';","};","","/**"," * Determines if `arg` is a string."," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isString = exports.isString = function isString (arg) {","\treturn typeof arg === 'string';","};","","/**"," * Determines if `arg` is a number."," *"," * @param {Object|Array|String|Function|RegExp|any} arg"," * @return {Boolean}"," * @api public"," */","","var isNumber = exports.isNumber = function isNumber (arg) {","\treturn typeof arg === 'number';","};","","/**"," * Make sure an email address looks valid."," * May cause false-negatives in extremely rare cases, see"," * http://www.regular-expressions.info/email.html"," *"," * @param {String} str"," * @return {String}"," * @api public"," */","","var isEmail = exports.isEmail = function isEmail (str) {","\treturn /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.['a-z0-9!#$%&*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i.test(str);","}; // ' // sublime syntax hilighter fix","","/**"," * Determines if `arg` is a base64 encoded data URI."," *"," * @param {String} arg"," * @return {Boolean}"," * @api public"," */","","var isDataURL = exports.isDataURL = function isDataURL (str) {","\tif (typeof str !== 'string') return false;","\tvar isDataURLRegex = /^\\s*data:([a-z]+\\/[a-z0-9\\-\\+]+(;[a-z\\-]+\\=[a-z0-9\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;","\treturn !!str.match(isDataURLRegex);","};","","/**"," * Applies options to a defaults object."," *"," * @param {Object} defaults (will be modified by reference)"," * @param {Object} options (will be assigned)"," * @return {Object} merged defaults and options"," * @api public"," */","","var options = exports.options = function options (defaults, ops) {","\tdefaults = defaults || {};","\tops = ops || {};","\tObject.keys(ops).forEach(function (key) {","\t\tdefaults[key] = ops[key];","\t});","\treturn defaults;","};","","/**"," * Creates a map of options"," *"," * @param {Array} options"," * @param {String} property to map"," * @param {Boolean} clone the options?"," * @return {Object} the map object"," * @api public"," */","","var optionsMap = exports.optionsMap = function optionsMap (arr, property, clone) {","\tif (arguments.length === 2 && typeof property === 'boolean') {","\t\tclone = property;","\t\tproperty = undefined;","\t}","\tvar obj = {};","\tfor (var i = 0; i < arr.length; i++) {","\t\tvar prop = (property) ? arr[i][property] : arr[i];","\t\tif (clone) {","\t\t\tprop = deepClone(prop);","\t\t}","\t\tobj[arr[i].value] = prop;","\t}","\treturn obj;","};","","/**"," * No operation"," */","exports.noop = function() {};","","/**"," * Defers a function invocation with `process.nextTick()` and invokes it with"," * the rest of the arguments. Less Zalgo with less code."," *"," * @param {Function} function to call"," */","","exports.defer = function defer (fn) {","\tvar args = Array.prototype.slice.call(arguments, 1);","\tprocess.nextTick(function () { fn.apply(null, args); });","};","","/**"," * Recursively binds method properties of an object to a scope"," * and returns a new object containing the bound methods"," *"," * @param {Object} object with method properties, can be nested in other objects"," * @param {Object} scope to bind as `this`"," * @return {Object} a new object containing the bound methods"," * @api public"," */","","var bindMethods = exports.bindMethods = function bindMethods (obj, scope) {","\tvar bound = {};","\tfor (var prop in obj) {","\t\tif (typeof obj[prop] === 'function') {","\t\t\tbound[prop] = obj[prop].bind(scope);","\t\t} else if (isObject(obj[prop])) {","\t\t\tbound[prop] = bindMethods(obj[prop], scope);","\t\t}","\t}","\treturn bound;","};","","/**"," * Generates a 'random' string of characters to the specified length."," *"," * @param {Number or Array}   len      the length of string to generate, can be a range (Array), Defaults to 10."," * @param {String}            chars    characters to include in the string, defaults to `0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz`"," * @return {String}"," * @api public"," */","","var randomString = exports.randomString = require('randomkey');","","/**"," * Converts a string to a number, accepting human-friendly input, e.g."," * - 1,432"," * - $1432"," * - 2.5"," *"," * @param {String} input"," * @return {Number} number"," * @api public"," */","","var number = exports.number = function number (str) {","\treturn parseFloat(String(str).replace(/[^\\-0-9\\.]/g, ''));","};","","/**"," * Escapes a string to be safely converted to a regular expression"," *"," * @param {String} string"," * @return {String} escaped string"," * @api public"," */","","var escapeRegExp = exports.escapeRegExp = function escapeRegExp (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');","};","","/**"," * Escapes a string to be safely used as a literal Javascript string"," *"," * @param {String} string"," * @return {String} escaped string"," * @api public"," */","","var escapeString = exports.escapeString = function escapeString (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn str.replace(/[\\\\'\"]/g, '\\\\$&');","};","","/**"," * Strips diacritics from a string, replacing them with their simple equivalents"," *"," * @param {String} string"," * @return {String} stripped string"," * @api public"," */","","var stripDiacritics = exports.stripDiacritics = function stripDiacritics (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tvar rtn = [];","\tfor (var i = 0; i < str.length; i++) {","\t\tvar c = str.charAt(i);","\t\trtn.push(diacritics[c] || c);","\t}","\treturn rtn.join('');","};","","/**"," * Transliterates Russian and Ukrainian words from cyrillic to latin."," *"," * @param  {String} word"," * @return {String} transliterated word"," * @api public"," */","var transliterate = exports.transliterate = function transliterate (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tvar rtn = [];","\t// applying зг-zgh rule","\tstr = str.replace(transliteration.regexp.Zgh, 'Zgh');","\tstr = str.replace(transliteration.regexp.zgh, 'zgh');","\t// replace characters with equivalent maps","\tfor (var i = 0; i < str.length; i++) {","\t\tvar character = str[i];","\t\tvar latinCharacter = transliteration.characterMap[character];","\t\trtn.push((latinCharacter || latinCharacter === '') ? latinCharacter : character);","\t}","\treturn rtn.join('');","};","","/**"," * Generates a slug from a string. Word breaks are hyphenated."," *"," * You can optionally provide a custom separator."," *"," * @param {String} str"," * @param {String} sep (defaults to '-')"," * @param {Hash} options (defaults to {})"," * @return {String} slug"," * @api public"," */","","var slug = exports.slug = function slug (str, sep, options) {","\tif (!limax) {","\t\treturn _slug(str,sep).toLowerCase();","\t}","\toptions = options || {};","\tsep = sep || '-';","\treturn limax(str, { tone: false, lang: options.locale, separator: sep });","};","","/**"," * Converts a string to its singular form"," *"," * @param {String} str"," * @return {String} singular form of str"," * @api public"," */","","var singular = exports.singular = function singular (str) {","\treturn inflect.singularize(str);","};","","/**"," * Displays the singular or plural of a string based on a number"," * or number of items in an array."," *"," * If arity is 1, returns the plural form of the word."," *"," * @param {String} count"," * @param {String} singular string"," * @param {String} plural string"," * @return {String} singular or plural, * is replaced with count"," * @api public"," */","","var plural = exports.plural = function plural (count, sn, pl) {","\tif (arguments.length === 1) {","\t\treturn inflect.pluralize(count);","\t}","\tif (typeof sn !== 'string') sn = '';","\tif (!pl) {","\t\tpl = inflect.pluralize(sn);","\t}","\tif (typeof count === 'string') {","\t\tcount = Number(count);","\t} else if (typeof count !== 'number') {","\t\tcount = Object.keys(count).length;","\t}","\treturn (count === 1 ? sn : pl).replace('*', count);","};","","/**"," * Converts the first letter in a string to uppercase"," *"," * @param {String} str"," * @return {String} Str"," * @api public"," */","","var upcase = exports.upcase = function upcase (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn (str.substr(0, 1).toUpperCase() + str.substr(1));","};","","/**"," * Converts the first letter in a string to lowercase"," *"," * @param {String} Str"," * @return {String} str"," * @api public"," */","","var downcase = exports.downcase = function downcase (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn (str.substr(0, 1).toLowerCase() + str.substr(1));","};","","/**"," * Converts a string to title case"," *"," * @param {String} str"," * @return {String} Title Case form of str"," * @api public"," */","","var titlecase = exports.titlecase = function titlecase (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tstr = str.replace(/([a-z])([A-Z])/g, '$1 $2');","\tvar parts = str.split(/\\s|_|\\-/);","\tfor (var i = 0; i < parts.length; i++) {","\t\tif (parts[i] && !/^[A-Z0-9]+$/.test(parts[i])) {","\t\t\tparts[i] = upcase(parts[i]);","\t\t}","\t}","\treturn compact(parts).join(' ');","};","","/**"," * Converts a string to camel case"," *"," * @param {String} str"," * @param {Boolean} lowercaseFirstWord"," * @return {String} camel-case form of str"," * @api public"," */","","var camelcase = exports.camelcase = function camelcase (str, lc) {","\treturn inflect.camelize(str, !(lc));","};","","/**"," * Decodes HTML Entities in a string"," *"," * @param {String}"," * @return {String}"," * @api public"," */","","var decodeHTMLEntities = exports.decodeHTMLEntities = function decodeHTMLEntities (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn str.replace(/&([^;&\\s]+);/g, function (match, ent) {","\t\treturn String.fromCharCode(ent[0] !== '#' ? htmlEntities[ent] : ent[1] === 'x' ? parseInt(ent.substr(2), 16) : parseInt(ent.substr(1), 10));","\t});","};","","/**"," * Encodes HTML Entities in a string"," *"," * @param {String}"," * @return {String}"," * @api public"," */","","var encodeHTMLEntities = exports.encodeHTMLEntities = function encodeHTMLEntities (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn str.replace(htmlEntitiesRegExp, function (match) {","\t\treturn '&' + htmlEntitiesMap[match] + ';';","\t});","};","","/**"," * Takes `obj`, `JSON.stringify`s it and escapes illegal JS but valid JSON unicode"," * characters."," *"," * @param {Object} obj"," * @return {String}"," * @apu public"," */","","var stringify = exports.stringify = function stringify (obj) {","\treturn JSON.stringify(obj).replace(/[\\u000A\\u000D\\u2028\\u2029]/g, function (c) {","\t\treturn '\\\\u' + ('0000' + c.charCodeAt(0).toString(16)).slice(-4);","\t});","};","","/**"," * Converts text to HTML (line breaks to <br>)"," *"," * @param {String} str"," * @return {String}"," * @api public"," */","","var textToHTML = exports.textToHTML = function textToHTML (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\treturn encodeHTMLEntities(str).replace(/\\n/g, '<br>');","};","","/**"," * Ultra simple converter to turn HTML into text."," *"," * Really only useful when you need a lightweight way to remove html from a string"," * before cropping it, so you don't end up with partial tags or an invalid DOM"," * structure."," *"," * It will convert `br`, `p`, `div`, `li`, `td`, `th` tags to single line-breaks."," * All other tags are stripped."," *"," * Multiple line breaks are then compressed to a single line break, and leading /"," * trailing white space is stripped."," *"," * For a more sophisticated use-case, you should check out the `to-markdown` and"," * `html-to-text` packages on npm."," *"," * @param {String} str"," * @return {String}"," * @api public"," */","","var htmlToText = exports.htmlToText = function htmlToText (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\t// remove all source-code line-breaks first","\tstr = str.replace(/\\n/g, '');","\t// turn non-breaking spaces into normal spaces","\tstr = str.replace(/&nbsp;/g, ' ');","\t// <br> tags become single line-breaks","\tstr = str.replace(/<br>/gi, '\\n');","\t// <p>, <li>, <td> and <th> tags become double line-breaks","\tstr = str.replace(/<(?:p|li|td|th)[^>]*>/gi, '\\n');","\t// strip all other tags (including closing tags)","\tstr = str.replace(/<[^>]*>/g, '');","\t// compress white space","\tstr = str.replace(/(\\s)\\s+/g, '$1');","\t// remove leading or trailing spaces","\tstr = str.replace(/^\\s+|\\s+$/g, '');","\treturn decodeHTMLEntities(str);","};","","/**"," * Crops a string to the specified length."," *"," * You can optionally a string to append (only appended if the original string was longer"," * than the specified length)."," *"," * If preserveWords is true, the length is extended to the end of the last word that would"," * have been cropped."," *"," * @param {String} string to crop"," * @param {Number} length to crop to"," * @param {String} string to append"," * @param {Boolean} whether to preserve the last word in full"," * @return {String} cropped string"," * @api public"," */","","var cropString = exports.cropString = function cropString (str, length, append, preserveWords) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tif (typeof append === 'boolean') {","\t\tpreserveWords = append;","\t\tappend = null;","\t}","\tstr = String(str);","\tif (str.length <= length) return str;","\tvar cropTo = length;","\tif (preserveWords) {","\t\tvar r = str.substr(cropTo);","\t\tvar word = r.match(/^\\w+/);","\t\tif (word && word.length) {","\t\t\tcropTo += word[0].length;","\t\t}","\t}","\tvar rtn = str.substr(0, cropTo);","\treturn (rtn.length < str.length && append) ? rtn + append : rtn;","};","","/**"," * Crops an HTML string safely by converting it to text, cropping it, then converting it"," * back to HTML. Also prevents cross-site attacks by stripping tags.","*/","","var cropHTMLString = exports.cropHTMLString = function cropHTMLString (str, length, append, preserveWords) {","\treturn textToHTML(cropString(htmlToText(str), length, append, preserveWords));","};","","/**"," * Converts a key to a label."," *"," * @param {String} key"," * @return {String}"," * @api public"," */","","var keyToLabel = exports.keyToLabel = function keyToLabel (str) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tstr = str.replace(/([a-z])([A-Z])/g, '$1 $2');","\tstr = str.replace(/([0-9])([a-zA-Z])/g, '$1 $2');","\tstr = str.replace(/([a-zA-Z])([0-9])/g, '$1 $2');","\tvar parts = str.split(/\\s|\\.|_|-|:|;|([A-z\\u00C0-\\u00ff]+)/);","\tfor (var i = 0; i < parts.length; i++) {","\t\tif (parts[i] && !/^[A-Z0-9]+$/.test(parts[i])) {","\t\t\tparts[i] = upcase(parts[i]);","\t\t}","\t}","\treturn compact(parts).join(' ');","};","","/**"," * Converts a key to a path. Like slug(keyToLabel(str)) but"," * optionally converts the last word to a plural."," *"," * @param {String} key"," * @return {String}"," * @api public"," */","","var keyToPath = exports.keyToPath = function keyToPath (str, plural) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tvar parts = slug(keyToLabel(str)).split('-');","\tif (parts.length && plural) {","\t\tparts[parts.length - 1] = inflect.pluralize(parts[parts.length - 1]);","\t}","\treturn parts.join('-');","};","","/**"," * Converts a key to a property. Like keyToPath but converts"," * to headlessCamelCase instead of dash-separated"," *"," * @param {String} key"," * @return {String}"," * @api public"," */","","var keyToProperty = exports.keyToProperty = function keyToProperty (str, plural) {","\tif (str && str.toString) str = str.toString();","\tif (!isString(str) || !str.length) return '';","\tvar parts = slug(keyToLabel(str)).split('-');","\tif (parts.length && plural) {","\t\tparts[parts.length - 1] = inflect.pluralize(parts[parts.length - 1]);","\t}","\tfor (var i = 1; i < parts.length; i++) {","\t\tparts[i] = upcase(parts[i]);","\t}","\treturn parts.join('');","};","","/**"," * Distance calculation function"," *"," * See http://en.wikipedia.org/wiki/Haversine_formula"," *"," * @param {Array} point1"," * @param {Array} point2"," * @return {Number} distance in radians"," * @api public"," */","","var calculateDistance = exports.calculateDistance = function calculateDistance (point1, point2) {","\tvar dLng = (point2[0] - point1[0]) * Math.PI / 180;","\tvar dLat = (point2[1] - point1[1]) * Math.PI / 180;","\tvar lat1 = (point1[1]) * Math.PI / 180;","\tvar lat2 = (point2[1]) * Math.PI / 180;","\tvar a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.sin(dLng / 2) * Math.sin(dLng / 2) * Math.cos(lat1) * Math.cos(lat2);","\tvar c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));","\treturn c;","};","","/**"," * Returns the distance between two [lat,lng] points in kilometres"," *"," * @param {Array} point1"," * @param {Array} point2"," * @return {Number} distance in kilometres"," * @api public"," */","","exports.kmBetween = function kmBetween (point1, point2) {","\treturn calculateDistance(point1, point2) * RADIUS_KM;","};","","/**"," * Returns the distance between two [lat,lng] points in miles"," *"," * @param {Array} point1"," * @param {Array} point2"," * @return {Number} distance in miles"," * @api public"," */","","exports.milesBetween = function milesBetween (point1, point2) {","\treturn calculateDistance(point1, point2) * RADIUS_MILES;","};",""],"l":{"12":1,"13":1,"15":1,"16":1,"17":1,"21":1,"22":1,"23":1,"25":1,"26":1,"27":253,"28":253,"29":253,"31":1,"35":1,"37":1,"40":1,"41":1,"43":1,"44":0,"45":0,"49":1,"50":0,"51":0,"62":1,"63":0,"74":1,"75":0,"86":1,"87":0,"88":0,"89":0,"91":0,"103":1,"104":0,"115":1,"116":0,"127":1,"128":0,"139":1,"140":0,"153":1,"154":0,"165":1,"166":0,"167":0,"168":0,"180":1,"181":0,"182":0,"183":0,"184":0,"186":0,"199":1,"200":0,"201":0,"202":0,"204":0,"205":0,"206":0,"207":0,"208":0,"210":0,"212":0,"218":1,"227":1,"228":0,"229":0,"242":1,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"251":0,"263":1,"276":1,"277":0,"288":1,"289":0,"290":0,"291":0,"302":1,"303":0,"304":0,"305":0,"316":1,"317":0,"318":0,"319":0,"320":0,"321":0,"322":0,"324":0,"334":1,"335":0,"336":0,"337":0,"339":0,"340":0,"342":0,"343":0,"344":0,"345":0,"347":0,"362":1,"363":0,"364":0,"366":0,"367":0,"368":0,"379":1,"380":0,"396":1,"397":0,"398":0,"400":0,"401":0,"402":0,"404":0,"405":0,"406":0,"407":0,"409":0,"420":1,"421":0,"422":0,"423":0,"434":1,"435":0,"436":0,"437":0,"448":1,"449":0,"450":0,"451":0,"452":0,"453":0,"454":0,"455":0,"458":0,"470":1,"471":0,"482":1,"483":0,"484":0,"485":0,"486":0,"498":1,"499":0,"500":0,"501":0,"502":0,"515":1,"516":0,"517":0,"529":1,"530":0,"531":0,"532":0,"556":1,"557":0,"558":0,"560":0,"562":0,"564":0,"566":0,"568":0,"570":0,"572":0,"573":0,"593":1,"594":0,"595":0,"596":0,"597":0,"598":0,"600":0,"601":0,"602":0,"603":0,"604":0,"605":0,"606":0,"607":0,"610":0,"611":0,"619":1,"620":0,"631":1,"632":0,"633":0,"634":0,"635":0,"636":0,"637":0,"638":0,"639":0,"640":0,"643":0,"655":1,"656":0,"657":0,"658":0,"659":0,"660":0,"662":0,"674":1,"675":0,"676":0,"677":0,"678":0,"679":0,"681":0,"682":0,"684":0,"698":1,"699":0,"700":0,"701":0,"702":0,"703":0,"704":0,"705":0,"717":1,"718":0,"730":1,"731":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/htmlEntities.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/htmlEntities.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":34,"column":2}}},"branchMap":{},"code":["exports = module.exports = {","\tapos: 0x0027, quot: 0x0022, amp: 0x0026, lt: 0x003C, gt: 0x003E, nbsp: 0x00A0, iexcl: 0x00A1, cent: 0x00A2, pound: 0x00A3,","\tcurren: 0x00A4, yen: 0x00A5, brvbar: 0x00A6, sect: 0x00A7, uml: 0x00A8, copy: 0x00A9, ordf: 0x00AA, laquo: 0x00AB,","\tnot: 0x00AC, shy: 0x00AD, reg: 0x00AE, macr: 0x00AF, deg: 0x00B0, plusmn: 0x00B1, sup2: 0x00B2, sup3: 0x00B3,","\tacute: 0x00B4, micro: 0x00B5, para: 0x00B6, middot: 0x00B7, cedil: 0x00B8, sup1: 0x00B9, ordm: 0x00BA, raquo: 0x00BB,","\tfrac14: 0x00BC, frac12: 0x00BD, frac34: 0x00BE, iquest: 0x00BF, Agrave: 0x00C0, Aacute: 0x00C1, Acirc: 0x00C2, Atilde: 0x00C3,","\tAuml: 0x00C4, Aring: 0x00C5, AElig: 0x00C6, Ccedil: 0x00C7, Egrave: 0x00C8, Eacute: 0x00C9, Ecirc: 0x00CA, Euml: 0x00CB,","\tIgrave: 0x00CC, Iacute: 0x00CD, Icirc: 0x00CE, Iuml: 0x00CF, ETH: 0x00D0, Ntilde: 0x00D1, Ograve: 0x00D2, Oacute: 0x00D3,","\tOcirc: 0x00D4, Otilde: 0x00D5, Ouml: 0x00D6, times: 0x00D7, Oslash: 0x00D8, Ugrave: 0x00D9, Uacute: 0x00DA, Ucirc: 0x00DB,","\tUuml: 0x00DC, Yacute: 0x00DD, THORN: 0x00DE, szlig: 0x00DF, agrave: 0x00E0, aacute: 0x00E1, acirc: 0x00E2, atilde: 0x00E3,","\tauml: 0x00E4, aring: 0x00E5, aelig: 0x00E6, ccedil: 0x00E7, egrave: 0x00E8, eacute: 0x00E9, ecirc: 0x00EA, euml: 0x00EB,","\tigrave: 0x00EC, iacute: 0x00ED, icirc: 0x00EE, iuml: 0x00EF, eth: 0x00F0, ntilde: 0x00F1, ograve: 0x00F2, oacute: 0x00F3,","\tocirc: 0x00F4, otilde: 0x00F5, ouml: 0x00F6, divide: 0x00F7, oslash: 0x00F8, ugrave: 0x00F9, uacute: 0x00FA, ucirc: 0x00FB,","\tuuml: 0x00FC, yacute: 0x00FD, thorn: 0x00FE, yuml: 0x00FF, OElig: 0x0152, oelig: 0x0153, Scaron: 0x0160, scaron: 0x0161,","\tYuml: 0x0178, fnof: 0x0192, circ: 0x02C6, tilde: 0x02DC, Alpha: 0x0391, Beta: 0x0392, Gamma: 0x0393, Delta: 0x0394,","\tEpsilon: 0x0395, Zeta: 0x0396, Eta: 0x0397, Theta: 0x0398, Iota: 0x0399, Kappa: 0x039A, Lambda: 0x039B, Mu: 0x039C,","\tNu: 0x039D, Xi: 0x039E, Omicron: 0x039F, Pi: 0x03A0, Rho: 0x03A1, Sigma: 0x03A3, Tau: 0x03A4, Upsilon: 0x03A5,","\tPhi: 0x03A6, Chi: 0x03A7, Psi: 0x03A8, Omega: 0x03A9, alpha: 0x03B1, beta: 0x03B2, gamma: 0x03B3, delta: 0x03B4,","\tepsilon: 0x03B5, zeta: 0x03B6, eta: 0x03B7, theta: 0x03B8, iota: 0x03B9, kappa: 0x03BA, lambda: 0x03BB, mu: 0x03BC,","\tnu: 0x03BD, xi: 0x03BE, omicron: 0x03BF, pi: 0x03C0, rho: 0x03C1, sigmaf: 0x03C2, sigma: 0x03C3, tau: 0x03C4,","\tupsilon: 0x03C5, phi: 0x03C6, chi: 0x03C7, psi: 0x03C8, omega: 0x03C9, thetasym: 0x03D1, upsih: 0x03D2, piv: 0x03D6,","\tensp: 0x2002, emsp: 0x2003, thinsp: 0x2009, zwnj: 0x200C, zwj: 0x200D, lrm: 0x200E, rlm: 0x200F, ndash: 0x2013,","\tmdash: 0x2014, lsquo: 0x2018, rsquo: 0x2019, sbquo: 0x201A, ldquo: 0x201C, rdquo: 0x201D, bdquo: 0x201E, dagger: 0x2020,","\tDagger: 0x2021, bull: 0x2022, hellip: 0x2026, permil: 0x2030, prime: 0x2032, Prime: 0x2033, lsaquo: 0x2039, rsaquo: 0x203A,","\toline: 0x203E, frasl: 0x2044, euro: 0x20AC, image: 0x2111, weierp: 0x2118, real: 0x211C, trade: 0x2122, alefsym: 0x2135,","\tlarr: 0x2190, uarr: 0x2191, rarr: 0x2192, darr: 0x2193, harr: 0x2194, crarr: 0x21B5, lArr: 0x21D0, uArr: 0x21D1,","\trArr: 0x21D2, dArr: 0x21D3, hArr: 0x21D4, forall: 0x2200, part: 0x2202, exist: 0x2203, empty: 0x2205, nabla: 0x2207,","\tisin: 0x2208, notin: 0x2209, ni: 0x220B, prod: 0x220F, sum: 0x2211, minus: 0x2212, lowast: 0x2217, radic: 0x221A,","\tprop: 0x221D, infin: 0x221E, ang: 0x2220, and: 0x2227, or: 0x2228, cap: 0x2229, cup: 0x222A, 'int': 0x222B,","\tthere4: 0x2234, sim: 0x223C, cong: 0x2245, asymp: 0x2248, ne: 0x2260, equiv: 0x2261, le: 0x2264, ge: 0x2265,","\tsub: 0x2282, sup: 0x2283, nsub: 0x2284, sube: 0x2286, supe: 0x2287, oplus: 0x2295, otimes: 0x2297, perp: 0x22A5,","\tsdot: 0x22C5, lceil: 0x2308, rceil: 0x2309, lfloor: 0x230A, rfloor: 0x230B, lang: 0x2329, rang: 0x232A, loz: 0x25CA,","\tspades: 0x2660, clubs: 0x2663, hearts: 0x2665, diams: 0x2666","};",""],"l":{"1":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/diacritics.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/diacritics.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":93,"column":2}}},"branchMap":{},"code":["exports = module.exports = {","\t'\\u24B6': 'A', '\\uFF21': 'A', '\\u00C0': 'A', '\\u00C1': 'A', '\\u00C2': 'A', '\\u1EA6': 'A', '\\u1EA4': 'A', '\\u1EAA': 'A', '\\u1EA8': 'A',","\t'\\u00C3': 'A', '\\u0100': 'A', '\\u0102': 'A', '\\u1EB0': 'A', '\\u1EAE': 'A', '\\u1EB4': 'A', '\\u1EB2': 'A', '\\u0226': 'A', '\\u01E0': 'A',","\t'\\u00C4': 'A', '\\u01DE': 'A', '\\u1EA2': 'A', '\\u00C5': 'A', '\\u01FA': 'A', '\\u01CD': 'A', '\\u0200': 'A', '\\u0202': 'A', '\\u1EA0': 'A',","\t'\\u1EAC': 'A', '\\u1EB6': 'A', '\\u1E00': 'A', '\\u0104': 'A', '\\u023A': 'A', '\\u2C6F': 'A', '\\uA732': 'AA', '\\u00C6': 'AE', '\\u01FC': 'AE',","\t'\\u01E2': 'AE', '\\uA734': 'AO', '\\uA736': 'AU', '\\uA738': 'AV', '\\uA73A': 'AV', '\\uA73C': 'AY', '\\u24B7': 'B', '\\uFF22': 'B', '\\u1E02': 'B',","\t'\\u1E04': 'B', '\\u1E06': 'B', '\\u0243': 'B', '\\u0182': 'B', '\\u0181': 'B', '\\u24B8': 'C', '\\uFF23': 'C', '\\u0106': 'C', '\\u0108': 'C',","\t'\\u010A': 'C', '\\u010C': 'C', '\\u00C7': 'C', '\\u1E08': 'C', '\\u0187': 'C', '\\u023B': 'C', '\\uA73E': 'C', '\\u24B9': 'D', '\\uFF24': 'D',","\t'\\u1E0A': 'D', '\\u010E': 'D', '\\u1E0C': 'D', '\\u1E10': 'D', '\\u1E12': 'D', '\\u1E0E': 'D', '\\u0110': 'D', '\\u018B': 'D', '\\u018A': 'D',","\t'\\u0189': 'D', '\\uA779': 'D', '\\u01F1': 'DZ', '\\u01C4': 'DZ', '\\u01F2': 'Dz', '\\u01C5': 'Dz', '\\u24BA': 'E', '\\uFF25': 'E', '\\u00C8': 'E',","\t'\\u00C9': 'E', '\\u00CA': 'E', '\\u1EC0': 'E', '\\u1EBE': 'E', '\\u1EC4': 'E', '\\u1EC2': 'E', '\\u1EBC': 'E', '\\u0112': 'E', '\\u1E14': 'E',","\t'\\u1E16': 'E', '\\u0114': 'E', '\\u0116': 'E', '\\u00CB': 'E', '\\u1EBA': 'E', '\\u011A': 'E', '\\u0204': 'E', '\\u0206': 'E', '\\u1EB8': 'E',","\t'\\u1EC6': 'E', '\\u0228': 'E', '\\u1E1C': 'E', '\\u0118': 'E', '\\u1E18': 'E', '\\u1E1A': 'E', '\\u0190': 'E', '\\u018E': 'E', '\\u24BB': 'F',","\t'\\uFF26': 'F', '\\u1E1E': 'F', '\\u0191': 'F', '\\uA77B': 'F', '\\u24BC': 'G', '\\uFF27': 'G', '\\u01F4': 'G', '\\u011C': 'G', '\\u1E20': 'G',","\t'\\u011E': 'G', '\\u0120': 'G', '\\u01E6': 'G', '\\u0122': 'G', '\\u01E4': 'G', '\\u0193': 'G', '\\uA7A0': 'G', '\\uA77D': 'G', '\\uA77E': 'G',","\t'\\u24BD': 'H', '\\uFF28': 'H', '\\u0124': 'H', '\\u1E22': 'H', '\\u1E26': 'H', '\\u021E': 'H', '\\u1E24': 'H', '\\u1E28': 'H', '\\u1E2A': 'H',","\t'\\u0126': 'H', '\\u2C67': 'H', '\\u2C75': 'H', '\\uA78D': 'H', '\\u24BE': 'I', '\\uFF29': 'I', '\\u00CC': 'I', '\\u00CD': 'I', '\\u00CE': 'I',","\t'\\u0128': 'I', '\\u012A': 'I', '\\u012C': 'I', '\\u0130': 'I', '\\u00CF': 'I', '\\u1E2E': 'I', '\\u1EC8': 'I', '\\u01CF': 'I', '\\u0208': 'I',","\t'\\u020A': 'I', '\\u1ECA': 'I', '\\u012E': 'I', '\\u1E2C': 'I', '\\u0197': 'I', '\\u24BF': 'J', '\\uFF2A': 'J', '\\u0134': 'J', '\\u0248': 'J',","\t'\\u24C0': 'K', '\\uFF2B': 'K', '\\u1E30': 'K', '\\u01E8': 'K', '\\u1E32': 'K', '\\u0136': 'K', '\\u1E34': 'K', '\\u0198': 'K', '\\u2C69': 'K',","\t'\\uA740': 'K', '\\uA742': 'K', '\\uA744': 'K', '\\uA7A2': 'K', '\\u24C1': 'L', '\\uFF2C': 'L', '\\u013F': 'L', '\\u0139': 'L', '\\u013D': 'L',","\t'\\u1E36': 'L', '\\u1E38': 'L', '\\u013B': 'L', '\\u1E3C': 'L', '\\u1E3A': 'L', '\\u0141': 'L', '\\u023D': 'L', '\\u2C62': 'L', '\\u2C60': 'L',","\t'\\uA748': 'L', '\\uA746': 'L', '\\uA780': 'L', '\\u01C7': 'LJ', '\\u01C8': 'Lj', '\\u24C2': 'M', '\\uFF2D': 'M', '\\u1E3E': 'M', '\\u1E40': 'M',","\t'\\u1E42': 'M', '\\u2C6E': 'M', '\\u019C': 'M', '\\u24C3': 'N', '\\uFF2E': 'N', '\\u01F8': 'N', '\\u0143': 'N', '\\u00D1': 'N', '\\u1E44': 'N',","\t'\\u0147': 'N', '\\u1E46': 'N', '\\u0145': 'N', '\\u1E4A': 'N', '\\u1E48': 'N', '\\u0220': 'N', '\\u019D': 'N', '\\uA790': 'N', '\\uA7A4': 'N',","\t'\\u01CA': 'NJ', '\\u01CB': 'Nj', '\\u24C4': 'O', '\\uFF2F': 'O', '\\u00D2': 'O', '\\u00D3': 'O', '\\u00D4': 'O', '\\u1ED2': 'O', '\\u1ED0': 'O',","\t'\\u1ED6': 'O', '\\u1ED4': 'O', '\\u00D5': 'O', '\\u1E4C': 'O', '\\u022C': 'O', '\\u1E4E': 'O', '\\u014C': 'O', '\\u1E50': 'O', '\\u1E52': 'O',","\t'\\u014E': 'O', '\\u022E': 'O', '\\u0230': 'O', '\\u00D6': 'O', '\\u022A': 'O', '\\u1ECE': 'O', '\\u0150': 'O', '\\u01D1': 'O', '\\u020C': 'O',","\t'\\u020E': 'O', '\\u01A0': 'O', '\\u1EDC': 'O', '\\u1EDA': 'O', '\\u1EE0': 'O', '\\u1EDE': 'O', '\\u1EE2': 'O', '\\u1ECC': 'O', '\\u1ED8': 'O',","\t'\\u01EA': 'O', '\\u01EC': 'O', '\\u00D8': 'O', '\\u01FE': 'O', '\\u0186': 'O', '\\u019F': 'O', '\\uA74A': 'O', '\\uA74C': 'O', '\\u01A2': 'OI',","\t'\\uA74E': 'OO', '\\u0222': 'OU', '\\u24C5': 'P', '\\uFF30': 'P', '\\u1E54': 'P', '\\u1E56': 'P', '\\u01A4': 'P', '\\u2C63': 'P', '\\uA750': 'P',","\t'\\uA752': 'P', '\\uA754': 'P', '\\u24C6': 'Q', '\\uFF31': 'Q', '\\uA756': 'Q', '\\uA758': 'Q', '\\u024A': 'Q', '\\u24C7': 'R', '\\uFF32': 'R',","\t'\\u0154': 'R', '\\u1E58': 'R', '\\u0158': 'R', '\\u0210': 'R', '\\u0212': 'R', '\\u1E5A': 'R', '\\u1E5C': 'R', '\\u0156': 'R', '\\u1E5E': 'R',","\t'\\u024C': 'R', '\\u2C64': 'R', '\\uA75A': 'R', '\\uA7A6': 'R', '\\uA782': 'R', '\\u24C8': 'S', '\\uFF33': 'S', '\\u1E9E': 'S', '\\u015A': 'S',","\t'\\u1E64': 'S', '\\u015C': 'S', '\\u1E60': 'S', '\\u0160': 'S', '\\u1E66': 'S', '\\u1E62': 'S', '\\u1E68': 'S', '\\u0218': 'S', '\\u015E': 'S',","\t'\\u2C7E': 'S', '\\uA7A8': 'S', '\\uA784': 'S', '\\u24C9': 'T', '\\uFF34': 'T', '\\u1E6A': 'T', '\\u0164': 'T', '\\u1E6C': 'T', '\\u021A': 'T',","\t'\\u0162': 'T', '\\u1E70': 'T', '\\u1E6E': 'T', '\\u0166': 'T', '\\u01AC': 'T', '\\u01AE': 'T', '\\u023E': 'T', '\\uA786': 'T', '\\uA728': 'TZ',","\t'\\u24CA': 'U', '\\uFF35': 'U', '\\u00D9': 'U', '\\u00DA': 'U', '\\u00DB': 'U', '\\u0168': 'U', '\\u1E78': 'U', '\\u016A': 'U', '\\u1E7A': 'U',","\t'\\u016C': 'U', '\\u00DC': 'U', '\\u01DB': 'U', '\\u01D7': 'U', '\\u01D5': 'U', '\\u01D9': 'U', '\\u1EE6': 'U', '\\u016E': 'U', '\\u0170': 'U',","\t'\\u01D3': 'U', '\\u0214': 'U', '\\u0216': 'U', '\\u01AF': 'U', '\\u1EEA': 'U', '\\u1EE8': 'U', '\\u1EEE': 'U', '\\u1EEC': 'U', '\\u1EF0': 'U',","\t'\\u1EE4': 'U', '\\u1E72': 'U', '\\u0172': 'U', '\\u1E76': 'U', '\\u1E74': 'U', '\\u0244': 'U', '\\u24CB': 'V', '\\uFF36': 'V', '\\u1E7C': 'V',","\t'\\u1E7E': 'V', '\\u01B2': 'V', '\\uA75E': 'V', '\\u0245': 'V', '\\uA760': 'VY', '\\u24CC': 'W', '\\uFF37': 'W', '\\u1E80': 'W', '\\u1E82': 'W',","\t'\\u0174': 'W', '\\u1E86': 'W', '\\u1E84': 'W', '\\u1E88': 'W', '\\u2C72': 'W', '\\u24CD': 'X', '\\uFF38': 'X', '\\u1E8A': 'X', '\\u1E8C': 'X',","\t'\\u24CE': 'Y', '\\uFF39': 'Y', '\\u1EF2': 'Y', '\\u00DD': 'Y', '\\u0176': 'Y', '\\u1EF8': 'Y', '\\u0232': 'Y', '\\u1E8E': 'Y', '\\u0178': 'Y',","\t'\\u1EF6': 'Y', '\\u1EF4': 'Y', '\\u01B3': 'Y', '\\u024E': 'Y', '\\u1EFE': 'Y', '\\u24CF': 'Z', '\\uFF3A': 'Z', '\\u0179': 'Z', '\\u1E90': 'Z',","\t'\\u017B': 'Z', '\\u017D': 'Z', '\\u1E92': 'Z', '\\u1E94': 'Z', '\\u01B5': 'Z', '\\u0224': 'Z', '\\u2C7F': 'Z', '\\u2C6B': 'Z', '\\uA762': 'Z',","\t'\\u24D0': 'a', '\\uFF41': 'a', '\\u1E9A': 'a', '\\u00E0': 'a', '\\u00E1': 'a', '\\u00E2': 'a', '\\u1EA7': 'a', '\\u1EA5': 'a', '\\u1EAB': 'a',","\t'\\u1EA9': 'a', '\\u00E3': 'a', '\\u0101': 'a', '\\u0103': 'a', '\\u1EB1': 'a', '\\u1EAF': 'a', '\\u1EB5': 'a', '\\u1EB3': 'a', '\\u0227': 'a',","\t'\\u01E1': 'a', '\\u00E4': 'a', '\\u01DF': 'a', '\\u1EA3': 'a', '\\u00E5': 'a', '\\u01FB': 'a', '\\u01CE': 'a', '\\u0201': 'a', '\\u0203': 'a',","\t'\\u1EA1': 'a', '\\u1EAD': 'a', '\\u1EB7': 'a', '\\u1E01': 'a', '\\u0105': 'a', '\\u2C65': 'a', '\\u0250': 'a', '\\uA733': 'aa', '\\u00E6': 'ae',","\t'\\u01FD': 'ae', '\\u01E3': 'ae', '\\uA735': 'ao', '\\uA737': 'au', '\\uA739': 'av', '\\uA73B': 'av', '\\uA73D': 'ay', '\\u24D1': 'b', '\\uFF42': 'b',","\t'\\u1E03': 'b', '\\u1E05': 'b', '\\u1E07': 'b', '\\u0180': 'b', '\\u0183': 'b', '\\u0253': 'b', '\\u24D2': 'c', '\\uFF43': 'c', '\\u0107': 'c',","\t'\\u0109': 'c', '\\u010B': 'c', '\\u010D': 'c', '\\u00E7': 'c', '\\u1E09': 'c', '\\u0188': 'c', '\\u023C': 'c', '\\uA73F': 'c', '\\u2184': 'c',","\t'\\u24D3': 'd', '\\uFF44': 'd', '\\u1E0B': 'd', '\\u010F': 'd', '\\u1E0D': 'd', '\\u1E11': 'd', '\\u1E13': 'd', '\\u1E0F': 'd', '\\u0111': 'd',","\t'\\u018C': 'd', '\\u0256': 'd', '\\u0257': 'd', '\\uA77A': 'd', '\\u01F3': 'dz', '\\u01C6': 'dz', '\\u24D4': 'e', '\\uFF45': 'e', '\\u00E8': 'e',","\t'\\u00E9': 'e', '\\u00EA': 'e', '\\u1EC1': 'e', '\\u1EBF': 'e', '\\u1EC5': 'e', '\\u1EC3': 'e', '\\u1EBD': 'e', '\\u0113': 'e', '\\u1E15': 'e',","\t'\\u1E17': 'e', '\\u0115': 'e', '\\u0117': 'e', '\\u00EB': 'e', '\\u1EBB': 'e', '\\u011B': 'e', '\\u0205': 'e', '\\u0207': 'e', '\\u1EB9': 'e',","\t'\\u1EC7': 'e', '\\u0229': 'e', '\\u1E1D': 'e', '\\u0119': 'e', '\\u1E19': 'e', '\\u1E1B': 'e', '\\u0247': 'e', '\\u025B': 'e', '\\u01DD': 'e',","\t'\\u24D5': 'f', '\\uFF46': 'f', '\\u1E1F': 'f', '\\u0192': 'f', '\\uA77C': 'f', '\\u24D6': 'g', '\\uFF47': 'g', '\\u01F5': 'g', '\\u011D': 'g',","\t'\\u1E21': 'g', '\\u011F': 'g', '\\u0121': 'g', '\\u01E7': 'g', '\\u0123': 'g', '\\u01E5': 'g', '\\u0260': 'g', '\\uA7A1': 'g', '\\u1D79': 'g',","\t'\\uA77F': 'g', '\\u24D7': 'h', '\\uFF48': 'h', '\\u0125': 'h', '\\u1E23': 'h', '\\u1E27': 'h', '\\u021F': 'h', '\\u1E25': 'h', '\\u1E29': 'h',","\t'\\u1E2B': 'h', '\\u1E96': 'h', '\\u0127': 'h', '\\u2C68': 'h', '\\u2C76': 'h', '\\u0265': 'h', '\\u0195': 'hv', '\\u24D8': 'i', '\\uFF49': 'i',","\t'\\u00EC': 'i', '\\u00ED': 'i', '\\u00EE': 'i', '\\u0129': 'i', '\\u012B': 'i', '\\u012D': 'i', '\\u00EF': 'i', '\\u1E2F': 'i', '\\u1EC9': 'i',","\t'\\u01D0': 'i', '\\u0209': 'i', '\\u020B': 'i', '\\u1ECB': 'i', '\\u012F': 'i', '\\u1E2D': 'i', '\\u0268': 'i', '\\u0131': 'i', '\\u24D9': 'j',","\t'\\uFF4A': 'j', '\\u0135': 'j', '\\u01F0': 'j', '\\u0249': 'j', '\\u24DA': 'k', '\\uFF4B': 'k', '\\u1E31': 'k', '\\u01E9': 'k', '\\u1E33': 'k',","\t'\\u0137': 'k', '\\u1E35': 'k', '\\u0199': 'k', '\\u2C6A': 'k', '\\uA741': 'k', '\\uA743': 'k', '\\uA745': 'k', '\\uA7A3': 'k', '\\u24DB': 'l',","\t'\\uFF4C': 'l', '\\u0140': 'l', '\\u013A': 'l', '\\u013E': 'l', '\\u1E37': 'l', '\\u1E39': 'l', '\\u013C': 'l', '\\u1E3D': 'l', '\\u1E3B': 'l',","\t'\\u017F': 'l', '\\u0142': 'l', '\\u019A': 'l', '\\u026B': 'l', '\\u2C61': 'l', '\\uA749': 'l', '\\uA781': 'l', '\\uA747': 'l', '\\u01C9': 'lj',","\t'\\u24DC': 'm', '\\uFF4D': 'm', '\\u1E3F': 'm', '\\u1E41': 'm', '\\u1E43': 'm', '\\u0271': 'm', '\\u026F': 'm', '\\u24DD': 'n', '\\uFF4E': 'n',","\t'\\u01F9': 'n', '\\u0144': 'n', '\\u00F1': 'n', '\\u1E45': 'n', '\\u0148': 'n', '\\u1E47': 'n', '\\u0146': 'n', '\\u1E4B': 'n', '\\u1E49': 'n',","\t'\\u019E': 'n', '\\u0272': 'n', '\\u0149': 'n', '\\uA791': 'n', '\\uA7A5': 'n', '\\u01CC': 'nj', '\\u24DE': 'o', '\\uFF4F': 'o', '\\u00F2': 'o',","\t'\\u00F3': 'o', '\\u00F4': 'o', '\\u1ED3': 'o', '\\u1ED1': 'o', '\\u1ED7': 'o', '\\u1ED5': 'o', '\\u00F5': 'o', '\\u1E4D': 'o', '\\u022D': 'o',","\t'\\u1E4F': 'o', '\\u014D': 'o', '\\u1E51': 'o', '\\u1E53': 'o', '\\u014F': 'o', '\\u022F': 'o', '\\u0231': 'o', '\\u00F6': 'o', '\\u022B': 'o',","\t'\\u1ECF': 'o', '\\u0151': 'o', '\\u01D2': 'o', '\\u020D': 'o', '\\u020F': 'o', '\\u01A1': 'o', '\\u1EDD': 'o', '\\u1EDB': 'o', '\\u1EE1': 'o',","\t'\\u1EDF': 'o', '\\u1EE3': 'o', '\\u1ECD': 'o', '\\u1ED9': 'o', '\\u01EB': 'o', '\\u01ED': 'o', '\\u00F8': 'o', '\\u01FF': 'o', '\\u0254': 'o',","\t'\\uA74B': 'o', '\\uA74D': 'o', '\\u0275': 'o', '\\u01A3': 'oi', '\\u0223': 'ou', '\\uA74F': 'oo', '\\u24DF': 'p', '\\uFF50': 'p', '\\u1E55': 'p',","\t'\\u1E57': 'p', '\\u01A5': 'p', '\\u1D7D': 'p', '\\uA751': 'p', '\\uA753': 'p', '\\uA755': 'p', '\\u24E0': 'q', '\\uFF51': 'q', '\\u024B': 'q',","\t'\\uA757': 'q', '\\uA759': 'q', '\\u24E1': 'r', '\\uFF52': 'r', '\\u0155': 'r', '\\u1E59': 'r', '\\u0159': 'r', '\\u0211': 'r', '\\u0213': 'r',","\t'\\u1E5B': 'r', '\\u1E5D': 'r', '\\u0157': 'r', '\\u1E5F': 'r', '\\u024D': 'r', '\\u027D': 'r', '\\uA75B': 'r', '\\uA7A7': 'r', '\\uA783': 'r',","\t'\\u24E2': 's', '\\uFF53': 's', '\\u00DF': 's', '\\u015B': 's', '\\u1E65': 's', '\\u015D': 's', '\\u1E61': 's', '\\u0161': 's', '\\u1E67': 's',","\t'\\u1E63': 's', '\\u1E69': 's', '\\u0219': 's', '\\u015F': 's', '\\u023F': 's', '\\uA7A9': 's', '\\uA785': 's', '\\u1E9B': 's', '\\u24E3': 't',","\t'\\uFF54': 't', '\\u1E6B': 't', '\\u1E97': 't', '\\u0165': 't', '\\u1E6D': 't', '\\u021B': 't', '\\u0163': 't', '\\u1E71': 't', '\\u1E6F': 't',","\t'\\u0167': 't', '\\u01AD': 't', '\\u0288': 't', '\\u2C66': 't', '\\uA787': 't', '\\uA729': 'tz', '\\u24E4': 'u', '\\uFF55': 'u', '\\u00F9': 'u',","\t'\\u00FA': 'u', '\\u00FB': 'u', '\\u0169': 'u', '\\u1E79': 'u', '\\u016B': 'u', '\\u1E7B': 'u', '\\u016D': 'u', '\\u00FC': 'u', '\\u01DC': 'u',","\t'\\u01D8': 'u', '\\u01D6': 'u', '\\u01DA': 'u', '\\u1EE7': 'u', '\\u016F': 'u', '\\u0171': 'u', '\\u01D4': 'u', '\\u0215': 'u', '\\u0217': 'u',","\t'\\u01B0': 'u', '\\u1EEB': 'u', '\\u1EE9': 'u', '\\u1EEF': 'u', '\\u1EED': 'u', '\\u1EF1': 'u', '\\u1EE5': 'u', '\\u1E73': 'u', '\\u0173': 'u',","\t'\\u1E77': 'u', '\\u1E75': 'u', '\\u0289': 'u', '\\u24E5': 'v', '\\uFF56': 'v', '\\u1E7D': 'v', '\\u1E7F': 'v', '\\u028B': 'v', '\\uA75F': 'v',","\t'\\u028C': 'v', '\\uA761': 'vy', '\\u24E6': 'w', '\\uFF57': 'w', '\\u1E81': 'w', '\\u1E83': 'w', '\\u0175': 'w', '\\u1E87': 'w', '\\u1E85': 'w',","\t'\\u1E98': 'w', '\\u1E89': 'w', '\\u2C73': 'w', '\\u24E7': 'x', '\\uFF58': 'x', '\\u1E8B': 'x', '\\u1E8D': 'x', '\\u24E8': 'y', '\\uFF59': 'y',","\t'\\u1EF3': 'y', '\\u00FD': 'y', '\\u0177': 'y', '\\u1EF9': 'y', '\\u0233': 'y', '\\u1E8F': 'y', '\\u00FF': 'y', '\\u1EF7': 'y', '\\u1E99': 'y',","\t'\\u1EF5': 'y', '\\u01B4': 'y', '\\u024F': 'y', '\\u1EFF': 'y', '\\u24E9': 'z', '\\uFF5A': 'z', '\\u017A': 'z', '\\u1E91': 'z', '\\u017C': 'z',","\t'\\u017E': 'z', '\\u1E93': 'z', '\\u1E95': 'z', '\\u01B6': 'z', '\\u0225': 'z', '\\u0240': 'z', '\\u2C6C': 'z', '\\uA763': 'z'","};",""],"l":{"1":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/transliteration.cyr.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone-utils/lib/transliteration.cyr.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":15,"column":0},"end":{"line":91,"column":2}},"2":{"start":{"line":93,"column":0},"end":{"line":96,"column":2}}},"branchMap":{},"code":["/*","* Copyright (c) 2013 Alexander Prozorov (staltec@gmail.com)","* https://github.com/Staltec/transliteration","*","* Copyright (c) 2011-2012 Anton Podviaznikov (anton@podviaznikov.com) by fork from https://github.com/podviaznikov/ua.transliteration","*","* Copyright (c) 2011 Enginimation Studio (http://enginimation.com).","*","* Copyright (c) 2014 Jed Watson (adaptation for keystone-utils)","*","* May be freely distributed under the MIT license.","*","*/","","exports.characterMap = {","\t'А': 'A',","\t'а': 'a',","\t'Б': 'B',","\t'б': 'b',","\t'В': 'V',","\t'в': 'v',","\t'Г': 'G',\t// russian","\t'г': 'g',\t// russian","\t'Ґ': 'G',","\t'ґ': 'g',","\t'Д': 'D',","\t'д': 'd',","\t'Е': 'E',","\t'е': 'e',","\t'Ё': 'E',","\t'ё': 'e',","\t'Є': 'Ye',\t// just on the word beginning","\t'є': 'ie',","\t'Ж': 'Zh',","\t'ж': 'zh',","\t'З': 'Z',","\t'з': 'z',","\t'И': 'Y',","\t'и': 'y',","\t'І': 'I',","\t'і': 'i',","\t'Ї': 'Yi',\t// just on the word beginning","\t'ї': 'i',","\t'Й': 'Y',\t// just on the word beginning","\t'й': 'i',","\t'К': 'K',","\t'к': 'k',","\t'Л': 'L',","\t'л': 'l',","\t'М': 'M',","\t'м': 'm',","\t'Н': 'N',","\t'н': 'n',","\t'О': 'O',","\t'о': 'o',","\t'П': 'P',","\t'п': 'p',","\t'Р': 'R',","\t'р': 'r',","\t'С': 'S',","\t'с': 's',","\t'Т': 'T',","\t'т': 't',","\t'У': 'U',","\t'у': 'u',","\t'Ф': 'F',","\t'ф': 'f',","\t'Х': 'Kh',","\t'х': 'kh',","\t'Ц': 'Ts',","\t'ц': 'ts',","\t'Ч': 'Ch',","\t'ч': 'ch',","\t'Ш': 'Sh',","\t'ш': 'sh',","\t'Щ': 'Shch',","\t'щ': 'shch',","\t'Ы': 'Y',","\t'ы': 'y',","\t'Э': 'E',","\t'э': 'e',","\t'Ю': 'Yu',\t// just on the word beginning","\t'ю': 'iu',","\t'Я': 'Ya',\t// just on the word beginning","\t'я': 'ia',","\t'Ь': '',\t// not transliterated","\t'ь': '',\t// not transliterated","\t'Ъ': '',\t// not transliterated","\t'ъ': '',\t// not transliterated","\t\"'\": ''\t\t// not transliterated","};","","exports.regexp = {","\tZgh: new RegExp('Зг', 'g'),","\tzgh: new RegExp('зг', 'g')","};",""],"l":{"15":1,"93":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/options.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/options.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":0,"14":1,"15":24,"16":3,"17":21,"18":0,"19":0,"20":0,"21":21,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":21,"70":21,"71":1,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":1,"82":1,"83":0,"84":1,"85":0,"86":0,"87":1,"88":1},"b":{"1":[3,21],"2":[0,21],"3":[0,0],"4":[0,0,0,0,1,0,0,0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,1],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0,0]},"f":{"1":1,"2":0,"3":24,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"options","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":19}}},"2":{"name":"isAbsolutePath","line":26,"loc":{"start":{"line":26,"column":1},"end":{"line":26,"column":32}}},"3":{"name":"(anonymous_3)","line":41,"loc":{"start":{"line":41,"column":15},"end":{"line":41,"column":36}}},"4":{"name":"(anonymous_4)","line":159,"loc":{"start":{"line":159,"column":19},"end":{"line":159,"column":37}}},"5":{"name":"(anonymous_5)","line":202,"loc":{"start":{"line":202,"column":19},"end":{"line":202,"column":47}}},"6":{"name":"(anonymous_6)","line":213,"loc":{"start":{"line":213,"column":22},"end":{"line":213,"column":42}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":36}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":39}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":54}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":42}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"7":{"start":{"line":7,"column":0},"end":{"line":7,"column":25}},"8":{"start":{"line":8,"column":0},"end":{"line":8,"column":38}},"9":{"start":{"line":10,"column":0},"end":{"line":222,"column":1}},"10":{"start":{"line":12,"column":1},"end":{"line":12,"column":18}},"11":{"start":{"line":20,"column":1},"end":{"line":23,"column":3}},"12":{"start":{"line":26,"column":1},"end":{"line":28,"column":2}},"13":{"start":{"line":27,"column":2},"end":{"line":27,"column":95}},"14":{"start":{"line":41,"column":1},"end":{"line":145,"column":3}},"15":{"start":{"line":43,"column":2},"end":{"line":45,"column":3}},"16":{"start":{"line":44,"column":3},"end":{"line":44,"column":29}},"17":{"start":{"line":47,"column":2},"end":{"line":53,"column":3}},"18":{"start":{"line":48,"column":3},"end":{"line":51,"column":4}},"19":{"start":{"line":49,"column":4},"end":{"line":50,"column":71}},"20":{"start":{"line":52,"column":3},"end":{"line":52,"column":30}},"21":{"start":{"line":55,"column":2},"end":{"line":141,"column":3}},"22":{"start":{"line":60,"column":4},"end":{"line":64,"column":5}},"23":{"start":{"line":61,"column":5},"end":{"line":63,"column":79}},"24":{"start":{"line":65,"column":3},"end":{"line":65,"column":9}},"25":{"start":{"line":69,"column":4},"end":{"line":79,"column":5}},"26":{"start":{"line":70,"column":5},"end":{"line":70,"column":40}},"27":{"start":{"line":71,"column":5},"end":{"line":71,"column":56}},"28":{"start":{"line":72,"column":5},"end":{"line":78,"column":7}},"29":{"start":{"line":80,"column":4},"end":{"line":82,"column":5}},"30":{"start":{"line":81,"column":5},"end":{"line":81,"column":30}},"31":{"start":{"line":83,"column":4},"end":{"line":83,"column":32}},"32":{"start":{"line":84,"column":3},"end":{"line":84,"column":9}},"33":{"start":{"line":86,"column":4},"end":{"line":89,"column":5}},"34":{"start":{"line":87,"column":5},"end":{"line":87,"column":32}},"35":{"start":{"line":88,"column":5},"end":{"line":88,"column":56}},"36":{"start":{"line":90,"column":3},"end":{"line":90,"column":9}},"37":{"start":{"line":92,"column":4},"end":{"line":95,"column":5}},"38":{"start":{"line":93,"column":5},"end":{"line":93,"column":39}},"39":{"start":{"line":94,"column":5},"end":{"line":94,"column":31}},"40":{"start":{"line":96,"column":3},"end":{"line":96,"column":9}},"41":{"start":{"line":98,"column":4},"end":{"line":98,"column":25}},"42":{"start":{"line":99,"column":4},"end":{"line":99,"column":35}},"43":{"start":{"line":100,"column":3},"end":{"line":100,"column":9}},"44":{"start":{"line":102,"column":4},"end":{"line":111,"column":5}},"45":{"start":{"line":103,"column":5},"end":{"line":110,"column":6}},"46":{"start":{"line":104,"column":6},"end":{"line":105,"column":89}},"47":{"start":{"line":106,"column":6},"end":{"line":106,"column":138}},"48":{"start":{"line":108,"column":6},"end":{"line":108,"column":140}},"49":{"start":{"line":109,"column":6},"end":{"line":109,"column":22}},"50":{"start":{"line":112,"column":3},"end":{"line":112,"column":9}},"51":{"start":{"line":115,"column":4},"end":{"line":118,"column":5}},"52":{"start":{"line":116,"column":5},"end":{"line":116,"column":37}},"53":{"start":{"line":117,"column":5},"end":{"line":117,"column":64}},"54":{"start":{"line":119,"column":3},"end":{"line":119,"column":9}},"55":{"start":{"line":121,"column":4},"end":{"line":121,"column":21}},"56":{"start":{"line":122,"column":3},"end":{"line":122,"column":9}},"57":{"start":{"line":124,"column":4},"end":{"line":124,"column":26}},"58":{"start":{"line":125,"column":3},"end":{"line":125,"column":9}},"59":{"start":{"line":127,"column":4},"end":{"line":127,"column":56}},"60":{"start":{"line":129,"column":4},"end":{"line":131,"column":5}},"61":{"start":{"line":130,"column":5},"end":{"line":130,"column":20}},"62":{"start":{"line":132,"column":4},"end":{"line":139,"column":5}},"63":{"start":{"line":133,"column":5},"end":{"line":133,"column":33}},"64":{"start":{"line":134,"column":5},"end":{"line":136,"column":6}},"65":{"start":{"line":135,"column":6},"end":{"line":135,"column":20}},"66":{"start":{"line":137,"column":11},"end":{"line":139,"column":5}},"67":{"start":{"line":138,"column":5},"end":{"line":138,"column":19}},"68":{"start":{"line":140,"column":3},"end":{"line":140,"column":9}},"69":{"start":{"line":143,"column":2},"end":{"line":143,"column":29}},"70":{"start":{"line":144,"column":2},"end":{"line":144,"column":14}},"71":{"start":{"line":159,"column":1},"end":{"line":174,"column":3}},"72":{"start":{"line":160,"column":2},"end":{"line":162,"column":3}},"73":{"start":{"line":161,"column":3},"end":{"line":161,"column":24}},"74":{"start":{"line":163,"column":2},"end":{"line":172,"column":3}},"75":{"start":{"line":164,"column":3},"end":{"line":164,"column":29}},"76":{"start":{"line":165,"column":3},"end":{"line":167,"column":6}},"77":{"start":{"line":168,"column":3},"end":{"line":171,"column":4}},"78":{"start":{"line":169,"column":4},"end":{"line":169,"column":16}},"79":{"start":{"line":170,"column":4},"end":{"line":170,"column":28}},"80":{"start":{"line":173,"column":2},"end":{"line":173,"column":23}},"81":{"start":{"line":188,"column":1},"end":{"line":188,"column":27}},"82":{"start":{"line":202,"column":1},"end":{"line":204,"column":3}},"83":{"start":{"line":203,"column":2},"end":{"line":203,"column":56}},"84":{"start":{"line":213,"column":1},"end":{"line":218,"column":3}},"85":{"start":{"line":214,"column":2},"end":{"line":216,"column":15}},"86":{"start":{"line":217,"column":2},"end":{"line":217,"column":19}},"87":{"start":{"line":220,"column":1},"end":{"line":220,"column":16}},"88":{"start":{"line":224,"column":0},"end":{"line":224,"column":25}}},"branchMap":{"1":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"2":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"3":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":3},"end":{"line":48,"column":3}},{"start":{"line":48,"column":3},"end":{"line":48,"column":3}}]},"4":{"line":55,"type":"switch","locations":[{"start":{"line":57,"column":3},"end":{"line":57,"column":34}},{"start":{"line":58,"column":3},"end":{"line":58,"column":30}},{"start":{"line":59,"column":3},"end":{"line":65,"column":9}},{"start":{"line":68,"column":3},"end":{"line":84,"column":9}},{"start":{"line":85,"column":3},"end":{"line":90,"column":9}},{"start":{"line":91,"column":3},"end":{"line":96,"column":9}},{"start":{"line":97,"column":3},"end":{"line":100,"column":9}},{"start":{"line":101,"column":3},"end":{"line":112,"column":9}},{"start":{"line":113,"column":3},"end":{"line":119,"column":9}},{"start":{"line":120,"column":3},"end":{"line":122,"column":9}},{"start":{"line":123,"column":3},"end":{"line":125,"column":9}},{"start":{"line":126,"column":3},"end":{"line":140,"column":9}}]},"5":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":60,"column":4}},{"start":{"line":60,"column":4},"end":{"line":60,"column":4}}]},"6":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":69,"column":4}},{"start":{"line":69,"column":4},"end":{"line":69,"column":4}}]},"7":{"line":71,"type":"cond-expr","locations":[{"start":{"line":71,"column":29},"end":{"line":71,"column":50}},{"start":{"line":71,"column":53},"end":{"line":71,"column":55}}]},"8":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":27},"end":{"line":77,"column":41}},{"start":{"line":77,"column":45},"end":{"line":77,"column":72}}]},"9":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":80,"column":4}},{"start":{"line":80,"column":4},"end":{"line":80,"column":4}}]},"10":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":4},"end":{"line":86,"column":4}},{"start":{"line":86,"column":4},"end":{"line":86,"column":4}}]},"11":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":4},"end":{"line":92,"column":4}},{"start":{"line":92,"column":4},"end":{"line":92,"column":4}}]},"12":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":8},"end":{"line":92,"column":22}},{"start":{"line":92,"column":26},"end":{"line":92,"column":46}}]},"13":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":4},"end":{"line":102,"column":4}},{"start":{"line":102,"column":4},"end":{"line":102,"column":4}}]},"14":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":5},"end":{"line":103,"column":5}},{"start":{"line":103,"column":5},"end":{"line":103,"column":5}}]},"15":{"line":103,"type":"binary-expr","locations":[{"start":{"line":103,"column":9},"end":{"line":103,"column":29}},{"start":{"line":103,"column":34},"end":{"line":103,"column":52}},{"start":{"line":103,"column":56},"end":{"line":103,"column":74}}]},"16":{"line":106,"type":"cond-expr","locations":[{"start":{"line":106,"column":37},"end":{"line":106,"column":77}},{"start":{"line":106,"column":80},"end":{"line":106,"column":137}}]},"17":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":4},"end":{"line":115,"column":4}},{"start":{"line":115,"column":4},"end":{"line":115,"column":4}}]},"18":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":4},"end":{"line":129,"column":4}},{"start":{"line":129,"column":4},"end":{"line":129,"column":4}}]},"19":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":4},"end":{"line":132,"column":4}},{"start":{"line":132,"column":4},"end":{"line":132,"column":4}}]},"20":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":5},"end":{"line":134,"column":5}},{"start":{"line":134,"column":5},"end":{"line":134,"column":5}}]},"21":{"line":137,"type":"if","locations":[{"start":{"line":137,"column":11},"end":{"line":137,"column":11}},{"start":{"line":137,"column":11},"end":{"line":137,"column":11}}]},"22":{"line":160,"type":"if","locations":[{"start":{"line":160,"column":2},"end":{"line":160,"column":2}},{"start":{"line":160,"column":2},"end":{"line":160,"column":2}}]},"23":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":2},"end":{"line":163,"column":2}},{"start":{"line":163,"column":2},"end":{"line":163,"column":2}}]},"24":{"line":203,"type":"binary-expr","locations":[{"start":{"line":203,"column":25},"end":{"line":203,"column":38}},{"start":{"line":203,"column":42},"end":{"line":203,"column":54}}]},"25":{"line":214,"type":"cond-expr","locations":[{"start":{"line":215,"column":5},"end":{"line":215,"column":50}},{"start":{"line":216,"column":5},"end":{"line":216,"column":14}}]},"26":{"line":214,"type":"binary-expr","locations":[{"start":{"line":214,"column":15},"end":{"line":214,"column":44}},{"start":{"line":214,"column":48},"end":{"line":214,"column":83}},{"start":{"line":214,"column":87},"end":{"line":214,"column":119}}]}},"code":["var _ = require('underscore');","var callerId = require('caller-id');","var cloudinary = require('cloudinary');","var debug = require('debug')('keystone:core:options');","var mandrillapi = require('mandrill-api');","var path = require('path');","var url = require('url');","var utils = require('keystone-utils');","","function options() {","\t","\tvar exports = {};","","\t/**","\t * This file contains methods specific to dealing with Keystone's options.","\t * All exports are added to the Keystone.prototype","\t */","","\t// Deprecated options that have been mapped to new keys","\tvar remappedOptions = {","\t\t'signin success': 'signin redirect',","\t\t'signout': 'signout url'","\t};","","\t// Determines if path is absolute or relative","\tfunction isAbsolutePath(value) {","\t\treturn path.resolve(value) === path.normalize(value).replace(new RegExp(path.sep + '$'), '');","\t}","","\t/**","\t * Sets keystone options","\t *","\t * ####Example:","\t *","\t *     keystone.set('user model', 'User') // sets the 'user model' option to `User`","\t *","\t * @param {String} key","\t * @param {String} value","\t * @api public","\t */","\texports.set = function(key, value) {","","\t\tif (arguments.length === 1) {","\t\t\treturn this._options[key];","\t\t}","\t\t","\t\tif (remappedOptions[key]) {","\t\t\tif (this.get('logger')) {","\t\t\t\tconsole.log('\\nWarning: the `' + key + '` option has been deprecated. Please use `' + remappedOptions[key] + '` instead.\\n\\n' +","\t\t\t\t\t'Support for `' + key + '` will be removed in a future version.');","\t\t\t}","\t\t\tkey = remappedOptions[key];","\t\t}","","\t\tswitch (key) {","\t\t\t// warn on deprecated/old/invalid settings","\t\t\tcase 'less middleware options':","\t\t\tcase 'less parser options':","\t\t\tcase 'less compiler options':","\t\t\t\tif (this.get('logger')) {","\t\t\t\t\tconsole.log('\\nWarning: less-middleware has changed the way it handles options, and ' +","\t\t\t\t\t\t'\\n`' + key + '` is no longer supported. You should simply use `less options` now;' +","\t\t\t\t\t\t'\\nsee https://github.com/emberfeather/less.js-middleware for details.');","\t\t\t\t}","\t\t\tbreak;","","\t\t\t// handle special settings","\t\t\tcase 'cloudinary config':","\t\t\t\tif (_.isString(value)) {","\t\t\t\t\tvar parts = url.parse(value, true);","\t\t\t\t\tvar auth = parts.auth ? parts.auth.split(':') : [];","\t\t\t\t\tvalue = {","\t\t\t\t\t\tcloud_name: parts.host,","\t\t\t\t\t\tapi_key: auth[0],","\t\t\t\t\t\tapi_secret: auth[1],","\t\t\t\t\t\tprivate_cdn: parts.pathname != null,","\t\t\t\t\t\tsecure_distribution: parts.pathname && parts.pathname.substring(1)","\t\t\t\t\t};","\t\t\t\t}","\t\t\t\tif (_.isObject(value)) {","\t\t\t\t\tcloudinary.config(value);","\t\t\t\t}","\t\t\t\tvalue = cloudinary.config();","\t\t\tbreak;","\t\t\tcase 'mandrill api key':","\t\t\t\tif (value) {","\t\t\t\t\tdebug('found mandril key');","\t\t\t\t\tthis.mandrillAPI = new mandrillapi.Mandrill(value);","\t\t\t\t}","\t\t\tbreak;","\t\t\tcase 'auth':","\t\t\t\tif (value === true && !this.get('session')) {","\t\t\t\t\tdebug('setting session for auth');","\t\t\t\t\tthis.set('session', true);","\t\t\t\t}","\t\t\tbreak;","\t\t\tcase 'nav':","\t\t\t\tdebug('setting nav');","\t\t\t\tthis.nav = this.initNav(value);","\t\t\tbreak;","\t\t\tcase 'mongo':","\t\t\t\tif ('string' !== typeof value) {","\t\t\t\t\tif (Array.isArray(value) && (value.length === 2 || value.length === 3)) {","\t\t\t\t\t\tconsole.log('\\nWarning: using an array for the `mongo` option has been deprecated.\\nPlease use a mongodb connection string, e.g. mongodb://localhost/db_name instead.\\n\\n' +","\t\t\t\t\t\t\t'Support for arrays as the `mongo` setting will be removed in a future version.');","\t\t\t\t\t\tvalue = (value.length === 2) ? 'mongodb://' + value[0] + '/' + value[1] : 'mongodb://' + value[0] + ':' + value[2] + '/' + value[1];","\t\t\t\t\t} else {","\t\t\t\t\t\tconsole.error('\\nInvalid Configuration:\\nThe `mongo` option must be a mongodb connection string, e.g. mongodb://localhost/db_name\\n');","\t\t\t\t\t\tprocess.exit(1);","\t\t\t\t\t}","\t\t\t\t}","\t\t\tbreak;","\t\t\tcase 'module root':","\t\t\t\t// if relative path is used, resolve it based on the caller's path","\t\t\t\tif (!isAbsolutePath(value)) {","\t\t\t\t\tvar caller = callerId.getData();","\t\t\t\t\tvalue = path.resolve(path.dirname(caller.filePath), value);","\t\t\t\t}","\t\t\tbreak;","\t\t\tcase 'app':","\t\t\t\tthis.app = value;","\t\t\tbreak;","\t\t\tcase 'mongoose':","\t\t\t\tthis.mongoose = value;","\t\t\tbreak;","\t\t\tcase 'frame guard':","\t\t\t\tvar validFrameGuardOptions = ['deny', 'sameorigin'];","","\t\t\t\tif (value === true) {","\t\t\t\t\tvalue = 'deny';","\t\t\t\t}","\t\t\t\tif (utils.isString(value)) {","\t\t\t\t\tvalue = value.toLowerCase();","\t\t\t\t\tif (validFrameGuardOptions.indexOf(value) < 0) {","\t\t\t\t\t\tvalue = false;","\t\t\t\t\t}","\t\t\t\t} else if ('boolean' !== typeof value) {","\t\t\t\t\tvalue = false;","\t\t\t\t}","\t\t\tbreak;","\t\t}","\t\t","\t\tthis._options[key] = value;","\t\treturn this;","\t};","","","\t/**","\t * Sets multiple keystone options.","\t *","\t * ####Example:","\t *","\t *     keystone.options({test: value}) // sets the 'test' option to `value`","\t *","\t * @param {Object} options","\t * @api public","\t */","","\texports.options = function(options) {","\t\tif (!arguments.length) {","\t\t\treturn this._options;","\t\t}","\t\tif (utils.isObject(options)) {","\t\t\tdebug('settings options');","\t\t\tvar keys = Object.keys(options),","\t\t\t\ti = keys.length,","\t\t\t\tk;","\t\t\twhile (i--) {","\t\t\t\tk = keys[i];","\t\t\t\tthis.set(k, options[k]);","\t\t\t}","\t\t}","\t\treturn this._options;","\t};","","","\t/**","\t * Gets keystone options","\t *","\t * ####Example:","\t *","\t *     keystone.get('test') // returns the 'test' value","\t *","\t * @param {String} key","\t * @api public","\t */","","\texports.get = exports.set;","","\t/**","\t * Gets an expanded path option, expanded to include moduleRoot if it is relative","\t *","\t * ####Example:","\t *","\t *     keystone.get('pathOption', 'defaultValue')","\t *","\t * @param {String} key","\t * @param {String} defaultValue","\t * @api public","\t */","","\texports.getPath = function(key, defaultValue) {","\t\treturn this.expandPath(this.get(key) || defaultValue);","\t};","","\t/**","\t * Expands a path to include moduleRoot if it is relative","\t *","\t * @param {String} pathValue","\t * @api public","\t */","","\texports.expandPath = function(pathValue) {","\t\tpathValue = ('string' === typeof pathValue && pathValue.substr(0, 1) !== path.sep && pathValue.substr(1, 2) !== ':\\\\')","\t\t\t? path.join(this.get('module root'), pathValue)","\t\t\t: pathValue;","\t\treturn pathValue;","\t};","\t","\treturn exports;","\t","}","","module.exports = options;",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"10":1,"12":1,"20":1,"26":1,"27":0,"41":1,"43":24,"44":3,"47":21,"48":0,"49":0,"52":0,"55":21,"60":0,"61":0,"65":0,"69":0,"70":0,"71":0,"72":0,"80":0,"81":0,"83":0,"84":0,"86":1,"87":0,"88":0,"90":1,"92":0,"93":0,"94":0,"96":0,"98":0,"99":0,"100":0,"102":0,"103":0,"104":0,"106":0,"108":0,"109":0,"112":0,"115":0,"116":0,"117":0,"119":0,"121":0,"122":0,"124":0,"125":0,"127":0,"129":0,"130":0,"132":0,"133":0,"134":0,"135":0,"137":0,"138":0,"140":0,"143":21,"144":21,"159":1,"160":0,"161":0,"163":0,"164":0,"165":0,"168":0,"169":0,"170":0,"173":0,"188":1,"202":1,"203":0,"213":1,"214":0,"217":0,"220":1,"224":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/bindEmailTestRoutes.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/bindEmailTestRoutes.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"bindEmailTestRoutes","line":3,"loc":{"start":{"line":3,"column":0},"end":{"line":3,"column":42}}},"2":{"name":"(anonymous_2)","line":7,"loc":{"start":{"line":7,"column":19},"end":{"line":7,"column":43}}},"3":{"name":"(anonymous_3)","line":18,"loc":{"start":{"line":18,"column":16},"end":{"line":18,"column":36}}},"4":{"name":"(anonymous_4)","line":20,"loc":{"start":{"line":20,"column":15},"end":{"line":20,"column":47}}},"5":{"name":"(anonymous_5)","line":21,"loc":{"start":{"line":21,"column":42},"end":{"line":21,"column":63}}},"6":{"name":"(anonymous_6)","line":30,"loc":{"start":{"line":30,"column":41},"end":{"line":30,"column":60}}},"7":{"name":"(anonymous_7)","line":32,"loc":{"start":{"line":32,"column":19},"end":{"line":32,"column":41}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":3,"column":0},"end":{"line":44,"column":1}},"3":{"start":{"line":5,"column":1},"end":{"line":5,"column":21}},"4":{"start":{"line":7,"column":1},"end":{"line":14,"column":3}},"5":{"start":{"line":8,"column":2},"end":{"line":13,"column":3}},"6":{"start":{"line":9,"column":3},"end":{"line":9,"column":16}},"7":{"start":{"line":12,"column":3},"end":{"line":12,"column":45}},"8":{"start":{"line":18,"column":1},"end":{"line":40,"column":4}},"9":{"start":{"line":20,"column":2},"end":{"line":28,"column":4}},"10":{"start":{"line":21,"column":3},"end":{"line":27,"column":6}},"11":{"start":{"line":22,"column":4},"end":{"line":26,"column":5}},"12":{"start":{"line":23,"column":5},"end":{"line":23,"column":32}},"13":{"start":{"line":25,"column":5},"end":{"line":25,"column":26}},"14":{"start":{"line":30,"column":2},"end":{"line":38,"column":5}},"15":{"start":{"line":31,"column":3},"end":{"line":37,"column":4}},"16":{"start":{"line":32,"column":4},"end":{"line":34,"column":7}},"17":{"start":{"line":33,"column":5},"end":{"line":33,"column":35}},"18":{"start":{"line":36,"column":4},"end":{"line":36,"column":33}},"19":{"start":{"line":42,"column":1},"end":{"line":42,"column":13}},"20":{"start":{"line":46,"column":0},"end":{"line":46,"column":37}}},"branchMap":{"1":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":2},"end":{"line":8,"column":2}},{"start":{"line":8,"column":2},"end":{"line":8,"column":2}}]},"2":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":4},"end":{"line":22,"column":4}},{"start":{"line":22,"column":4},"end":{"line":22,"column":4}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":3},"end":{"line":31,"column":3}},{"start":{"line":31,"column":3},"end":{"line":31,"column":3}}]}},"code":["var _ = require('underscore');","","function bindEmailTestRoutes(app, emails) {","\t","\tvar keystone = this;","\t","\tvar handleError = function(req, res, err) {","\t\tif (res.err) {","\t\t\tres.err(err);","\t\t} else {","\t\t\t// TODO: Nicer default error handler","\t\t\tres.status(500).send(JSON.stringify(err));","\t\t}","\t};","\t","\t// TODO: Index of email tests, and custom email test 404's (currently bounces to list 404)","\t","\t_.each(emails, function(vars, key) {","\t\t","\t\tvar render = function(err, req, res, locals) {// eslint-disable-line no-unused-vars, handle-callback-err","\t\t\tnew keystone.Email(key).render(locals, function(err, email) {","\t\t\t\tif (err) {","\t\t\t\t\thandleError(req, res, err);","\t\t\t\t} else {","\t\t\t\t\tres.send(email.html);","\t\t\t\t}","\t\t\t});","\t\t};","\t\t","\t\tapp.get('/keystone/test-email/' + key, function(req, res) {","\t\t\tif ('function' === typeof vars) {","\t\t\t\tvars(req, res, function(err, locals) {","\t\t\t\t\trender(err, req, res, locals);","\t\t\t\t});","\t\t\t} else {","\t\t\t\trender(null, req, res, vars);","\t\t\t}","\t\t});","\t\t","\t});","\t","\treturn this;","\t","}","","module.exports = bindEmailTestRoutes;",""],"l":{"1":1,"3":1,"5":0,"7":0,"8":0,"9":0,"12":0,"18":0,"20":0,"21":0,"22":0,"23":0,"25":0,"30":0,"31":0,"32":0,"33":0,"36":0,"42":0,"46":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/connect.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/connect.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"connect","line":16,"loc":{"start":{"line":16,"column":0},"end":{"line":16,"column":19}}}},"statementMap":{"1":{"start":{"line":14,"column":0},"end":{"line":14,"column":54}},"2":{"start":{"line":16,"column":0},"end":{"line":35,"column":1}},"3":{"start":{"line":17,"column":1},"end":{"line":20,"column":87}},"4":{"start":{"line":22,"column":1},"end":{"line":22,"column":53}},"5":{"start":{"line":25,"column":1},"end":{"line":33,"column":2}},"6":{"start":{"line":26,"column":2},"end":{"line":32,"column":3}},"7":{"start":{"line":27,"column":3},"end":{"line":27,"column":30}},"8":{"start":{"line":28,"column":3},"end":{"line":28,"column":32}},"9":{"start":{"line":29,"column":9},"end":{"line":32,"column":3}},"10":{"start":{"line":30,"column":3},"end":{"line":30,"column":33}},"11":{"start":{"line":31,"column":3},"end":{"line":31,"column":27}},"12":{"start":{"line":34,"column":1},"end":{"line":34,"column":13}},"13":{"start":{"line":37,"column":0},"end":{"line":37,"column":25}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":9},"end":{"line":29,"column":9}},{"start":{"line":29,"column":9},"end":{"line":29,"column":9}}]}},"code":["/**"," * Connects keystone to the application's mongoose instance."," *"," * ####Example:"," *"," *     var mongoose = require('mongoose');"," *"," *     keystone.connect(mongoose);"," *"," * @param {Object} connections"," * @api public"," */","","var debug = require('debug')('keystone:core:connect');","","function connect() {","\tvar warningMsg = 'keystone.connect() is now deprecated and will not be available in future versions of KeystoneJS\\n' +","\t\t'It has been replaced with the Keystone \"app\" and \"mongoose\" options.\\n' +","\t\t'Due to changes in Express 4, \"keystone.connect()\" no longer works as expected.\\n\\n' +","\t\t'See http://localhost:8080/docs/configuration#options-project for more information.';","","\tthis.console.err('Deprecation Warning', warningMsg);","","\t// detect type of each argument","\tfor (var i = 0; i < arguments.length; i++) {","\t\tif (arguments[i].constructor.name === 'Mongoose') {","\t\t\tdebug('detected mongoose');","\t\t\tthis.mongoose = arguments[i];","\t\t} else if (arguments[i].name === 'app') {","\t\t\tdebug('detected express app');","\t\t\tthis.app = arguments[i];","\t\t}","\t}","\treturn this;","}","","module.exports = connect;",""],"l":{"14":1,"16":1,"17":0,"22":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"34":0,"37":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/createItems.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/createItems.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"fnMap":{"1":{"name":"createItems","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":42}}},"2":{"name":"writeLog","line":39,"loc":{"start":{"line":39,"column":1},"end":{"line":39,"column":25}}},"3":{"name":"(anonymous_3)","line":46,"loc":{"start":{"line":46,"column":2},"end":{"line":46,"column":17}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":27},"end":{"line":48,"column":51}}},"5":{"name":"(anonymous_5)","line":51,"loc":{"start":{"line":51,"column":76},"end":{"line":51,"column":88}}},"6":{"name":"(anonymous_6)","line":87,"loc":{"start":{"line":87,"column":32},"end":{"line":87,"column":57}}},"7":{"name":"(anonymous_7)","line":92,"loc":{"start":{"line":92,"column":26},"end":{"line":92,"column":38}}},"8":{"name":"(anonymous_8)","line":107,"loc":{"start":{"line":107,"column":25},"end":{"line":107,"column":41}}},"9":{"name":"(anonymous_9)","line":119,"loc":{"start":{"line":119,"column":14},"end":{"line":119,"column":28}}},"10":{"name":"(anonymous_10)","line":136,"loc":{"start":{"line":136,"column":2},"end":{"line":136,"column":17}}},"11":{"name":"(anonymous_11)","line":138,"loc":{"start":{"line":138,"column":21},"end":{"line":138,"column":45}}},"12":{"name":"(anonymous_12)","line":157,"loc":{"start":{"line":157,"column":26},"end":{"line":157,"column":54}}},"13":{"name":"(anonymous_13)","line":169,"loc":{"start":{"line":169,"column":31},"end":{"line":169,"column":58}}},"14":{"name":"(anonymous_14)","line":209,"loc":{"start":{"line":209,"column":66},"end":{"line":209,"column":78}}},"15":{"name":"(anonymous_15)","line":210,"loc":{"start":{"line":210,"column":25},"end":{"line":210,"column":37}}},"16":{"name":"(anonymous_16)","line":215,"loc":{"start":{"line":215,"column":18},"end":{"line":215,"column":41}}},"17":{"name":"(anonymous_17)","line":229,"loc":{"start":{"line":229,"column":47},"end":{"line":229,"column":61}}},"18":{"name":"(anonymous_18)","line":285,"loc":{"start":{"line":285,"column":8},"end":{"line":285,"column":22}}},"19":{"name":"(anonymous_19)","line":305,"loc":{"start":{"line":305,"column":4},"end":{"line":305,"column":18}}},"20":{"name":"(anonymous_20)","line":316,"loc":{"start":{"line":316,"column":16},"end":{"line":316,"column":31}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":30}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":58}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":38}},"5":{"start":{"line":10,"column":0},"end":{"line":328,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":21}},"7":{"start":{"line":14,"column":1},"end":{"line":18,"column":3}},"8":{"start":{"line":20,"column":1},"end":{"line":20,"column":65}},"9":{"start":{"line":22,"column":1},"end":{"line":24,"column":2}},"10":{"start":{"line":23,"column":2},"end":{"line":23,"column":90}},"11":{"start":{"line":26,"column":1},"end":{"line":28,"column":2}},"12":{"start":{"line":27,"column":2},"end":{"line":27,"column":25}},"13":{"start":{"line":30,"column":1},"end":{"line":32,"column":2}},"14":{"start":{"line":31,"column":2},"end":{"line":31,"column":17}},"15":{"start":{"line":34,"column":1},"end":{"line":36,"column":13}},"16":{"start":{"line":39,"column":1},"end":{"line":41,"column":2}},"17":{"start":{"line":40,"column":2},"end":{"line":40,"column":50}},"18":{"start":{"line":43,"column":1},"end":{"line":326,"column":4}},"19":{"start":{"line":47,"column":3},"end":{"line":47,"column":25}},"20":{"start":{"line":48,"column":3},"end":{"line":132,"column":12}},"21":{"start":{"line":50,"column":4},"end":{"line":51,"column":108}},"22":{"start":{"line":51,"column":90},"end":{"line":51,"column":104}},"23":{"start":{"line":53,"column":4},"end":{"line":64,"column":5}},"24":{"start":{"line":54,"column":5},"end":{"line":59,"column":6}},"25":{"start":{"line":55,"column":6},"end":{"line":58,"column":9}},"26":{"start":{"line":60,"column":5},"end":{"line":62,"column":6}},"27":{"start":{"line":61,"column":6},"end":{"line":61,"column":48}},"28":{"start":{"line":63,"column":5},"end":{"line":63,"column":23}},"29":{"start":{"line":66,"column":4},"end":{"line":68,"column":5}},"30":{"start":{"line":67,"column":5},"end":{"line":67,"column":25}},"31":{"start":{"line":70,"column":4},"end":{"line":75,"column":6}},"32":{"start":{"line":77,"column":4},"end":{"line":78,"column":35}},"33":{"start":{"line":80,"column":4},"end":{"line":85,"column":5}},"34":{"start":{"line":81,"column":5},"end":{"line":81,"column":22}},"35":{"start":{"line":82,"column":5},"end":{"line":82,"column":41}},"36":{"start":{"line":83,"column":5},"end":{"line":83,"column":48}},"37":{"start":{"line":84,"column":5},"end":{"line":84,"column":22}},"38":{"start":{"line":87,"column":4},"end":{"line":130,"column":17}},"39":{"start":{"line":89,"column":5},"end":{"line":89,"column":22}},"40":{"start":{"line":92,"column":5},"end":{"line":99,"column":8}},"41":{"start":{"line":93,"column":6},"end":{"line":98,"column":7}},"42":{"start":{"line":94,"column":7},"end":{"line":94,"column":27}},"43":{"start":{"line":95,"column":7},"end":{"line":97,"column":8}},"44":{"start":{"line":96,"column":8},"end":{"line":96,"column":72}},"45":{"start":{"line":101,"column":5},"end":{"line":101,"column":45}},"46":{"start":{"line":103,"column":5},"end":{"line":105,"column":6}},"47":{"start":{"line":104,"column":6},"end":{"line":104,"column":39}},"48":{"start":{"line":107,"column":5},"end":{"line":112,"column":8}},"49":{"start":{"line":109,"column":6},"end":{"line":111,"column":7}},"50":{"start":{"line":110,"column":7},"end":{"line":110,"column":35}},"51":{"start":{"line":114,"column":5},"end":{"line":117,"column":6}},"52":{"start":{"line":115,"column":6},"end":{"line":115,"column":51}},"53":{"start":{"line":116,"column":6},"end":{"line":116,"column":97}},"54":{"start":{"line":119,"column":5},"end":{"line":128,"column":8}},"55":{"start":{"line":120,"column":6},"end":{"line":126,"column":7}},"56":{"start":{"line":121,"column":7},"end":{"line":121,"column":23}},"57":{"start":{"line":122,"column":7},"end":{"line":122,"column":23}},"58":{"start":{"line":123,"column":7},"end":{"line":123,"column":35}},"59":{"start":{"line":125,"column":7},"end":{"line":125,"column":33}},"60":{"start":{"line":127,"column":6},"end":{"line":127,"column":20}},"61":{"start":{"line":138,"column":3},"end":{"line":302,"column":12}},"62":{"start":{"line":140,"column":4},"end":{"line":141,"column":68}},"63":{"start":{"line":143,"column":4},"end":{"line":145,"column":5}},"64":{"start":{"line":144,"column":5},"end":{"line":144,"column":23}},"65":{"start":{"line":147,"column":4},"end":{"line":148,"column":35}},"66":{"start":{"line":150,"column":4},"end":{"line":155,"column":5}},"67":{"start":{"line":151,"column":5},"end":{"line":151,"column":22}},"68":{"start":{"line":152,"column":5},"end":{"line":152,"column":54}},"69":{"start":{"line":153,"column":5},"end":{"line":153,"column":49}},"70":{"start":{"line":154,"column":5},"end":{"line":154,"column":22}},"71":{"start":{"line":157,"column":4},"end":{"line":300,"column":17}},"72":{"start":{"line":159,"column":5},"end":{"line":160,"column":31}},"73":{"start":{"line":162,"column":5},"end":{"line":162,"column":22}},"74":{"start":{"line":164,"column":5},"end":{"line":167,"column":6}},"75":{"start":{"line":165,"column":6},"end":{"line":165,"column":51}},"76":{"start":{"line":166,"column":6},"end":{"line":166,"column":99}},"77":{"start":{"line":169,"column":5},"end":{"line":298,"column":8}},"78":{"start":{"line":171,"column":6},"end":{"line":172,"column":25}},"79":{"start":{"line":174,"column":6},"end":{"line":180,"column":7}},"80":{"start":{"line":175,"column":7},"end":{"line":175,"column":92}},"81":{"start":{"line":176,"column":7},"end":{"line":176,"column":34}},"82":{"start":{"line":177,"column":7},"end":{"line":177,"column":26}},"83":{"start":{"line":179,"column":7},"end":{"line":179,"column":40}},"84":{"start":{"line":182,"column":6},"end":{"line":188,"column":7}},"85":{"start":{"line":183,"column":7},"end":{"line":186,"column":8}},"86":{"start":{"line":184,"column":8},"end":{"line":184,"column":125}},"87":{"start":{"line":185,"column":8},"end":{"line":185,"column":35}},"88":{"start":{"line":187,"column":7},"end":{"line":187,"column":26}},"89":{"start":{"line":190,"column":6},"end":{"line":196,"column":7}},"90":{"start":{"line":191,"column":7},"end":{"line":191,"column":167}},"91":{"start":{"line":192,"column":7},"end":{"line":192,"column":34}},"92":{"start":{"line":193,"column":7},"end":{"line":193,"column":26}},"93":{"start":{"line":195,"column":7},"end":{"line":195,"column":44}},"94":{"start":{"line":198,"column":6},"end":{"line":200,"column":7}},"95":{"start":{"line":199,"column":7},"end":{"line":199,"column":26}},"96":{"start":{"line":203,"column":6},"end":{"line":283,"column":7}},"97":{"start":{"line":205,"column":7},"end":{"line":205,"column":30}},"98":{"start":{"line":207,"column":7},"end":{"line":213,"column":41}},"99":{"start":{"line":209,"column":80},"end":{"line":209,"column":96}},"100":{"start":{"line":211,"column":9},"end":{"line":211,"column":33}},"101":{"start":{"line":215,"column":7},"end":{"line":223,"column":10}},"102":{"start":{"line":216,"column":8},"end":{"line":216,"column":42}},"103":{"start":{"line":216,"column":19},"end":{"line":216,"column":40}},"104":{"start":{"line":217,"column":8},"end":{"line":221,"column":9}},"105":{"start":{"line":218,"column":9},"end":{"line":218,"column":44}},"106":{"start":{"line":220,"column":9},"end":{"line":220,"column":83}},"107":{"start":{"line":222,"column":8},"end":{"line":222,"column":23}},"108":{"start":{"line":225,"column":13},"end":{"line":283,"column":7}},"109":{"start":{"line":227,"column":7},"end":{"line":251,"column":8}},"110":{"start":{"line":229,"column":8},"end":{"line":231,"column":12}},"111":{"start":{"line":230,"column":9},"end":{"line":230,"column":79}},"112":{"start":{"line":233,"column":8},"end":{"line":239,"column":9}},"113":{"start":{"line":234,"column":9},"end":{"line":238,"column":12}},"114":{"start":{"line":241,"column":8},"end":{"line":241,"column":31}},"115":{"start":{"line":242,"column":8},"end":{"line":242,"column":37}},"116":{"start":{"line":243,"column":8},"end":{"line":243,"column":20}},"117":{"start":{"line":246,"column":8},"end":{"line":250,"column":11}},"118":{"start":{"line":253,"column":13},"end":{"line":283,"column":7}},"119":{"start":{"line":255,"column":7},"end":{"line":255,"column":58}},"120":{"start":{"line":257,"column":7},"end":{"line":263,"column":8}},"121":{"start":{"line":258,"column":8},"end":{"line":262,"column":25}},"122":{"start":{"line":265,"column":7},"end":{"line":265,"column":30}},"123":{"start":{"line":267,"column":7},"end":{"line":267,"column":67}},"124":{"start":{"line":269,"column":7},"end":{"line":269,"column":19}},"125":{"start":{"line":271,"column":13},"end":{"line":283,"column":7}},"126":{"start":{"line":273,"column":7},"end":{"line":273,"column":30}},"127":{"start":{"line":274,"column":7},"end":{"line":274,"column":73}},"128":{"start":{"line":275,"column":7},"end":{"line":275,"column":19}},"129":{"start":{"line":278,"column":7},"end":{"line":282,"column":10}},"130":{"start":{"line":286,"column":6},"end":{"line":289,"column":7}},"131":{"start":{"line":287,"column":7},"end":{"line":287,"column":28}},"132":{"start":{"line":288,"column":7},"end":{"line":288,"column":28}},"133":{"start":{"line":290,"column":6},"end":{"line":292,"column":7}},"134":{"start":{"line":291,"column":7},"end":{"line":291,"column":110}},"135":{"start":{"line":293,"column":6},"end":{"line":297,"column":7}},"136":{"start":{"line":294,"column":7},"end":{"line":294,"column":26}},"137":{"start":{"line":296,"column":7},"end":{"line":296,"column":18}},"138":{"start":{"line":307,"column":2},"end":{"line":313,"column":3}},"139":{"start":{"line":308,"column":3},"end":{"line":308,"column":22}},"140":{"start":{"line":309,"column":3},"end":{"line":311,"column":4}},"141":{"start":{"line":310,"column":4},"end":{"line":310,"column":29}},"142":{"start":{"line":312,"column":3},"end":{"line":312,"column":36}},"143":{"start":{"line":315,"column":2},"end":{"line":315,"column":40}},"144":{"start":{"line":316,"column":2},"end":{"line":321,"column":5}},"145":{"start":{"line":317,"column":3},"end":{"line":317,"column":90}},"146":{"start":{"line":318,"column":3},"end":{"line":320,"column":4}},"147":{"start":{"line":319,"column":4},"end":{"line":319,"column":77}},"148":{"start":{"line":322,"column":2},"end":{"line":322,"column":29}},"149":{"start":{"line":324,"column":2},"end":{"line":324,"column":24}},"150":{"start":{"line":330,"column":0},"end":{"line":330,"column":29}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},{"start":{"line":22,"column":1},"end":{"line":22,"column":1}}]},"2":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},{"start":{"line":26,"column":1},"end":{"line":26,"column":1}}]},"3":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},{"start":{"line":30,"column":1},"end":{"line":30,"column":1}}]},"4":{"line":35,"type":"binary-expr","locations":[{"start":{"line":35,"column":9},"end":{"line":35,"column":21}},{"start":{"line":35,"column":25},"end":{"line":35,"column":27}}]},"5":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":4},"end":{"line":53,"column":4}},{"start":{"line":53,"column":4},"end":{"line":53,"column":4}}]},"6":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":5},"end":{"line":54,"column":5}},{"start":{"line":54,"column":5},"end":{"line":54,"column":5}}]},"7":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":5},"end":{"line":60,"column":5}},{"start":{"line":60,"column":5},"end":{"line":60,"column":5}}]},"8":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":4},"end":{"line":66,"column":4}},{"start":{"line":66,"column":4},"end":{"line":66,"column":4}}]},"9":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":4},"end":{"line":80,"column":4}},{"start":{"line":80,"column":4},"end":{"line":80,"column":4}}]},"10":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":6},"end":{"line":93,"column":6}},{"start":{"line":93,"column":6},"end":{"line":93,"column":6}}]},"11":{"line":93,"type":"binary-expr","locations":[{"start":{"line":93,"column":10},"end":{"line":93,"column":31}},{"start":{"line":93,"column":35},"end":{"line":93,"column":70}}]},"12":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":7},"end":{"line":95,"column":7}},{"start":{"line":95,"column":7},"end":{"line":95,"column":7}}]},"13":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":5},"end":{"line":103,"column":5}},{"start":{"line":103,"column":5},"end":{"line":103,"column":5}}]},"14":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":6},"end":{"line":109,"column":6}},{"start":{"line":109,"column":6},"end":{"line":109,"column":6}}]},"15":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":5},"end":{"line":114,"column":5}},{"start":{"line":114,"column":5},"end":{"line":114,"column":5}}]},"16":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":6},"end":{"line":120,"column":6}},{"start":{"line":120,"column":6},"end":{"line":120,"column":6}}]},"17":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":4},"end":{"line":143,"column":4}},{"start":{"line":143,"column":4},"end":{"line":143,"column":4}}]},"18":{"line":143,"type":"binary-expr","locations":[{"start":{"line":143,"column":8},"end":{"line":143,"column":13}},{"start":{"line":143,"column":17},"end":{"line":143,"column":38}}]},"19":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":4},"end":{"line":150,"column":4}},{"start":{"line":150,"column":4},"end":{"line":150,"column":4}}]},"20":{"line":164,"type":"if","locations":[{"start":{"line":164,"column":5},"end":{"line":164,"column":5}},{"start":{"line":164,"column":5},"end":{"line":164,"column":5}}]},"21":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":6},"end":{"line":174,"column":6}},{"start":{"line":174,"column":6},"end":{"line":174,"column":6}}]},"22":{"line":182,"type":"if","locations":[{"start":{"line":182,"column":6},"end":{"line":182,"column":6}},{"start":{"line":182,"column":6},"end":{"line":182,"column":6}}]},"23":{"line":183,"type":"if","locations":[{"start":{"line":183,"column":7},"end":{"line":183,"column":7}},{"start":{"line":183,"column":7},"end":{"line":183,"column":7}}]},"24":{"line":190,"type":"if","locations":[{"start":{"line":190,"column":6},"end":{"line":190,"column":6}},{"start":{"line":190,"column":6},"end":{"line":190,"column":6}}]},"25":{"line":198,"type":"if","locations":[{"start":{"line":198,"column":6},"end":{"line":198,"column":6}},{"start":{"line":198,"column":6},"end":{"line":198,"column":6}}]},"26":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":6},"end":{"line":203,"column":6}},{"start":{"line":203,"column":6},"end":{"line":203,"column":6}}]},"27":{"line":216,"type":"if","locations":[{"start":{"line":216,"column":8},"end":{"line":216,"column":8}},{"start":{"line":216,"column":8},"end":{"line":216,"column":8}}]},"28":{"line":217,"type":"if","locations":[{"start":{"line":217,"column":8},"end":{"line":217,"column":8}},{"start":{"line":217,"column":8},"end":{"line":217,"column":8}}]},"29":{"line":218,"type":"binary-expr","locations":[{"start":{"line":218,"column":29},"end":{"line":218,"column":36}},{"start":{"line":218,"column":40},"end":{"line":218,"column":42}}]},"30":{"line":220,"type":"cond-expr","locations":[{"start":{"line":220,"column":59},"end":{"line":220,"column":69}},{"start":{"line":220,"column":72},"end":{"line":220,"column":81}}]},"31":{"line":220,"type":"binary-expr","locations":[{"start":{"line":220,"column":30},"end":{"line":220,"column":37}},{"start":{"line":220,"column":41},"end":{"line":220,"column":55}}]},"32":{"line":225,"type":"if","locations":[{"start":{"line":225,"column":13},"end":{"line":225,"column":13}},{"start":{"line":225,"column":13},"end":{"line":225,"column":13}}]},"33":{"line":227,"type":"if","locations":[{"start":{"line":227,"column":7},"end":{"line":227,"column":7}},{"start":{"line":227,"column":7},"end":{"line":227,"column":7}}]},"34":{"line":230,"type":"cond-expr","locations":[{"start":{"line":230,"column":48},"end":{"line":230,"column":66}},{"start":{"line":230,"column":69},"end":{"line":230,"column":78}}]},"35":{"line":230,"type":"binary-expr","locations":[{"start":{"line":230,"column":16},"end":{"line":230,"column":26}},{"start":{"line":230,"column":30},"end":{"line":230,"column":45}}]},"36":{"line":233,"type":"if","locations":[{"start":{"line":233,"column":8},"end":{"line":233,"column":8}},{"start":{"line":233,"column":8},"end":{"line":233,"column":8}}]},"37":{"line":233,"type":"binary-expr","locations":[{"start":{"line":233,"column":12},"end":{"line":233,"column":26}},{"start":{"line":233,"column":30},"end":{"line":233,"column":66}}]},"38":{"line":253,"type":"if","locations":[{"start":{"line":253,"column":13},"end":{"line":253,"column":13}},{"start":{"line":253,"column":13},"end":{"line":253,"column":13}}]},"39":{"line":255,"type":"binary-expr","locations":[{"start":{"line":255,"column":21},"end":{"line":255,"column":31}},{"start":{"line":255,"column":35},"end":{"line":255,"column":57}}]},"40":{"line":257,"type":"if","locations":[{"start":{"line":257,"column":7},"end":{"line":257,"column":7}},{"start":{"line":257,"column":7},"end":{"line":257,"column":7}}]},"41":{"line":258,"type":"cond-expr","locations":[{"start":{"line":258,"column":32},"end":{"line":262,"column":10}},{"start":{"line":262,"column":13},"end":{"line":262,"column":24}}]},"42":{"line":267,"type":"cond-expr","locations":[{"start":{"line":267,"column":40},"end":{"line":267,"column":52}},{"start":{"line":267,"column":55},"end":{"line":267,"column":65}}]},"43":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":13},"end":{"line":271,"column":13}},{"start":{"line":271,"column":13},"end":{"line":271,"column":13}}]},"44":{"line":271,"type":"binary-expr","locations":[{"start":{"line":271,"column":17},"end":{"line":271,"column":27}},{"start":{"line":271,"column":31},"end":{"line":271,"column":44}}]},"45":{"line":274,"type":"cond-expr","locations":[{"start":{"line":274,"column":40},"end":{"line":274,"column":55}},{"start":{"line":274,"column":58},"end":{"line":274,"column":71}}]},"46":{"line":286,"type":"if","locations":[{"start":{"line":286,"column":6},"end":{"line":286,"column":6}},{"start":{"line":286,"column":6},"end":{"line":286,"column":6}}]},"47":{"line":290,"type":"if","locations":[{"start":{"line":290,"column":6},"end":{"line":290,"column":6}},{"start":{"line":290,"column":6},"end":{"line":290,"column":6}}]},"48":{"line":293,"type":"if","locations":[{"start":{"line":293,"column":6},"end":{"line":293,"column":6}},{"start":{"line":293,"column":6},"end":{"line":293,"column":6}}]},"49":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":2},"end":{"line":307,"column":2}},{"start":{"line":307,"column":2},"end":{"line":307,"column":2}}]},"50":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":3},"end":{"line":309,"column":3}},{"start":{"line":309,"column":3},"end":{"line":309,"column":3}}]},"51":{"line":312,"type":"binary-expr","locations":[{"start":{"line":312,"column":10},"end":{"line":312,"column":18}},{"start":{"line":312,"column":22},"end":{"line":312,"column":35}}]},"52":{"line":318,"type":"if","locations":[{"start":{"line":318,"column":3},"end":{"line":318,"column":3}},{"start":{"line":318,"column":3},"end":{"line":318,"column":3}}]}},"code":["/**","* Creates multiple items in one or more Lists","*/","","var _ = require('underscore');","var async = require('async');","var debug = require('debug')('keystone:core:createItems');","var utils = require('keystone-utils');","","function createItems(data, ops, callback) {","\t","\tvar keystone = this;","\t","\tvar options = {","\t\tverbose: false,","\t\tstrict: true,","\t\trefs: null","\t};","\t","\tvar dashes = '------------------------------------------------';","\t","\tif (!_.isObject(data)) {","\t\tthrow new Error('keystone.createItems() requires a data object as the first argument.');","\t}","\t","\tif (_.isObject(ops)) {","\t\t_.extend(options, ops);","\t}","\t","\tif (_.isFunction(ops)) {","\t\tcallback = ops;","\t}","\t","\tvar lists = _.keys(data),","\t\trefs = options.refs || {},","\t\tstats = {};","","\t// logger function","\tfunction writeLog(data) {","\t\tconsole.log(keystone.get('name') + ': ' + data);","\t}","","\tasync.waterfall([","\t\t","\t\t// create items","\t\tfunction(next) {","\t\t\tdebug('create items');","\t\t\tasync.eachSeries(lists, function(key, doneList) {","\t\t\t\t","\t\t\t\tvar list = keystone.list(key),","\t\t\t\t\trelationshipPaths = _.where(list.fields, { type: 'relationship' }).map(function(i) { return i.path; });","\t\t\t\t","\t\t\t\tif (!list) {","\t\t\t\t\tif (options.strict) {","\t\t\t\t\t\treturn doneList({","\t\t\t\t\t\t\ttype: 'invalid list',","\t\t\t\t\t\t\tmessage: 'List key ' + key + ' is invalid.'","\t\t\t\t\t\t});","\t\t\t\t\t}","\t\t\t\t\tif (options.verbose) {","\t\t\t\t\t\twriteLog('Skipping invalid list: ' + key);","\t\t\t\t\t}","\t\t\t\t\treturn doneList();","\t\t\t\t}","\t\t\t\t","\t\t\t\tif (!refs[list.key]) {","\t\t\t\t\trefs[list.key] = {};","\t\t\t\t}","\t\t\t\t","\t\t\t\tstats[list.key] = {","\t\t\t\t\tsingular: list.singular,","\t\t\t\t\tplural: list.plural,","\t\t\t\t\tcreated: 0,","\t\t\t\t\twarnings: 0","\t\t\t\t};","\t\t\t\t","\t\t\t\tvar itemsProcessed = 0,","\t\t\t\t\ttotalItems = data[key].length;","\t\t\t\t","\t\t\t\tif (options.verbose) {","\t\t\t\t\twriteLog(dashes);","\t\t\t\t\twriteLog('Processing list: ' + key);","\t\t\t\t\twriteLog('Items to create: ' + totalItems);","\t\t\t\t\twriteLog(dashes);","\t\t\t\t}","\t\t\t\t","\t\t\t\tasync.eachSeries(data[key], function(data, doneItem) {","\t\t\t\t\t","\t\t\t\t\titemsProcessed++;","\t\t\t\t\t","\t\t\t\t\t// Evaluate function properties to allow generated values (excluding relationships)","\t\t\t\t\t_.keys(data).forEach(function(i) {","\t\t\t\t\t\tif (_.isFunction(data[i]) && relationshipPaths.indexOf(i) === -1) {","\t\t\t\t\t\t\tdata[i] = data[i]();","\t\t\t\t\t\t\tif (options.verbose) {","\t\t\t\t\t\t\t\twriteLog('Generated dynamic value for [' + i + ']: ' + data[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t\t\tvar doc = data.__doc = new list.model();","\t\t\t\t\t","\t\t\t\t\tif (data.__ref) {","\t\t\t\t\t\trefs[list.key][data.__ref] = doc;","\t\t\t\t\t}","\t\t\t\t\t","\t\t\t\t\t_.each(list.fields, function(field) {","\t\t\t\t\t\t// skip relationship fields on the first pass.","\t\t\t\t\t\tif (field.type !== 'relationship') {","\t\t\t\t\t\t\tfield.updateItem(doc, data);","\t\t\t\t\t\t}","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t\t\tif (options.verbose) {","\t\t\t\t\t\tvar documentName = list.getDocumentName(doc);","\t\t\t\t\t\twriteLog('Creating item [' + itemsProcessed + ' of ' + totalItems + '] - ' + documentName);","\t\t\t\t\t}","\t\t\t\t\t","\t\t\t\t\tdoc.save(function(err) {","\t\t\t\t\t\tif (err) {","\t\t\t\t\t\t\terr.model = key;","\t\t\t\t\t\t\terr.data = data;","\t\t\t\t\t\t\tdebug('error saving ', key);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tstats[list.key].created++;","\t\t\t\t\t\t}","\t\t\t\t\t\tdoneItem(err);","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t\t}, doneList);","\t\t\t\t","\t\t\t}, next);","\t\t},","\t\t","\t\t// link items","\t\tfunction(next) {","\t\t\t","\t\t\tasync.each(lists, function(key, doneList) {","\t\t\t\t","\t\t\t\tvar list = keystone.list(key),","\t\t\t\t\trelationships = _.where(list.fields, { type: 'relationship' });","\t\t\t\t","\t\t\t\tif (!list || !relationships.length) {","\t\t\t\t\treturn doneList();","\t\t\t\t}","\t\t\t\t","\t\t\t\tvar itemsProcessed = 0,","\t\t\t\t\ttotalItems = data[key].length;","\t\t\t\t","\t\t\t\tif (options.verbose) {","\t\t\t\t\twriteLog(dashes);","\t\t\t\t\twriteLog('Processing relationships for: ' + key);","\t\t\t\t\twriteLog('Items to process: ' + totalItems);","\t\t\t\t\twriteLog(dashes);","\t\t\t\t}","\t\t\t\t","\t\t\t\tasync.each(data[key], function(srcData, doneItem) {","\t\t\t\t\t","\t\t\t\t\tvar doc = srcData.__doc,","\t\t\t\t\t\trelationshipsUpdated = 0;","\t\t\t\t\t","\t\t\t\t\titemsProcessed++;","\t\t\t\t\t","\t\t\t\t\tif (options.verbose) {","\t\t\t\t\t\tvar documentName = list.getDocumentName(doc);","\t\t\t\t\t\twriteLog('Processing item [' + itemsProcessed + ' of ' + totalItems + '] - ' + documentName);","\t\t\t\t\t}","\t\t\t\t\t","\t\t\t\t\tasync.each(relationships, function(field, doneField) {","\t\t\t\t\t","\t\t\t\t\t\tvar fieldValue = null,","\t\t\t\t\t\t\trefsLookup = null;","\t\t\t\t\t\t","\t\t\t\t\t\tif (!field.path) {","\t\t\t\t\t\t\twriteLog('WARNING:  Invalid relationship (undefined list path) [List: ' + key + ']');","\t\t\t\t\t\t\tstats[list.key].warnings++;","\t\t\t\t\t\t\treturn doneField();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfieldValue = srcData[field.path];","\t\t\t\t\t\t}","\t\t\t\t\t\t","\t\t\t\t\t\tif (!field.refList) {","\t\t\t\t\t\t\tif (fieldValue) {","\t\t\t\t\t\t\t\twriteLog('WARNING:  Invalid relationship (undefined reference list) [list: ' + key + '] [path: ' + fieldValue + ']');","\t\t\t\t\t\t\t\tstats[list.key].warnings++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\treturn doneField();","\t\t\t\t\t\t}","\t\t\t\t\t\t","\t\t\t\t\t\tif (!field.refList.key) {","\t\t\t\t\t\t\twriteLog('WARNING:  Invalid relationship (undefined ref list key) [list: ' + key + '] [field.refList: ' + field.refList + '] [fieldValue: ' + fieldValue + ']');","\t\t\t\t\t\t\tstats[list.key].warnings++;","\t\t\t\t\t\t\treturn doneField();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\trefsLookup = refs[field.refList.key];","\t\t\t\t\t\t}","\t\t\t\t\t\t","\t\t\t\t\t\tif (!fieldValue) {","\t\t\t\t\t\t\treturn doneField();","\t\t\t\t\t\t}","\t\t\t\t\t\t","\t\t\t\t\t\t// populate relationships from saved refs","\t\t\t\t\t\tif (_.isFunction(fieldValue)) {","\t\t\t\t\t\t\t","\t\t\t\t\t\t\trelationshipsUpdated++;","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tvar fn = fieldValue,","\t\t\t\t\t\t\t\targsRegExp = /^function\\s*[^\\(]*\\(\\s*([^\\)]*)\\)/m,","\t\t\t\t\t\t\t\tlists = fn.toString().match(argsRegExp)[1].split(',').map(function(i) { return i.trim(); }),","\t\t\t\t\t\t\t\targs = lists.map(function(i) {","\t\t\t\t\t\t\t\t\treturn keystone.list(i);","\t\t\t\t\t\t\t\t}),","\t\t\t\t\t\t\t\tquery = fn.apply(keystone, args);","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tquery.exec(function(err, results) {","\t\t\t\t\t\t\t\tif (err) { debug('error ', err); }","\t\t\t\t\t\t\t\tif (field.many) {","\t\t\t\t\t\t\t\t\tdoc.set(field.path, results || []);","\t\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\t\tdoc.set(field.path, (results && results.length) ? results[0] : undefined);","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tdoneField(err);","\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t","\t\t\t\t\t\t} else if (_.isArray(fieldValue)) {","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tif (field.many) {","\t\t\t\t\t\t\t\t","\t\t\t\t\t\t\t\tvar refsArr = _.compact(fieldValue.map(function(ref) {","\t\t\t\t\t\t\t\t\treturn refsLookup && refsLookup[ref] ? refsLookup[ref].id : undefined;","\t\t\t\t\t\t\t\t}));","\t\t\t\t\t\t\t\t","\t\t\t\t\t\t\t\tif (options.strict && refsArr.length !== fieldValue.length) {","\t\t\t\t\t\t\t\t\treturn doneField({","\t\t\t\t\t\t\t\t\t\ttype: 'invalid ref',","\t\t\t\t\t\t\t\t\t\tsrcData: srcData,","\t\t\t\t\t\t\t\t\t\tmessage: 'Relationship ' + list.key + '.' + field.path + ' contains an invalid reference.'","\t\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t","\t\t\t\t\t\t\t\trelationshipsUpdated++;","\t\t\t\t\t\t\t\tdoc.set(field.path, refsArr);","\t\t\t\t\t\t\t\tdoneField();","\t\t\t\t\t\t\t\t","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\treturn doneField({","\t\t\t\t\t\t\t\t\ttype: 'invalid data',","\t\t\t\t\t\t\t\t\tsrcData: srcData,","\t\t\t\t\t\t\t\t\tmessage: 'Single-value relationship ' + list.key + '.' + field.path + ' provided as an array.'","\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t","\t\t\t\t\t\t} else if (_.isString(fieldValue)) {","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tvar refItem = refsLookup && refsLookup[fieldValue];","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tif (!refItem) {","\t\t\t\t\t\t\t\treturn options.strict ? doneField({","\t\t\t\t\t\t\t\t\ttype: 'invalid ref',","\t\t\t\t\t\t\t\t\tsrcData: srcData,","\t\t\t\t\t\t\t\t\tmessage: 'Relationship ' + list.key + '.' + field.path + ' contains an invalid reference: \"' + fieldValue + '\".'","\t\t\t\t\t\t\t\t}) : doneField();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t","\t\t\t\t\t\t\trelationshipsUpdated++;","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tdoc.set(field.path, field.many ? [refItem.id] : refItem.id);","\t\t\t\t\t\t\t","\t\t\t\t\t\t\tdoneField();","\t\t\t\t\t\t\t","\t\t\t\t\t\t} else if (fieldValue && fieldValue.id) {","\t\t\t\t\t\t\t","\t\t\t\t\t\t\trelationshipsUpdated++;","\t\t\t\t\t\t\tdoc.set(field.path, field.many ? [fieldValue.id] : fieldValue.id);","\t\t\t\t\t\t\tdoneField();","\t\t\t\t\t\t\t","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\treturn doneField({","\t\t\t\t\t\t\t\ttype: 'invalid data',","\t\t\t\t\t\t\t\tsrcData: srcData,","\t\t\t\t\t\t\t\tmessage: 'Relationship ' + list.key + '.' + field.path + ' contains an invalid data type.'","\t\t\t\t\t\t\t});","\t\t\t\t\t\t}","\t\t\t\t\t\t","\t\t\t\t\t}, function(err) {","\t\t\t\t\t\tif (err) {","\t\t\t\t\t\t\tdebug('error ', err);","\t\t\t\t\t\t\treturn doneItem(err);","\t\t\t\t\t\t}","\t\t\t\t\t\tif (options.verbose) {","\t\t\t\t\t\t\twriteLog('Populated ' + utils.plural(relationshipsUpdated, '* relationship', '* relationships') + '.');","\t\t\t\t\t\t}","\t\t\t\t\t\tif (relationshipsUpdated) {","\t\t\t\t\t\t\tdoc.save(doneItem);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdoneItem();","\t\t\t\t\t\t}","\t\t\t\t\t});","\t\t\t\t\t","\t\t\t\t}, doneList);","\t\t\t\t","\t\t\t}, next);","\t\t}","\t\t","\t], function(err) {","","\t\tif (err) {","\t\t\tconsole.error(err);","\t\t\tif ('stack' in err) {","\t\t\t\tconsole.trace(err.stack);","\t\t\t}","\t\t\treturn callback && callback(err);","\t\t}","","\t\tvar msg = '\\nSuccessfully created:\\n';","\t\t_.each(stats, function(list) {","\t\t\tmsg += '\\n*   ' + utils.plural(list.created, '* ' + list.singular, '* ' + list.plural);","\t\t\tif (list.warnings) {","\t\t\t\tmsg += '\\n    ' + utils.plural(list.warnings, '* warning', '* warnings');","\t\t\t}","\t\t});","\t\tstats.message = msg + '\\n';","\t\t","\t\tcallback(null, stats);","\t\t","\t});","\t","}","","module.exports = createItems;",""],"l":{"5":1,"6":1,"7":1,"8":1,"10":1,"12":0,"14":0,"20":0,"22":0,"23":0,"26":0,"27":0,"30":0,"31":0,"34":0,"39":1,"40":0,"43":0,"47":0,"48":0,"50":0,"51":0,"53":0,"54":0,"55":0,"60":0,"61":0,"63":0,"66":0,"67":0,"70":0,"77":0,"80":0,"81":0,"82":0,"83":0,"84":0,"87":0,"89":0,"92":0,"93":0,"94":0,"95":0,"96":0,"101":0,"103":0,"104":0,"107":0,"109":0,"110":0,"114":0,"115":0,"116":0,"119":0,"120":0,"121":0,"122":0,"123":0,"125":0,"127":0,"138":0,"140":0,"143":0,"144":0,"147":0,"150":0,"151":0,"152":0,"153":0,"154":0,"157":0,"159":0,"162":0,"164":0,"165":0,"166":0,"169":0,"171":0,"174":0,"175":0,"176":0,"177":0,"179":0,"182":0,"183":0,"184":0,"185":0,"187":0,"190":0,"191":0,"192":0,"193":0,"195":0,"198":0,"199":0,"203":0,"205":0,"207":0,"209":0,"211":0,"215":0,"216":0,"217":0,"218":0,"220":0,"222":0,"225":0,"227":0,"229":0,"230":0,"233":0,"234":0,"241":0,"242":0,"243":0,"246":0,"253":0,"255":0,"257":0,"258":0,"265":0,"267":0,"269":0,"271":0,"273":0,"274":0,"275":0,"278":0,"286":0,"287":0,"288":0,"290":0,"291":0,"293":0,"294":0,"296":0,"307":0,"308":0,"309":0,"310":0,"312":0,"315":0,"316":0,"317":0,"318":0,"319":0,"322":0,"324":0,"330":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/getOrphanedLists.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/getOrphanedLists.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"getOrphanedLists","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":28}}},"2":{"name":"(anonymous_2)","line":11,"loc":{"start":{"line":11,"column":29},"end":{"line":11,"column":49}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":7,"column":0},"end":{"line":15,"column":1}},"3":{"start":{"line":8,"column":1},"end":{"line":10,"column":2}},"4":{"start":{"line":9,"column":2},"end":{"line":9,"column":12}},"5":{"start":{"line":11,"column":1},"end":{"line":14,"column":15}},"6":{"start":{"line":12,"column":2},"end":{"line":12,"column":39}},"7":{"start":{"line":12,"column":26},"end":{"line":12,"column":39}},"8":{"start":{"line":13,"column":2},"end":{"line":13,"column":49}},"9":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}}},"branchMap":{"1":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},{"start":{"line":8,"column":1},"end":{"line":8,"column":1}}]},"2":{"line":12,"type":"if","locations":[{"start":{"line":12,"column":2},"end":{"line":12,"column":2}},{"start":{"line":12,"column":2},"end":{"line":12,"column":2}}]},"3":{"line":13,"type":"cond-expr","locations":[{"start":{"line":13,"column":36},"end":{"line":13,"column":40}},{"start":{"line":13,"column":43},"end":{"line":13,"column":48}}]}},"code":["var _ = require('underscore');","","/**"," * Retrieves orphaned lists (those not in a nav section)"," */","","function getOrphanedLists() {","\tif (!this.nav) {","\t\treturn [];","\t}","\treturn _.filter(this.lists, function(list, key) {","\t\tif (list.get('hidden')) return false;","\t\treturn (!this.nav.by.list[key]) ? list : false;","\t}.bind(this));","}","","module.exports = getOrphanedLists;",""],"l":{"1":1,"7":1,"8":0,"9":0,"11":0,"12":0,"13":0,"17":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/importer.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/importer.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"dispatchImporter","line":22,"loc":{"start":{"line":22,"column":0},"end":{"line":22,"column":40}}},"2":{"name":"importer","line":24,"loc":{"start":{"line":24,"column":1},"end":{"line":24,"column":25}}},"3":{"name":"(anonymous_3)","line":27,"loc":{"start":{"line":27,"column":17},"end":{"line":27,"column":28}}},"4":{"name":"(anonymous_4)","line":32,"loc":{"start":{"line":32,"column":33},"end":{"line":32,"column":48}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":23}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":55}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":22,"column":0},"end":{"line":54,"column":1}},"5":{"start":{"line":24,"column":1},"end":{"line":50,"column":2}},"6":{"start":{"line":25,"column":2},"end":{"line":25,"column":28}},"7":{"start":{"line":26,"column":2},"end":{"line":26,"column":20}},"8":{"start":{"line":27,"column":2},"end":{"line":29,"column":4}},"9":{"start":{"line":28,"column":3},"end":{"line":28,"column":60}},"10":{"start":{"line":31,"column":2},"end":{"line":31,"column":74}},"11":{"start":{"line":32,"column":2},"end":{"line":47,"column":5}},"12":{"start":{"line":33,"column":3},"end":{"line":33,"column":51}},"13":{"start":{"line":34,"column":3},"end":{"line":34,"column":18}},"14":{"start":{"line":35,"column":3},"end":{"line":46,"column":4}},"15":{"start":{"line":36,"column":4},"end":{"line":36,"column":52}},"16":{"start":{"line":39,"column":4},"end":{"line":39,"column":33}},"17":{"start":{"line":40,"column":4},"end":{"line":40,"column":40}},"18":{"start":{"line":41,"column":4},"end":{"line":45,"column":5}},"19":{"start":{"line":42,"column":5},"end":{"line":42,"column":67}},"20":{"start":{"line":44,"column":5},"end":{"line":44,"column":35}},"21":{"start":{"line":49,"column":2},"end":{"line":49,"column":18}},"22":{"start":{"line":52,"column":1},"end":{"line":52,"column":17}},"23":{"start":{"line":56,"column":0},"end":{"line":56,"column":34}}},"branchMap":{"1":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":3},"end":{"line":35,"column":3}},{"start":{"line":35,"column":3},"end":{"line":35,"column":3}}]},"2":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":4}},{"start":{"line":41,"column":4},"end":{"line":41,"column":4}}]}},"code":["var fs = require('fs');","var debug = require('debug')('keystone:core:importer');","var path = require('path');","","/**"," * Returns a function that looks in a specified path relative to the current"," * directory, and returns all .js modules it (recursively)."," *"," * ####Example:"," *"," *     var importRoutes = keystone.importer(__dirname);"," *"," *     var routes = {"," *         site: importRoutes('./site'),"," *         api: importRoutes('./api')"," *     };"," *"," * @param {String} rel__dirname"," * @api public"," */","","function dispatchImporter(rel__dirname) {","\t","\tfunction importer(from) {","\t\tdebug('importing ', from);","\t\tvar imported = {};","\t\tvar joinPath = function() {","\t\t\treturn '.' + path.sep + path.join.apply(path, arguments);","\t\t};","\t\t","\t\tvar fsPath = joinPath(path.relative(process.cwd(), rel__dirname), from);","\t\tfs.readdirSync(fsPath).forEach(function(name) {","\t\t\tvar info = fs.statSync(path.join(fsPath, name));","\t\t\tdebug('recur');","\t\t\tif (info.isDirectory()) {","\t\t\t\timported[name] = importer(joinPath(from, name));","\t\t\t} else {","\t\t\t\t// only import files that we can `require`","\t\t\t\tvar ext = path.extname(name);","\t\t\t\tvar base = path.basename(name, ext);","\t\t\t\tif (require.extensions[ext]) {","\t\t\t\t\timported[base] = require(path.join(rel__dirname, from, name));","\t\t\t\t} else {","\t\t\t\t\tdebug('cannot require ', ext);","\t\t\t\t}","\t\t\t}","\t\t});","\t\t","\t\treturn imported;","\t}","\t","\treturn importer;","\t","}","","module.exports = dispatchImporter;",""],"l":{"1":1,"2":1,"3":1,"22":1,"24":1,"25":0,"26":0,"27":0,"28":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"39":0,"40":0,"41":0,"42":0,"44":0,"49":0,"52":0,"56":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/init.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/init.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"init","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":23}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":16,"column":51}},"2":{"start":{"line":18,"column":0},"end":{"line":32,"column":1}},"3":{"start":{"line":19,"column":1},"end":{"line":19,"column":27}},"4":{"start":{"line":20,"column":1},"end":{"line":20,"column":23}},"5":{"start":{"line":22,"column":1},"end":{"line":24,"column":2}},"6":{"start":{"line":23,"column":2},"end":{"line":23,"column":40}},"7":{"start":{"line":26,"column":1},"end":{"line":28,"column":2}},"8":{"start":{"line":27,"column":2},"end":{"line":27,"column":44}},"9":{"start":{"line":30,"column":1},"end":{"line":30,"column":13}},"10":{"start":{"line":34,"column":0},"end":{"line":34,"column":22}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},{"start":{"line":22,"column":1},"end":{"line":22,"column":1}}]},"2":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},{"start":{"line":26,"column":1},"end":{"line":26,"column":1}}]}},"code":["/**"," * Initialises Keystone in encapsulated mode."," *"," * Creates an Express app and configures it if none has been connected."," *"," * Also connects to the default mongoose instance if none has been connected."," *"," * Accepts an options argument."," *"," * Returns `this` to allow chaining."," *"," * @param {Object} options"," * @api public"," */","","var debug = require('debug')('keystone:core:init');","","function init(options) {","\tdebug('initializing app');","\tthis.options(options);","\t","\tif (!this.app) {","\t\tthis.set('app', require('express')());","\t}","\t","\tif (!this.mongoose) {","\t\tthis.set('mongoose', require('mongoose'));","\t}","\t","\treturn this;","\t","}","","module.exports = init;",""],"l":{"16":1,"18":1,"19":0,"20":0,"22":0,"23":0,"26":0,"27":0,"30":0,"34":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/initNav.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/initNav.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"initNav","line":12,"loc":{"start":{"line":12,"column":0},"end":{"line":12,"column":27}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":21},"end":{"line":27,"column":36}}},"3":{"name":"(anonymous_3)","line":33,"loc":{"start":{"line":33,"column":18},"end":{"line":33,"column":41}}},"4":{"name":"(anonymous_4)","line":42,"loc":{"start":{"line":42,"column":39},"end":{"line":42,"column":51}}}},"statementMap":{"1":{"start":{"line":8,"column":0},"end":{"line":8,"column":30}},"2":{"start":{"line":9,"column":0},"end":{"line":9,"column":54}},"3":{"start":{"line":10,"column":0},"end":{"line":10,"column":38}},"4":{"start":{"line":12,"column":0},"end":{"line":76,"column":1}},"5":{"start":{"line":13,"column":1},"end":{"line":13,"column":19}},"6":{"start":{"line":14,"column":1},"end":{"line":14,"column":21}},"7":{"start":{"line":16,"column":1},"end":{"line":22,"column":3}},"8":{"start":{"line":24,"column":1},"end":{"line":31,"column":2}},"9":{"start":{"line":25,"column":2},"end":{"line":25,"column":16}},"10":{"start":{"line":26,"column":2},"end":{"line":26,"column":18}},"11":{"start":{"line":27,"column":2},"end":{"line":30,"column":5}},"12":{"start":{"line":28,"column":3},"end":{"line":28,"column":34}},"13":{"start":{"line":28,"column":27},"end":{"line":28,"column":34}},"14":{"start":{"line":29,"column":3},"end":{"line":29,"column":37}},"15":{"start":{"line":33,"column":1},"end":{"line":73,"column":4}},"16":{"start":{"line":34,"column":2},"end":{"line":36,"column":3}},"17":{"start":{"line":35,"column":3},"end":{"line":35,"column":23}},"18":{"start":{"line":37,"column":2},"end":{"line":40,"column":4}},"19":{"start":{"line":41,"column":2},"end":{"line":41,"column":20}},"20":{"start":{"line":42,"column":2},"end":{"line":68,"column":5}},"21":{"start":{"line":43,"column":3},"end":{"line":66,"column":4}},"22":{"start":{"line":44,"column":4},"end":{"line":44,"column":32}},"23":{"start":{"line":45,"column":4},"end":{"line":47,"column":5}},"24":{"start":{"line":46,"column":5},"end":{"line":46,"column":94}},"25":{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},"26":{"start":{"line":49,"column":5},"end":{"line":49,"column":83}},"27":{"start":{"line":51,"column":4},"end":{"line":51,"column":36}},"28":{"start":{"line":52,"column":4},"end":{"line":56,"column":6}},"29":{"start":{"line":57,"column":10},"end":{"line":66,"column":4}},"30":{"start":{"line":58,"column":4},"end":{"line":60,"column":5}},"31":{"start":{"line":59,"column":5},"end":{"line":59,"column":101}},"32":{"start":{"line":61,"column":4},"end":{"line":61,"column":47}},"33":{"start":{"line":62,"column":4},"end":{"line":62,"column":44}},"34":{"start":{"line":63,"column":4},"end":{"line":63,"column":22}},"35":{"start":{"line":64,"column":4},"end":{"line":64,"column":33}},"36":{"start":{"line":65,"column":4},"end":{"line":65,"column":13}},"37":{"start":{"line":67,"column":3},"end":{"line":67,"column":95}},"38":{"start":{"line":69,"column":2},"end":{"line":72,"column":3}},"39":{"start":{"line":70,"column":3},"end":{"line":70,"column":30}},"40":{"start":{"line":71,"column":3},"end":{"line":71,"column":41}},"41":{"start":{"line":75,"column":1},"end":{"line":75,"column":12}},"42":{"start":{"line":78,"column":0},"end":{"line":78,"column":25}}},"branchMap":{"1":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},{"start":{"line":24,"column":1},"end":{"line":24,"column":1}}]},"2":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":3},"end":{"line":28,"column":3}},{"start":{"line":28,"column":3},"end":{"line":28,"column":3}}]},"3":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"4":{"line":39,"type":"cond-expr","locations":[{"start":{"line":39,"column":21},"end":{"line":39,"column":52}},{"start":{"line":39,"column":55},"end":{"line":39,"column":76}}]},"5":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":3},"end":{"line":43,"column":3}},{"start":{"line":43,"column":3},"end":{"line":43,"column":3}}]},"6":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":4}},{"start":{"line":45,"column":4},"end":{"line":45,"column":4}}]},"7":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":48,"column":4}},{"start":{"line":48,"column":4},"end":{"line":48,"column":4}}]},"8":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":10},"end":{"line":57,"column":10}},{"start":{"line":57,"column":10},"end":{"line":57,"column":10}}]},"9":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":4},"end":{"line":58,"column":4}},{"start":{"line":58,"column":4},"end":{"line":58,"column":4}}]},"10":{"line":61,"type":"binary-expr","locations":[{"start":{"line":61,"column":14},"end":{"line":61,"column":21}},{"start":{"line":61,"column":25},"end":{"line":61,"column":46}}]},"11":{"line":62,"type":"binary-expr","locations":[{"start":{"line":62,"column":13},"end":{"line":62,"column":19}},{"start":{"line":62,"column":23},"end":{"line":62,"column":43}}]},"12":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":69,"column":2}},{"start":{"line":69,"column":2},"end":{"line":69,"column":2}}]}},"code":["/**"," * Initialises Keystone's internal nav config"," *"," * @param {Object} nav"," * @api private"," */","","var _ = require('underscore');","var debug = require('debug')('keystone:core:initNav');","var utils = require('keystone-utils');","","function initNav(sections) {","\tdebug('init nav');","\tvar keystone = this;","\t","\tvar nav = {","\t\tsections: [],","\t\tby: {","\t\t\tlist: {},","\t\t\tsection: {}","\t\t}","\t};","\t","\tif (!sections) {","\t\tsections = {};","\t\tnav.flat = true;","\t\t_.each(this.lists, function(list) {","\t\t\tif (list.get('hidden')) return;","\t\t\tsections[list.path] = [list.path];","\t\t});","\t}","\t","\t_.each(sections, function(section, key) {","\t\tif ('string' === typeof section) {","\t\t\tsection = [section];","\t\t}","\t\tsection = {","\t\t\tlists: section,","\t\t\tlabel: nav.flat ? keystone.list(section[0]).label : utils.keyToLabel(key)","\t\t};","\t\tsection.key = key;","\t\tsection.lists = _.map(section.lists, function(i) {","\t\t\tif (_.isString(i)) {","\t\t\t\tvar list = keystone.list(i);","\t\t\t\tif (!list) {","\t\t\t\t\tthrow new Error('Invalid Keystone Option (nav): list ' + i + ' has not been defined.\\n');","\t\t\t\t}","\t\t\t\tif (list.get('hidden')) {","\t\t\t\t\tthrow new Error('Invalid Keystone Option (nav): list ' + i + ' is hidden.\\n');","\t\t\t\t}","\t\t\t\tnav.by.list[list.key] = section;","\t\t\t\treturn {","\t\t\t\t\tkey: list.key,","\t\t\t\t\tlabel: list.label,","\t\t\t\t\tpath: list.path","\t\t\t\t};","\t\t\t} else if (_.isObject(i)) {","\t\t\t\tif (!_.has(i, 'key')) {","\t\t\t\t\tthrow new Error('Invalid Keystone Option (nav): object ' + i + ' requires a \"key\" property.\\n');","\t\t\t\t}","\t\t\t\ti.label = i.label || utils.keyToLabel(key);","\t\t\t\ti.path = i.path || utils.keyToPath(key);","\t\t\t\ti.external = true;","\t\t\t\tnav.by.list[i.key] = section;","\t\t\t\treturn i;","\t\t\t}","\t\t\tthrow new Error('Invalid Keystone Option (nav): ' + i + ' is in an unrecognized format.\\n');","\t\t});","\t\tif (section.lists.length) {","\t\t\tnav.sections.push(section);","\t\t\tnav.by.section[section.key] = section;","\t\t}","\t});","\t","\treturn nav;","}","","module.exports = initNav;",""],"l":{"8":1,"9":1,"10":1,"12":1,"13":0,"14":0,"16":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"33":0,"34":0,"35":0,"37":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"48":0,"49":0,"51":0,"52":0,"57":0,"58":0,"59":0,"61":0,"62":0,"63":0,"64":0,"65":0,"67":0,"69":0,"70":0,"71":0,"75":0,"78":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/list.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/list.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"list","line":5,"loc":{"start":{"line":5,"column":0},"end":{"line":5,"column":19}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":14,"column":1}},"2":{"start":{"line":6,"column":1},"end":{"line":10,"column":2}},"3":{"start":{"line":7,"column":2},"end":{"line":7,"column":28}},"4":{"start":{"line":8,"column":2},"end":{"line":8,"column":33}},"5":{"start":{"line":9,"column":2},"end":{"line":9,"column":13}},"6":{"start":{"line":11,"column":1},"end":{"line":11,"column":58}},"7":{"start":{"line":12,"column":1},"end":{"line":12,"column":84}},"8":{"start":{"line":12,"column":11},"end":{"line":12,"column":84}},"9":{"start":{"line":13,"column":1},"end":{"line":13,"column":12}},"10":{"start":{"line":16,"column":0},"end":{"line":16,"column":22}}},"branchMap":{"1":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},{"start":{"line":6,"column":1},"end":{"line":6,"column":1}}]},"2":{"line":6,"type":"binary-expr","locations":[{"start":{"line":6,"column":5},"end":{"line":6,"column":8}},{"start":{"line":6,"column":12},"end":{"line":6,"column":41}}]},"3":{"line":11,"type":"binary-expr","locations":[{"start":{"line":11,"column":11},"end":{"line":11,"column":26}},{"start":{"line":11,"column":30},"end":{"line":11,"column":57}}]},"4":{"line":12,"type":"if","locations":[{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},{"start":{"line":12,"column":1},"end":{"line":12,"column":1}}]}},"code":["/**"," * Registers or retrieves a list"," */","","function list(arg) {","\tif (arg && arg.constructor === this.List) {","\t\tthis.lists[arg.key] = arg;","\t\tthis.paths[arg.path] = arg.key;","\t\treturn arg;","\t}","\tvar ret = this.lists[arg] || this.lists[this.paths[arg]];","\tif (!ret) throw new ReferenceError('Unknown keystone list ' + JSON.stringify(arg));","\treturn ret;","}","","module.exports = list;",""],"l":{"5":1,"6":0,"7":0,"8":0,"9":0,"11":0,"12":0,"13":0,"16":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/mount.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/mount.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":0,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":0,"272":0,"273":0,"274":0,"275":0,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":0,"293":0,"294":0,"295":0,"296":0,"297":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0,0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},"fnMap":{"1":{"name":"mount","line":66,"loc":{"start":{"line":66,"column":0},"end":{"line":66,"column":45}}},"2":{"name":"(anonymous_2)","line":181,"loc":{"start":{"line":181,"column":31},"end":{"line":181,"column":49}}},"3":{"name":"(anonymous_3)","line":185,"loc":{"start":{"line":185,"column":42},"end":{"line":185,"column":53}}},"4":{"name":"(anonymous_4)","line":227,"loc":{"start":{"line":227,"column":39},"end":{"line":227,"column":64}}},"5":{"name":"(anonymous_5)","line":274,"loc":{"start":{"line":274,"column":9},"end":{"line":274,"column":34}}},"6":{"name":"(anonymous_6)","line":301,"loc":{"start":{"line":301,"column":20},"end":{"line":301,"column":36}}},"7":{"name":"(anonymous_7)","line":333,"loc":{"start":{"line":333,"column":20},"end":{"line":333,"column":36}}},"8":{"name":"(anonymous_8)","line":353,"loc":{"start":{"line":353,"column":22},"end":{"line":353,"column":38}}},"9":{"name":"(anonymous_9)","line":371,"loc":{"start":{"line":371,"column":9},"end":{"line":371,"column":34}}},"10":{"name":"(anonymous_10)","line":380,"loc":{"start":{"line":380,"column":9},"end":{"line":380,"column":34}}},"11":{"name":"(anonymous_11)","line":403,"loc":{"start":{"line":403,"column":9},"end":{"line":403,"column":34}}},"12":{"name":"(anonymous_12)","line":457,"loc":{"start":{"line":457,"column":9},"end":{"line":457,"column":34}}},"13":{"name":"(anonymous_13)","line":476,"loc":{"start":{"line":476,"column":19},"end":{"line":476,"column":31}}},"14":{"name":"(anonymous_14)","line":480,"loc":{"start":{"line":480,"column":11},"end":{"line":480,"column":36}}},"15":{"name":"(anonymous_15)","line":490,"loc":{"start":{"line":490,"column":26},"end":{"line":490,"column":51}}},"16":{"name":"(anonymous_16)","line":494,"loc":{"start":{"line":494,"column":10},"end":{"line":494,"column":35}}},"17":{"name":"(anonymous_17)","line":523,"loc":{"start":{"line":523,"column":26},"end":{"line":523,"column":56}}},"18":{"name":"(anonymous_18)","line":553,"loc":{"start":{"line":553,"column":10},"end":{"line":553,"column":40}}},"19":{"name":"(anonymous_19)","line":597,"loc":{"start":{"line":597,"column":33},"end":{"line":597,"column":51}}},"20":{"name":"(anonymous_20)","line":618,"loc":{"start":{"line":618,"column":38},"end":{"line":618,"column":52}}},"21":{"name":"(anonymous_21)","line":633,"loc":{"start":{"line":633,"column":15},"end":{"line":633,"column":26}}},"22":{"name":"(anonymous_22)","line":638,"loc":{"start":{"line":638,"column":16},"end":{"line":638,"column":27}}},"23":{"name":"(anonymous_23)","line":643,"loc":{"start":{"line":643,"column":18},"end":{"line":643,"column":29}}}},"statementMap":{"1":{"start":{"line":49,"column":0},"end":{"line":49,"column":30}},"2":{"start":{"line":50,"column":0},"end":{"line":50,"column":52}},"3":{"start":{"line":51,"column":0},"end":{"line":51,"column":28}},"4":{"start":{"line":52,"column":0},"end":{"line":52,"column":33}},"5":{"start":{"line":53,"column":0},"end":{"line":53,"column":27}},"6":{"start":{"line":54,"column":0},"end":{"line":54,"column":38}},"7":{"start":{"line":55,"column":0},"end":{"line":55,"column":39}},"8":{"start":{"line":56,"column":0},"end":{"line":56,"column":31}},"9":{"start":{"line":57,"column":0},"end":{"line":57,"column":48}},"10":{"start":{"line":58,"column":0},"end":{"line":58,"column":41}},"11":{"start":{"line":59,"column":0},"end":{"line":59,"column":31}},"12":{"start":{"line":60,"column":0},"end":{"line":60,"column":40}},"13":{"start":{"line":61,"column":0},"end":{"line":61,"column":44}},"14":{"start":{"line":62,"column":0},"end":{"line":62,"column":41}},"15":{"start":{"line":64,"column":0},"end":{"line":64,"column":68}},"16":{"start":{"line":66,"column":0},"end":{"line":659,"column":1}},"17":{"start":{"line":67,"column":2},"end":{"line":67,"column":20}},"18":{"start":{"line":70,"column":1},"end":{"line":73,"column":2}},"19":{"start":{"line":71,"column":2},"end":{"line":71,"column":146}},"20":{"start":{"line":72,"column":2},"end":{"line":72,"column":18}},"21":{"start":{"line":77,"column":1},"end":{"line":77,"column":21}},"22":{"start":{"line":78,"column":1},"end":{"line":78,"column":20}},"23":{"start":{"line":83,"column":1},"end":{"line":83,"column":23}},"24":{"start":{"line":87,"column":1},"end":{"line":92,"column":2}},"25":{"start":{"line":88,"column":2},"end":{"line":88,"column":67}},"26":{"start":{"line":89,"column":2},"end":{"line":89,"column":221}},"27":{"start":{"line":90,"column":2},"end":{"line":90,"column":40}},"28":{"start":{"line":91,"column":2},"end":{"line":91,"column":27}},"29":{"start":{"line":96,"column":1},"end":{"line":99,"column":2}},"30":{"start":{"line":97,"column":2},"end":{"line":97,"column":121}},"31":{"start":{"line":98,"column":2},"end":{"line":98,"column":18}},"32":{"start":{"line":101,"column":1},"end":{"line":101,"column":50}},"33":{"start":{"line":103,"column":1},"end":{"line":105,"column":2}},"34":{"start":{"line":104,"column":2},"end":{"line":104,"column":22}},"35":{"start":{"line":107,"column":1},"end":{"line":109,"column":2}},"36":{"start":{"line":108,"column":2},"end":{"line":108,"column":38}},"37":{"start":{"line":111,"column":1},"end":{"line":115,"column":4}},"38":{"start":{"line":117,"column":1},"end":{"line":117,"column":71}},"39":{"start":{"line":119,"column":1},"end":{"line":119,"column":46}},"40":{"start":{"line":121,"column":1},"end":{"line":121,"column":25}},"41":{"start":{"line":123,"column":1},"end":{"line":204,"column":2}},"42":{"start":{"line":124,"column":2},"end":{"line":124,"column":47}},"43":{"start":{"line":125,"column":8},"end":{"line":204,"column":2}},"44":{"start":{"line":127,"column":2},"end":{"line":127,"column":68}},"45":{"start":{"line":131,"column":2},"end":{"line":135,"column":3}},"46":{"start":{"line":132,"column":3},"end":{"line":132,"column":34}},"47":{"start":{"line":133,"column":9},"end":{"line":135,"column":3}},"48":{"start":{"line":134,"column":3},"end":{"line":134,"column":34}},"49":{"start":{"line":137,"column":2},"end":{"line":176,"column":3}},"50":{"start":{"line":139,"column":4},"end":{"line":139,"column":43}},"51":{"start":{"line":140,"column":4},"end":{"line":142,"column":5}},"52":{"start":{"line":141,"column":5},"end":{"line":141,"column":40}},"53":{"start":{"line":143,"column":4},"end":{"line":146,"column":7}},"54":{"start":{"line":147,"column":4},"end":{"line":147,"column":10}},"55":{"start":{"line":150,"column":4},"end":{"line":150,"column":56}},"56":{"start":{"line":151,"column":4},"end":{"line":153,"column":7}},"57":{"start":{"line":154,"column":4},"end":{"line":161,"column":5}},"58":{"start":{"line":155,"column":5},"end":{"line":159,"column":11}},"59":{"start":{"line":160,"column":5},"end":{"line":160,"column":21}},"60":{"start":{"line":162,"column":4},"end":{"line":162,"column":10}},"61":{"start":{"line":165,"column":4},"end":{"line":165,"column":43}},"62":{"start":{"line":166,"column":4},"end":{"line":166,"column":10}},"63":{"start":{"line":169,"column":4},"end":{"line":173,"column":10}},"64":{"start":{"line":174,"column":4},"end":{"line":174,"column":20}},"65":{"start":{"line":175,"column":4},"end":{"line":175,"column":10}},"66":{"start":{"line":179,"column":2},"end":{"line":203,"column":3}},"67":{"start":{"line":180,"column":3},"end":{"line":180,"column":53}},"68":{"start":{"line":181,"column":3},"end":{"line":191,"column":6}},"69":{"start":{"line":182,"column":4},"end":{"line":182,"column":74}},"70":{"start":{"line":183,"column":4},"end":{"line":183,"column":48}},"71":{"start":{"line":184,"column":4},"end":{"line":184,"column":50}},"72":{"start":{"line":185,"column":4},"end":{"line":190,"column":7}},"73":{"start":{"line":186,"column":5},"end":{"line":188,"column":11}},"74":{"start":{"line":189,"column":5},"end":{"line":189,"column":21}},"75":{"start":{"line":193,"column":3},"end":{"line":202,"column":4}},"76":{"start":{"line":194,"column":4},"end":{"line":198,"column":10}},"77":{"start":{"line":199,"column":4},"end":{"line":199,"column":20}},"78":{"start":{"line":201,"column":4},"end":{"line":201,"column":12}},"79":{"start":{"line":207,"column":1},"end":{"line":207,"column":45}},"80":{"start":{"line":208,"column":1},"end":{"line":208,"column":54}},"81":{"start":{"line":212,"column":1},"end":{"line":215,"column":2}},"82":{"start":{"line":213,"column":2},"end":{"line":213,"column":24}},"83":{"start":{"line":214,"column":2},"end":{"line":214,"column":19}},"84":{"start":{"line":217,"column":1},"end":{"line":219,"column":2}},"85":{"start":{"line":218,"column":2},"end":{"line":218,"column":31}},"86":{"start":{"line":221,"column":1},"end":{"line":221,"column":26}},"87":{"start":{"line":221,"column":14},"end":{"line":221,"column":26}},"88":{"start":{"line":225,"column":1},"end":{"line":233,"column":2}},"89":{"start":{"line":227,"column":2},"end":{"line":230,"column":5}},"90":{"start":{"line":228,"column":3},"end":{"line":228,"column":73}},"91":{"start":{"line":229,"column":3},"end":{"line":229,"column":10}},"92":{"start":{"line":232,"column":2},"end":{"line":232,"column":32}},"93":{"start":{"line":238,"column":1},"end":{"line":240,"column":2}},"94":{"start":{"line":239,"column":2},"end":{"line":239,"column":65}},"95":{"start":{"line":243,"column":1},"end":{"line":243,"column":63}},"96":{"start":{"line":244,"column":1},"end":{"line":244,"column":49}},"97":{"start":{"line":247,"column":1},"end":{"line":249,"column":2}},"98":{"start":{"line":248,"column":2},"end":{"line":248,"column":43}},"99":{"start":{"line":252,"column":1},"end":{"line":254,"column":2}},"100":{"start":{"line":253,"column":2},"end":{"line":253,"column":27}},"101":{"start":{"line":257,"column":1},"end":{"line":257,"column":72}},"102":{"start":{"line":260,"column":1},"end":{"line":262,"column":2}},"103":{"start":{"line":261,"column":2},"end":{"line":261,"column":48}},"104":{"start":{"line":265,"column":1},"end":{"line":267,"column":2}},"105":{"start":{"line":266,"column":2},"end":{"line":266,"column":25}},"106":{"start":{"line":270,"column":1},"end":{"line":273,"column":2}},"107":{"start":{"line":271,"column":2},"end":{"line":271,"column":45}},"108":{"start":{"line":272,"column":2},"end":{"line":272,"column":30}},"109":{"start":{"line":274,"column":1},"end":{"line":276,"column":4}},"110":{"start":{"line":275,"column":2},"end":{"line":275,"column":50}},"111":{"start":{"line":280,"column":1},"end":{"line":282,"column":2}},"112":{"start":{"line":281,"column":2},"end":{"line":281,"column":43}},"113":{"start":{"line":286,"column":1},"end":{"line":288,"column":2}},"114":{"start":{"line":287,"column":2},"end":{"line":287,"column":58}},"115":{"start":{"line":293,"column":1},"end":{"line":293,"column":34}},"116":{"start":{"line":294,"column":1},"end":{"line":294,"column":50}},"117":{"start":{"line":296,"column":1},"end":{"line":298,"column":2}},"118":{"start":{"line":297,"column":2},"end":{"line":297,"column":26}},"119":{"start":{"line":300,"column":1},"end":{"line":304,"column":2}},"120":{"start":{"line":301,"column":2},"end":{"line":303,"column":11}},"121":{"start":{"line":302,"column":3},"end":{"line":302,"column":76}},"122":{"start":{"line":309,"column":1},"end":{"line":310,"column":47}},"123":{"start":{"line":312,"column":1},"end":{"line":314,"column":2}},"124":{"start":{"line":313,"column":2},"end":{"line":313,"column":26}},"125":{"start":{"line":316,"column":1},"end":{"line":340,"column":2}},"126":{"start":{"line":317,"column":2},"end":{"line":317,"column":21}},"127":{"start":{"line":318,"column":2},"end":{"line":332,"column":3}},"128":{"start":{"line":319,"column":3},"end":{"line":319,"column":24}},"129":{"start":{"line":320,"column":3},"end":{"line":320,"column":52}},"130":{"start":{"line":322,"column":3},"end":{"line":331,"column":4}},"131":{"start":{"line":323,"column":4},"end":{"line":327,"column":6}},"132":{"start":{"line":328,"column":4},"end":{"line":328,"column":20}},"133":{"start":{"line":330,"column":4},"end":{"line":330,"column":12}},"134":{"start":{"line":333,"column":2},"end":{"line":339,"column":11}},"135":{"start":{"line":334,"column":3},"end":{"line":338,"column":21}},"136":{"start":{"line":345,"column":1},"end":{"line":345,"column":38}},"137":{"start":{"line":346,"column":1},"end":{"line":346,"column":48}},"138":{"start":{"line":348,"column":1},"end":{"line":350,"column":2}},"139":{"start":{"line":349,"column":2},"end":{"line":349,"column":30}},"140":{"start":{"line":352,"column":1},"end":{"line":356,"column":2}},"141":{"start":{"line":353,"column":2},"end":{"line":355,"column":11}},"142":{"start":{"line":354,"column":3},"end":{"line":354,"column":66}},"143":{"start":{"line":359,"column":1},"end":{"line":362,"column":2}},"144":{"start":{"line":360,"column":2},"end":{"line":360,"column":33}},"145":{"start":{"line":361,"column":2},"end":{"line":361,"column":66}},"146":{"start":{"line":366,"column":1},"end":{"line":368,"column":2}},"147":{"start":{"line":367,"column":2},"end":{"line":367,"column":46}},"148":{"start":{"line":371,"column":1},"end":{"line":373,"column":4}},"149":{"start":{"line":372,"column":2},"end":{"line":372,"column":50}},"150":{"start":{"line":376,"column":1},"end":{"line":379,"column":2}},"151":{"start":{"line":377,"column":2},"end":{"line":377,"column":49}},"152":{"start":{"line":378,"column":2},"end":{"line":378,"column":34}},"153":{"start":{"line":380,"column":1},"end":{"line":382,"column":4}},"154":{"start":{"line":381,"column":2},"end":{"line":381,"column":54}},"155":{"start":{"line":385,"column":1},"end":{"line":385,"column":27}},"156":{"start":{"line":387,"column":1},"end":{"line":390,"column":2}},"157":{"start":{"line":388,"column":2},"end":{"line":388,"column":29}},"158":{"start":{"line":389,"column":2},"end":{"line":389,"column":50}},"159":{"start":{"line":392,"column":1},"end":{"line":392,"column":44}},"160":{"start":{"line":393,"column":1},"end":{"line":393,"column":34}},"161":{"start":{"line":394,"column":1},"end":{"line":394,"column":50}},"162":{"start":{"line":395,"column":1},"end":{"line":395,"column":27}},"163":{"start":{"line":396,"column":1},"end":{"line":396,"column":38}},"164":{"start":{"line":399,"column":1},"end":{"line":402,"column":2}},"165":{"start":{"line":400,"column":2},"end":{"line":400,"column":46}},"166":{"start":{"line":401,"column":2},"end":{"line":401,"column":31}},"167":{"start":{"line":403,"column":1},"end":{"line":405,"column":4}},"168":{"start":{"line":404,"column":2},"end":{"line":404,"column":51}},"169":{"start":{"line":407,"column":1},"end":{"line":407,"column":38}},"170":{"start":{"line":408,"column":1},"end":{"line":410,"column":5}},"171":{"start":{"line":411,"column":1},"end":{"line":411,"column":37}},"172":{"start":{"line":413,"column":1},"end":{"line":417,"column":2}},"173":{"start":{"line":414,"column":2},"end":{"line":414,"column":32}},"174":{"start":{"line":415,"column":8},"end":{"line":417,"column":2}},"175":{"start":{"line":416,"column":2},"end":{"line":416,"column":31}},"176":{"start":{"line":420,"column":1},"end":{"line":423,"column":2}},"177":{"start":{"line":421,"column":2},"end":{"line":421,"column":32}},"178":{"start":{"line":422,"column":2},"end":{"line":422,"column":51}},"179":{"start":{"line":426,"column":1},"end":{"line":431,"column":2}},"180":{"start":{"line":427,"column":2},"end":{"line":427,"column":34}},"181":{"start":{"line":428,"column":2},"end":{"line":428,"column":28}},"182":{"start":{"line":430,"column":2},"end":{"line":430,"column":29}},"183":{"start":{"line":434,"column":1},"end":{"line":448,"column":2}},"184":{"start":{"line":435,"column":2},"end":{"line":441,"column":3}},"185":{"start":{"line":436,"column":3},"end":{"line":439,"column":5}},"186":{"start":{"line":440,"column":3},"end":{"line":440,"column":19}},"187":{"start":{"line":442,"column":2},"end":{"line":442,"column":59}},"188":{"start":{"line":443,"column":2},"end":{"line":446,"column":4}},"189":{"start":{"line":447,"column":2},"end":{"line":447,"column":40}},"190":{"start":{"line":453,"column":1},"end":{"line":456,"column":2}},"191":{"start":{"line":454,"column":2},"end":{"line":454,"column":45}},"192":{"start":{"line":455,"column":2},"end":{"line":455,"column":30}},"193":{"start":{"line":457,"column":1},"end":{"line":459,"column":4}},"194":{"start":{"line":458,"column":2},"end":{"line":458,"column":50}},"195":{"start":{"line":463,"column":1},"end":{"line":466,"column":2}},"196":{"start":{"line":464,"column":2},"end":{"line":464,"column":49}},"197":{"start":{"line":465,"column":2},"end":{"line":465,"column":19}},"198":{"start":{"line":470,"column":1},"end":{"line":473,"column":2}},"199":{"start":{"line":471,"column":2},"end":{"line":471,"column":34}},"200":{"start":{"line":472,"column":2},"end":{"line":472,"column":26}},"201":{"start":{"line":476,"column":1},"end":{"line":583,"column":3}},"202":{"start":{"line":479,"column":2},"end":{"line":487,"column":3}},"203":{"start":{"line":480,"column":3},"end":{"line":486,"column":6}},"204":{"start":{"line":481,"column":4},"end":{"line":485,"column":5}},"205":{"start":{"line":482,"column":5},"end":{"line":482,"column":49}},"206":{"start":{"line":484,"column":5},"end":{"line":484,"column":12}},"207":{"start":{"line":490,"column":2},"end":{"line":492,"column":4}},"208":{"start":{"line":491,"column":3},"end":{"line":491,"column":103}},"209":{"start":{"line":494,"column":2},"end":{"line":519,"column":5}},"210":{"start":{"line":495,"column":3},"end":{"line":495,"column":36}},"211":{"start":{"line":496,"column":3},"end":{"line":518,"column":4}},"212":{"start":{"line":497,"column":4},"end":{"line":515,"column":5}},"213":{"start":{"line":498,"column":5},"end":{"line":507,"column":6}},"214":{"start":{"line":499,"column":6},"end":{"line":499,"column":29}},"215":{"start":{"line":500,"column":12},"end":{"line":507,"column":6}},"216":{"start":{"line":501,"column":6},"end":{"line":501,"column":37}},"217":{"start":{"line":503,"column":6},"end":{"line":505,"column":7}},"218":{"start":{"line":504,"column":7},"end":{"line":504,"column":128}},"219":{"start":{"line":506,"column":6},"end":{"line":506,"column":40}},"220":{"start":{"line":509,"column":5},"end":{"line":513,"column":6}},"221":{"start":{"line":510,"column":6},"end":{"line":510,"column":62}},"222":{"start":{"line":511,"column":6},"end":{"line":511,"column":21}},"223":{"start":{"line":512,"column":6},"end":{"line":512,"column":26}},"224":{"start":{"line":514,"column":5},"end":{"line":514,"column":39}},"225":{"start":{"line":517,"column":4},"end":{"line":517,"column":38}},"226":{"start":{"line":523,"column":2},"end":{"line":551,"column":4}},"227":{"start":{"line":525,"column":3},"end":{"line":532,"column":4}},"228":{"start":{"line":526,"column":4},"end":{"line":530,"column":5}},"229":{"start":{"line":527,"column":5},"end":{"line":527,"column":92}},"230":{"start":{"line":529,"column":5},"end":{"line":529,"column":57}},"231":{"start":{"line":531,"column":4},"end":{"line":531,"column":34}},"232":{"start":{"line":534,"column":3},"end":{"line":534,"column":16}},"233":{"start":{"line":536,"column":3},"end":{"line":548,"column":4}},"234":{"start":{"line":538,"column":4},"end":{"line":547,"column":5}},"235":{"start":{"line":539,"column":5},"end":{"line":541,"column":6}},"236":{"start":{"line":540,"column":6},"end":{"line":540,"column":41}},"237":{"start":{"line":542,"column":5},"end":{"line":542,"column":42}},"238":{"start":{"line":543,"column":11},"end":{"line":547,"column":5}},"239":{"start":{"line":544,"column":5},"end":{"line":544,"column":55}},"240":{"start":{"line":545,"column":11},"end":{"line":547,"column":5}},"241":{"start":{"line":546,"column":5},"end":{"line":546,"column":16}},"242":{"start":{"line":550,"column":3},"end":{"line":550,"column":104}},"243":{"start":{"line":553,"column":2},"end":{"line":582,"column":5}},"244":{"start":{"line":555,"column":3},"end":{"line":555,"column":36}},"245":{"start":{"line":557,"column":3},"end":{"line":580,"column":4}},"246":{"start":{"line":558,"column":4},"end":{"line":577,"column":5}},"247":{"start":{"line":559,"column":5},"end":{"line":569,"column":6}},"248":{"start":{"line":560,"column":6},"end":{"line":560,"column":34}},"249":{"start":{"line":561,"column":12},"end":{"line":569,"column":6}},"250":{"start":{"line":562,"column":6},"end":{"line":562,"column":27}},"251":{"start":{"line":563,"column":6},"end":{"line":563,"column":37}},"252":{"start":{"line":565,"column":6},"end":{"line":567,"column":7}},"253":{"start":{"line":566,"column":7},"end":{"line":566,"column":124}},"254":{"start":{"line":568,"column":6},"end":{"line":568,"column":45}},"255":{"start":{"line":571,"column":5},"end":{"line":575,"column":6}},"256":{"start":{"line":572,"column":6},"end":{"line":572,"column":58}},"257":{"start":{"line":573,"column":6},"end":{"line":573,"column":21}},"258":{"start":{"line":574,"column":6},"end":{"line":574,"column":26}},"259":{"start":{"line":576,"column":5},"end":{"line":576,"column":44}},"260":{"start":{"line":579,"column":4},"end":{"line":579,"column":43}},"261":{"start":{"line":587,"column":1},"end":{"line":587,"column":33}},"262":{"start":{"line":590,"column":1},"end":{"line":616,"column":2}},"263":{"start":{"line":591,"column":2},"end":{"line":591,"column":40}},"264":{"start":{"line":592,"column":2},"end":{"line":592,"column":50}},"265":{"start":{"line":593,"column":2},"end":{"line":593,"column":19}},"266":{"start":{"line":595,"column":2},"end":{"line":595,"column":130}},"267":{"start":{"line":597,"column":2},"end":{"line":599,"column":5}},"268":{"start":{"line":598,"column":3},"end":{"line":598,"column":109}},"269":{"start":{"line":601,"column":2},"end":{"line":607,"column":4}},"270":{"start":{"line":609,"column":2},"end":{"line":609,"column":39}},"271":{"start":{"line":610,"column":2},"end":{"line":610,"column":42}},"272":{"start":{"line":613,"column":2},"end":{"line":613,"column":31}},"273":{"start":{"line":614,"column":2},"end":{"line":614,"column":43}},"274":{"start":{"line":618,"column":1},"end":{"line":658,"column":4}},"275":{"start":{"line":620,"column":2},"end":{"line":624,"column":3}},"276":{"start":{"line":621,"column":3},"end":{"line":621,"column":67}},"277":{"start":{"line":622,"column":3},"end":{"line":622,"column":33}},"278":{"start":{"line":623,"column":3},"end":{"line":623,"column":20}},"279":{"start":{"line":626,"column":2},"end":{"line":631,"column":3}},"280":{"start":{"line":627,"column":3},"end":{"line":627,"column":46}},"281":{"start":{"line":627,"column":39},"end":{"line":627,"column":46}},"282":{"start":{"line":628,"column":3},"end":{"line":628,"column":13}},"283":{"start":{"line":630,"column":3},"end":{"line":630,"column":80}},"284":{"start":{"line":635,"column":2},"end":{"line":635,"column":33}},"285":{"start":{"line":636,"column":2},"end":{"line":636,"column":29}},"286":{"start":{"line":638,"column":2},"end":{"line":641,"column":4}},"287":{"start":{"line":639,"column":3},"end":{"line":639,"column":38}},"288":{"start":{"line":640,"column":3},"end":{"line":640,"column":17}},"289":{"start":{"line":643,"column":2},"end":{"line":650,"column":4}},"290":{"start":{"line":644,"column":3},"end":{"line":649,"column":4}},"291":{"start":{"line":645,"column":4},"end":{"line":645,"column":34}},"292":{"start":{"line":646,"column":4},"end":{"line":646,"column":35}},"293":{"start":{"line":648,"column":4},"end":{"line":648,"column":14}},"294":{"start":{"line":652,"column":2},"end":{"line":656,"column":3}},"295":{"start":{"line":653,"column":3},"end":{"line":653,"column":39}},"296":{"start":{"line":655,"column":3},"end":{"line":655,"column":15}},"297":{"start":{"line":661,"column":0},"end":{"line":661,"column":23}}},"branchMap":{"1":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},{"start":{"line":70,"column":1},"end":{"line":70,"column":1}}]},"2":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},{"start":{"line":87,"column":1},"end":{"line":87,"column":1}}]},"3":{"line":88,"type":"binary-expr","locations":[{"start":{"line":88,"column":15},"end":{"line":88,"column":34}},{"start":{"line":88,"column":38},"end":{"line":88,"column":66}}]},"4":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":14},"end":{"line":89,"column":35}},{"start":{"line":89,"column":39},"end":{"line":89,"column":60}},{"start":{"line":89,"column":64},"end":{"line":89,"column":87}},{"start":{"line":89,"column":91},"end":{"line":89,"column":115}},{"start":{"line":89,"column":119},"end":{"line":89,"column":143}},{"start":{"line":89,"column":147},"end":{"line":89,"column":220}}]},"5":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":148},"end":{"line":89,"column":184}},{"start":{"line":89,"column":188},"end":{"line":89,"column":210}}]},"6":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},{"start":{"line":96,"column":1},"end":{"line":96,"column":1}}]},"7":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},{"start":{"line":103,"column":1},"end":{"line":103,"column":1}}]},"8":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},{"start":{"line":107,"column":1},"end":{"line":107,"column":1}}]},"9":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},{"start":{"line":123,"column":1},"end":{"line":123,"column":1}}]},"10":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":8},"end":{"line":125,"column":8}},{"start":{"line":125,"column":8},"end":{"line":125,"column":8}}]},"11":{"line":127,"type":"binary-expr","locations":[{"start":{"line":127,"column":28},"end":{"line":127,"column":61}},{"start":{"line":127,"column":65},"end":{"line":127,"column":67}}]},"12":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":2},"end":{"line":131,"column":2}},{"start":{"line":131,"column":2},"end":{"line":131,"column":2}}]},"13":{"line":133,"type":"if","locations":[{"start":{"line":133,"column":9},"end":{"line":133,"column":9}},{"start":{"line":133,"column":9},"end":{"line":133,"column":9}}]},"14":{"line":137,"type":"switch","locations":[{"start":{"line":138,"column":3},"end":{"line":147,"column":10}},{"start":{"line":149,"column":3},"end":{"line":162,"column":10}},{"start":{"line":164,"column":3},"end":{"line":166,"column":10}},{"start":{"line":168,"column":3},"end":{"line":175,"column":10}}]},"15":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":4},"end":{"line":140,"column":4}},{"start":{"line":140,"column":4},"end":{"line":140,"column":4}}]},"16":{"line":154,"type":"if","locations":[{"start":{"line":154,"column":4},"end":{"line":154,"column":4}},{"start":{"line":154,"column":4},"end":{"line":154,"column":4}}]},"17":{"line":193,"type":"if","locations":[{"start":{"line":193,"column":3},"end":{"line":193,"column":3}},{"start":{"line":193,"column":3},"end":{"line":193,"column":3}}]},"18":{"line":212,"type":"if","locations":[{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},{"start":{"line":212,"column":1},"end":{"line":212,"column":1}}]},"19":{"line":217,"type":"if","locations":[{"start":{"line":217,"column":1},"end":{"line":217,"column":1}},{"start":{"line":217,"column":1},"end":{"line":217,"column":1}}]},"20":{"line":221,"type":"if","locations":[{"start":{"line":221,"column":1},"end":{"line":221,"column":1}},{"start":{"line":221,"column":1},"end":{"line":221,"column":1}}]},"21":{"line":225,"type":"if","locations":[{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},{"start":{"line":225,"column":1},"end":{"line":225,"column":1}}]},"22":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},{"start":{"line":238,"column":1},"end":{"line":238,"column":1}}]},"23":{"line":243,"type":"binary-expr","locations":[{"start":{"line":243,"column":18},"end":{"line":243,"column":39}},{"start":{"line":243,"column":43},"end":{"line":243,"column":61}}]},"24":{"line":247,"type":"if","locations":[{"start":{"line":247,"column":1},"end":{"line":247,"column":1}},{"start":{"line":247,"column":1},"end":{"line":247,"column":1}}]},"25":{"line":252,"type":"if","locations":[{"start":{"line":252,"column":1},"end":{"line":252,"column":1}},{"start":{"line":252,"column":1},"end":{"line":252,"column":1}}]},"26":{"line":252,"type":"binary-expr","locations":[{"start":{"line":252,"column":5},"end":{"line":252,"column":37}},{"start":{"line":252,"column":41},"end":{"line":252,"column":72}}]},"27":{"line":257,"type":"cond-expr","locations":[{"start":{"line":257,"column":58},"end":{"line":257,"column":62}},{"start":{"line":257,"column":65},"end":{"line":257,"column":70}}]},"28":{"line":260,"type":"if","locations":[{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},{"start":{"line":260,"column":1},"end":{"line":260,"column":1}}]},"29":{"line":265,"type":"if","locations":[{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},{"start":{"line":265,"column":1},"end":{"line":265,"column":1}}]},"30":{"line":270,"type":"if","locations":[{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},{"start":{"line":270,"column":1},"end":{"line":270,"column":1}}]},"31":{"line":280,"type":"if","locations":[{"start":{"line":280,"column":1},"end":{"line":280,"column":1}},{"start":{"line":280,"column":1},"end":{"line":280,"column":1}}]},"32":{"line":286,"type":"if","locations":[{"start":{"line":286,"column":1},"end":{"line":286,"column":1}},{"start":{"line":286,"column":1},"end":{"line":286,"column":1}}]},"33":{"line":294,"type":"binary-expr","locations":[{"start":{"line":294,"column":19},"end":{"line":294,"column":43}},{"start":{"line":294,"column":47},"end":{"line":294,"column":49}}]},"34":{"line":296,"type":"if","locations":[{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},{"start":{"line":296,"column":1},"end":{"line":296,"column":1}}]},"35":{"line":300,"type":"if","locations":[{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},{"start":{"line":300,"column":1},"end":{"line":300,"column":1}}]},"36":{"line":310,"type":"binary-expr","locations":[{"start":{"line":310,"column":16},"end":{"line":310,"column":40}},{"start":{"line":310,"column":44},"end":{"line":310,"column":46}}]},"37":{"line":312,"type":"if","locations":[{"start":{"line":312,"column":1},"end":{"line":312,"column":1}},{"start":{"line":312,"column":1},"end":{"line":312,"column":1}}]},"38":{"line":316,"type":"if","locations":[{"start":{"line":316,"column":1},"end":{"line":316,"column":1}},{"start":{"line":316,"column":1},"end":{"line":316,"column":1}}]},"39":{"line":322,"type":"if","locations":[{"start":{"line":322,"column":3},"end":{"line":322,"column":3}},{"start":{"line":322,"column":3},"end":{"line":322,"column":3}}]},"40":{"line":337,"type":"cond-expr","locations":[{"start":{"line":337,"column":52},"end":{"line":337,"column":64}},{"start":{"line":337,"column":67},"end":{"line":337,"column":75}}]},"41":{"line":348,"type":"if","locations":[{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},{"start":{"line":348,"column":1},"end":{"line":348,"column":1}}]},"42":{"line":352,"type":"if","locations":[{"start":{"line":352,"column":1},"end":{"line":352,"column":1}},{"start":{"line":352,"column":1},"end":{"line":352,"column":1}}]},"43":{"line":359,"type":"if","locations":[{"start":{"line":359,"column":1},"end":{"line":359,"column":1}},{"start":{"line":359,"column":1},"end":{"line":359,"column":1}}]},"44":{"line":366,"type":"if","locations":[{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},{"start":{"line":366,"column":1},"end":{"line":366,"column":1}}]},"45":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":1},"end":{"line":376,"column":1}},{"start":{"line":376,"column":1},"end":{"line":376,"column":1}}]},"46":{"line":387,"type":"if","locations":[{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},{"start":{"line":387,"column":1},"end":{"line":387,"column":1}}]},"47":{"line":399,"type":"if","locations":[{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},{"start":{"line":399,"column":1},"end":{"line":399,"column":1}}]},"48":{"line":413,"type":"if","locations":[{"start":{"line":413,"column":1},"end":{"line":413,"column":1}},{"start":{"line":413,"column":1},"end":{"line":413,"column":1}}]},"49":{"line":415,"type":"if","locations":[{"start":{"line":415,"column":8},"end":{"line":415,"column":8}},{"start":{"line":415,"column":8},"end":{"line":415,"column":8}}]},"50":{"line":420,"type":"if","locations":[{"start":{"line":420,"column":1},"end":{"line":420,"column":1}},{"start":{"line":420,"column":1},"end":{"line":420,"column":1}}]},"51":{"line":426,"type":"if","locations":[{"start":{"line":426,"column":1},"end":{"line":426,"column":1}},{"start":{"line":426,"column":1},"end":{"line":426,"column":1}}]},"52":{"line":434,"type":"if","locations":[{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},{"start":{"line":434,"column":1},"end":{"line":434,"column":1}}]},"53":{"line":435,"type":"if","locations":[{"start":{"line":435,"column":2},"end":{"line":435,"column":2}},{"start":{"line":435,"column":2},"end":{"line":435,"column":2}}]},"54":{"line":453,"type":"if","locations":[{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},{"start":{"line":453,"column":1},"end":{"line":453,"column":1}}]},"55":{"line":463,"type":"if","locations":[{"start":{"line":463,"column":1},"end":{"line":463,"column":1}},{"start":{"line":463,"column":1},"end":{"line":463,"column":1}}]},"56":{"line":470,"type":"if","locations":[{"start":{"line":470,"column":1},"end":{"line":470,"column":1}},{"start":{"line":470,"column":1},"end":{"line":470,"column":1}}]},"57":{"line":479,"type":"if","locations":[{"start":{"line":479,"column":2},"end":{"line":479,"column":2}},{"start":{"line":479,"column":2},"end":{"line":479,"column":2}}]},"58":{"line":481,"type":"if","locations":[{"start":{"line":481,"column":4},"end":{"line":481,"column":4}},{"start":{"line":481,"column":4},"end":{"line":481,"column":4}}]},"59":{"line":496,"type":"if","locations":[{"start":{"line":496,"column":3},"end":{"line":496,"column":3}},{"start":{"line":496,"column":3},"end":{"line":496,"column":3}}]},"60":{"line":498,"type":"if","locations":[{"start":{"line":498,"column":5},"end":{"line":498,"column":5}},{"start":{"line":498,"column":5},"end":{"line":498,"column":5}}]},"61":{"line":500,"type":"if","locations":[{"start":{"line":500,"column":12},"end":{"line":500,"column":12}},{"start":{"line":500,"column":12},"end":{"line":500,"column":12}}]},"62":{"line":503,"type":"if","locations":[{"start":{"line":503,"column":6},"end":{"line":503,"column":6}},{"start":{"line":503,"column":6},"end":{"line":503,"column":6}}]},"63":{"line":509,"type":"if","locations":[{"start":{"line":509,"column":5},"end":{"line":509,"column":5}},{"start":{"line":509,"column":5},"end":{"line":509,"column":5}}]},"64":{"line":525,"type":"if","locations":[{"start":{"line":525,"column":3},"end":{"line":525,"column":3}},{"start":{"line":525,"column":3},"end":{"line":525,"column":3}}]},"65":{"line":526,"type":"if","locations":[{"start":{"line":526,"column":4},"end":{"line":526,"column":4}},{"start":{"line":526,"column":4},"end":{"line":526,"column":4}}]},"66":{"line":527,"type":"cond-expr","locations":[{"start":{"line":527,"column":29},"end":{"line":527,"column":43}},{"start":{"line":527,"column":46},"end":{"line":527,"column":48}}]},"67":{"line":531,"type":"binary-expr","locations":[{"start":{"line":531,"column":16},"end":{"line":531,"column":25}},{"start":{"line":531,"column":29},"end":{"line":531,"column":32}}]},"68":{"line":536,"type":"if","locations":[{"start":{"line":536,"column":3},"end":{"line":536,"column":3}},{"start":{"line":536,"column":3},"end":{"line":536,"column":3}}]},"69":{"line":538,"type":"if","locations":[{"start":{"line":538,"column":4},"end":{"line":538,"column":4}},{"start":{"line":538,"column":4},"end":{"line":538,"column":4}}]},"70":{"line":539,"type":"if","locations":[{"start":{"line":539,"column":5},"end":{"line":539,"column":5}},{"start":{"line":539,"column":5},"end":{"line":539,"column":5}}]},"71":{"line":543,"type":"if","locations":[{"start":{"line":543,"column":11},"end":{"line":543,"column":11}},{"start":{"line":543,"column":11},"end":{"line":543,"column":11}}]},"72":{"line":545,"type":"if","locations":[{"start":{"line":545,"column":11},"end":{"line":545,"column":11}},{"start":{"line":545,"column":11},"end":{"line":545,"column":11}}]},"73":{"line":557,"type":"if","locations":[{"start":{"line":557,"column":3},"end":{"line":557,"column":3}},{"start":{"line":557,"column":3},"end":{"line":557,"column":3}}]},"74":{"line":559,"type":"if","locations":[{"start":{"line":559,"column":5},"end":{"line":559,"column":5}},{"start":{"line":559,"column":5},"end":{"line":559,"column":5}}]},"75":{"line":561,"type":"if","locations":[{"start":{"line":561,"column":12},"end":{"line":561,"column":12}},{"start":{"line":561,"column":12},"end":{"line":561,"column":12}}]},"76":{"line":565,"type":"if","locations":[{"start":{"line":565,"column":6},"end":{"line":565,"column":6}},{"start":{"line":565,"column":6},"end":{"line":565,"column":6}}]},"77":{"line":571,"type":"if","locations":[{"start":{"line":571,"column":5},"end":{"line":571,"column":5}},{"start":{"line":571,"column":5},"end":{"line":571,"column":5}}]},"78":{"line":590,"type":"if","locations":[{"start":{"line":590,"column":1},"end":{"line":590,"column":1}},{"start":{"line":590,"column":1},"end":{"line":590,"column":1}}]},"79":{"line":595,"type":"cond-expr","locations":[{"start":{"line":595,"column":69},"end":{"line":595,"column":124}},{"start":{"line":595,"column":127},"end":{"line":595,"column":129}}]},"80":{"line":595,"type":"binary-expr","locations":[{"start":{"line":595,"column":21},"end":{"line":595,"column":41}},{"start":{"line":595,"column":45},"end":{"line":595,"column":65}}]},"81":{"line":620,"type":"if","locations":[{"start":{"line":620,"column":2},"end":{"line":620,"column":2}},{"start":{"line":620,"column":2},"end":{"line":620,"column":2}}]},"82":{"line":626,"type":"if","locations":[{"start":{"line":626,"column":2},"end":{"line":626,"column":2}},{"start":{"line":626,"column":2},"end":{"line":626,"column":2}}]},"83":{"line":627,"type":"if","locations":[{"start":{"line":627,"column":3},"end":{"line":627,"column":3}},{"start":{"line":627,"column":3},"end":{"line":627,"column":3}}]},"84":{"line":639,"type":"binary-expr","locations":[{"start":{"line":639,"column":3},"end":{"line":639,"column":17}},{"start":{"line":639,"column":21},"end":{"line":639,"column":37}}]},"85":{"line":644,"type":"if","locations":[{"start":{"line":644,"column":3},"end":{"line":644,"column":3}},{"start":{"line":644,"column":3},"end":{"line":644,"column":3}}]},"86":{"line":652,"type":"if","locations":[{"start":{"line":652,"column":2},"end":{"line":652,"column":2}},{"start":{"line":652,"column":2},"end":{"line":652,"column":2}}]}},"code":["/**"," * Configures a Keystone app in encapsulated mode, but does not start it."," *"," * Connects to the database and runs updates and then calls back."," *"," * This is the code-path to use if you'd like to mount the keystone app as a sub-app in another express application."," *"," *   var app = express();"," *"," *   //...do your normal express setup stuff, add middleware and routes (but not static content or error handling middleware yet)"," *"," *   keystone.mount('/content', app, function() {"," *\t //put your app's static content and error handling middleware here and start your server"," *   });"," *"," * Events are fired during initialisation to allow customisation, including:"," *"," *   - onMount"," *"," * If the events argument is a function, it is assumed to be the mounted event."," *"," *"," * ####Options:"," *"," * Keystone supports the following options specifically for running in encapsulated mode (with no embedded server):"," *"," *   - name"," *   - port"," *   - views"," *   - view engine"," *   - compress"," *   - favico"," *   - less"," *   - static"," *   - headless"," *   - logger"," *   - cookie secret"," *   - session"," *   - 404"," *   - 500"," *   - routes"," *   - locals"," *   - auto update"," *"," *"," * @api public"," */","","var _ = require('underscore');","var debug = require('debug')('keystone:core:mount');","var P = require('bluebird');","var express = require('express');","var path = require('path');","var utils = require('keystone-utils');","var favicon = require('serve-favicon');","var morgan = require('morgan');","var methodOverride = require('method-override');","var session = require('express-session');","var multer = require('multer');","var bodyParser = require('body-parser');","var cookieParser = require('cookie-parser');","var compression = require('compression');","","var dashes = '\\n------------------------------------------------\\n';","","function mount(mountPath, parentApp, events) {","  debug('mounting');","\t// Validate the express app instance","","\tif (!this.app) {","\t\tconsole.error('\\nKeystoneJS Initialisaton Error:\\n\\napp must be initialised. Call keystone.init() or keystone.connect(new Express()) first.\\n');","\t\tprocess.exit(1);","\t}","","\t// Localise references to this for closures","","\tvar keystone = this;","\tvar app = this.app;","","\t// this.nativeApp indicates keystone has been mounted natively","\t// (not as part of a custom middleware stack)","\t//","\tthis.nativeApp = true;","","\t// Initialise the mongo connection url","","\tif (!this.get('mongo')) {","\t\tvar dbName = this.get('db name') || utils.slug(this.get('name'));","\t\tvar dbUrl = process.env.MONGO_URI || process.env.MONGO_URL || process.env.MONGODB_URL || process.env.MONGOLAB_URI || process.env.MONGOLAB_URL || (process.env.OPENSHIFT_MONGODB_DB_URL || 'mongodb://localhost/') + dbName;","\t\tdebug('setting DB URI to : ' + dbUrl);","\t\tthis.set('mongo', dbUrl);","\t}","","\t// Initialise and validate session options","","\tif (!this.get('cookie secret')) {","\t\tconsole.error('\\nKeystoneJS Configuration Error:\\n\\nPlease provide a `cookie secret` value for session encryption.\\n');","\t\tprocess.exit(1);","\t}","","\tvar sessionOptions = this.get('session options');","","\tif (!_.isObject(sessionOptions)) {","\t\tsessionOptions = {};","\t}","","\tif (!sessionOptions.key) {","\t\tsessionOptions.key = 'keystone.sid';","\t}","","\t_.defaults(sessionOptions, {","\t\tresave: false,","\t\tsecret: this.get('cookie secret'),","\t\tsaveUninitialized: false","\t});","","\tsessionOptions.cookieParser = cookieParser(this.get('cookie secret'));","","\tvar sessionStore = this.get('session store');","","\tvar sessionStorePromise;","","\tif (typeof sessionStore === 'function') {","\t\tsessionOptions.store = sessionStore(session);","\t} else if (sessionStore) {","","\t\tvar sessionStoreOptions = this.get('session store options') || {};","","\t\t// Perform any session store specific configuration or exit on an unsupported session store","","\t\tif (sessionStore === 'mongo') {","\t\t\tsessionStore = 'connect-mongo';","\t\t} else if (sessionStore === 'redis') {","\t\t\tsessionStore = 'connect-redis';","\t\t}","","\t\tswitch (sessionStore) {","\t\t\tcase 'connect-mongo':","\t\t\t\tdebug('using mongo for session store');","\t\t\t\tif (process.version.substr(0, 4) === 'v0.1') {","\t\t\t\t\tsessionStore = 'connect-mongo/es5';","\t\t\t\t}","\t\t\t\t_.defaults(sessionStoreOptions, {","\t\t\t\t\tcollection: 'app_sessions',","\t\t\t\t\turl: this.get('mongo')","\t\t\t\t});","\t\t\t\tbreak;","","\t\t\tcase 'connect-mongostore':","\t\t\t\tdebug('using connect-mongostore for session store');","\t\t\t\t_.defaults(sessionStoreOptions, {","\t\t\t\t\tcollection: 'app_sessions'","\t\t\t\t});","\t\t\t\tif (!sessionStoreOptions.db) {","\t\t\t\t\tconsole.error(","\t\t\t\t\t\t'\\nERROR: connect-mongostore requires `session store options` to be set.' +","\t\t\t\t\t\t'\\n' +","\t\t\t\t\t\t'\\nSee http://keystonejs.com/docs/configuration#options-database for details.' +","\t\t\t\t\t'\\n');","\t\t\t\t\tprocess.exit(1);","\t\t\t\t}","\t\t\t\tbreak;","","\t\t\tcase 'connect-redis':","\t\t\t\tdebug('using redis for session store');","\t\t\t\tbreak;","","\t\t\tdefault:","\t\t\t\tconsole.error(","\t\t\t\t\t'\\nERROR: unsupported session store ' + sessionStore + '.' +","\t\t\t\t\t'\\n' +","\t\t\t\t\t'\\nSee http://keystonejs.com/docs/configuration#options-database for details.' +","\t\t\t\t'\\n');","\t\t\t\tprocess.exit(1);","\t\t\t\tbreak;","\t\t}","","\t\t// Initialize the session store","\t\ttry {","\t\t\tvar SessionStore = require(sessionStore)(session);","\t\t\tsessionStorePromise = new P(function(resolve) {","\t\t\t\tsessionOptions.store = new SessionStore(sessionStoreOptions, resolve);","\t\t\t\tsessionOptions.store.on('connect', resolve);","\t\t\t\tsessionOptions.store.on('connected', resolve);","\t\t\t\tsessionOptions.store.on('disconnect', function() {","\t\t\t\t\tconsole.error(","\t\t\t\t\t\t'\\nThere was an error connecting to the ' + sessionStore + ' session store.' +","\t\t\t\t\t'\\n');","\t\t\t\t\tprocess.exit(1);","\t\t\t\t});","\t\t\t});","\t\t} catch(e) {","\t\t\tif (e.code === 'MODULE_NOT_FOUND') {","\t\t\t\tconsole.error(","\t\t\t\t\t'\\n' + e.toString() +","\t\t\t\t\t'\\nTo use ' + this.get('session store') + ' as a `session store` option, run:' +","\t\t\t\t\t'\\nnpm install ' + sessionStore + ' --save' +","\t\t\t\t'\\n');","\t\t\t\tprocess.exit(1);","\t\t\t} else {","\t\t\t\tthrow e;","\t\t\t}","\t\t}","\t}","","\t// expose initialised session and options","\tthis.set('session options', sessionOptions);","\tthis.set('express session', session(sessionOptions));","","","\t// wrangle arguments","\tif (arguments.length === 1) {","\t\tevents = arguments[0];","\t\tmountPath = null;","\t}","","\tif ('function' === typeof events) {","\t\tevents = { onMount: events };","\t}","","\tif (!events) events = {};","","\t/* Express sub-app mounting to external app at a mount point (if specified) */","","\tif (mountPath) {","\t\t//fix root-relative keystone urls for assets (gets around having to re-write all the keystone templates)","\t\tparentApp.all(/^\\/keystone($|\\/.*)/, function(req, res, next) {","\t\t\treq.url = (mountPath + req.url).replace(new RegExp(/\\/\\//, 'g'), '/');","\t\t\tnext();","\t\t});","","\t\tparentApp.use(mountPath, app);","\t}","","\t/* Keystone's encapsulated Express App Setup */","","\t// Allow usage of custom view engines","\tif (this.get('custom engine')) {","\t\tapp.engine(this.get('view engine'), this.get('custom engine'));","\t}","","\t// Set location of view templates and view engine","\tapp.set('views', this.getPath('views') || path.sep + 'views');","\tapp.set('view engine', this.get('view engine'));","","\t// Apply locals","\tif (utils.isObject(this.get('locals'))) {","\t\t_.extend(app.locals, this.get('locals'));","\t}","","\t// Indent HTML everywhere, except production","\tif (this.get('env') !== 'production' && app.locals.pretty === undefined) {","\t\tapp.locals.pretty = true;","\t}","","\t// Default view caching logic","\tapp.set('view cache', this.get('env') === 'production' ? true : false);","","\t// Setup view caching from app settings","\tif (this.get('view cache') !== undefined) {","\t\tapp.set('view cache', this.get('view cache'));","\t}","","\t// Compress response bodies","\tif (this.get('compress')) {","\t\tapp.use(compression());","\t}","","\t// Pre static config","\tif ('function' === typeof this.get('pre:static')) {","\t\tdebug('configuring pre:static middleware');","\t\tthis.get('pre:static')(app);","\t}","\tapp.use(function(req, res, next) {","\t\tkeystone.callHook('pre:static', req, res, next);","\t});","","\t// Serve static assets","","\tif (this.get('favico')) {","\t\tapp.use(favicon(this.getPath('favico')));","\t}","","\t// unless the headless option is set (which disables the Admin UI),","\t// add the Admin UI's Static Router for public resources","\tif (!this.get('headless')) {","\t\tapp.use('/keystone', require('../../admin/app/static'));","\t}","","\t// the less option can be a single path, or array of paths","\t// when set, we configure the less middleware","","\tvar lessPaths = this.get('less');","\tvar lessOptions = this.get('less options') || {};","","\tif (_.isString(lessPaths)) {","\t\tlessPaths = [lessPaths];","\t}","","\tif (_.isArray(lessPaths)) {","\t\t_.each(lessPaths, function(value) {","\t\t\tapp.use(require('less-middleware')(this.expandPath(value), lessOptions));","\t\t}, this);","\t}","","\t// the sass option can be a single path, or array of paths","\t// when set, we configure the node-sass middleware","","\tvar sassPaths = this.get('sass'),","\t\tsassOptions = this.get('sass options') || {};","","\tif (_.isString(sassPaths)) {","\t\tsassPaths = [sassPaths];","\t}","","\tif (_.isArray(sassPaths)) {","\t\tvar sassMiddleware;","\t\ttry {","\t\t\tdebug('adding sass');","\t\t\tsassMiddleware = require('node-sass-middleware');","\t\t} catch(e) {","\t\t\tif (e.code === 'MODULE_NOT_FOUND') {","\t\t\t\tconsole.error(","\t\t\t\t\t'\\nERROR: node-sass not found.\\n' +","\t\t\t\t\t'\\nPlease install the node-sass-middleware from npm to use the `sass` option.' +","\t\t\t\t\t'\\nYou can do this by running \"npm install node-sass-middleware --save\".\\n'","\t\t\t\t);","\t\t\t\tprocess.exit(1);","\t\t\t} else {","\t\t\t\tthrow e;","\t\t\t}","\t\t}","\t\t_.each(sassPaths, function(value) {","\t\t\tapp.use(sassMiddleware(_.extend({","\t\t\t\tsrc: this.expandPath(value),","\t\t\t\tdest: this.expandPath(value),","\t\t\t\toutputStyle: this.get('env') === 'production' ? 'compressed' : 'nested'","\t\t\t}, sassOptions)));","\t\t}, this);","\t}","","\t// the static option can be a single path, or array of paths","\t// when set, we configure the express static middleware","","\tvar staticPaths = this.get('static');","\tvar staticOptions = this.get('static options');","","\tif (_.isString(staticPaths)) {","\t\tstaticPaths = [staticPaths];","\t}","","\tif (_.isArray(staticPaths)) {","\t\t_.each(staticPaths, function(value) {","\t\t\tapp.use(express.static(this.expandPath(value), staticOptions));","\t\t}, this);","\t}","","\t// Log dynamic requests","\tif (this.get('logger')) {","\t\tdebug('adding request logger');","\t\tapp.use(morgan(this.get('logger'), this.get('logger options')));","\t}","","\t// If the user wants to define their own middleware for logging,","\t// they should be able to","\tif (keystone.get('logging middleware')) {","\t\tapp.use(keystone.get('logging middleware'));","\t}","","\t// We should also allow custom logging middleware to exist in the normal middleware flow","\tapp.use(function(req, res, next) {","\t\tkeystone.callHook('pre:logger', req, res, next);","\t});","","\t// Pre bodyparser middleware","\tif ('function' === typeof this.get('pre:bodyparser')) {","\t\tdebug('configuring pre:bodyparser middleware');","\t\tthis.get('pre:bodyparser')(app);","\t}","\tapp.use(function(req, res, next) {","\t\tkeystone.callHook('pre:bodyparser', req, res, next);","\t});","","\t// Set up body options and cookie parser","\tvar bodyParserParams = {};","","\tif (this.get('file limit')) {","\t\tdebug('adding file limit');","\t\tbodyParserParams.limit = this.get('file limit');","\t}","","\tapp.use(bodyParser.json(bodyParserParams));","\tbodyParserParams.extended = true;","\tapp.use(bodyParser.urlencoded(bodyParserParams));","\tapp.use(methodOverride());","\tapp.use(sessionOptions.cookieParser);","","\t// Pre session config","\tif ('function' === typeof this.get('pre:session')) {","\t\tdebug('configuring pre:session middleware');","\t\tthis.get('pre:session')(app);","\t}","\tapp.use(function(req, res, next) {","\t\tkeystone.callHook('pre:session', req, res, next);","\t});","","\tapp.use(this.get('express session'));","\tapp.use(multer({","\t\tincludeEmptyFields: true","\t}));","\tapp.use(require('connect-flash')());","","\tif (this.get('session') === true) {","\t\tapp.use(this.session.persist);","\t} else if ('function' === typeof this.get('session')) {","\t\tapp.use(this.get('session'));","\t}","","\t// Add 'X-Frame-Options' to response header for ClickJacking protection","\tif (this.get('frame guard')) {","\t\tdebug('enabling frame guard');","\t\tapp.use(require('../security/frameGuard')(this));","\t}","","\t// Process 'X-Forwarded-For' request header","\tif (this.get('trust proxy') === true) {","\t\tdebug('enabling trusted proxy');","\t\tapp.enable('trust proxy');","\t} else {","\t\tapp.disable('trust proxy');","\t}","","\t// Check for IP range restrictions","\tif (this.get('allowed ip ranges')) {","\t\tif (!app.get('trust proxy')) {","\t\t\tconsole.log(","\t\t\t\t'KeystoneJS Initialisaton Error:\\n\\n' +","\t\t\t\t'to set IP range restrictions the \"trust proxy\" setting must be enabled.\\n\\n'","\t\t\t);","\t\t\tprocess.exit(1);","\t\t}","\t\tdebug('adding IP ranges', this.get('allowed ip ranges'));","\t\tvar ipRangeMiddleware = require('../security/ipRangeRestrict')(","\t\t\tthis.get('allowed ip ranges'),","\t\t\tthis.wrapHTMLError","\t\t);","\t\tthis.pre('routes', ipRangeMiddleware);","\t}","","\t// Pre route config","","\t// Pre session config","\tif ('function' === typeof this.get('pre:routes')) {","\t\tdebug('configuring pre:routes middleware');","\t\tthis.get('pre:routes')(app);","\t}","\tapp.use(function(req, res, next) {","\t\tkeystone.callHook('pre:routes', req, res, next);","\t});","","\t// unless the headless option is set (which disables the Admin UI),","\t// include the Admin UI route handlers","\tif (!this.get('headless')) {","\t\tdebug('adding keystone routes to express app');","\t\tthis.routes(app);","\t}","","","\t// Configure application routes","\tif ('function' === typeof this.get('routes')) {","\t\tdebug('configuring app routes');","\t\tthis.get('routes')(app);","\t}","","\t//prepare the error handlers; they should be called last","\tvar setHandlers = function () {","","\t\t// Handle redirects before 404s","\t\tif (Object.keys(keystone._redirects).length) {","\t\t\tapp.use(function(req, res, next) {","\t\t\t\tif (keystone._redirects[req.path]) {","\t\t\t\t\tres.redirect(keystone._redirects[req.path]);","\t\t\t\t} else {","\t\t\t\t\tnext();","\t\t\t\t}","\t\t\t});","\t\t}","","\t\t// Handle 404 (no route matched) errors","\t\tvar default404Handler = function(req, res, next) {// eslint-disable-line no-unused-vars","\t\t\tres.status(404).send(keystone.wrapHTMLError('Sorry, no page could be found at this address (404)'));","\t\t};","","\t\tapp.use(function(req, res, next) {","\t\t\tvar err404 = keystone.get('404');","\t\t\tif (err404) {","\t\t\t\ttry {","\t\t\t\t\tif ('function' === typeof err404) {","\t\t\t\t\t\terr404(req, res, next);","\t\t\t\t\t} else if ('string' === typeof err404) {","\t\t\t\t\t\tres.status(404).render(err404);","\t\t\t\t\t} else {","\t\t\t\t\t\tif (keystone.get('logger')) {","\t\t\t\t\t\t\tconsole.log(dashes + 'Error handling 404 (not found): Invalid type (' + (typeof err404) + ') for 404 setting.' + dashes);","\t\t\t\t\t\t}","\t\t\t\t\t\tdefault404Handler(req, res, next);","\t\t\t\t\t}","\t\t\t\t} catch(e) {","\t\t\t\t\tif (keystone.get('logger')) {","\t\t\t\t\t\tconsole.log(dashes + 'Error handling 404 (not found):');","\t\t\t\t\t\tconsole.log(e);","\t\t\t\t\t\tconsole.log(dashes);","\t\t\t\t\t}","\t\t\t\t\tdefault404Handler(req, res, next);","\t\t\t\t}","\t\t\t} else {","\t\t\t\tdefault404Handler(req, res, next);","\t\t\t}","\t\t});","","\t\t// Handle other errors","","\t\tvar default500Handler = function(err, req, res, next) {// eslint-disable-line no-unused-vars","","\t\t\tif (keystone.get('logger')) {","\t\t\t\tif (err instanceof Error) {","\t\t\t\t\tconsole.log((err.type ? err.type + ' ' : '') + 'Error thrown for request: ' + req.url);","\t\t\t\t} else {","\t\t\t\t\tconsole.log('Error thrown for request: ' + req.url);","\t\t\t\t}","\t\t\t\tconsole.log(err.stack || err);","\t\t\t}","","\t\t\tvar msg = '';","","\t\t\tif (keystone.get('env') === 'development') {","","\t\t\t\tif (err instanceof Error) {","\t\t\t\t\tif (err.type) {","\t\t\t\t\t\tmsg += '<h2>' + err.type + '</h2>';","\t\t\t\t\t}","\t\t\t\t\tmsg += utils.textToHTML(err.message);","\t\t\t\t} else if ('object' === typeof err) {","\t\t\t\t\tmsg += '<code>' + JSON.stringify(err) + '</code>';","\t\t\t\t} else if (err) {","\t\t\t\t\tmsg += err;","\t\t\t\t}","\t\t\t}","","\t\t\tres.status(500).send(keystone.wrapHTMLError('Sorry, an error occurred loading the page (500)', msg));","\t\t};","","\t\tapp.use(function(err, req, res, next) {","","\t\t\tvar err500 = keystone.get('500');","","\t\t\tif (err500) {","\t\t\t\ttry {","\t\t\t\t\tif ('function' === typeof err500) {","\t\t\t\t\t\terr500(err, req, res, next);","\t\t\t\t\t} else if ('string' === typeof err500) {","\t\t\t\t\t\tres.locals.err = err;","\t\t\t\t\t\tres.status(500).render(err500);","\t\t\t\t\t} else {","\t\t\t\t\t\tif (keystone.get('logger')) {","\t\t\t\t\t\t\tconsole.log(dashes + 'Error handling 500 (error): Invalid type (' + (typeof err500) + ') for 500 setting.' + dashes);","\t\t\t\t\t\t}","\t\t\t\t\t\tdefault500Handler(err, req, res, next);","\t\t\t\t\t}","\t\t\t\t} catch(e) {","\t\t\t\t\tif (keystone.get('logger')) {","\t\t\t\t\t\tconsole.log(dashes + 'Error handling 500 (error):');","\t\t\t\t\t\tconsole.log(e);","\t\t\t\t\t\tconsole.log(dashes);","\t\t\t\t\t}","\t\t\t\t\tdefault500Handler(err, req, res, next);","\t\t\t\t}","\t\t\t} else {","\t\t\t\tdefault500Handler(err, req, res, next);","\t\t\t}","","\t\t});","\t};","","\t// Connect to database","","\tvar mongoConnectionOpen = false;","","\t// support replica sets for mongoose","\tif (this.get('mongo replica set')){","\t\tdebug('setting up mongo replica set');","\t\tvar replicaData = this.get('mongo replica set');","\t\tvar replica = '';","","\t\tvar credentials = (replicaData.username && replicaData.password) ? replicaData.username + ':' + replicaData.password + '@' : '';","","\t\treplicaData.db.servers.forEach(function (server) {","\t\t\treplica += 'mongodb://' + credentials + server.host + ':' + server.port + '/' + replicaData.db.name + ',';","\t\t});","","\t\tvar options = {","\t\t\tauth: { authSource: replicaData.authSource },","\t\t\treplset: {","\t\t\t\trs_name: replicaData.db.replicaSetOptions.rs_name,","\t\t\t\treadPreference: replicaData.db.replicaSetOptions.readPreference","\t\t\t}","\t\t};","","\t\tdebug('connecting to replicate set');","\t\tthis.mongoose.connect(replica, options);","","\t} else {","\t\tdebug('connecting to mongo');","\t\tthis.mongoose.connect(this.get('mongo'));","","\t}","","\tthis.mongoose.connection.on('error', function(err) {","","\t\tif (keystone.get('logger')) {","\t\t\tconsole.log('------------------------------------------------');","\t\t\tconsole.log('Mongo Error:\\n');","\t\t\tconsole.log(err);","\t\t}","","\t\tif (mongoConnectionOpen) {","\t\t\tif (err.name === 'ValidationError') return;","\t\t\tthrow err;","\t\t} else {","\t\t\tthrow new Error('KeystoneJS (' + keystone.get('name') + ') failed to start');","\t\t}","","\t}).on('open', function() {","","\t\tdebug('mongo connection open');","\t\tmongoConnectionOpen = true;","","\t\tvar mounted = function() {","\t\t\tevents.onMount && events.onMount();// eslint-disable-line no-unused-expressions","\t\t\tsetHandlers();","\t\t};","","\t\tvar connected = function() {","\t\t\tif (keystone.get('auto update')) {","\t\t\t\tdebug('applying auto update');","\t\t\t\tkeystone.applyUpdates(mounted);","\t\t\t} else {","\t\t\t\tmounted();","\t\t\t}","\t\t};","","\t\tif (sessionStorePromise) {","\t\t\tsessionStorePromise.then(connected);","\t\t} else {","\t\t\tconnected();","\t\t}","","\t});","}","","module.exports = mount;",""],"l":{"49":1,"50":1,"51":1,"52":1,"53":1,"54":1,"55":1,"56":1,"57":1,"58":1,"59":1,"60":1,"61":1,"62":1,"64":1,"66":1,"67":0,"70":0,"71":0,"72":0,"77":0,"78":0,"83":0,"87":0,"88":0,"89":0,"90":0,"91":0,"96":0,"97":0,"98":0,"101":0,"103":0,"104":0,"107":0,"108":0,"111":0,"117":0,"119":0,"121":0,"123":0,"124":0,"125":0,"127":0,"131":0,"132":0,"133":0,"134":0,"137":0,"139":0,"140":0,"141":0,"143":0,"147":0,"150":0,"151":0,"154":0,"155":0,"160":0,"162":0,"165":0,"166":0,"169":0,"174":0,"175":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"189":0,"193":0,"194":0,"199":0,"201":0,"207":0,"208":0,"212":0,"213":0,"214":0,"217":0,"218":0,"221":0,"225":0,"227":0,"228":0,"229":0,"232":0,"238":0,"239":0,"243":0,"244":0,"247":0,"248":0,"252":0,"253":0,"257":0,"260":0,"261":0,"265":0,"266":0,"270":0,"271":0,"272":0,"274":0,"275":0,"280":0,"281":0,"286":0,"287":0,"293":0,"294":0,"296":0,"297":0,"300":0,"301":0,"302":0,"309":0,"312":0,"313":0,"316":0,"317":0,"318":0,"319":0,"320":0,"322":0,"323":0,"328":0,"330":0,"333":0,"334":0,"345":0,"346":0,"348":0,"349":0,"352":0,"353":0,"354":0,"359":0,"360":0,"361":0,"366":0,"367":0,"371":0,"372":0,"376":0,"377":0,"378":0,"380":0,"381":0,"385":0,"387":0,"388":0,"389":0,"392":0,"393":0,"394":0,"395":0,"396":0,"399":0,"400":0,"401":0,"403":0,"404":0,"407":0,"408":0,"411":0,"413":0,"414":0,"415":0,"416":0,"420":0,"421":0,"422":0,"426":0,"427":0,"428":0,"430":0,"434":0,"435":0,"436":0,"440":0,"442":0,"443":0,"447":0,"453":0,"454":0,"455":0,"457":0,"458":0,"463":0,"464":0,"465":0,"470":0,"471":0,"472":0,"476":0,"479":0,"480":0,"481":0,"482":0,"484":0,"490":0,"491":0,"494":0,"495":0,"496":0,"497":0,"498":0,"499":0,"500":0,"501":0,"503":0,"504":0,"506":0,"509":0,"510":0,"511":0,"512":0,"514":0,"517":0,"523":0,"525":0,"526":0,"527":0,"529":0,"531":0,"534":0,"536":0,"538":0,"539":0,"540":0,"542":0,"543":0,"544":0,"545":0,"546":0,"550":0,"553":0,"555":0,"557":0,"558":0,"559":0,"560":0,"561":0,"562":0,"563":0,"565":0,"566":0,"568":0,"571":0,"572":0,"573":0,"574":0,"576":0,"579":0,"587":0,"590":0,"591":0,"592":0,"593":0,"595":0,"597":0,"598":0,"601":0,"609":0,"610":0,"613":0,"614":0,"618":0,"620":0,"621":0,"622":0,"623":0,"626":0,"627":0,"628":0,"630":0,"635":0,"636":0,"638":0,"639":0,"640":0,"643":0,"644":0,"645":0,"646":0,"648":0,"652":0,"653":0,"655":0,"661":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/populateRelated.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/populateRelated.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"populateRelated","line":12,"loc":{"start":{"line":12,"column":0},"end":{"line":12,"column":56}}},"2":{"name":"(anonymous_2)","line":15,"loc":{"start":{"line":15,"column":19},"end":{"line":15,"column":39}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":29}},"2":{"start":{"line":12,"column":0},"end":{"line":24,"column":1}},"3":{"start":{"line":14,"column":1},"end":{"line":22,"column":2}},"4":{"start":{"line":15,"column":2},"end":{"line":17,"column":15}},"5":{"start":{"line":16,"column":3},"end":{"line":16,"column":44}},"6":{"start":{"line":18,"column":8},"end":{"line":22,"column":2}},"7":{"start":{"line":19,"column":2},"end":{"line":19,"column":48}},"8":{"start":{"line":21,"column":2},"end":{"line":21,"column":13}},"9":{"start":{"line":26,"column":0},"end":{"line":26,"column":33}}},"branchMap":{"1":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},{"start":{"line":14,"column":1},"end":{"line":14,"column":1}}]},"2":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":8},"end":{"line":18,"column":8}},{"start":{"line":18,"column":8},"end":{"line":18,"column":8}}]},"3":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":12},"end":{"line":18,"column":16}},{"start":{"line":18,"column":20},"end":{"line":18,"column":40}}]}},"code":["var async = require('async');","","/**"," * Populates relationships on a document or array of documents"," *"," * WARNING: This is currently highly inefficient and should only be used in development, or for"," * small data sets. There are lots of things that can be done to improve performance... later."," *"," * @api public"," */","","function populateRelated(docs, relationships, callback) {","\t","\tif (Array.isArray(docs)) {","\t\tasync.each(docs, function(doc, done) {","\t\t\tdoc.populateRelated(relationships, done);","\t\t}, callback);","\t} else if (docs && docs.populateRelated) {","\t\tdocs.populateRelated(relationships, callback);","\t} else {","\t\tcallback();","\t}","","}","","module.exports = populateRelated;",""],"l":{"1":1,"12":1,"14":0,"15":0,"16":0,"18":0,"19":0,"21":0,"26":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/redirect.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/redirect.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0]},"f":{"1":0},"fnMap":{"1":{"name":"redirect","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":20}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":55}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"4":{"start":{"line":19,"column":0},"end":{"line":29,"column":1}},"5":{"start":{"line":20,"column":1},"end":{"line":20,"column":28}},"6":{"start":{"line":21,"column":1},"end":{"line":25,"column":2}},"7":{"start":{"line":22,"column":2},"end":{"line":22,"column":42}},"8":{"start":{"line":23,"column":8},"end":{"line":25,"column":2}},"9":{"start":{"line":24,"column":2},"end":{"line":24,"column":47}},"10":{"start":{"line":27,"column":1},"end":{"line":27,"column":13}},"11":{"start":{"line":31,"column":0},"end":{"line":31,"column":26}}},"branchMap":{"1":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},{"start":{"line":21,"column":1},"end":{"line":21,"column":1}}]},"2":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":5},"end":{"line":21,"column":27}},{"start":{"line":21,"column":31},"end":{"line":21,"column":59}}]},"3":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":8}},{"start":{"line":23,"column":8},"end":{"line":23,"column":8}}]},"4":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":12},"end":{"line":23,"column":34}},{"start":{"line":23,"column":38},"end":{"line":23,"column":70}},{"start":{"line":23,"column":74},"end":{"line":23,"column":106}}]}},"code":["var _ = require('underscore');","var debug = require('debug')('keystone:core:redirect');","var utils = require('keystone-utils');","","/**"," * Adds one or more redirections (urls that are redirected when no matching"," * routes are found, before treating the request as a 404)"," *"," * #### Example:"," * \t\tkeystone.redirect('/old-route', 'new-route');"," *"," * \t\t// or"," *"," * \t\tkeystone.redirect({"," * \t\t\t'old-route': 'new-route'"," * \t\t});"," */","","function redirect() {","\tdebug('handling redirect');","\tif (arguments.length === 1 && utils.isObject(arguments[0])) {","\t\t_.extend(this._redirects, arguments[0]);","\t} else if (arguments.length === 2 && 'string' === typeof arguments[0] && 'string' === typeof arguments[1]) {","\t\tthis._redirects[arguments[0]] = arguments[1];","\t}","\t","\treturn this;","\t","}","","module.exports = redirect;",""],"l":{"1":1,"2":1,"3":1,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"27":0,"31":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/render.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/render.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"render","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":37}}},"2":{"name":"(anonymous_2)","line":36,"loc":{"start":{"line":36,"column":23},"end":{"line":36,"column":34}}},"3":{"name":"(anonymous_3)","line":65,"loc":{"start":{"line":65,"column":33},"end":{"line":65,"column":48}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":39}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":53}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":23}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":31}},"7":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}},"8":{"start":{"line":8,"column":0},"end":{"line":8,"column":38}},"9":{"start":{"line":16,"column":0},"end":{"line":16,"column":23}},"10":{"start":{"line":18,"column":0},"end":{"line":132,"column":1}},"11":{"start":{"line":20,"column":1},"end":{"line":20,"column":21}},"12":{"start":{"line":22,"column":1},"end":{"line":22,"column":75}},"13":{"start":{"line":24,"column":1},"end":{"line":24,"column":36}},"14":{"start":{"line":26,"column":1},"end":{"line":29,"column":3}},"15":{"start":{"line":36,"column":1},"end":{"line":39,"column":3}},"16":{"start":{"line":37,"column":2},"end":{"line":37,"column":21}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":74}},"18":{"start":{"line":41,"column":1},"end":{"line":43,"column":22}},"19":{"start":{"line":45,"column":1},"end":{"line":48,"column":2}},"20":{"start":{"line":46,"column":2},"end":{"line":46,"column":147}},"21":{"start":{"line":47,"column":2},"end":{"line":47,"column":18}},"22":{"start":{"line":49,"column":1},"end":{"line":55,"column":3}},"23":{"start":{"line":57,"column":1},"end":{"line":95,"column":3}},"24":{"start":{"line":65,"column":50},"end":{"line":65,"column":69}},"25":{"start":{"line":98,"column":1},"end":{"line":98,"column":23}},"26":{"start":{"line":101,"column":1},"end":{"line":123,"column":2}},"27":{"start":{"line":102,"column":2},"end":{"line":122,"column":3}},"28":{"start":{"line":103,"column":3},"end":{"line":103,"column":37}},"29":{"start":{"line":104,"column":3},"end":{"line":104,"column":62}},"30":{"start":{"line":105,"column":3},"end":{"line":113,"column":5}},"31":{"start":{"line":114,"column":3},"end":{"line":114,"column":67}},"32":{"start":{"line":116,"column":3},"end":{"line":121,"column":4}},"33":{"start":{"line":117,"column":4},"end":{"line":118,"column":96}},"34":{"start":{"line":120,"column":4},"end":{"line":120,"column":12}},"35":{"start":{"line":126,"column":1},"end":{"line":126,"column":107}},"36":{"start":{"line":128,"column":1},"end":{"line":128,"column":44}},"37":{"start":{"line":130,"column":1},"end":{"line":130,"column":28}},"38":{"start":{"line":131,"column":1},"end":{"line":131,"column":16}},"39":{"start":{"line":134,"column":0},"end":{"line":134,"column":24}}},"branchMap":{"1":{"line":41,"type":"cond-expr","locations":[{"start":{"line":42,"column":4},"end":{"line":42,"column":68}},{"start":{"line":43,"column":4},"end":{"line":43,"column":21}}]},"2":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":4},"end":{"line":42,"column":23}},{"start":{"line":42,"column":28},"end":{"line":42,"column":67}}]},"3":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},{"start":{"line":45,"column":1},"end":{"line":45,"column":1}}]},"4":{"line":65,"type":"cond-expr","locations":[{"start":{"line":65,"column":75},"end":{"line":65,"column":88}},{"start":{"line":65,"column":91},"end":{"line":65,"column":96}}]},"5":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":11},"end":{"line":73,"column":35}},{"start":{"line":73,"column":39},"end":{"line":73,"column":42}}]},"6":{"line":85,"type":"cond-expr","locations":[{"start":{"line":85,"column":50},"end":{"line":85,"column":54}},{"start":{"line":85,"column":57},"end":{"line":85,"column":62}}]},"7":{"line":86,"type":"cond-expr","locations":[{"start":{"line":86,"column":72},"end":{"line":86,"column":76}},{"start":{"line":86,"column":79},"end":{"line":86,"column":84}}]},"8":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":22},"end":{"line":87,"column":64}},{"start":{"line":87,"column":68},"end":{"line":87,"column":70}}]},"9":{"line":88,"type":"binary-expr","locations":[{"start":{"line":88,"column":22},"end":{"line":88,"column":64}},{"start":{"line":88,"column":68},"end":{"line":88,"column":70}}]},"10":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":22},"end":{"line":89,"column":64}},{"start":{"line":89,"column":68},"end":{"line":89,"column":70}}]},"11":{"line":91,"type":"binary-expr","locations":[{"start":{"line":91,"column":9},"end":{"line":91,"column":37}},{"start":{"line":91,"column":41},"end":{"line":91,"column":51}}]},"12":{"line":93,"type":"binary-expr","locations":[{"start":{"line":93,"column":14},"end":{"line":93,"column":47}},{"start":{"line":93,"column":51},"end":{"line":93,"column":53}}]},"13":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},{"start":{"line":101,"column":1},"end":{"line":101,"column":1}}]},"14":{"line":110,"type":"binary-expr","locations":[{"start":{"line":110,"column":12},"end":{"line":110,"column":45}},{"start":{"line":110,"column":49},"end":{"line":110,"column":51}}]},"15":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":3},"end":{"line":116,"column":3}},{"start":{"line":116,"column":3},"end":{"line":116,"column":3}}]}},"code":["var _ = require('underscore');","var cloudinary = require('cloudinary');","var debug = require('debug')('keystone:core:render');","var fs = require('fs');","var jade = require('jade');","var moment = require('moment');","var numeral = require('numeral');","var utils = require('keystone-utils');","","/**"," * Renders a Keystone View"," *"," * @api private"," */","","var templateCache = {};","","function render(req, res, view, ext) {","","\tvar keystone = this;","","\tvar templatePath = __dirname + '/../../templates/views/' + view + '.jade';","","\tdebug('rendering ' + templatePath);","","\tvar jadeOptions = {","\t\tfilename: templatePath,","\t\tpretty: keystone.get('env') !== 'production'","\t};","","\t// TODO: Allow custom basePath for extensions... like this or similar","\t// if (keystone.get('extensions')) {","\t// \tjadeOptions.basedir = keystone.getPath('extensions') + '/templates';","\t// }","","\tvar compileTemplate = function() {","\t\tdebug('compiling');","\t\treturn jade.compile(fs.readFileSync(templatePath, 'utf8'), jadeOptions);","\t};","","\tvar template = keystone.get('viewCache')","\t\t? templateCache[view] || (templateCache[view] = compileTemplate())","\t\t: compileTemplate();","","\tif (!res.req.flash) {","\t\tconsole.error('\\nKeystoneJS Runtime Error:\\n\\napp must have flash middleware installed. Try adding \"connect-flash\" to your express instance.\\n');","\t\tprocess.exit(1);","\t}","\tvar flashMessages = {","\t\tinfo: res.req.flash('info'),","\t\tsuccess: res.req.flash('success'),","\t\twarning: res.req.flash('warning'),","\t\terror: res.req.flash('error'),","\t\thilight: res.req.flash('hilight')","\t};","","\tvar locals = {","\t\t_: _,","\t\tmoment: moment,","\t\tnumeral: numeral,","\t\tenv: keystone.get('env'),","\t\tbrand: keystone.get('brand'),","\t\tappversion : keystone.get('appversion'),","\t\tnav: keystone.nav,","\t\tmessages: _.any(flashMessages, function(msgs) { return msgs.length; }) ? flashMessages : false,","\t\tlists: keystone.lists,","\t\tjs: 'javascript:;',// eslint-disable-line no-script-url","\t\tutils: utils,","\t\tUser: keystone.lists[keystone.get('user model')],","\t\tuser: req.user,","\t\ttitle: 'Keystone',","\t\tsignout: keystone.get('signout url'),","\t\tbackUrl: keystone.get('back url') || '/',","\t\tsection: {},","\t\tversion: keystone.version,","\t\tcsrf_header_key: keystone.security.csrf.CSRF_HEADER_KEY,","\t\tcsrf_token_key: keystone.security.csrf.TOKEN_KEY,","\t\tcsrf_token_value: keystone.security.csrf.getToken(req, res),","\t\tcsrf_query: '&' + keystone.security.csrf.TOKEN_KEY + '=' + keystone.security.csrf.getToken(req, res),","\t\tga: {","\t\t\tproperty: keystone.get('ga property'),","\t\t\tdomain: keystone.get('ga domain')","\t\t},","\t\twysiwygOptions: {","\t\t\tenableImages: keystone.get('wysiwyg images') ? true : false,","\t\t\tenableCloudinaryUploads: keystone.get('wysiwyg cloudinary images') ? true : false,","\t\t\tadditionalButtons: keystone.get('wysiwyg additional buttons') || '',","\t\t\tadditionalPlugins: keystone.get('wysiwyg additional plugins') || '',","\t\t\tadditionalOptions: keystone.get('wysiwyg additional options') || {},","\t\t\toverrideToolbar: keystone.get('wysiwyg override toolbar'),","\t\t\tskin: keystone.get('wysiwyg skin') || 'keystone',","\t\t\tmenubar: keystone.get('wysiwyg menubar'),","\t\t\timportcss: keystone.get('wysiwyg importcss') || ''","\t\t}","\t};","","\t// optional extensions to the local scope","\t_.extend(locals, ext);","","\t// add cloudinary locals if configured","\tif (keystone.get('cloudinary config')) {","\t\ttry {","\t\t\tdebug('adding cloudinary locals');","\t\t\tvar cloudinaryUpload = cloudinary.uploader.direct_upload();","\t\t\tlocals.cloudinary = {","\t\t\t\tcloud_name: keystone.get('cloudinary config').cloud_name,","\t\t\t\tapi_key: keystone.get('cloudinary config').api_key,","\t\t\t\ttimestamp: cloudinaryUpload.hidden_fields.timestamp,","\t\t\t\tsignature: cloudinaryUpload.hidden_fields.signature,","\t\t\t\tprefix: keystone.get('cloudinary prefix') || '',","\t\t\t\tfolders: keystone.get('cloudinary folders'),","\t\t\t\tuploader: cloudinary.uploader","\t\t\t};","\t\t\tlocals.cloudinary_js_config = cloudinary.cloudinary_js_config();","\t\t} catch(e) {","\t\t\tif (e === 'Must supply api_key') {","\t\t\t\tthrow new Error('Invalid Cloudinary Config Provided\\n\\n' +","\t\t\t\t\t'See http://keystonejs.com/docs/configuration/#services-cloudinary for more information.');","\t\t\t} else {","\t\t\t\tthrow e;","\t\t\t}","\t\t}","\t}","","\t// fieldLocals defines locals that are provided to each field's `render` method","\tlocals.fieldLocals = _.pick(locals, '_', 'moment', 'numeral', 'env', 'js', 'utils', 'user', 'cloudinary');","","\tvar html = template(_.extend(locals, ext));","","\tdebug('sending down html');","\tres.send(html);","}","","module.exports = render;",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"16":1,"18":1,"20":0,"22":0,"24":0,"26":0,"36":0,"37":0,"38":0,"41":0,"45":0,"46":0,"47":0,"49":0,"57":0,"65":0,"98":0,"101":0,"102":0,"103":0,"104":0,"105":0,"114":0,"116":0,"117":0,"120":0,"126":0,"128":0,"130":0,"131":0,"134":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/routes.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/routes.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"routes","line":15,"loc":{"start":{"line":15,"column":0},"end":{"line":15,"column":21}}},"2":{"name":"initList","line":53,"loc":{"start":{"line":53,"column":1},"end":{"line":53,"column":40}}},"3":{"name":"(anonymous_3)","line":54,"loc":{"start":{"line":54,"column":9},"end":{"line":54,"column":34}}},"4":{"name":"(anonymous_4)","line":86,"loc":{"start":{"line":86,"column":26},"end":{"line":86,"column":51}}},"5":{"name":"(anonymous_5)","line":87,"loc":{"start":{"line":87,"column":17},"end":{"line":87,"column":36}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":53}},"2":{"start":{"line":15,"column":0},"end":{"line":123,"column":1}},"3":{"start":{"line":16,"column":1},"end":{"line":16,"column":16}},"4":{"start":{"line":17,"column":1},"end":{"line":17,"column":21}},"5":{"start":{"line":20,"column":1},"end":{"line":23,"column":2}},"6":{"start":{"line":21,"column":2},"end":{"line":21,"column":26}},"7":{"start":{"line":22,"column":2},"end":{"line":22,"column":28}},"8":{"start":{"line":26,"column":1},"end":{"line":26,"column":58}},"9":{"start":{"line":30,"column":1},"end":{"line":30,"column":74}},"10":{"start":{"line":31,"column":1},"end":{"line":31,"column":85}},"11":{"start":{"line":32,"column":1},"end":{"line":32,"column":87}},"12":{"start":{"line":36,"column":1},"end":{"line":51,"column":2}},"13":{"start":{"line":37,"column":2},"end":{"line":39,"column":3}},"14":{"start":{"line":38,"column":3},"end":{"line":38,"column":48}},"15":{"start":{"line":40,"column":2},"end":{"line":42,"column":3}},"16":{"start":{"line":41,"column":3},"end":{"line":41,"column":46}},"17":{"start":{"line":43,"column":2},"end":{"line":45,"column":3}},"18":{"start":{"line":44,"column":3},"end":{"line":44,"column":47}},"19":{"start":{"line":46,"column":2},"end":{"line":46,"column":74}},"20":{"start":{"line":47,"column":2},"end":{"line":47,"column":76}},"21":{"start":{"line":48,"column":2},"end":{"line":48,"column":51}},"22":{"start":{"line":49,"column":8},"end":{"line":51,"column":2}},"23":{"start":{"line":50,"column":2},"end":{"line":50,"column":42}},"24":{"start":{"line":53,"column":1},"end":{"line":66,"column":2}},"25":{"start":{"line":54,"column":2},"end":{"line":65,"column":4}},"26":{"start":{"line":55,"column":3},"end":{"line":55,"column":45}},"27":{"start":{"line":57,"column":3},"end":{"line":61,"column":4}},"28":{"start":{"line":58,"column":4},"end":{"line":58,"column":51}},"29":{"start":{"line":59,"column":4},"end":{"line":59,"column":75}},"30":{"start":{"line":60,"column":4},"end":{"line":60,"column":37}},"31":{"start":{"line":63,"column":3},"end":{"line":63,"column":43}},"32":{"start":{"line":64,"column":3},"end":{"line":64,"column":10}},"33":{"start":{"line":68,"column":1},"end":{"line":68,"column":39}},"34":{"start":{"line":69,"column":1},"end":{"line":69,"column":64}},"35":{"start":{"line":72,"column":1},"end":{"line":75,"column":2}},"36":{"start":{"line":73,"column":2},"end":{"line":73,"column":37}},"37":{"start":{"line":74,"column":2},"end":{"line":74,"column":57}},"38":{"start":{"line":78,"column":1},"end":{"line":83,"column":2}},"39":{"start":{"line":79,"column":2},"end":{"line":79,"column":34}},"40":{"start":{"line":80,"column":2},"end":{"line":80,"column":85}},"41":{"start":{"line":81,"column":2},"end":{"line":81,"column":103}},"42":{"start":{"line":82,"column":2},"end":{"line":82,"column":92}},"43":{"start":{"line":86,"column":1},"end":{"line":107,"column":4}},"44":{"start":{"line":87,"column":2},"end":{"line":105,"column":4}},"45":{"start":{"line":88,"column":3},"end":{"line":88,"column":24}},"46":{"start":{"line":89,"column":3},"end":{"line":93,"column":4}},"47":{"start":{"line":90,"column":4},"end":{"line":90,"column":21}},"48":{"start":{"line":91,"column":4},"end":{"line":91,"column":15}},"49":{"start":{"line":92,"column":4},"end":{"line":92,"column":22}},"50":{"start":{"line":94,"column":3},"end":{"line":96,"column":4}},"51":{"start":{"line":95,"column":4},"end":{"line":95,"column":26}},"52":{"start":{"line":97,"column":3},"end":{"line":99,"column":4}},"53":{"start":{"line":98,"column":4},"end":{"line":98,"column":22}},"54":{"start":{"line":100,"column":3},"end":{"line":102,"column":4}},"55":{"start":{"line":101,"column":4},"end":{"line":101,"column":22}},"56":{"start":{"line":103,"column":3},"end":{"line":103,"column":26}},"57":{"start":{"line":104,"column":3},"end":{"line":104,"column":36}},"58":{"start":{"line":106,"column":2},"end":{"line":106,"column":9}},"59":{"start":{"line":110,"column":1},"end":{"line":110,"column":118}},"60":{"start":{"line":111,"column":1},"end":{"line":111,"column":92}},"61":{"start":{"line":112,"column":1},"end":{"line":112,"column":81}},"62":{"start":{"line":113,"column":1},"end":{"line":113,"column":85}},"63":{"start":{"line":114,"column":1},"end":{"line":114,"column":96}},"64":{"start":{"line":116,"column":1},"end":{"line":116,"column":86}},"65":{"start":{"line":119,"column":1},"end":{"line":119,"column":105}},"66":{"start":{"line":120,"column":1},"end":{"line":120,"column":92}},"67":{"start":{"line":122,"column":1},"end":{"line":122,"column":13}},"68":{"start":{"line":125,"column":0},"end":{"line":125,"column":24}}},"branchMap":{"1":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},{"start":{"line":20,"column":1},"end":{"line":20,"column":1}}]},"2":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},{"start":{"line":36,"column":1},"end":{"line":36,"column":1}}]},"3":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":2},"end":{"line":37,"column":2}},{"start":{"line":37,"column":2},"end":{"line":37,"column":2}}]},"4":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":2},"end":{"line":40,"column":2}},{"start":{"line":40,"column":2},"end":{"line":40,"column":2}}]},"5":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"6":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":6},"end":{"line":43,"column":21}},{"start":{"line":43,"column":25},"end":{"line":43,"column":45}}]},"7":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":8},"end":{"line":49,"column":8}},{"start":{"line":49,"column":8},"end":{"line":49,"column":8}}]},"8":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":3},"end":{"line":57,"column":3}},{"start":{"line":57,"column":3},"end":{"line":57,"column":3}}]},"9":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":7},"end":{"line":57,"column":16}},{"start":{"line":57,"column":21},"end":{"line":57,"column":40}},{"start":{"line":57,"column":44},"end":{"line":57,"column":66}}]},"10":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},{"start":{"line":72,"column":1},"end":{"line":72,"column":1}}]},"11":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},{"start":{"line":78,"column":1},"end":{"line":78,"column":1}}]},"12":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":3},"end":{"line":89,"column":3}},{"start":{"line":89,"column":3},"end":{"line":89,"column":3}}]},"13":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":3},"end":{"line":94,"column":3}},{"start":{"line":94,"column":3},"end":{"line":94,"column":3}}]},"14":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":3},"end":{"line":97,"column":3}},{"start":{"line":97,"column":3},"end":{"line":97,"column":3}}]},"15":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":3},"end":{"line":100,"column":3}},{"start":{"line":100,"column":3},"end":{"line":100,"column":3}}]},"16":{"line":100,"type":"binary-expr","locations":[{"start":{"line":100,"column":7},"end":{"line":100,"column":30}},{"start":{"line":100,"column":34},"end":{"line":100,"column":45}}]}},"code":["var debug = require('debug')('keystone:core:routes');","","/**"," * Adds bindings for the keystone routes"," *"," * ####Example:"," *"," *     var app = express();"," *     app.use(...); // middleware, routes, etc. should come before keystone is initialised"," *     keystone.routes(app);"," *"," * @param {Express()} app"," * @api public"," */","function routes(app) {","\tthis.app = app;","\tvar keystone = this;","","\t// ensure keystone nav has been initialised","\tif (!this.nav) {","\t\tdebug('setting up nav');","\t\tthis.nav = this.initNav();","\t}","","\t// Cache compiled view templates if we are in Production mode","\tthis.set('view cache', this.get('env') === 'production');","","\t// Session API","\t// TODO: this should respect keystone auth options","\tapp.get('/keystone/api/session', require('../../admin/api/session/get'));","\tapp.post('/keystone/api/session/signin', require('../../admin/api/session/signin'));","\tapp.post('/keystone/api/session/signout', require('../../admin/api/session/signout'));","","\t// Bind auth middleware (generic or custom) to /keystone* routes, allowing","\t// access to the generic signin page if generic auth is used","\tif (this.get('auth') === true) {","\t\tif (!this.get('signout url')) {","\t\t\tthis.set('signout url', '/keystone/signout');","\t\t}","\t\tif (!this.get('signin url')) {","\t\t\tthis.set('signin url', '/keystone/signin');","\t\t}","\t\tif (!this.nativeApp || !this.get('session')) {","\t\t\tapp.all('/keystone*', this.session.persist);","\t\t}","\t\tapp.all('/keystone/signin', require('../../admin/routes/views/signin'));","\t\tapp.all('/keystone/signout', require('../../admin/routes/views/signout'));","\t\tapp.all('/keystone*', this.session.keystoneAuth);","\t} else if ('function' === typeof this.get('auth')) {","\t\tapp.all('/keystone*', this.get('auth'));","\t}","","\tfunction initList(respectHiddenOption) {","\t\treturn function(req, res, next) {","\t\t\treq.list = keystone.list(req.params.list);","","\t\t\tif (!req.list || (respectHiddenOption && req.list.get('hidden'))) {","\t\t\t\tdebug('could not find list ', req.params.list);","\t\t\t\treq.flash('error', 'List ' + req.params.list + ' could not be found.');","\t\t\t\treturn res.redirect('/keystone');","\t\t\t}","","\t\t\tdebug('getting list ', req.params.list);","\t\t\tnext();","\t\t};","\t}","","\tdebug('setting keystone Admin Route');","\tapp.all('/keystone', require('../../admin/routes/views/home'));","","\t// Email test routes","\tif (this.get('email tests')) {","\t\tdebug('setting email test routes');","\t\tthis.bindEmailTestRoutes(app, this.get('email tests'));","\t}","","\t// Cloudinary API for selecting an existing image / upload a new image","\tif (keystone.get('cloudinary config')) {","\t\tdebug('setting cloudinary api');","\t\tapp.get('/keystone/api/cloudinary/get', require('../../admin/api/cloudinary').get);","\t\tapp.get('/keystone/api/cloudinary/autocomplete', require('../../admin/api/cloudinary').autocomplete);","\t\tapp.post('/keystone/api/cloudinary/upload', require('../../admin/api/cloudinary').upload);","\t}","","\t// Init API request helpers","\tapp.use('/keystone/api', function(req, res, next) {","\t\tres.apiError = function(key, err) {","\t\t\tvar statusCode = 500;","\t\t\tif (key === 404) {","\t\t\t\tstatusCode = 404;","\t\t\t\tkey = null;","\t\t\t\tkey = 'not found';","\t\t\t}","\t\t\tif (!key) {","\t\t\t\tkey = 'unknown error';","\t\t\t}","\t\t\tif (!err) {","\t\t\t\terr = 'API Error';","\t\t\t}","\t\t\tif (typeof err === 'object' && err.message) {","\t\t\t\terr = err.message;","\t\t\t}","\t\t\tres.status(statusCode);","\t\t\tres.json({ err: err, key: key });","\t\t};","\t\tnext();","\t});","","\t// Generic Lists API","\tapp.all('/keystone/api/:list/:action(autocomplete|order|create|fetch)', initList(), require('../../admin/api/list'));","\tapp.post('/keystone/api/:list/delete', initList(), require('../../admin/api/list/delete'));","\tapp.get('/keystone/api/:list', initList(), require('../../admin/api/list/get'));","\tapp.get('/keystone/api/:list/:id', initList(), require('../../admin/api/item/get'));","\tapp.post('/keystone/api/:list/:id/delete', initList(), require('../../admin/api/item/delete'));","","\tapp.all('/keystone/download/:list', initList(), require('../../admin/api/download'));","","\t// Admin-UI API","\tapp.all('/keystone/:list/:page([0-9]{1,5})?', initList(true), require('../../admin/routes/views/list'));","\tapp.all('/keystone/:list/:item', initList(true), require('../../admin/routes/views/item'));","","\treturn this;","}","","module.exports = routes;",""],"l":{"1":1,"15":1,"16":0,"17":0,"20":0,"21":0,"22":0,"26":0,"30":0,"31":0,"32":0,"36":0,"37":0,"38":0,"40":0,"41":0,"43":0,"44":0,"46":0,"47":0,"48":0,"49":0,"50":0,"53":1,"54":0,"55":0,"57":0,"58":0,"59":0,"60":0,"63":0,"64":0,"68":0,"69":0,"72":0,"73":0,"74":0,"78":0,"79":0,"80":0,"81":0,"82":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"94":0,"95":0,"97":0,"98":0,"100":0,"101":0,"103":0,"104":0,"106":0,"110":0,"111":0,"112":0,"113":0,"114":0,"116":0,"119":0,"120":0,"122":0,"125":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/start.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/start.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"start","line":52,"loc":{"start":{"line":52,"column":0},"end":{"line":52,"column":23}}},"2":{"name":"(anonymous_2)","line":81,"loc":{"start":{"line":81,"column":18},"end":{"line":81,"column":29}}},"3":{"name":"(anonymous_3)","line":90,"loc":{"start":{"line":90,"column":22},"end":{"line":90,"column":33}}},"4":{"name":"(anonymous_4)","line":111,"loc":{"start":{"line":111,"column":59},"end":{"line":111,"column":79}}},"5":{"name":"(anonymous_5)","line":133,"loc":{"start":{"line":133,"column":21},"end":{"line":133,"column":35}}},"6":{"name":"(anonymous_6)","line":134,"loc":{"start":{"line":134,"column":11},"end":{"line":134,"column":22}}},"7":{"name":"(anonymous_7)","line":177,"loc":{"start":{"line":177,"column":23},"end":{"line":177,"column":37}}},"8":{"name":"(anonymous_8)","line":178,"loc":{"start":{"line":178,"column":12},"end":{"line":178,"column":23}}},"9":{"name":"(anonymous_9)","line":207,"loc":{"start":{"line":207,"column":27},"end":{"line":207,"column":41}}},"10":{"name":"(anonymous_10)","line":208,"loc":{"start":{"line":208,"column":11},"end":{"line":208,"column":22}}},"11":{"name":"(anonymous_11)","line":216,"loc":{"start":{"line":216,"column":25},"end":{"line":216,"column":39}}},"12":{"name":"(anonymous_12)","line":219,"loc":{"start":{"line":219,"column":32},"end":{"line":219,"column":42}}},"13":{"name":"(anonymous_13)","line":228,"loc":{"start":{"line":228,"column":34},"end":{"line":228,"column":46}}}},"statementMap":{"1":{"start":{"line":46,"column":0},"end":{"line":46,"column":23}},"2":{"start":{"line":47,"column":0},"end":{"line":47,"column":52}},"3":{"start":{"line":48,"column":0},"end":{"line":48,"column":29}},"4":{"start":{"line":50,"column":0},"end":{"line":50,"column":68}},"5":{"start":{"line":52,"column":0},"end":{"line":252,"column":1}},"6":{"start":{"line":56,"column":1},"end":{"line":58,"column":2}},"7":{"start":{"line":57,"column":2},"end":{"line":57,"column":31}},"8":{"start":{"line":60,"column":1},"end":{"line":60,"column":26}},"9":{"start":{"line":60,"column":14},"end":{"line":60,"column":26}},"10":{"start":{"line":64,"column":1},"end":{"line":66,"column":2}},"11":{"start":{"line":65,"column":2},"end":{"line":65,"column":148}},"12":{"start":{"line":70,"column":1},"end":{"line":71,"column":17}},"13":{"start":{"line":74,"column":1},"end":{"line":74,"column":39}},"14":{"start":{"line":79,"column":1},"end":{"line":79,"column":30}},"15":{"start":{"line":81,"column":1},"end":{"line":245,"column":3}},"16":{"start":{"line":83,"column":2},"end":{"line":83,"column":23}},"17":{"start":{"line":85,"column":2},"end":{"line":86,"column":22}},"18":{"start":{"line":90,"column":2},"end":{"line":98,"column":4}},"19":{"start":{"line":91,"column":3},"end":{"line":91,"column":20}},"20":{"start":{"line":92,"column":3},"end":{"line":92,"column":30}},"21":{"start":{"line":92,"column":23},"end":{"line":92,"column":30}},"22":{"start":{"line":93,"column":3},"end":{"line":95,"column":4}},"23":{"start":{"line":94,"column":4},"end":{"line":94,"column":62}},"24":{"start":{"line":96,"column":3},"end":{"line":96,"column":28}},"25":{"start":{"line":97,"column":3},"end":{"line":97,"column":38}},"26":{"start":{"line":102,"column":2},"end":{"line":107,"column":16}},"27":{"start":{"line":109,"column":2},"end":{"line":116,"column":3}},"28":{"start":{"line":110,"column":3},"end":{"line":110,"column":20}},"29":{"start":{"line":111,"column":3},"end":{"line":115,"column":6}},"30":{"start":{"line":112,"column":4},"end":{"line":112,"column":27}},"31":{"start":{"line":112,"column":15},"end":{"line":112,"column":25}},"32":{"start":{"line":113,"column":4},"end":{"line":113,"column":30}},"33":{"start":{"line":114,"column":4},"end":{"line":114,"column":20}},"34":{"start":{"line":117,"column":2},"end":{"line":148,"column":3}},"35":{"start":{"line":118,"column":3},"end":{"line":118,"column":57}},"36":{"start":{"line":120,"column":3},"end":{"line":131,"column":4}},"37":{"start":{"line":121,"column":4},"end":{"line":121,"column":37}},"38":{"start":{"line":122,"column":4},"end":{"line":126,"column":5}},"39":{"start":{"line":123,"column":5},"end":{"line":123,"column":32}},"40":{"start":{"line":125,"column":5},"end":{"line":125,"column":29}},"41":{"start":{"line":127,"column":10},"end":{"line":131,"column":4}},"42":{"start":{"line":128,"column":4},"end":{"line":128,"column":35}},"43":{"start":{"line":130,"column":4},"end":{"line":130,"column":32}},"44":{"start":{"line":133,"column":3},"end":{"line":138,"column":5}},"45":{"start":{"line":134,"column":4},"end":{"line":137,"column":6}},"46":{"start":{"line":135,"column":5},"end":{"line":135,"column":31}},"47":{"start":{"line":136,"column":5},"end":{"line":136,"column":21}},"48":{"start":{"line":140,"column":3},"end":{"line":144,"column":4}},"49":{"start":{"line":141,"column":4},"end":{"line":141,"column":84}},"50":{"start":{"line":143,"column":4},"end":{"line":143,"column":78}},"51":{"start":{"line":145,"column":3},"end":{"line":145,"column":62}},"52":{"start":{"line":147,"column":3},"end":{"line":147,"column":20}},"53":{"start":{"line":150,"column":2},"end":{"line":203,"column":3}},"54":{"start":{"line":152,"column":3},"end":{"line":152,"column":33}},"55":{"start":{"line":153,"column":3},"end":{"line":153,"column":60}},"56":{"start":{"line":155,"column":3},"end":{"line":157,"column":4}},"57":{"start":{"line":156,"column":4},"end":{"line":156,"column":65}},"58":{"start":{"line":158,"column":3},"end":{"line":160,"column":4}},"59":{"start":{"line":159,"column":4},"end":{"line":159,"column":63}},"60":{"start":{"line":161,"column":3},"end":{"line":163,"column":4}},"61":{"start":{"line":162,"column":4},"end":{"line":162,"column":61}},"62":{"start":{"line":165,"column":3},"end":{"line":199,"column":4}},"63":{"start":{"line":167,"column":4},"end":{"line":173,"column":5}},"64":{"start":{"line":168,"column":5},"end":{"line":168,"column":87}},"65":{"start":{"line":169,"column":5},"end":{"line":169,"column":20}},"66":{"start":{"line":171,"column":5},"end":{"line":171,"column":64}},"67":{"start":{"line":172,"column":5},"end":{"line":172,"column":21}},"68":{"start":{"line":177,"column":4},"end":{"line":182,"column":6}},"69":{"start":{"line":178,"column":5},"end":{"line":181,"column":7}},"70":{"start":{"line":179,"column":6},"end":{"line":179,"column":32}},"71":{"start":{"line":180,"column":6},"end":{"line":180,"column":22}},"72":{"start":{"line":184,"column":4},"end":{"line":184,"column":60}},"73":{"start":{"line":185,"column":4},"end":{"line":185,"column":65}},"74":{"start":{"line":187,"column":4},"end":{"line":188,"column":48}},"75":{"start":{"line":190,"column":4},"end":{"line":190,"column":116}},"76":{"start":{"line":192,"column":4},"end":{"line":197,"column":5}},"77":{"start":{"line":193,"column":5},"end":{"line":193,"column":119}},"78":{"start":{"line":195,"column":5},"end":{"line":195,"column":111}},"79":{"start":{"line":196,"column":5},"end":{"line":196,"column":86}},"80":{"start":{"line":202,"column":3},"end":{"line":202,"column":20}},"81":{"start":{"line":205,"column":2},"end":{"line":226,"column":3}},"82":{"start":{"line":207,"column":3},"end":{"line":212,"column":5}},"83":{"start":{"line":208,"column":4},"end":{"line":211,"column":6}},"84":{"start":{"line":209,"column":5},"end":{"line":209,"column":31}},"85":{"start":{"line":210,"column":5},"end":{"line":210,"column":21}},"86":{"start":{"line":214,"column":3},"end":{"line":214,"column":70}},"87":{"start":{"line":216,"column":3},"end":{"line":222,"column":6}},"88":{"start":{"line":217,"column":4},"end":{"line":217,"column":82}},"89":{"start":{"line":218,"column":4},"end":{"line":218,"column":67}},"90":{"start":{"line":219,"column":4},"end":{"line":221,"column":7}},"91":{"start":{"line":225,"column":3},"end":{"line":225,"column":20}},"92":{"start":{"line":228,"column":2},"end":{"line":243,"column":5}},"93":{"start":{"line":229,"column":3},"end":{"line":242,"column":4}},"94":{"start":{"line":230,"column":4},"end":{"line":232,"column":83}},"95":{"start":{"line":233,"column":4},"end":{"line":233,"column":19}},"96":{"start":{"line":240,"column":4},"end":{"line":240,"column":30}},"97":{"start":{"line":241,"column":4},"end":{"line":241,"column":20}},"98":{"start":{"line":247,"column":1},"end":{"line":247,"column":32}},"99":{"start":{"line":248,"column":1},"end":{"line":248,"column":20}},"100":{"start":{"line":250,"column":1},"end":{"line":250,"column":13}},"101":{"start":{"line":254,"column":0},"end":{"line":254,"column":23}}},"branchMap":{"1":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},{"start":{"line":56,"column":1},"end":{"line":56,"column":1}}]},"2":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},{"start":{"line":60,"column":1},"end":{"line":60,"column":1}}]},"3":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},{"start":{"line":64,"column":1},"end":{"line":64,"column":1}}]},"4":{"line":83,"type":"binary-expr","locations":[{"start":{"line":83,"column":2},"end":{"line":83,"column":9}},{"start":{"line":83,"column":13},"end":{"line":83,"column":22}}]},"5":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":3},"end":{"line":92,"column":3}},{"start":{"line":92,"column":3},"end":{"line":92,"column":3}}]},"6":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":3},"end":{"line":93,"column":3}},{"start":{"line":93,"column":3},"end":{"line":93,"column":3}}]},"7":{"line":97,"type":"binary-expr","locations":[{"start":{"line":97,"column":3},"end":{"line":97,"column":17}},{"start":{"line":97,"column":21},"end":{"line":97,"column":37}}]},"8":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":2},"end":{"line":109,"column":2}},{"start":{"line":109,"column":2},"end":{"line":109,"column":2}}]},"9":{"line":109,"type":"binary-expr","locations":[{"start":{"line":109,"column":6},"end":{"line":109,"column":17}},{"start":{"line":109,"column":21},"end":{"line":109,"column":32}}]},"10":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":4},"end":{"line":112,"column":4}},{"start":{"line":112,"column":4},"end":{"line":112,"column":4}}]},"11":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":2},"end":{"line":117,"column":2}},{"start":{"line":117,"column":2},"end":{"line":117,"column":2}}]},"12":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":6},"end":{"line":117,"column":20}},{"start":{"line":117,"column":24},"end":{"line":117,"column":36}},{"start":{"line":117,"column":40},"end":{"line":117,"column":51}}]},"13":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":3},"end":{"line":120,"column":3}},{"start":{"line":120,"column":3},"end":{"line":120,"column":3}}]},"14":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":4},"end":{"line":122,"column":4}},{"start":{"line":122,"column":4},"end":{"line":122,"column":4}}]},"15":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":10},"end":{"line":127,"column":10}},{"start":{"line":127,"column":10},"end":{"line":127,"column":10}}]},"16":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":3},"end":{"line":140,"column":3}},{"start":{"line":140,"column":3},"end":{"line":140,"column":3}}]},"17":{"line":141,"type":"binary-expr","locations":[{"start":{"line":141,"column":37},"end":{"line":141,"column":41}},{"start":{"line":141,"column":45},"end":{"line":141,"column":49}}]},"18":{"line":143,"type":"binary-expr","locations":[{"start":{"line":143,"column":37},"end":{"line":143,"column":41}},{"start":{"line":143,"column":45},"end":{"line":143,"column":49}}]},"19":{"line":145,"type":"binary-expr","locations":[{"start":{"line":145,"column":3},"end":{"line":145,"column":29}},{"start":{"line":145,"column":33},"end":{"line":145,"column":61}}]},"20":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":2},"end":{"line":150,"column":2}},{"start":{"line":150,"column":2},"end":{"line":150,"column":2}}]},"21":{"line":150,"type":"binary-expr","locations":[{"start":{"line":150,"column":6},"end":{"line":150,"column":9}},{"start":{"line":150,"column":13},"end":{"line":150,"column":25}},{"start":{"line":150,"column":29},"end":{"line":150,"column":40}}]},"22":{"line":153,"type":"binary-expr","locations":[{"start":{"line":153,"column":17},"end":{"line":153,"column":53}},{"start":{"line":153,"column":57},"end":{"line":153,"column":59}}]},"23":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":3},"end":{"line":155,"column":3}},{"start":{"line":155,"column":3},"end":{"line":155,"column":3}}]},"24":{"line":155,"type":"binary-expr","locations":[{"start":{"line":155,"column":7},"end":{"line":155,"column":31}},{"start":{"line":155,"column":35},"end":{"line":155,"column":78}}]},"25":{"line":158,"type":"if","locations":[{"start":{"line":158,"column":3},"end":{"line":158,"column":3}},{"start":{"line":158,"column":3},"end":{"line":158,"column":3}}]},"26":{"line":158,"type":"binary-expr","locations":[{"start":{"line":158,"column":7},"end":{"line":158,"column":30}},{"start":{"line":158,"column":34},"end":{"line":158,"column":76}}]},"27":{"line":161,"type":"if","locations":[{"start":{"line":161,"column":3},"end":{"line":161,"column":3}},{"start":{"line":161,"column":3},"end":{"line":161,"column":3}}]},"28":{"line":161,"type":"binary-expr","locations":[{"start":{"line":161,"column":7},"end":{"line":161,"column":29}},{"start":{"line":161,"column":33},"end":{"line":161,"column":74}}]},"29":{"line":165,"type":"if","locations":[{"start":{"line":165,"column":3},"end":{"line":165,"column":3}},{"start":{"line":165,"column":3},"end":{"line":165,"column":3}}]},"30":{"line":165,"type":"binary-expr","locations":[{"start":{"line":165,"column":7},"end":{"line":165,"column":19}},{"start":{"line":165,"column":23},"end":{"line":165,"column":36}}]},"31":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":4},"end":{"line":167,"column":4}},{"start":{"line":167,"column":4},"end":{"line":167,"column":4}}]},"32":{"line":185,"type":"binary-expr","locations":[{"start":{"line":185,"column":4},"end":{"line":185,"column":31}},{"start":{"line":185,"column":35},"end":{"line":185,"column":64}}]},"33":{"line":187,"type":"binary-expr","locations":[{"start":{"line":187,"column":18},"end":{"line":187,"column":42}},{"start":{"line":187,"column":46},"end":{"line":187,"column":50}}]},"34":{"line":188,"type":"binary-expr","locations":[{"start":{"line":188,"column":15},"end":{"line":188,"column":39}},{"start":{"line":188,"column":43},"end":{"line":188,"column":47}}]},"35":{"line":190,"type":"cond-expr","locations":[{"start":{"line":190,"column":43},"end":{"line":190,"column":87}},{"start":{"line":190,"column":90},"end":{"line":190,"column":115}}]},"36":{"line":192,"type":"if","locations":[{"start":{"line":192,"column":4},"end":{"line":192,"column":4}},{"start":{"line":192,"column":4},"end":{"line":192,"column":4}}]},"37":{"line":195,"type":"cond-expr","locations":[{"start":{"line":195,"column":53},"end":{"line":195,"column":88}},{"start":{"line":195,"column":91},"end":{"line":195,"column":110}}]},"38":{"line":205,"type":"if","locations":[{"start":{"line":205,"column":2},"end":{"line":205,"column":2}},{"start":{"line":205,"column":2},"end":{"line":205,"column":2}}]},"39":{"line":218,"type":"binary-expr","locations":[{"start":{"line":218,"column":4},"end":{"line":218,"column":32}},{"start":{"line":218,"column":36},"end":{"line":218,"column":66}}]},"40":{"line":229,"type":"if","locations":[{"start":{"line":229,"column":3},"end":{"line":229,"column":3}},{"start":{"line":229,"column":3},"end":{"line":229,"column":3}}]},"41":{"line":240,"type":"binary-expr","locations":[{"start":{"line":240,"column":16},"end":{"line":240,"column":23}},{"start":{"line":240,"column":27},"end":{"line":240,"column":28}}]}},"code":["/**"," * Configures and starts a Keystone app in encapsulated mode."," *"," * Connects to the database, runs updates and listens for incoming requests."," *"," * Events are fired during initialisation to allow customisation, including:"," *"," *   - onMount"," *   - onStart"," *   - onHttpServerCreated"," *   - onHttpsServerCreated"," *"," * If the events argument is a function, it is assumed to be the started event."," *"," *"," * ####Options:"," *"," * Keystone supports the following options specifically for running in encapsulated mode:"," *"," *   - name"," *   - port"," *   - views"," *   - view engine"," *   - compress"," *   - favico"," *   - less"," *   - static"," *   - headless"," *   - logger"," *   - cookie secret"," *   - session"," *   - 404"," *   - 500"," *   - routes"," *   - locals"," *   - auto update"," *   - ssl"," *   - sslport"," *   - sslkey"," *   - sslcert"," *"," *"," * @api public"," */","","var fs = require('fs');","var debug = require('debug')('keystone:core:start');","var https = require('https');","","var dashes = '\\n------------------------------------------------\\n';","","function start(events) {","\t","\t// Validate arguments","\t","\tif ('function' === typeof events) {","\t\tevents = { onStart: events };","\t}","\t","\tif (!events) events = {};","\t","\t// Ensure Keystone has been initialised","\t","\tif (!this.app) {","\t\tthrow new Error('KeystoneJS Initialisaton Error:\\n\\napp must be initialised. Call keystone.init() or keystone.connect(new Express()) first.\\n\\n');","\t}","\t","\t// Localise references to this for closures","\t","\tvar keystone = this,","\t\tapp = this.app;","","\t// Prebuild the Admin Resources","\tthis.adminApp.staticRouter.prebuild();","","\t// Maintain passed in onMount binding but override to start http servers","\t// (call user-defined onMount first if present)","\t","\tvar onMount = events.onMount;","\t","\tevents.onMount = function() {","\t\t","\t\tonMount && onMount();// eslint-disable-line no-unused-expressions","\t\t","\t\tvar startupMessages = ['KeystoneJS Started:'],","\t\t\twaitForServers = 3;","\t\t\t","\t\t// Log the startup messages and calls the onStart method","\t\t","\t\tvar serverStarted = function() {","\t\t\twaitForServers--;","\t\t\tif (waitForServers) return;","\t\t\tif (keystone.get('logger')) {","\t\t\t\tconsole.log(dashes + startupMessages.join('\\n') + dashes);","\t\t\t}","\t\t\tdebug('server starting');","\t\t\tevents.onStart && events.onStart();// eslint-disable-line no-unused-expressions","\t\t};","\t\t","\t\t// Create the http server and listens to the specified port with default port specified","\t\t","\t\tvar host = keystone.get('host'),","\t\t\tport = keystone.get('port'),","\t\t\tssl = keystone.get('ssl'),","\t\t\tunixSocket = keystone.get('unix socket'),","\t\t\tletsencrypt = keystone.get('letsencrypt'),","\t\t\thttpReadyMsg;","\t\t","\t\tif (letsencrypt && !unixSocket) {","\t\t\twaitForServers++;","\t\t\trequire('../../server/startLetsEncrypt')(keystone, app, function (err, msg) {","\t\t\t\tif (err) { throw err; }","\t\t\t\tstartupMessages.push(msg);","\t\t\t\tserverStarted();","\t\t\t});","\t\t}","\t\tif (ssl !== 'only' && !letsencrypt && !unixSocket) {","\t\t\thttpReadyMsg = keystone.get('name') + ' is ready on ';","\t\t\t","\t\t\tif (host) {","\t\t\t\thttpReadyMsg += 'http://' + host;","\t\t\t\tif (port) {","\t\t\t\t\thttpReadyMsg += ':' + port;","\t\t\t\t} else {","\t\t\t\t\thttpReadyMsg += ':3000';","\t\t\t\t}","\t\t\t} else if (port){","\t\t\t\thttpReadyMsg += 'port ' + port;","\t\t\t} else {","\t\t\t\thttpReadyMsg += 'port 3000';","\t\t\t}","\t\t\t","\t\t\tvar httpStarted = function(msg) {","\t\t\t\treturn function() {","\t\t\t\t\tstartupMessages.push(msg);","\t\t\t\t\tserverStarted();","\t\t\t\t};","\t\t\t};","\t\t\t","\t\t\tif (host) {","\t\t\t\tkeystone.httpServer = app.listen(port || 3000, host, httpStarted(httpReadyMsg));","\t\t\t} else {","\t\t\t\tkeystone.httpServer = app.listen(port || 3000, httpStarted(httpReadyMsg));","\t\t\t}","\t\t\tevents.onHttpServerCreated && events.onHttpServerCreated();// eslint-disable-line no-unused-expressions","\t\t} else {","\t\t\twaitForServers--;","\t\t}","\t\t","\t\tif (ssl && !letsencrypt && !unixSocket) {","\t\t\t","\t\t\tdebug('start the ssl server');","\t\t\tvar sslOpts = keystone.get('https server options') || {};","\t\t\t","\t\t\tif (keystone.get('ssl cert') && fs.existsSync(keystone.getPath('ssl cert'))) {","\t\t\t\tsslOpts.cert = fs.readFileSync(keystone.getPath('ssl cert'));","\t\t\t}","\t\t\tif (keystone.get('ssl key') && fs.existsSync(keystone.getPath('ssl key'))) {","\t\t\t\tsslOpts.key = fs.readFileSync(keystone.getPath('ssl key'));","\t\t\t}","\t\t\tif (keystone.get('ssl ca') && fs.existsSync(keystone.getPath('ssl ca'))) {","\t\t\t\tsslOpts.ca = fs.readFileSync(keystone.getPath('ssl ca'));","\t\t\t}","\t\t\t","\t\t\tif (!sslOpts.key || !sslOpts.cert) {","\t\t\t\t","\t\t\t\tif (ssl === 'only') {","\t\t\t\t\tconsole.log(keystone.get('name') + ' failed to start: invalid ssl configuration');","\t\t\t\t\tprocess.exit();","\t\t\t\t} else {","\t\t\t\t\tstartupMessages.push('Warning: Invalid SSL Configuration');","\t\t\t\t\tserverStarted();","\t\t\t\t}","\t\t\t\t","\t\t\t} else {","\t\t\t\t","\t\t\t\tvar httpsStarted = function(msg) {","\t\t\t\t\treturn function() {","\t\t\t\t\t\tstartupMessages.push(msg);","\t\t\t\t\t\tserverStarted();","\t\t\t\t\t};","\t\t\t\t};","\t\t\t\t","\t\t\t\tkeystone.httpsServer = https.createServer(sslOpts, app);","\t\t\t\tevents.onHttpsServerCreated && events.onHttpsServerCreated();// eslint-disable-line no-unused-expressions","\t\t\t\t","\t\t\t\tvar sslHost = keystone.get('ssl host') || host,","\t\t\t\t\tsslPort = keystone.get('ssl port') || 3001;","\t\t\t\t","\t\t\t\tvar httpsReadyMsg = (ssl === 'only') ? keystone.get('name') + ' (SSL) is ready on ' : 'SSL Server is ready on ';","\t\t\t\t","\t\t\t\tif (sslHost) {","\t\t\t\t\tkeystone.httpsServer.listen(sslPort, sslHost, httpsStarted(httpsReadyMsg + 'https://' + sslHost + ':' + sslPort));","\t\t\t\t} else {","\t\t\t\t\tvar httpsPortMsg = (keystone.get('ssl port')) ? 'port: ' + keystone.get('ssl port') : 'default port 3001';","\t\t\t\t\tkeystone.httpsServer.listen(sslPort, httpsStarted(httpsReadyMsg + httpsPortMsg));","\t\t\t\t}","\t\t\t\t","\t\t\t}","\t\t\t","\t\t} else {","\t\t\twaitForServers--;","\t\t}","\t\t","\t\tif(unixSocket) {","\t\t\t","\t\t\tvar unixSocketStarted = function(msg) {","\t\t\t\treturn function() {","\t\t\t\t\tstartupMessages.push(msg);","\t\t\t\t\tserverStarted();","\t\t\t\t};","\t\t\t};","\t\t\t","\t\t\thttpReadyMsg = keystone.get('name') + ' is ready on ' + unixSocket;","\t\t\t","\t\t\tfs.unlink(unixSocket, function(err) {// eslint-disable-line no-unused-vars, handle-callback-err","\t\t\t\tkeystone.httpServer = app.listen(unixSocket, unixSocketStarted(httpReadyMsg));","\t\t\t\tevents.onSocketServerCreated && events.onSocketServerCreated();// eslint-disable-line no-unused-expressions","\t\t\t\tfs.chmod(unixSocket, 0x777, function(){","\t\t\t\t\t// set permissions","\t\t\t\t});","\t\t\t});","\t\t\t","\t\t} else {","\t\t\twaitForServers--;","\t\t}","\t\t","\t\tprocess.on('uncaughtException', function(e) {","\t\t\tif (e.code === 'EADDRINUSE') {","\t\t\t\tconsole.log(dashes +","\t\t\t\t\tkeystone.get('name') + ' failed to start: address already in use\\n' +","\t\t\t\t\t'Please check you are not already running a server on the specified port.\\n');","\t\t\t\tprocess.exit();","\t\t\t}/* else if (e.code === 'ECONNRESET') {","\t\t\t\t// Connection reset by peer, ignore it instead of exiting server with a throw.","\t\t\t\t// Disabled for release 0.2.16 while further research is being done.","\t\t\t\tconsole.log('Connection reset by peer');","\t\t\t\tconsole.log(e);","\t\t\t} */else {","\t\t\t\tconsole.log(e.stack || e);","\t\t\t\tprocess.exit(1);","\t\t\t}","\t\t});","\t\t","\t};","\t","\tdebug('mount the express app');","\tthis.mount(events);","\t","\treturn this;","\t","}","","module.exports = start;",""],"l":{"46":1,"47":1,"48":1,"50":1,"52":1,"56":0,"57":0,"60":0,"64":0,"65":0,"70":0,"74":0,"79":0,"81":0,"83":0,"85":0,"90":0,"91":0,"92":0,"93":0,"94":0,"96":0,"97":0,"102":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"117":0,"118":0,"120":0,"121":0,"122":0,"123":0,"125":0,"127":0,"128":0,"130":0,"133":0,"134":0,"135":0,"136":0,"140":0,"141":0,"143":0,"145":0,"147":0,"150":0,"152":0,"153":0,"155":0,"156":0,"158":0,"159":0,"161":0,"162":0,"165":0,"167":0,"168":0,"169":0,"171":0,"172":0,"177":0,"178":0,"179":0,"180":0,"184":0,"185":0,"187":0,"190":0,"192":0,"193":0,"195":0,"196":0,"202":0,"205":0,"207":0,"208":0,"209":0,"210":0,"214":0,"216":0,"217":0,"218":0,"219":0,"225":0,"228":0,"229":0,"230":0,"233":0,"240":0,"241":0,"247":0,"248":0,"250":0,"254":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/wrapHTMLError.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/core/wrapHTMLError.js","s":{"1":1,"2":0,"3":1},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"wrapHTMLError","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":35}}}},"statementMap":{"1":{"start":{"line":7,"column":0},"end":{"line":12,"column":1}},"2":{"start":{"line":8,"column":1},"end":{"line":11,"column":76}},"3":{"start":{"line":14,"column":0},"end":{"line":14,"column":31}}},"branchMap":{"1":{"line":11,"type":"binary-expr","locations":[{"start":{"line":11,"column":34},"end":{"line":11,"column":37}},{"start":{"line":11,"column":41},"end":{"line":11,"column":43}}]}},"code":["/**"," * Wraps an error in simple HTML to be sent as a response to the browser"," *"," * @api public"," */","","function wrapHTMLError(title, err) {","\treturn '<html><head><meta charset=\\'utf-8\\'><title>Error</title>' +","\t'<link rel=\\'stylesheet\\' href=\\'/keystone/styles/error.css\\'>' +","\t'</head><body><div class=\\'error\\'><h1 class=\\'error-title\\'>' + title + '</h1>' +","\t'<div class=\"error-message\">' + (err || '') + '</div></div></body></html>';","}","","module.exports = wrapHTMLError;",""],"l":{"7":1,"8":0,"14":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/app/static.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/app/static.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":24,"loc":{"start":{"line":24,"column":18},"end":{"line":24,"column":29}}}},"statementMap":{"1":{"start":{"line":9,"column":0},"end":{"line":9,"column":41}},"2":{"start":{"line":10,"column":0},"end":{"line":10,"column":33}},"3":{"start":{"line":11,"column":0},"end":{"line":11,"column":38}},"4":{"start":{"line":12,"column":0},"end":{"line":12,"column":27}},"5":{"start":{"line":13,"column":0},"end":{"line":13,"column":30}},"6":{"start":{"line":17,"column":0},"end":{"line":22,"column":2}},"7":{"start":{"line":24,"column":0},"end":{"line":29,"column":2}},"8":{"start":{"line":25,"column":1},"end":{"line":25,"column":24}},"9":{"start":{"line":26,"column":1},"end":{"line":26,"column":22}},"10":{"start":{"line":27,"column":1},"end":{"line":27,"column":22}},"11":{"start":{"line":28,"column":1},"end":{"line":28,"column":22}},"12":{"start":{"line":33,"column":0},"end":{"line":33,"column":85}},"13":{"start":{"line":35,"column":0},"end":{"line":41,"column":2}},"14":{"start":{"line":45,"column":0},"end":{"line":45,"column":83}},"15":{"start":{"line":46,"column":0},"end":{"line":46,"column":62}},"16":{"start":{"line":47,"column":0},"end":{"line":47,"column":50}},"17":{"start":{"line":48,"column":0},"end":{"line":48,"column":46}},"18":{"start":{"line":49,"column":0},"end":{"line":49,"column":46}},"19":{"start":{"line":50,"column":0},"end":{"line":50,"column":46}},"20":{"start":{"line":52,"column":0},"end":{"line":52,"column":24}}},"branchMap":{},"code":["/**"," * Returns an Express Router with bindings for the Admin UI static resources,"," * i.e files, less and browserified scripts."," *"," * Should be included before other middleware (e.g. session management,"," * logging, etc) for reduced overhead."," */","","var browserify = require('./browserify');","var express = require('express');","var less = require('less-middleware');","var path = require('path');","var router = express.Router();","","/* Prepare browserify bundles */","","var bundles = {","\tfields: browserify('fields.js', 'FieldTypes'),","\thome: browserify('views/home.js'),","\titem: browserify('views/item.js'),","\tlist: browserify('views/list.js')","};","","router.prebuild = function() {","\tbundles.fields.build();","\tbundles.home.build();","\tbundles.item.build();","\tbundles.list.build();","};","","/* Prepare LESS options */","","var reactSelectPath = path.join(path.dirname(require.resolve('react-select')), '..');","","var lessOptions = {","\trender: {","\t\tmodifyVars: {","\t\t\treactSelectPath: JSON.stringify(reactSelectPath)","\t\t}","\t}","};","","/* Configure router */","","router.use('/styles', less(path.join(__dirname, '../public/styles'), lessOptions));","router.use(express.static(path.join(__dirname, '../public')));","router.get('/js/fields.js', bundles.fields.serve);","router.get('/js/home.js', bundles.home.serve);","router.get('/js/item.js', bundles.item.serve);","router.get('/js/list.js', bundles.list.serve);","","module.exports = router;",""],"l":{"9":1,"10":1,"11":1,"12":1,"13":1,"17":1,"24":1,"25":0,"26":0,"27":0,"28":0,"33":1,"35":1,"45":1,"46":1,"47":1,"48":1,"49":1,"50":1,"52":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/app/browserify.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/app/browserify.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":0,"13":1,"14":0,"15":1,"16":0,"17":1,"18":0,"19":1,"20":4,"21":4,"22":4,"23":4,"24":4,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":1,"58":0,"59":0,"60":0,"61":0,"62":0,"63":1,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":4},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":4,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"ts","line":13,"loc":{"start":{"line":13,"column":0},"end":{"line":13,"column":14}}},"2":{"name":"logInit","line":17,"loc":{"start":{"line":17,"column":0},"end":{"line":17,"column":23}}},"3":{"name":"logRebuild","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":26}}},"4":{"name":"logError","line":25,"loc":{"start":{"line":25,"column":0},"end":{"line":25,"column":29}}},"5":{"name":"(anonymous_5)","line":29,"loc":{"start":{"line":29,"column":17},"end":{"line":29,"column":38}}},"6":{"name":"build","line":35,"loc":{"start":{"line":35,"column":1},"end":{"line":35,"column":18}}},"7":{"name":"(anonymous_7)","line":54,"loc":{"start":{"line":54,"column":19},"end":{"line":54,"column":31}}},"8":{"name":"(anonymous_8)","line":60,"loc":{"start":{"line":60,"column":11},"end":{"line":60,"column":31}}},"9":{"name":"(anonymous_9)","line":64,"loc":{"start":{"line":64,"column":17},"end":{"line":64,"column":34}}},"10":{"name":"(anonymous_10)","line":68,"loc":{"start":{"line":68,"column":17},"end":{"line":68,"column":28}}},"11":{"name":"(anonymous_11)","line":69,"loc":{"start":{"line":69,"column":12},"end":{"line":69,"column":32}}},"12":{"name":"serve","line":76,"loc":{"start":{"line":76,"column":1},"end":{"line":76,"column":26}}},"13":{"name":"send","line":84,"loc":{"start":{"line":84,"column":1},"end":{"line":84,"column":25}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":39}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":31}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":38}},"7":{"start":{"line":7,"column":0},"end":{"line":7,"column":27}},"8":{"start":{"line":8,"column":0},"end":{"line":8,"column":35}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":51}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":50}},"11":{"start":{"line":13,"column":0},"end":{"line":15,"column":1}},"12":{"start":{"line":14,"column":1},"end":{"line":14,"column":60}},"13":{"start":{"line":17,"column":0},"end":{"line":19,"column":1}},"14":{"start":{"line":18,"column":1},"end":{"line":18,"column":112}},"15":{"start":{"line":21,"column":0},"end":{"line":23,"column":1}},"16":{"start":{"line":22,"column":1},"end":{"line":22,"column":69}},"17":{"start":{"line":25,"column":0},"end":{"line":27,"column":1}},"18":{"start":{"line":26,"column":1},"end":{"line":26,"column":101}},"19":{"start":{"line":29,"column":0},"end":{"line":101,"column":2}},"20":{"start":{"line":30,"column":1},"end":{"line":30,"column":7}},"21":{"start":{"line":31,"column":1},"end":{"line":31,"column":22}},"22":{"start":{"line":32,"column":1},"end":{"line":32,"column":16}},"23":{"start":{"line":33,"column":1},"end":{"line":33,"column":11}},"24":{"start":{"line":34,"column":1},"end":{"line":34,"column":9}},"25":{"start":{"line":35,"column":1},"end":{"line":75,"column":2}},"26":{"start":{"line":36,"column":2},"end":{"line":36,"column":23}},"27":{"start":{"line":36,"column":16},"end":{"line":36,"column":23}},"28":{"start":{"line":37,"column":2},"end":{"line":37,"column":18}},"29":{"start":{"line":38,"column":2},"end":{"line":38,"column":34}},"30":{"start":{"line":39,"column":2},"end":{"line":43,"column":3}},"31":{"start":{"line":40,"column":3},"end":{"line":40,"column":17}},"32":{"start":{"line":41,"column":3},"end":{"line":41,"column":19}},"33":{"start":{"line":42,"column":3},"end":{"line":42,"column":26}},"34":{"start":{"line":44,"column":2},"end":{"line":49,"column":3}},"35":{"start":{"line":45,"column":3},"end":{"line":45,"column":24}},"36":{"start":{"line":46,"column":3},"end":{"line":46,"column":44}},"37":{"start":{"line":48,"column":3},"end":{"line":48,"column":37}},"38":{"start":{"line":50,"column":2},"end":{"line":52,"column":6}},"39":{"start":{"line":53,"column":2},"end":{"line":53,"column":26}},"40":{"start":{"line":54,"column":2},"end":{"line":56,"column":5}},"41":{"start":{"line":55,"column":3},"end":{"line":55,"column":16}},"42":{"start":{"line":57,"column":2},"end":{"line":59,"column":3}},"43":{"start":{"line":58,"column":3},"end":{"line":58,"column":19}},"44":{"start":{"line":60,"column":2},"end":{"line":67,"column":5}},"45":{"start":{"line":61,"column":3},"end":{"line":61,"column":39}},"46":{"start":{"line":61,"column":12},"end":{"line":61,"column":39}},"47":{"start":{"line":62,"column":3},"end":{"line":62,"column":14}},"48":{"start":{"line":63,"column":3},"end":{"line":63,"column":16}},"49":{"start":{"line":64,"column":3},"end":{"line":66,"column":6}},"50":{"start":{"line":65,"column":4},"end":{"line":65,"column":29}},"51":{"start":{"line":68,"column":2},"end":{"line":74,"column":5}},"52":{"start":{"line":69,"column":3},"end":{"line":73,"column":6}},"53":{"start":{"line":70,"column":4},"end":{"line":71,"column":26}},"54":{"start":{"line":70,"column":13},"end":{"line":70,"column":40}},"55":{"start":{"line":71,"column":9},"end":{"line":71,"column":26}},"56":{"start":{"line":72,"column":4},"end":{"line":72,"column":15}},"57":{"start":{"line":76,"column":1},"end":{"line":83,"column":2}},"58":{"start":{"line":77,"column":2},"end":{"line":81,"column":3}},"59":{"start":{"line":78,"column":3},"end":{"line":78,"column":11}},"60":{"start":{"line":79,"column":3},"end":{"line":79,"column":26}},"61":{"start":{"line":80,"column":3},"end":{"line":80,"column":10}},"62":{"start":{"line":82,"column":2},"end":{"line":82,"column":17}},"63":{"start":{"line":84,"column":1},"end":{"line":96,"column":2}},"64":{"start":{"line":85,"column":2},"end":{"line":85,"column":58}},"65":{"start":{"line":86,"column":2},"end":{"line":86,"column":76}},"66":{"start":{"line":87,"column":2},"end":{"line":95,"column":3}},"67":{"start":{"line":88,"column":3},"end":{"line":88,"column":19}},"68":{"start":{"line":89,"column":3},"end":{"line":89,"column":13}},"69":{"start":{"line":92,"column":3},"end":{"line":92,"column":31}},"70":{"start":{"line":93,"column":3},"end":{"line":93,"column":44}},"71":{"start":{"line":94,"column":3},"end":{"line":94,"column":17}},"72":{"start":{"line":97,"column":1},"end":{"line":100,"column":3}}},"branchMap":{"1":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"2":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":2},"end":{"line":39,"column":2}},{"start":{"line":39,"column":2},"end":{"line":39,"column":2}}]},"3":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":2},"end":{"line":44,"column":2}},{"start":{"line":44,"column":2},"end":{"line":44,"column":2}}]},"4":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":2},"end":{"line":57,"column":2}},{"start":{"line":57,"column":2},"end":{"line":57,"column":2}}]},"5":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":3},"end":{"line":61,"column":3}},{"start":{"line":61,"column":3},"end":{"line":61,"column":3}}]},"6":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":4},"end":{"line":70,"column":4}},{"start":{"line":70,"column":4},"end":{"line":70,"column":4}}]},"7":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":2},"end":{"line":77,"column":2}},{"start":{"line":77,"column":2},"end":{"line":77,"column":2}}]},"8":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":2},"end":{"line":87,"column":2}},{"start":{"line":87,"column":2},"end":{"line":87,"column":2}}]},"9":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":6},"end":{"line":87,"column":13}},{"start":{"line":87,"column":18},"end":{"line":87,"column":51}}]}},"code":["var babelify = require('babelify');","var browserify = require('browserify');","var chalk = require('chalk');","var crypto = require('crypto');","var moment = require('moment');","var packages = require('../packages');","var path = require('path');","var watchify = require('watchify');","","var basedir = path.resolve(__dirname + '/../src/');","var devMode = process.env.KEYSTONE_DEV === 'true';","","function ts() {","\treturn chalk.gray(moment().format('YYYY-MM-DD HH:MM:SS '));","}","","function logInit(file) {","\tconsole.log(chalk.grey('Watching ' + chalk.black.underline('keystone/admin/src/' + file) + ' for changes...'));","}","","function logRebuild(file) {","\tconsole.log(ts() + chalk.green('rebuilt ' + chalk.underline(file)));","}","","function logError(file, err) {","\tconsole.log(ts() + chalk.red('error building ' + chalk.underline(file) + ':') + '\\n' + err.message);","}","","module.exports = function(file, name) {","\tvar b;","\tvar building = false;","\tvar queue = [];","\tvar ready;","\tvar src;","\tfunction build() {","\t\tif (building) return;","\t\tbuilding = true;","\t\tvar opts = { basedir: basedir };","\t\tif (devMode) {","\t\t\tlogInit(file);","\t\t\topts.cache = {};","\t\t\topts.packageCache = {};","\t\t}","\t\tif (name) {","\t\t\tb = browserify(opts);","\t\t\tb.require('./' + file, { expose: name });","\t\t} else {","\t\t\tb = browserify('./' + file, opts);","\t\t}","\t\tb.transform(babelify.configure({","\t\t\tignore: ['**/lib/**']","\t\t}));","\t\tb.exclude('FieldTypes');","\t\tpackages.forEach(function(i) {","\t\t\tb.exclude(i);","\t\t});","\t\tif (devMode) {","\t\t\tb = watchify(b);","\t\t}","\t\tb.bundle(function(err, buff) {","\t\t\tif (err) return logError(file, err);","\t\t\tsrc = buff;","\t\t\tready = true;","\t\t\tqueue.forEach(function(reqres) {","\t\t\t\tsend.apply(null, reqres);","\t\t\t});","\t\t});","\t\tb.on('update', function() {","\t\t\tb.bundle(function(err, buff) {","\t\t\t\tif (err) return logError(file, err);","\t\t\t\telse logRebuild(file);","\t\t\t\tsrc = buff;","\t\t\t});","\t\t});","\t}","\tfunction serve(req, res) {","\t\tif (!ready) {","\t\t\tbuild();","\t\t\tqueue.push([req, res]);","\t\t\treturn;","\t\t}","\t\tsend(req, res);","\t}","\tfunction send(req, res) {","\t\tres.setHeader('Content-Type', 'application/javascript');","\t\tvar etag = crypto.createHash('md5').update(src).digest('hex').slice(0, 6);","\t\tif (req.get && (etag === req.get('If-None-Match'))) {","\t\t\tres.status(304);","\t\t\tres.end();","\t\t}","\t\telse {","\t\t\tres.setHeader('ETag', etag);","\t\t\tres.setHeader('Vary', 'Accept-Encoding');","\t\t\tres.send(src);","\t\t}","\t}","\treturn {","\t\tserve: serve,","\t\tbuild: build","\t};","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"10":1,"11":1,"13":1,"14":0,"17":1,"18":0,"21":1,"22":0,"25":1,"26":0,"29":1,"30":4,"31":4,"32":4,"33":4,"34":4,"35":1,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"44":0,"45":0,"46":0,"48":0,"50":0,"53":0,"54":0,"55":0,"57":0,"58":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"68":0,"69":0,"70":0,"71":0,"72":0,"76":1,"77":0,"78":0,"79":0,"80":0,"82":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"92":0,"93":0,"94":0,"97":4}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/packages.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/packages.js","s":{"1":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":17,"column":2}}},"branchMap":{},"code":["// This file exports the common packages required by the Admin UI.","// ","// It is used to build /public/js/packages.js, and exclude these packages from","// the Admin UI bundle generated by browserify.","module.exports = [","\t'bytes',","\t'classnames',","\t'marked',","\t'moment',","\t'numeral',","\t'pikaday',","\t'react',","\t'react-select',","\t'react-alt-text',","\t'react/addons',","\t'superagent'","];",""],"l":{"5":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/middleware/api.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/middleware/api.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":23,"loc":{"start":{"line":23,"column":27},"end":{"line":23,"column":46}}},"2":{"name":"initAPI","line":24,"loc":{"start":{"line":24,"column":8},"end":{"line":24,"column":41}}},"3":{"name":"(anonymous_3)","line":26,"loc":{"start":{"line":26,"column":20},"end":{"line":26,"column":35}}},"4":{"name":"(anonymous_4)","line":34,"loc":{"start":{"line":34,"column":17},"end":{"line":34,"column":47}}},"5":{"name":"(anonymous_5)","line":48,"loc":{"start":{"line":48,"column":20},"end":{"line":48,"column":40}}},"6":{"name":"(anonymous_6)","line":52,"loc":{"start":{"line":52,"column":22},"end":{"line":52,"column":42}}}},"statementMap":{"1":{"start":{"line":23,"column":0},"end":{"line":58,"column":2}},"2":{"start":{"line":24,"column":1},"end":{"line":57,"column":3}},"3":{"start":{"line":26,"column":2},"end":{"line":32,"column":4}},"4":{"start":{"line":27,"column":3},"end":{"line":31,"column":4}},"5":{"start":{"line":28,"column":4},"end":{"line":28,"column":20}},"6":{"start":{"line":30,"column":4},"end":{"line":30,"column":19}},"7":{"start":{"line":34,"column":2},"end":{"line":46,"column":4}},"8":{"start":{"line":35,"column":3},"end":{"line":35,"column":24}},"9":{"start":{"line":36,"column":3},"end":{"line":36,"column":32}},"10":{"start":{"line":37,"column":3},"end":{"line":37,"column":27}},"11":{"start":{"line":38,"column":3},"end":{"line":43,"column":4}},"12":{"start":{"line":39,"column":4},"end":{"line":39,"column":40}},"13":{"start":{"line":40,"column":4},"end":{"line":42,"column":5}},"14":{"start":{"line":41,"column":5},"end":{"line":41,"column":22}},"15":{"start":{"line":44,"column":3},"end":{"line":44,"column":27}},"16":{"start":{"line":45,"column":3},"end":{"line":45,"column":59}},"17":{"start":{"line":48,"column":2},"end":{"line":50,"column":4}},"18":{"start":{"line":49,"column":3},"end":{"line":49,"column":64}},"19":{"start":{"line":52,"column":2},"end":{"line":54,"column":4}},"20":{"start":{"line":53,"column":3},"end":{"line":53,"column":70}},"21":{"start":{"line":56,"column":2},"end":{"line":56,"column":9}}},"branchMap":{"1":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":3},"end":{"line":27,"column":3}},{"start":{"line":27,"column":3},"end":{"line":27,"column":3}}]},"2":{"line":35,"type":"binary-expr","locations":[{"start":{"line":35,"column":9},"end":{"line":35,"column":12}},{"start":{"line":35,"column":16},"end":{"line":35,"column":23}}]},"3":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":9},"end":{"line":36,"column":12}},{"start":{"line":36,"column":16},"end":{"line":36,"column":31}}]},"4":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":3},"end":{"line":38,"column":3}},{"start":{"line":38,"column":3},"end":{"line":38,"column":3}}]},"5":{"line":39,"type":"cond-expr","locations":[{"start":{"line":39,"column":29},"end":{"line":39,"column":32}},{"start":{"line":39,"column":35},"end":{"line":39,"column":37}}]},"6":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":4},"end":{"line":40,"column":4}},{"start":{"line":40,"column":4},"end":{"line":40,"column":4}}]},"7":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":14},"end":{"line":44,"column":18}},{"start":{"line":44,"column":22},"end":{"line":44,"column":25}}]},"8":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":28},"end":{"line":45,"column":31}},{"start":{"line":45,"column":35},"end":{"line":45,"column":42}}]},"9":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":39},"end":{"line":49,"column":42}},{"start":{"line":49,"column":46},"end":{"line":49,"column":57}}]},"10":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":43},"end":{"line":53,"column":46}},{"start":{"line":53,"column":50},"end":{"line":53,"column":63}}]}},"code":["/**"," * Adds shortcut methods for JSON API responses:"," * "," *   * `res.apiResponse(data)`"," *   * `res.apiError(key, err, msg, code)`"," *   * `res.apiNotFound(err, msg)`"," *   * `res.apiNotAllowed(err, msg)`"," *"," * ####Example:"," *"," *     app.all('/api*', keystone.middleware.api);"," *"," * @param {app.request} req"," * @param {app.response} res"," * @param {function} next"," * @api public"," */","","// The exported function returns a closure that retains","// a reference to the keystone instance, so it can be","// passed as middeware to the express app.","","exports = module.exports = function(keystone) {","\treturn function initAPI(req, res, next) {","\t\t","\t\tres.apiResponse = function(data) {","\t\t\tif (req.query.callback) {","\t\t\t\tres.jsonp(data);","\t\t\t} else {","\t\t\t\tres.json(data);","\t\t\t}","\t\t};","","\t\tres.apiError = function(key, err, msg, code) {","\t\t\tmsg = msg || 'Error';","\t\t\tkey = key || 'unknown error';","\t\t\tmsg += ' (' + key + ')';","\t\t\tif (keystone.get('logger')) {","\t\t\t\tconsole.log(msg + (err ? ':' : ''));","\t\t\t\tif (err) {","\t\t\t\t\tconsole.log(err);","\t\t\t\t}","\t\t\t}","\t\t\tres.status(code || 500);","\t\t\tres.apiResponse({ error: key || 'error', detail: err });","\t\t};","\t\t","\t\tres.apiNotFound = function (err, msg) {","\t\t\tres.apiError('data not found', err, msg || 'not found', 404);","\t\t};","\t\t","\t\tres.apiNotAllowed = function (err, msg) {","\t\t\tres.apiError('access not allowed', err, msg || 'not allowed', 403);","\t\t};","","\t\tnext();","\t};","};",""],"l":{"23":1,"24":1,"26":0,"27":0,"28":0,"30":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"44":0,"45":0,"48":0,"49":0,"52":0,"53":0,"56":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/middleware/cors.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/middleware/cors.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":1,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":18,"loc":{"start":{"line":18,"column":27},"end":{"line":18,"column":46}}},"2":{"name":"cors","line":19,"loc":{"start":{"line":19,"column":8},"end":{"line":19,"column":38}}}},"statementMap":{"1":{"start":{"line":18,"column":0},"end":{"line":35,"column":2}},"2":{"start":{"line":19,"column":1},"end":{"line":34,"column":3}},"3":{"start":{"line":21,"column":2},"end":{"line":21,"column":49}},"4":{"start":{"line":22,"column":2},"end":{"line":24,"column":3}},"5":{"start":{"line":23,"column":3},"end":{"line":23,"column":77}},"6":{"start":{"line":26,"column":2},"end":{"line":28,"column":3}},"7":{"start":{"line":27,"column":3},"end":{"line":27,"column":107}},"8":{"start":{"line":29,"column":2},"end":{"line":31,"column":3}},"9":{"start":{"line":30,"column":3},"end":{"line":30,"column":115}},"10":{"start":{"line":33,"column":2},"end":{"line":33,"column":9}}},"branchMap":{"1":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":2},"end":{"line":22,"column":2}},{"start":{"line":22,"column":2},"end":{"line":22,"column":2}}]},"2":{"line":23,"type":"cond-expr","locations":[{"start":{"line":23,"column":63},"end":{"line":23,"column":66}},{"start":{"line":23,"column":69},"end":{"line":23,"column":75}}]},"3":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":2},"end":{"line":26,"column":2}},{"start":{"line":26,"column":2},"end":{"line":26,"column":2}}]},"4":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":46},"end":{"line":27,"column":80}},{"start":{"line":27,"column":84},"end":{"line":27,"column":105}}]},"5":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"6":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":46},"end":{"line":30,"column":80}},{"start":{"line":30,"column":84},"end":{"line":30,"column":113}}]}},"code":["/**"," * Adds CORS headers to the response"," *"," * ####Example:"," *"," *     app.all('/api*', keystone.middleware.cors);"," *"," * @param {app.request} req"," * @param {app.response} res"," * @param {function} next"," * @api public"," */","","// The exported function returns a closure that retains","// a reference to the keystone instance, so it can be","// passed as middeware to the express app.","","exports = module.exports = function(keystone) {","\treturn function cors(req, res, next) {","\t\t","\t\tvar origin = keystone.get('cors allow origin');","\t\tif (origin) {","\t\t\tres.header('Access-Control-Allow-Origin', origin === true ? '*' : origin);","\t\t}","\t\t","\t\tif (keystone.get('cors allow methods') !== false) {","\t\t\tres.header('Access-Control-Allow-Methods', keystone.get('cors allow methods') || 'GET,PUT,POST,DELETE');","\t\t}","\t\tif (keystone.get('cors allow headers') !== false) {","\t\t\tres.header('Access-Control-Allow-Headers', keystone.get('cors allow headers') || 'Content-Type, Authorization');","\t\t}","","\t\tnext();","\t};","};",""],"l":{"18":1,"19":1,"21":0,"22":0,"23":0,"26":0,"27":0,"29":0,"30":0,"33":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/email.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/email.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":1,"14":0,"15":0,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":0,"25":0,"26":0,"27":0,"28":1,"29":1,"30":0,"31":0,"32":0,"33":0,"34":1,"35":1,"36":0,"37":0,"38":0,"39":0,"40":1,"41":1,"42":0,"43":0,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":1,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":1,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":1,"74":0,"75":0,"76":1,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":1,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":1,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":1,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":1,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":1,"164":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"183":0,"184":0,"185":0,"186":0,"187":0,"188":0,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"198":0,"199":0,"200":0,"201":0,"202":0,"203":0,"204":0,"205":0,"206":0,"207":0,"208":0,"209":0,"210":0,"211":0,"212":0,"213":0,"214":0,"215":0,"216":0,"217":0,"218":0,"219":0,"220":0,"221":0,"222":0,"223":0,"224":0,"225":0,"226":0,"227":0,"228":0,"229":0,"230":0,"231":0,"232":0,"233":1,"234":0,"235":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"244":0,"245":0,"246":0,"247":0,"248":0,"249":0,"250":0,"251":0,"252":0,"253":0,"254":0,"255":0,"256":0,"257":0,"258":0,"259":0,"260":0,"261":0,"262":0,"263":0,"264":0,"265":0,"266":0,"267":0,"268":0,"269":0,"270":0,"271":1,"272":0,"273":0,"274":0,"275":0,"276":0,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":0,"284":0,"285":0,"286":0,"287":0,"288":0,"289":0,"290":0,"291":0,"292":1,"293":1,"294":1,"295":1,"296":1},"b":{"1":[0,1],"2":[1,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0],"70":[0,0],"71":[0,0],"72":[0,0],"73":[0,0],"74":[0,0],"75":[0,0],"76":[0,0],"77":[0,0],"78":[0,0],"79":[0,0],"80":[0,0],"81":[0,0],"82":[0,0],"83":[0,0],"84":[0,0],"85":[0,0],"86":[0,0],"87":[0,0],"88":[0,0],"89":[0,0],"90":[0,0],"91":[0,0],"92":[0,0],"93":[0,0],"94":[0,0],"95":[0,0],"96":[0,0],"97":[0,0],"98":[0,0],"99":[0,0],"100":[0,0],"101":[0,0],"102":[0,0],"103":[0,0],"104":[0,0],"105":[0,0],"106":[0,0],"107":[0,0],"108":[0,0],"109":[0,0],"110":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0},"fnMap":{"1":{"name":"(anonymous_1)","line":45,"loc":{"start":{"line":45,"column":31},"end":{"line":45,"column":42}}},"2":{"name":"(anonymous_2)","line":53,"loc":{"start":{"line":53,"column":28},"end":{"line":53,"column":39}}},"3":{"name":"(anonymous_3)","line":61,"loc":{"start":{"line":61,"column":32},"end":{"line":61,"column":43}}},"4":{"name":"(anonymous_4)","line":71,"loc":{"start":{"line":71,"column":20},"end":{"line":71,"column":31}}},"5":{"name":"buildAddress","line":79,"loc":{"start":{"line":79,"column":0},"end":{"line":79,"column":36}}},"6":{"name":"(anonymous_6)","line":81,"loc":{"start":{"line":81,"column":19},"end":{"line":81,"column":33}}},"7":{"name":"(anonymous_7)","line":93,"loc":{"start":{"line":93,"column":20},"end":{"line":93,"column":41}}},"8":{"name":"(anonymous_8)","line":121,"loc":{"start":{"line":121,"column":24},"end":{"line":121,"column":40}}},"9":{"name":"(anonymous_9)","line":125,"loc":{"start":{"line":125,"column":16},"end":{"line":125,"column":37}}},"10":{"name":"(anonymous_10)","line":136,"loc":{"start":{"line":136,"column":13},"end":{"line":136,"column":38}}},"11":{"name":"(anonymous_11)","line":164,"loc":{"start":{"line":164,"column":12},"end":{"line":164,"column":30}}},"12":{"name":"(anonymous_12)","line":202,"loc":{"start":{"line":202,"column":25},"end":{"line":202,"column":52}}},"13":{"name":"(anonymous_13)","line":210,"loc":{"start":{"line":210,"column":58},"end":{"line":210,"column":69}}},"14":{"name":"(anonymous_14)","line":231,"loc":{"start":{"line":231,"column":22},"end":{"line":231,"column":36}}},"15":{"name":"(anonymous_15)","line":253,"loc":{"start":{"line":253,"column":42},"end":{"line":253,"column":54}}},"16":{"name":"(anonymous_16)","line":266,"loc":{"start":{"line":266,"column":17},"end":{"line":266,"column":32}}},"17":{"name":"(anonymous_17)","line":299,"loc":{"start":{"line":299,"column":31},"end":{"line":299,"column":50}}},"18":{"name":"(anonymous_18)","line":301,"loc":{"start":{"line":301,"column":58},"end":{"line":301,"column":69}}},"19":{"name":"(anonymous_19)","line":305,"loc":{"start":{"line":305,"column":29},"end":{"line":305,"column":53}}},"20":{"name":"(anonymous_20)","line":310,"loc":{"start":{"line":310,"column":32},"end":{"line":310,"column":56}}},"21":{"name":"(anonymous_21)","line":333,"loc":{"start":{"line":333,"column":34},"end":{"line":333,"column":53}}},"22":{"name":"(anonymous_22)","line":334,"loc":{"start":{"line":334,"column":58},"end":{"line":334,"column":69}}},"23":{"name":"(anonymous_23)","line":340,"loc":{"start":{"line":340,"column":19},"end":{"line":340,"column":53}}},"24":{"name":"(anonymous_24)","line":366,"loc":{"start":{"line":366,"column":26},"end":{"line":366,"column":54}}},"25":{"name":"(anonymous_25)","line":374,"loc":{"start":{"line":374,"column":58},"end":{"line":374,"column":69}}},"26":{"name":"(anonymous_26)","line":379,"loc":{"start":{"line":379,"column":22},"end":{"line":379,"column":42}}},"27":{"name":"(anonymous_27)","line":399,"loc":{"start":{"line":399,"column":31},"end":{"line":399,"column":64}}},"28":{"name":"(anonymous_28)","line":400,"loc":{"start":{"line":400,"column":58},"end":{"line":400,"column":69}}},"29":{"name":"(anonymous_29)","line":596,"loc":{"start":{"line":596,"column":23},"end":{"line":596,"column":52}}},"30":{"name":"(anonymous_30)","line":612,"loc":{"start":{"line":612,"column":13},"end":{"line":612,"column":33}}},"31":{"name":"(anonymous_31)","line":618,"loc":{"start":{"line":618,"column":13},"end":{"line":618,"column":34}}},"32":{"name":"(anonymous_32)","line":623,"loc":{"start":{"line":623,"column":21},"end":{"line":623,"column":44}}},"33":{"name":"(anonymous_33)","line":628,"loc":{"start":{"line":628,"column":18},"end":{"line":628,"column":34}}},"34":{"name":"(anonymous_34)","line":632,"loc":{"start":{"line":632,"column":15},"end":{"line":632,"column":31}}},"35":{"name":"(anonymous_35)","line":649,"loc":{"start":{"line":649,"column":27},"end":{"line":649,"column":39}}},"36":{"name":"(anonymous_36)","line":650,"loc":{"start":{"line":650,"column":42},"end":{"line":650,"column":63}}},"37":{"name":"(anonymous_37)","line":657,"loc":{"start":{"line":657,"column":28},"end":{"line":657,"column":40}}},"38":{"name":"(anonymous_38)","line":661,"loc":{"start":{"line":661,"column":28},"end":{"line":661,"column":40}}},"39":{"name":"(anonymous_39)","line":676,"loc":{"start":{"line":676,"column":33},"end":{"line":676,"column":62}}},"40":{"name":"(anonymous_40)","line":686,"loc":{"start":{"line":686,"column":58},"end":{"line":686,"column":69}}},"41":{"name":"(anonymous_41)","line":688,"loc":{"start":{"line":688,"column":21},"end":{"line":688,"column":44}}},"42":{"name":"(anonymous_42)","line":709,"loc":{"start":{"line":709,"column":18},"end":{"line":709,"column":34}}},"43":{"name":"(anonymous_43)","line":713,"loc":{"start":{"line":713,"column":15},"end":{"line":713,"column":31}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":23}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":30}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":42}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":39}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"7":{"start":{"line":7,"column":0},"end":{"line":7,"column":31}},"8":{"start":{"line":8,"column":0},"end":{"line":8,"column":27}},"9":{"start":{"line":9,"column":0},"end":{"line":9,"column":27}},"10":{"start":{"line":10,"column":0},"end":{"line":10,"column":38}},"11":{"start":{"line":12,"column":0},"end":{"line":12,"column":23}},"12":{"start":{"line":15,"column":0},"end":{"line":15,"column":34}},"13":{"start":{"line":16,"column":0},"end":{"line":22,"column":1}},"14":{"start":{"line":17,"column":1},"end":{"line":17,"column":44}},"15":{"start":{"line":18,"column":1},"end":{"line":18,"column":49}},"16":{"start":{"line":20,"column":1},"end":{"line":20,"column":23}},"17":{"start":{"line":21,"column":1},"end":{"line":21,"column":35}},"18":{"start":{"line":24,"column":0},"end":{"line":28,"column":2}},"19":{"start":{"line":29,"column":0},"end":{"line":38,"column":1}},"20":{"start":{"line":30,"column":1},"end":{"line":35,"column":3}},"21":{"start":{"line":36,"column":1},"end":{"line":36,"column":43}},"22":{"start":{"line":37,"column":1},"end":{"line":37,"column":41}},"23":{"start":{"line":45,"column":0},"end":{"line":50,"column":2}},"24":{"start":{"line":46,"column":1},"end":{"line":46,"column":30}},"25":{"start":{"line":47,"column":1},"end":{"line":47,"column":49}},"26":{"start":{"line":48,"column":1},"end":{"line":48,"column":51}},"27":{"start":{"line":49,"column":1},"end":{"line":49,"column":40}},"28":{"start":{"line":51,"column":0},"end":{"line":51,"column":47}},"29":{"start":{"line":53,"column":0},"end":{"line":58,"column":2}},"30":{"start":{"line":54,"column":1},"end":{"line":54,"column":30}},"31":{"start":{"line":55,"column":1},"end":{"line":55,"column":49}},"32":{"start":{"line":56,"column":1},"end":{"line":56,"column":117}},"33":{"start":{"line":57,"column":1},"end":{"line":57,"column":37}},"34":{"start":{"line":59,"column":0},"end":{"line":59,"column":44}},"35":{"start":{"line":61,"column":0},"end":{"line":66,"column":2}},"36":{"start":{"line":62,"column":1},"end":{"line":62,"column":30}},"37":{"start":{"line":63,"column":1},"end":{"line":63,"column":49}},"38":{"start":{"line":64,"column":1},"end":{"line":64,"column":103}},"39":{"start":{"line":65,"column":1},"end":{"line":65,"column":41}},"40":{"start":{"line":67,"column":0},"end":{"line":67,"column":44}},"41":{"start":{"line":71,"column":0},"end":{"line":77,"column":2}},"42":{"start":{"line":72,"column":1},"end":{"line":72,"column":39}},"43":{"start":{"line":73,"column":1},"end":{"line":75,"column":2}},"44":{"start":{"line":74,"column":2},"end":{"line":74,"column":14}},"45":{"start":{"line":76,"column":1},"end":{"line":76,"column":35}},"46":{"start":{"line":79,"column":0},"end":{"line":85,"column":1}},"47":{"start":{"line":80,"column":1},"end":{"line":84,"column":2}},"48":{"start":{"line":81,"column":2},"end":{"line":81,"column":88}},"49":{"start":{"line":81,"column":35},"end":{"line":81,"column":74}},"50":{"start":{"line":83,"column":2},"end":{"line":83,"column":50}},"51":{"start":{"line":93,"column":0},"end":{"line":112,"column":2}},"52":{"start":{"line":94,"column":1},"end":{"line":94,"column":22}},"53":{"start":{"line":95,"column":1},"end":{"line":95,"column":15}},"54":{"start":{"line":97,"column":1},"end":{"line":110,"column":2}},"55":{"start":{"line":98,"column":2},"end":{"line":98,"column":41}},"56":{"start":{"line":98,"column":32},"end":{"line":98,"column":41}},"57":{"start":{"line":100,"column":2},"end":{"line":109,"column":3}},"58":{"start":{"line":101,"column":3},"end":{"line":101,"column":46}},"59":{"start":{"line":102,"column":3},"end":{"line":106,"column":4}},"60":{"start":{"line":103,"column":4},"end":{"line":103,"column":46}},"61":{"start":{"line":103,"column":37},"end":{"line":103,"column":46}},"62":{"start":{"line":105,"column":4},"end":{"line":105,"column":43}},"63":{"start":{"line":108,"column":3},"end":{"line":108,"column":24}},"64":{"start":{"line":111,"column":1},"end":{"line":111,"column":13}},"65":{"start":{"line":121,"column":0},"end":{"line":131,"column":2}},"66":{"start":{"line":122,"column":1},"end":{"line":122,"column":15}},"67":{"start":{"line":123,"column":1},"end":{"line":129,"column":2}},"68":{"start":{"line":124,"column":2},"end":{"line":124,"column":39}},"69":{"start":{"line":125,"column":2},"end":{"line":127,"column":5}},"70":{"start":{"line":126,"column":3},"end":{"line":126,"column":44}},"71":{"start":{"line":128,"column":2},"end":{"line":128,"column":14}},"72":{"start":{"line":130,"column":1},"end":{"line":130,"column":13}},"73":{"start":{"line":135,"column":0},"end":{"line":142,"column":2}},"74":{"start":{"line":138,"column":2},"end":{"line":138,"column":157}},"75":{"start":{"line":139,"column":2},"end":{"line":139,"column":129}},"76":{"start":{"line":164,"column":0},"end":{"line":190,"column":2}},"77":{"start":{"line":166,"column":1},"end":{"line":172,"column":2}},"78":{"start":{"line":167,"column":2},"end":{"line":169,"column":4}},"79":{"start":{"line":170,"column":8},"end":{"line":172,"column":2}},"80":{"start":{"line":171,"column":2},"end":{"line":171,"column":40}},"81":{"start":{"line":174,"column":1},"end":{"line":174,"column":58}},"82":{"start":{"line":175,"column":1},"end":{"line":175,"column":114}},"83":{"start":{"line":177,"column":1},"end":{"line":177,"column":71}},"84":{"start":{"line":178,"column":1},"end":{"line":178,"column":70}},"85":{"start":{"line":179,"column":1},"end":{"line":179,"column":79}},"86":{"start":{"line":180,"column":1},"end":{"line":180,"column":85}},"87":{"start":{"line":181,"column":1},"end":{"line":181,"column":82}},"88":{"start":{"line":182,"column":1},"end":{"line":182,"column":79}},"89":{"start":{"line":184,"column":1},"end":{"line":186,"column":2}},"90":{"start":{"line":185,"column":2},"end":{"line":185,"column":39}},"91":{"start":{"line":188,"column":1},"end":{"line":188,"column":13}},"92":{"start":{"line":202,"column":0},"end":{"line":289,"column":2}},"93":{"start":{"line":204,"column":1},"end":{"line":207,"column":2}},"94":{"start":{"line":205,"column":2},"end":{"line":205,"column":20}},"95":{"start":{"line":206,"column":2},"end":{"line":206,"column":14}},"96":{"start":{"line":209,"column":1},"end":{"line":209,"column":53}},"97":{"start":{"line":210,"column":1},"end":{"line":210,"column":72}},"98":{"start":{"line":212,"column":1},"end":{"line":214,"column":2}},"99":{"start":{"line":213,"column":2},"end":{"line":213,"column":51}},"100":{"start":{"line":216,"column":1},"end":{"line":225,"column":4}},"101":{"start":{"line":227,"column":1},"end":{"line":229,"column":2}},"102":{"start":{"line":228,"column":2},"end":{"line":228,"column":28}},"103":{"start":{"line":231,"column":1},"end":{"line":287,"column":15}},"104":{"start":{"line":232,"column":2},"end":{"line":234,"column":3}},"105":{"start":{"line":233,"column":3},"end":{"line":233,"column":24}},"106":{"start":{"line":236,"column":2},"end":{"line":236,"column":18}},"107":{"start":{"line":237,"column":2},"end":{"line":237,"column":50}},"108":{"start":{"line":238,"column":2},"end":{"line":250,"column":3}},"109":{"start":{"line":239,"column":3},"end":{"line":239,"column":48}},"110":{"start":{"line":240,"column":9},"end":{"line":250,"column":3}},"111":{"start":{"line":241,"column":3},"end":{"line":241,"column":27}},"112":{"start":{"line":242,"column":9},"end":{"line":250,"column":3}},"113":{"start":{"line":243,"column":3},"end":{"line":243,"column":34}},"114":{"start":{"line":245,"column":3},"end":{"line":249,"column":6}},"115":{"start":{"line":253,"column":2},"end":{"line":255,"column":5}},"116":{"start":{"line":254,"column":3},"end":{"line":254,"column":74}},"117":{"start":{"line":258,"column":2},"end":{"line":258,"column":42}},"118":{"start":{"line":260,"column":2},"end":{"line":280,"column":3}},"119":{"start":{"line":262,"column":3},"end":{"line":264,"column":4}},"120":{"start":{"line":263,"column":4},"end":{"line":263,"column":20}},"121":{"start":{"line":266,"column":3},"end":{"line":278,"column":6}},"122":{"start":{"line":267,"column":4},"end":{"line":277,"column":5}},"123":{"start":{"line":269,"column":5},"end":{"line":270,"column":29}},"124":{"start":{"line":272,"column":5},"end":{"line":274,"column":6}},"125":{"start":{"line":273,"column":6},"end":{"line":273,"column":36}},"126":{"start":{"line":276,"column":5},"end":{"line":276,"column":40}},"127":{"start":{"line":282,"column":2},"end":{"line":285,"column":5}},"128":{"start":{"line":299,"column":0},"end":{"line":323,"column":2}},"129":{"start":{"line":301,"column":1},"end":{"line":301,"column":72}},"130":{"start":{"line":303,"column":1},"end":{"line":303,"column":99}},"131":{"start":{"line":305,"column":1},"end":{"line":321,"column":15}},"132":{"start":{"line":306,"column":2},"end":{"line":319,"column":3}},"133":{"start":{"line":307,"column":3},"end":{"line":316,"column":4}},"134":{"start":{"line":308,"column":4},"end":{"line":308,"column":102}},"135":{"start":{"line":310,"column":4},"end":{"line":312,"column":7}},"136":{"start":{"line":311,"column":5},"end":{"line":311,"column":45}},"137":{"start":{"line":315,"column":4},"end":{"line":315,"column":25}},"138":{"start":{"line":318,"column":3},"end":{"line":318,"column":50}},"139":{"start":{"line":333,"column":0},"end":{"line":356,"column":2}},"140":{"start":{"line":334,"column":1},"end":{"line":334,"column":72}},"141":{"start":{"line":336,"column":1},"end":{"line":338,"column":2}},"142":{"start":{"line":337,"column":2},"end":{"line":337,"column":36}},"143":{"start":{"line":340,"column":1},"end":{"line":354,"column":15}},"144":{"start":{"line":341,"column":2},"end":{"line":341,"column":32}},"145":{"start":{"line":341,"column":11},"end":{"line":341,"column":32}},"146":{"start":{"line":343,"column":2},"end":{"line":343,"column":22}},"147":{"start":{"line":344,"column":2},"end":{"line":348,"column":3}},"148":{"start":{"line":345,"column":3},"end":{"line":345,"column":136}},"149":{"start":{"line":347,"column":3},"end":{"line":347,"column":197}},"150":{"start":{"line":350,"column":2},"end":{"line":350,"column":46}},"151":{"start":{"line":352,"column":2},"end":{"line":352,"column":13}},"152":{"start":{"line":366,"column":0},"end":{"line":389,"column":2}},"153":{"start":{"line":367,"column":1},"end":{"line":367,"column":22}},"154":{"start":{"line":369,"column":1},"end":{"line":372,"column":2}},"155":{"start":{"line":370,"column":2},"end":{"line":370,"column":26}},"156":{"start":{"line":371,"column":2},"end":{"line":371,"column":41}},"157":{"start":{"line":374,"column":1},"end":{"line":374,"column":72}},"158":{"start":{"line":377,"column":1},"end":{"line":388,"column":2}},"159":{"start":{"line":379,"column":2},"end":{"line":383,"column":16}},"160":{"start":{"line":381,"column":3},"end":{"line":381,"column":28}},"161":{"start":{"line":382,"column":3},"end":{"line":382,"column":56}},"162":{"start":{"line":387,"column":2},"end":{"line":387,"column":56}},"163":{"start":{"line":399,"column":0},"end":{"line":558,"column":2}},"164":{"start":{"line":400,"column":1},"end":{"line":400,"column":72}},"165":{"start":{"line":402,"column":1},"end":{"line":404,"column":2}},"166":{"start":{"line":403,"column":2},"end":{"line":403,"column":23}},"167":{"start":{"line":406,"column":1},"end":{"line":412,"column":2}},"168":{"start":{"line":407,"column":2},"end":{"line":411,"column":5}},"169":{"start":{"line":414,"column":1},"end":{"line":420,"column":2}},"170":{"start":{"line":415,"column":2},"end":{"line":415,"column":34}},"171":{"start":{"line":416,"column":2},"end":{"line":416,"column":35}},"172":{"start":{"line":417,"column":8},"end":{"line":420,"column":2}},"173":{"start":{"line":418,"column":2},"end":{"line":418,"column":100}},"174":{"start":{"line":419,"column":2},"end":{"line":419,"column":41}},"175":{"start":{"line":422,"column":1},"end":{"line":428,"column":2}},"176":{"start":{"line":423,"column":2},"end":{"line":427,"column":5}},"177":{"start":{"line":429,"column":1},"end":{"line":453,"column":2}},"178":{"start":{"line":430,"column":2},"end":{"line":441,"column":3}},"179":{"start":{"line":431,"column":3},"end":{"line":437,"column":4}},"180":{"start":{"line":432,"column":4},"end":{"line":436,"column":7}},"181":{"start":{"line":438,"column":3},"end":{"line":438,"column":49}},"182":{"start":{"line":439,"column":3},"end":{"line":439,"column":47}},"183":{"start":{"line":440,"column":3},"end":{"line":440,"column":73}},"184":{"start":{"line":443,"column":2},"end":{"line":452,"column":3}},"185":{"start":{"line":444,"column":3},"end":{"line":450,"column":4}},"186":{"start":{"line":445,"column":4},"end":{"line":449,"column":7}},"187":{"start":{"line":451,"column":3},"end":{"line":451,"column":81}},"188":{"start":{"line":455,"column":1},"end":{"line":455,"column":64}},"189":{"start":{"line":456,"column":1},"end":{"line":456,"column":60}},"190":{"start":{"line":457,"column":1},"end":{"line":457,"column":38}},"191":{"start":{"line":459,"column":1},"end":{"line":461,"column":2}},"192":{"start":{"line":460,"column":2},"end":{"line":460,"column":35}},"193":{"start":{"line":466,"column":1},"end":{"line":468,"column":2}},"194":{"start":{"line":467,"column":2},"end":{"line":467,"column":115}},"195":{"start":{"line":470,"column":1},"end":{"line":470,"column":21}},"196":{"start":{"line":471,"column":1},"end":{"line":471,"column":20}},"197":{"start":{"line":473,"column":1},"end":{"line":473,"column":68}},"198":{"start":{"line":475,"column":1},"end":{"line":520,"column":2}},"199":{"start":{"line":476,"column":2},"end":{"line":494,"column":3}},"200":{"start":{"line":477,"column":3},"end":{"line":477,"column":44}},"201":{"start":{"line":478,"column":9},"end":{"line":494,"column":3}},"202":{"start":{"line":479,"column":3},"end":{"line":485,"column":4}},"203":{"start":{"line":480,"column":4},"end":{"line":484,"column":7}},"204":{"start":{"line":488,"column":3},"end":{"line":492,"column":6}},"205":{"start":{"line":496,"column":2},"end":{"line":496,"column":49}},"206":{"start":{"line":497,"column":2},"end":{"line":497,"column":59}},"207":{"start":{"line":499,"column":2},"end":{"line":507,"column":3}},"208":{"start":{"line":500,"column":3},"end":{"line":500,"column":39}},"209":{"start":{"line":501,"column":3},"end":{"line":501,"column":60}},"210":{"start":{"line":502,"column":9},"end":{"line":507,"column":3}},"211":{"start":{"line":503,"column":3},"end":{"line":503,"column":50}},"212":{"start":{"line":504,"column":3},"end":{"line":504,"column":71}},"213":{"start":{"line":505,"column":3},"end":{"line":505,"column":78}},"214":{"start":{"line":506,"column":3},"end":{"line":506,"column":76}},"215":{"start":{"line":510,"column":2},"end":{"line":512,"column":3}},"216":{"start":{"line":511,"column":3},"end":{"line":511,"column":50}},"217":{"start":{"line":514,"column":2},"end":{"line":514,"column":29}},"218":{"start":{"line":516,"column":2},"end":{"line":519,"column":5}},"219":{"start":{"line":522,"column":1},"end":{"line":532,"column":3}},"220":{"start":{"line":534,"column":1},"end":{"line":536,"column":2}},"221":{"start":{"line":535,"column":2},"end":{"line":535,"column":36}},"222":{"start":{"line":538,"column":1},"end":{"line":540,"column":2}},"223":{"start":{"line":539,"column":2},"end":{"line":539,"column":30}},"224":{"start":{"line":542,"column":1},"end":{"line":542,"column":46}},"225":{"start":{"line":543,"column":1},"end":{"line":543,"column":46}},"226":{"start":{"line":545,"column":1},"end":{"line":547,"column":3}},"227":{"start":{"line":549,"column":1},"end":{"line":555,"column":2}},"228":{"start":{"line":550,"column":2},"end":{"line":550,"column":51}},"229":{"start":{"line":551,"column":2},"end":{"line":551,"column":57}},"230":{"start":{"line":552,"column":2},"end":{"line":554,"column":3}},"231":{"start":{"line":553,"column":3},"end":{"line":553,"column":93}},"232":{"start":{"line":557,"column":1},"end":{"line":557,"column":24}},"233":{"start":{"line":596,"column":0},"end":{"line":669,"column":2}},"234":{"start":{"line":597,"column":1},"end":{"line":597,"column":22}},"235":{"start":{"line":598,"column":1},"end":{"line":598,"column":31}},"236":{"start":{"line":600,"column":1},"end":{"line":621,"column":2}},"237":{"start":{"line":602,"column":2},"end":{"line":604,"column":3}},"238":{"start":{"line":603,"column":3},"end":{"line":603,"column":37}},"239":{"start":{"line":605,"column":2},"end":{"line":605,"column":26}},"240":{"start":{"line":607,"column":8},"end":{"line":621,"column":2}},"241":{"start":{"line":609,"column":2},"end":{"line":611,"column":3}},"242":{"start":{"line":610,"column":3},"end":{"line":610,"column":37}},"243":{"start":{"line":612,"column":2},"end":{"line":614,"column":4}},"244":{"start":{"line":613,"column":3},"end":{"line":613,"column":29}},"245":{"start":{"line":613,"column":12},"end":{"line":613,"column":29}},"246":{"start":{"line":616,"column":8},"end":{"line":621,"column":2}},"247":{"start":{"line":618,"column":2},"end":{"line":620,"column":4}},"248":{"start":{"line":619,"column":3},"end":{"line":619,"column":29}},"249":{"start":{"line":619,"column":12},"end":{"line":619,"column":29}},"250":{"start":{"line":623,"column":1},"end":{"line":666,"column":15}},"251":{"start":{"line":624,"column":2},"end":{"line":626,"column":3}},"252":{"start":{"line":625,"column":3},"end":{"line":625,"column":30}},"253":{"start":{"line":628,"column":2},"end":{"line":630,"column":4}},"254":{"start":{"line":629,"column":3},"end":{"line":629,"column":24}},"255":{"start":{"line":632,"column":2},"end":{"line":639,"column":4}},"256":{"start":{"line":633,"column":3},"end":{"line":638,"column":6}},"257":{"start":{"line":640,"column":2},"end":{"line":665,"column":3}},"258":{"start":{"line":641,"column":3},"end":{"line":641,"column":28}},"259":{"start":{"line":642,"column":3},"end":{"line":648,"column":5}},"260":{"start":{"line":649,"column":3},"end":{"line":654,"column":6}},"261":{"start":{"line":650,"column":4},"end":{"line":653,"column":7}},"262":{"start":{"line":651,"column":5},"end":{"line":651,"column":33}},"263":{"start":{"line":651,"column":14},"end":{"line":651,"column":33}},"264":{"start":{"line":652,"column":5},"end":{"line":652,"column":21}},"265":{"start":{"line":656,"column":3},"end":{"line":664,"column":4}},"266":{"start":{"line":657,"column":4},"end":{"line":659,"column":7}},"267":{"start":{"line":658,"column":5},"end":{"line":658,"column":71}},"268":{"start":{"line":661,"column":4},"end":{"line":663,"column":7}},"269":{"start":{"line":662,"column":5},"end":{"line":662,"column":63}},"270":{"start":{"line":668,"column":1},"end":{"line":668,"column":42}},"271":{"start":{"line":676,"column":0},"end":{"line":726,"column":2}},"272":{"start":{"line":677,"column":1},"end":{"line":677,"column":22}},"273":{"start":{"line":678,"column":1},"end":{"line":678,"column":31}},"274":{"start":{"line":680,"column":1},"end":{"line":684,"column":2}},"275":{"start":{"line":681,"column":2},"end":{"line":681,"column":26}},"276":{"start":{"line":682,"column":2},"end":{"line":682,"column":41}},"277":{"start":{"line":683,"column":2},"end":{"line":683,"column":31}},"278":{"start":{"line":686,"column":1},"end":{"line":686,"column":72}},"279":{"start":{"line":688,"column":1},"end":{"line":723,"column":4}},"280":{"start":{"line":689,"column":2},"end":{"line":691,"column":3}},"281":{"start":{"line":690,"column":3},"end":{"line":690,"column":30}},"282":{"start":{"line":701,"column":2},"end":{"line":703,"column":3}},"283":{"start":{"line":702,"column":3},"end":{"line":702,"column":57}},"284":{"start":{"line":705,"column":2},"end":{"line":707,"column":3}},"285":{"start":{"line":706,"column":3},"end":{"line":706,"column":63}},"286":{"start":{"line":709,"column":2},"end":{"line":711,"column":4}},"287":{"start":{"line":710,"column":3},"end":{"line":710,"column":24}},"288":{"start":{"line":713,"column":2},"end":{"line":720,"column":4}},"289":{"start":{"line":714,"column":3},"end":{"line":719,"column":6}},"290":{"start":{"line":722,"column":2},"end":{"line":722,"column":63}},"291":{"start":{"line":725,"column":1},"end":{"line":725,"column":42}},"292":{"start":{"line":728,"column":0},"end":{"line":728,"column":36}},"293":{"start":{"line":729,"column":0},"end":{"line":729,"column":36}},"294":{"start":{"line":730,"column":0},"end":{"line":730,"column":46}},"295":{"start":{"line":731,"column":0},"end":{"line":731,"column":31}},"296":{"start":{"line":733,"column":0},"end":{"line":733,"column":33}}},"branchMap":{"1":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":0},"end":{"line":16,"column":0}},{"start":{"line":16,"column":0},"end":{"line":16,"column":0}}]},"2":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":0},"end":{"line":29,"column":0}},{"start":{"line":29,"column":0},"end":{"line":29,"column":0}}]},"3":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},{"start":{"line":73,"column":1},"end":{"line":73,"column":1}}]},"4":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},{"start":{"line":80,"column":1},"end":{"line":80,"column":1}}]},"5":{"line":83,"type":"cond-expr","locations":[{"start":{"line":83,"column":16},"end":{"line":83,"column":41}},{"start":{"line":83,"column":44},"end":{"line":83,"column":49}}]},"6":{"line":94,"type":"binary-expr","locations":[{"start":{"line":94,"column":9},"end":{"line":94,"column":14}},{"start":{"line":94,"column":18},"end":{"line":94,"column":21}}]},"7":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":2},"end":{"line":98,"column":2}},{"start":{"line":98,"column":2},"end":{"line":98,"column":2}}]},"8":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":2},"end":{"line":100,"column":2}},{"start":{"line":100,"column":2},"end":{"line":100,"column":2}}]},"9":{"line":100,"type":"binary-expr","locations":[{"start":{"line":100,"column":6},"end":{"line":100,"column":36}},{"start":{"line":100,"column":40},"end":{"line":100,"column":57}}]},"10":{"line":103,"type":"if","locations":[{"start":{"line":103,"column":4},"end":{"line":103,"column":4}},{"start":{"line":103,"column":4},"end":{"line":103,"column":4}}]},"11":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},{"start":{"line":123,"column":1},"end":{"line":123,"column":1}}]},"12":{"line":139,"type":"cond-expr","locations":[{"start":{"line":139,"column":35},"end":{"line":139,"column":42}},{"start":{"line":139,"column":43},"end":{"line":139,"column":46}}]},"13":{"line":139,"type":"cond-expr","locations":[{"start":{"line":139,"column":39},"end":{"line":139,"column":40}},{"start":{"line":139,"column":41},"end":{"line":139,"column":42}}]},"14":{"line":139,"type":"cond-expr","locations":[{"start":{"line":139,"column":65},"end":{"line":139,"column":72}},{"start":{"line":139,"column":73},"end":{"line":139,"column":76}}]},"15":{"line":139,"type":"cond-expr","locations":[{"start":{"line":139,"column":69},"end":{"line":139,"column":70}},{"start":{"line":139,"column":71},"end":{"line":139,"column":72}}]},"16":{"line":139,"type":"cond-expr","locations":[{"start":{"line":139,"column":93},"end":{"line":139,"column":100}},{"start":{"line":139,"column":101},"end":{"line":139,"column":104}}]},"17":{"line":139,"type":"cond-expr","locations":[{"start":{"line":139,"column":97},"end":{"line":139,"column":98}},{"start":{"line":139,"column":99},"end":{"line":139,"column":100}}]},"18":{"line":166,"type":"if","locations":[{"start":{"line":166,"column":1},"end":{"line":166,"column":1}},{"start":{"line":166,"column":1},"end":{"line":166,"column":1}}]},"19":{"line":170,"type":"if","locations":[{"start":{"line":170,"column":8},"end":{"line":170,"column":8}},{"start":{"line":170,"column":8},"end":{"line":170,"column":8}}]},"20":{"line":175,"type":"cond-expr","locations":[{"start":{"line":175,"column":77},"end":{"line":175,"column":108}},{"start":{"line":175,"column":111},"end":{"line":175,"column":113}}]},"21":{"line":177,"type":"binary-expr","locations":[{"start":{"line":177,"column":21},"end":{"line":177,"column":41}},{"start":{"line":177,"column":45},"end":{"line":177,"column":70}}]},"22":{"line":178,"type":"binary-expr","locations":[{"start":{"line":178,"column":20},"end":{"line":178,"column":39}},{"start":{"line":178,"column":43},"end":{"line":178,"column":69}}]},"23":{"line":179,"type":"binary-expr","locations":[{"start":{"line":179,"column":23},"end":{"line":179,"column":45}},{"start":{"line":179,"column":49},"end":{"line":179,"column":78}}]},"24":{"line":180,"type":"binary-expr","locations":[{"start":{"line":180,"column":25},"end":{"line":180,"column":49}},{"start":{"line":180,"column":53},"end":{"line":180,"column":84}}]},"25":{"line":181,"type":"binary-expr","locations":[{"start":{"line":181,"column":24},"end":{"line":181,"column":47}},{"start":{"line":181,"column":51},"end":{"line":181,"column":81}}]},"26":{"line":182,"type":"binary-expr","locations":[{"start":{"line":182,"column":23},"end":{"line":182,"column":45}},{"start":{"line":182,"column":49},"end":{"line":182,"column":78}}]},"27":{"line":184,"type":"if","locations":[{"start":{"line":184,"column":1},"end":{"line":184,"column":1}},{"start":{"line":184,"column":1},"end":{"line":184,"column":1}}]},"28":{"line":204,"type":"if","locations":[{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},{"start":{"line":204,"column":1},"end":{"line":204,"column":1}}]},"29":{"line":204,"type":"binary-expr","locations":[{"start":{"line":204,"column":5},"end":{"line":204,"column":33}},{"start":{"line":204,"column":37},"end":{"line":204,"column":46}}]},"30":{"line":209,"type":"cond-expr","locations":[{"start":{"line":209,"column":41},"end":{"line":209,"column":47}},{"start":{"line":209,"column":50},"end":{"line":209,"column":52}}]},"31":{"line":210,"type":"cond-expr","locations":[{"start":{"line":210,"column":47},"end":{"line":210,"column":55}},{"start":{"line":210,"column":58},"end":{"line":210,"column":71}}]},"32":{"line":212,"type":"if","locations":[{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},{"start":{"line":212,"column":1},"end":{"line":212,"column":1}}]},"33":{"line":227,"type":"if","locations":[{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},{"start":{"line":227,"column":1},"end":{"line":227,"column":1}}]},"34":{"line":232,"type":"if","locations":[{"start":{"line":232,"column":2},"end":{"line":232,"column":2}},{"start":{"line":232,"column":2},"end":{"line":232,"column":2}}]},"35":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":2},"end":{"line":238,"column":2}},{"start":{"line":238,"column":2},"end":{"line":238,"column":2}}]},"36":{"line":240,"type":"if","locations":[{"start":{"line":240,"column":9},"end":{"line":240,"column":9}},{"start":{"line":240,"column":9},"end":{"line":240,"column":9}}]},"37":{"line":242,"type":"if","locations":[{"start":{"line":242,"column":9},"end":{"line":242,"column":9}},{"start":{"line":242,"column":9},"end":{"line":242,"column":9}}]},"38":{"line":260,"type":"if","locations":[{"start":{"line":260,"column":2},"end":{"line":260,"column":2}},{"start":{"line":260,"column":2},"end":{"line":260,"column":2}}]},"39":{"line":262,"type":"if","locations":[{"start":{"line":262,"column":3},"end":{"line":262,"column":3}},{"start":{"line":262,"column":3},"end":{"line":262,"column":3}}]},"40":{"line":267,"type":"if","locations":[{"start":{"line":267,"column":4},"end":{"line":267,"column":4}},{"start":{"line":267,"column":4},"end":{"line":267,"column":4}}]},"41":{"line":267,"type":"binary-expr","locations":[{"start":{"line":267,"column":8},"end":{"line":267,"column":17}},{"start":{"line":267,"column":21},"end":{"line":267,"column":33}}]},"42":{"line":272,"type":"if","locations":[{"start":{"line":272,"column":5},"end":{"line":272,"column":5}},{"start":{"line":272,"column":5},"end":{"line":272,"column":5}}]},"43":{"line":301,"type":"cond-expr","locations":[{"start":{"line":301,"column":47},"end":{"line":301,"column":55}},{"start":{"line":301,"column":58},"end":{"line":301,"column":71}}]},"44":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":2},"end":{"line":306,"column":2}},{"start":{"line":306,"column":2},"end":{"line":306,"column":2}}]},"45":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":3},"end":{"line":307,"column":3}},{"start":{"line":307,"column":3},"end":{"line":307,"column":3}}]},"46":{"line":334,"type":"cond-expr","locations":[{"start":{"line":334,"column":47},"end":{"line":334,"column":55}},{"start":{"line":334,"column":58},"end":{"line":334,"column":71}}]},"47":{"line":336,"type":"if","locations":[{"start":{"line":336,"column":1},"end":{"line":336,"column":1}},{"start":{"line":336,"column":1},"end":{"line":336,"column":1}}]},"48":{"line":336,"type":"binary-expr","locations":[{"start":{"line":336,"column":5},"end":{"line":336,"column":41}},{"start":{"line":336,"column":45},"end":{"line":336,"column":77}}]},"49":{"line":341,"type":"if","locations":[{"start":{"line":341,"column":2},"end":{"line":341,"column":2}},{"start":{"line":341,"column":2},"end":{"line":341,"column":2}}]},"50":{"line":344,"type":"if","locations":[{"start":{"line":344,"column":2},"end":{"line":344,"column":2}},{"start":{"line":344,"column":2},"end":{"line":344,"column":2}}]},"51":{"line":347,"type":"binary-expr","locations":[{"start":{"line":347,"column":63},"end":{"line":347,"column":93}},{"start":{"line":347,"column":97},"end":{"line":347,"column":168}}]},"52":{"line":369,"type":"if","locations":[{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},{"start":{"line":369,"column":1},"end":{"line":369,"column":1}}]},"53":{"line":369,"type":"binary-expr","locations":[{"start":{"line":369,"column":5},"end":{"line":369,"column":27}},{"start":{"line":369,"column":31},"end":{"line":369,"column":58}}]},"54":{"line":371,"type":"binary-expr","locations":[{"start":{"line":371,"column":12},"end":{"line":371,"column":24}},{"start":{"line":371,"column":28},"end":{"line":371,"column":40}}]},"55":{"line":374,"type":"cond-expr","locations":[{"start":{"line":374,"column":47},"end":{"line":374,"column":55}},{"start":{"line":374,"column":58},"end":{"line":374,"column":71}}]},"56":{"line":377,"type":"if","locations":[{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},{"start":{"line":377,"column":1},"end":{"line":377,"column":1}}]},"57":{"line":377,"type":"binary-expr","locations":[{"start":{"line":377,"column":5},"end":{"line":377,"column":31}},{"start":{"line":377,"column":35},"end":{"line":377,"column":57}}]},"58":{"line":400,"type":"cond-expr","locations":[{"start":{"line":400,"column":47},"end":{"line":400,"column":55}},{"start":{"line":400,"column":58},"end":{"line":400,"column":71}}]},"59":{"line":402,"type":"if","locations":[{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},{"start":{"line":402,"column":1},"end":{"line":402,"column":1}}]},"60":{"line":406,"type":"if","locations":[{"start":{"line":406,"column":1},"end":{"line":406,"column":1}},{"start":{"line":406,"column":1},"end":{"line":406,"column":1}}]},"61":{"line":414,"type":"if","locations":[{"start":{"line":414,"column":1},"end":{"line":414,"column":1}},{"start":{"line":414,"column":1},"end":{"line":414,"column":1}}]},"62":{"line":417,"type":"if","locations":[{"start":{"line":417,"column":8},"end":{"line":417,"column":8}},{"start":{"line":417,"column":8},"end":{"line":417,"column":8}}]},"63":{"line":418,"type":"cond-expr","locations":[{"start":{"line":418,"column":57},"end":{"line":418,"column":79}},{"start":{"line":418,"column":82},"end":{"line":418,"column":99}}]},"64":{"line":422,"type":"if","locations":[{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},{"start":{"line":422,"column":1},"end":{"line":422,"column":1}}]},"65":{"line":422,"type":"binary-expr","locations":[{"start":{"line":422,"column":5},"end":{"line":422,"column":22}},{"start":{"line":422,"column":26},"end":{"line":422,"column":44}}]},"66":{"line":429,"type":"if","locations":[{"start":{"line":429,"column":1},"end":{"line":429,"column":1}},{"start":{"line":429,"column":1},"end":{"line":429,"column":1}}]},"67":{"line":430,"type":"if","locations":[{"start":{"line":430,"column":2},"end":{"line":430,"column":2}},{"start":{"line":430,"column":2},"end":{"line":430,"column":2}}]},"68":{"line":431,"type":"if","locations":[{"start":{"line":431,"column":3},"end":{"line":431,"column":3}},{"start":{"line":431,"column":3},"end":{"line":431,"column":3}}]},"69":{"line":443,"type":"if","locations":[{"start":{"line":443,"column":2},"end":{"line":443,"column":2}},{"start":{"line":443,"column":2},"end":{"line":443,"column":2}}]},"70":{"line":444,"type":"if","locations":[{"start":{"line":444,"column":3},"end":{"line":444,"column":3}},{"start":{"line":444,"column":3},"end":{"line":444,"column":3}}]},"71":{"line":455,"type":"cond-expr","locations":[{"start":{"line":455,"column":46},"end":{"line":455,"column":58}},{"start":{"line":455,"column":61},"end":{"line":455,"column":63}}]},"72":{"line":459,"type":"if","locations":[{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},{"start":{"line":459,"column":1},"end":{"line":459,"column":1}}]},"73":{"line":466,"type":"if","locations":[{"start":{"line":466,"column":1},"end":{"line":466,"column":1}},{"start":{"line":466,"column":1},"end":{"line":466,"column":1}}]},"74":{"line":467,"type":"binary-expr","locations":[{"start":{"line":467,"column":31},"end":{"line":467,"column":56}},{"start":{"line":467,"column":60},"end":{"line":467,"column":62}}]},"75":{"line":473,"type":"cond-expr","locations":[{"start":{"line":473,"column":42},"end":{"line":473,"column":52}},{"start":{"line":473,"column":55},"end":{"line":473,"column":67}}]},"76":{"line":476,"type":"if","locations":[{"start":{"line":476,"column":2},"end":{"line":476,"column":2}},{"start":{"line":476,"column":2},"end":{"line":476,"column":2}}]},"77":{"line":478,"type":"if","locations":[{"start":{"line":478,"column":9},"end":{"line":478,"column":9}},{"start":{"line":478,"column":9},"end":{"line":478,"column":9}}]},"78":{"line":478,"type":"binary-expr","locations":[{"start":{"line":478,"column":13},"end":{"line":478,"column":46}},{"start":{"line":478,"column":50},"end":{"line":478,"column":72}}]},"79":{"line":479,"type":"if","locations":[{"start":{"line":479,"column":3},"end":{"line":479,"column":3}},{"start":{"line":479,"column":3},"end":{"line":479,"column":3}}]},"80":{"line":499,"type":"if","locations":[{"start":{"line":499,"column":2},"end":{"line":499,"column":2}},{"start":{"line":499,"column":2},"end":{"line":499,"column":2}}]},"81":{"line":502,"type":"if","locations":[{"start":{"line":502,"column":9},"end":{"line":502,"column":9}},{"start":{"line":502,"column":9},"end":{"line":502,"column":9}}]},"82":{"line":503,"type":"binary-expr","locations":[{"start":{"line":503,"column":20},"end":{"line":503,"column":43}},{"start":{"line":503,"column":47},"end":{"line":503,"column":49}}]},"83":{"line":504,"type":"binary-expr","locations":[{"start":{"line":504,"column":38},"end":{"line":504,"column":61}},{"start":{"line":504,"column":65},"end":{"line":504,"column":67}}]},"84":{"line":505,"type":"binary-expr","locations":[{"start":{"line":505,"column":44},"end":{"line":505,"column":68}},{"start":{"line":505,"column":72},"end":{"line":505,"column":74}}]},"85":{"line":506,"type":"binary-expr","locations":[{"start":{"line":506,"column":43},"end":{"line":506,"column":66}},{"start":{"line":506,"column":70},"end":{"line":506,"column":72}}]},"86":{"line":510,"type":"if","locations":[{"start":{"line":510,"column":2},"end":{"line":510,"column":2}},{"start":{"line":510,"column":2},"end":{"line":510,"column":2}}]},"87":{"line":534,"type":"if","locations":[{"start":{"line":534,"column":1},"end":{"line":534,"column":1}},{"start":{"line":534,"column":1},"end":{"line":534,"column":1}}]},"88":{"line":538,"type":"if","locations":[{"start":{"line":538,"column":1},"end":{"line":538,"column":1}},{"start":{"line":538,"column":1},"end":{"line":538,"column":1}}]},"89":{"line":549,"type":"if","locations":[{"start":{"line":549,"column":1},"end":{"line":549,"column":1}},{"start":{"line":549,"column":1},"end":{"line":549,"column":1}}]},"90":{"line":552,"type":"if","locations":[{"start":{"line":552,"column":2},"end":{"line":552,"column":2}},{"start":{"line":552,"column":2},"end":{"line":552,"column":2}}]},"91":{"line":600,"type":"if","locations":[{"start":{"line":600,"column":1},"end":{"line":600,"column":1}},{"start":{"line":600,"column":1},"end":{"line":600,"column":1}}]},"92":{"line":602,"type":"if","locations":[{"start":{"line":602,"column":2},"end":{"line":602,"column":2}},{"start":{"line":602,"column":2},"end":{"line":602,"column":2}}]},"93":{"line":607,"type":"if","locations":[{"start":{"line":607,"column":8},"end":{"line":607,"column":8}},{"start":{"line":607,"column":8},"end":{"line":607,"column":8}}]},"94":{"line":607,"type":"binary-expr","locations":[{"start":{"line":607,"column":12},"end":{"line":607,"column":34}},{"start":{"line":607,"column":38},"end":{"line":607,"column":65}}]},"95":{"line":609,"type":"if","locations":[{"start":{"line":609,"column":2},"end":{"line":609,"column":2}},{"start":{"line":609,"column":2},"end":{"line":609,"column":2}}]},"96":{"line":613,"type":"if","locations":[{"start":{"line":613,"column":3},"end":{"line":613,"column":3}},{"start":{"line":613,"column":3},"end":{"line":613,"column":3}}]},"97":{"line":616,"type":"if","locations":[{"start":{"line":616,"column":8},"end":{"line":616,"column":8}},{"start":{"line":616,"column":8},"end":{"line":616,"column":8}}]},"98":{"line":619,"type":"if","locations":[{"start":{"line":619,"column":3},"end":{"line":619,"column":3}},{"start":{"line":619,"column":3},"end":{"line":619,"column":3}}]},"99":{"line":624,"type":"if","locations":[{"start":{"line":624,"column":2},"end":{"line":624,"column":2}},{"start":{"line":624,"column":2},"end":{"line":624,"column":2}}]},"100":{"line":640,"type":"if","locations":[{"start":{"line":640,"column":2},"end":{"line":640,"column":2}},{"start":{"line":640,"column":2},"end":{"line":640,"column":2}}]},"101":{"line":651,"type":"if","locations":[{"start":{"line":651,"column":5},"end":{"line":651,"column":5}},{"start":{"line":651,"column":5},"end":{"line":651,"column":5}}]},"102":{"line":656,"type":"if","locations":[{"start":{"line":656,"column":3},"end":{"line":656,"column":3}},{"start":{"line":656,"column":3},"end":{"line":656,"column":3}}]},"103":{"line":680,"type":"if","locations":[{"start":{"line":680,"column":1},"end":{"line":680,"column":1}},{"start":{"line":680,"column":1},"end":{"line":680,"column":1}}]},"104":{"line":680,"type":"binary-expr","locations":[{"start":{"line":680,"column":5},"end":{"line":680,"column":27}},{"start":{"line":680,"column":31},"end":{"line":680,"column":58}}]},"105":{"line":682,"type":"binary-expr","locations":[{"start":{"line":682,"column":12},"end":{"line":682,"column":24}},{"start":{"line":682,"column":28},"end":{"line":682,"column":40}}]},"106":{"line":686,"type":"cond-expr","locations":[{"start":{"line":686,"column":47},"end":{"line":686,"column":55}},{"start":{"line":686,"column":58},"end":{"line":686,"column":71}}]},"107":{"line":689,"type":"if","locations":[{"start":{"line":689,"column":2},"end":{"line":689,"column":2}},{"start":{"line":689,"column":2},"end":{"line":689,"column":2}}]},"108":{"line":701,"type":"if","locations":[{"start":{"line":701,"column":2},"end":{"line":701,"column":2}},{"start":{"line":701,"column":2},"end":{"line":701,"column":2}}]},"109":{"line":701,"type":"binary-expr","locations":[{"start":{"line":701,"column":6},"end":{"line":701,"column":31}},{"start":{"line":701,"column":35},"end":{"line":701,"column":67}}]},"110":{"line":705,"type":"if","locations":[{"start":{"line":705,"column":2},"end":{"line":705,"column":2}},{"start":{"line":705,"column":2},"end":{"line":705,"column":2}}]}},"code":["var _ = require('underscore');","var fs = require('fs');","var keystone = require('../');","var mandrillapi = require('mandrill-api');","var mailgunapi = require('mailgun-js');","var juice = require('juice');","var moment = require('moment');","var path = require('path');","var util = require('util');","var utils = require('keystone-utils');","","var templateCache = {};","","// Get view engine","var emailsEngine, emailsEnginelib;","if (keystone.get('custom engine')) {","\temailsEngine = keystone.get('view engine');","\temailsEnginelib = keystone.get('custom engine');","} else {","\temailsEngine = 'jade';","\temailsEnginelib = require('jade');","}","","var defaultConfig = {","\ttemplateExt: emailsEngine,","\ttemplateEngine: emailsEnginelib,","\ttemplateBasePath: path.normalize(path.join(__dirname, '..', 'templates', 'helpers', 'emails')),","};","if (!_.isEqual(keystone.get('email transport'), 'mailgun')) {","\tdefaultConfig.mandrill = {","\t\ttrack_opens: true,","\t\ttrack_clicks: true,","\t\tpreserve_recipients: false,","\t\tinline_css: true,","\t};","\tdefaultConfig.templateMandrillName = null; // Mandrill template","\tdefaultConfig.templateForceHtml = false; // Force html render","}","","/** Custom Errors */","","// TOTO: Uses arguments.callee for the stack trace, which prevents optimisation.","// I've marked these to be ignored by jshint but we should find a better way.","","var ErrorNoEmailTemplateName = function() {","\tError.apply(this, arguments);","\tError.captureStackTrace(this, arguments.callee);","\tthis.message = 'No email templateName specified.';","\tthis.name = 'ErrorNoEmailTemplateName';","};","util.inherits(ErrorNoEmailTemplateName, Error);","","var ErrorEmailsPathNotSet = function() {","\tError.apply(this, arguments);","\tError.captureStackTrace(this, arguments.callee);","\tthis.message = 'Keystone has not been configured for email support. Set the `emails` option in your configuration.';","\tthis.name = 'ErrorEmailsPathNotSet';","};","util.inherits(ErrorEmailsPathNotSet, Error);","","var ErrorEmailOptionsRequired = function() {","\tError.apply(this, arguments);","\tError.captureStackTrace(this, arguments.callee);","\tthis.message = 'The keystone.Email class requires a templateName or options argument to be provided.';","\tthis.name = 'ErrorEmailOptionsRequired';","};","util.inherits(ErrorEmailsPathNotSet, Error);","","/** Helper methods */","","var getEmailsPath = function() {","\tvar path = keystone.getPath('emails');","\tif (path) {","\t\treturn path;","\t}","\tthrow new ErrorEmailsPathNotSet();","};","","function buildAddress (email, name) {","\tif (Array.isArray(email)) {","\t\treturn email.map(function (to) { return to.name + ' <' + to.email + '>'; }).join(',');","\t} else {","\t\treturn name ? name + ' <' + email + '>' : email;","\t}","}","","/**"," * Flatten an object"," * @param  {Object} obj   Source object"," * @param  {String} delim Delimeter"," * @return {Object}       Flat object"," */","var flattenObject = function(obj, delim) {","\tdelim = delim || '_';","\tvar _ret = {};","","\tfor (var key in obj) {","\t\tif (!obj.hasOwnProperty(key)) continue;","","\t\tif ((typeof obj[key]) === 'object' && obj[key] !== null) {","\t\t\tvar _flat = flattenObject(obj[key], delim);","\t\t\tfor (var next in _flat) {","\t\t\t\tif (!_flat.hasOwnProperty(next)) continue;","","\t\t\t\t_ret[key + delim + next] = _flat[next];","\t\t\t}","\t\t} else {","\t\t\t_ret[key] = obj[key];","\t\t}","\t}","\treturn _ret;","};","","/**"," * Converts javascript Objects into"," * Mandrill's vars objects."," *"," * @param  {Mixed}  _var Object to parse"," * @return {Array}       An array of vars"," */","var objToMandrillVars = function (_var) {","\tvar _new = [];","\tif ('object' === typeof _var) {","\t\tvar _flat = flattenObject(_var, '_');","\t\t_.each(_flat, function(value, key) {","\t\t\t_new.push({ name: key, content: value });","\t\t});","\t\treturn _new;","\t}","\treturn _var;","};","","/** CSS Helper methods */","","var templateCSSMethods = {","\tshadeColor: function(color, percent) {","\t\t/* eslint-disable space-infix-ops */","\t\tvar num = parseInt(color.slice(1), 16), amt = Math.round(2.55 * percent), R = (num >> 16) + amt, G = (num >> 8 & 0x00FF) + amt, B = (num & 0x0000FF) + amt;","\t\treturn '#' + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255)).toString(16).slice(1);","\t\t/* eslint-enable */","\t}","};","","","","/**"," * Email Class"," * ==========="," *"," * Helper class for sending emails with Mandrill."," *"," * New instances take a `templatePath` string which must be a folder in the"," * emails path, and must contain either `templateName/email.templateExt` or `templateName.templateExt`"," * which is used as the template for the HTML part of the email."," *"," * Once created, emails can be rendered or sent."," *"," * Requires the `emails` path option and the `mandrill api key` option to be"," * set on Keystone."," *"," * @api public"," */","","var Email = function(options) {","\t// Passing a string will use Email.defaults for everything but template name","\tif ('string' === typeof options) {","\t\toptions = {","\t\t\ttemplateName: options","\t\t};","\t} else if (!utils.isObject(options)) {","\t\tthrow new ErrorEmailOptionsRequired();","\t}","","\tthis.templateMandrillName = options.templateMandrillName;","\tthis.templateMandrillContent = _.isArray(options.templateMandrillContent) ? options.templateMandrillContent : [];","","\tthis.templateName = options.templateName || this.templateMandrillName;","\tthis.templateExt = options.templateExt || Email.defaults.templateExt;","\tthis.templateEngine = options.templateEngine || Email.defaults.templateEngine;","\tthis.templateBasePath = options.templateBasePath || Email.defaults.templateBasePath;","\tthis.templateCompile = options.templateCompile || Email.defaults.templateCompile;","\tthis.templateRender = options.templateRender || Email.defaults.templateRender;","","\tif (!this.templateName) {","\t\tthrow new ErrorNoEmailTemplateName();","\t}","","\treturn this;","","};","","/**"," * Renders the email and passes it to the callback. Used by `email.send()` but"," * can also be called directly to generate a preview."," *"," * @param {Object} locals - object of local variables provided to the template"," * @param {Function} callback(err, email)"," *"," * @api public"," */","","Email.prototype.render = function(locals, callback) {","","\tif ('function' === typeof locals && !callback) {","\t\tcallback = locals;","\t\tlocals = {};","\t}","","\tlocals = ('object' === typeof locals) ? locals : {};","\tcallback = ('function' === typeof callback) ? callback : function() {};","","\tif (keystone.get('email locals')) {","\t\t_.defaults(locals, keystone.get('email locals'));","\t}","","\t_.defaults(locals, {","\t\tpretty: true,","\t\t_: _,","\t\tmoment: moment,","\t\tutils: utils,","\t\tsubject: '(no subject)',","\t\tbrand: keystone.get('brand'),","\t\ttheme: {},","\t\tcss: templateCSSMethods","\t});","","\tif (!locals.theme.buttons) {","\t\tlocals.theme.buttons = {};","\t}","","\tthis.compileTemplate(function(err) {","\t\tif (err) {","\t\t\treturn callback(err);","\t\t}","","\t\tvar html = null;","\t\tvar template = templateCache[this.templateName];","\t\tif (this.templateRender) {","\t\t\thtml = this.templateRender(template, locals);","\t\t} else if (typeof template === 'function') {","\t\t\thtml = template(locals);","\t\t} else if (typeof template.render === 'function') {","\t\t\thtml = template.render(locals);","\t\t} else {","\t\t\treturn callback({","\t\t\t\tfrom: 'Email.compileTemplate',","\t\t\t\tkey: 'invalid rendering function',","\t\t\t\tmessage: 'no template rendering function could be found.',","\t\t\t});","\t\t}","","\t\t// ensure extended characters are replaced","\t\thtml = html.replace(/[\\u007f-\\uffff]/g, function(c) {","\t\t\treturn '&#x' + ('0000' + c.charCodeAt(0).toString(16)).slice(-4) + ';';","\t\t});","","\t\t// process email rules","\t\tvar rules = keystone.get('email rules');","","\t\tif (rules) {","","\t\t\tif (!Array.isArray(rules)) {","\t\t\t\trules = [rules];","\t\t\t}","","\t\t\t_.each(rules, function(rule) {","\t\t\t\tif (rule.find && rule.replace) {","","\t\t\t\t\tvar find = rule.find,","\t\t\t\t\t\treplace = rule.replace;","","\t\t\t\t\tif ('string' === typeof find) {","\t\t\t\t\t\tfind = new RegExp(find, 'gi');","\t\t\t\t\t}","","\t\t\t\t\thtml = html.replace(find, replace);","\t\t\t\t}","\t\t\t});","","\t\t}","","\t\tcallback(null, {","\t\t\tsubject: locals.subject,","\t\t\thtml: html","\t\t});","","\t}.bind(this));","","};","","/**"," * Loads the template. Looks for `templateName.templateExt`, followed by `templateName/email.templateExt`"," *"," * @param {Function} callback(err)"," *"," * @api private"," */","","Email.prototype.loadTemplate = function(callback) {","","\tcallback = ('function' === typeof callback) ? callback : function() {};","","\tvar fsTemplatePath = path.join(Email.getEmailsPath(), this.templateName + '.' + this.templateExt);","","\tfs.readFile(fsTemplatePath, function(err, contents) {","\t\tif (err) {","\t\t\tif (err.code === 'ENOENT') {","\t\t\t\tfsTemplatePath = path.join(Email.getEmailsPath(), this.templateName, 'email.' + this.templateExt);","","\t\t\t\tfs.readFile(fsTemplatePath, function(err, contents) {","\t\t\t\t\tcallback(err, fsTemplatePath, contents);","\t\t\t\t});","","\t\t\t} else {","\t\t\t\treturn callback(err);","\t\t\t}","\t\t} else {","\t\t\treturn callback(err, fsTemplatePath, contents);","\t\t}","","\t}.bind(this));","","};","","/**"," * Ensures the template for the email has been compiled"," *"," * @param {Function} callback(err)"," *"," * @api private"," */","","Email.prototype.compileTemplate = function(callback) {","\tcallback = ('function' === typeof callback) ? callback : function() {};","","\tif (keystone.get('env') === 'production' && templateCache[this.templateName]) {","\t\treturn process.nextTick(callback);","\t}","","\tthis.loadTemplate(function(err, filename, contents) {","\t\tif (err) return callback(err);","","\t\tvar template = null;","\t\tif (this.templateCompile) {","\t\t\ttemplate = this.templateCompile(this.templateEngine, contents.toString(), Email.defaults.compilerOptions, fs.realpathSync(filename));","\t\t} else {","\t\t\ttemplate = this.templateEngine.compile(contents.toString(), Email.defaults.compilerOptions || { filename: fs.realpathSync(filename), basedir: this.templateBasePath }, fs.realpathSync(filename));","\t\t}","","\t\ttemplateCache[this.templateName] = template;","","\t\tcallback();","","\t}.bind(this));","","};","","/**"," * Prepares the email, with or without render"," *"," * @param  {Object}   options  options to render the email"," * @param  {Function} callback(err, message)"," *"," * @api private"," */","Email.prototype.prepare = function(options, callback) {","\tvar locals = options;","","\tif (arguments.length === 3 || !utils.isFunction(callback)) {","\t\tcallback = arguments[2];","\t\toptions = arguments[1] || arguments[0];","\t}","","\tcallback = ('function' === typeof callback) ? callback : function() {};","","\t// Renders an email via Keystone (default behavior)","\tif (!this.templateMandrillName || this.templateForceHtml) {","","\t\tthis.render(locals, function(err, email){","","\t\t\t_.extend(options, email);","\t\t\tthis.buildOptions.call(this, err, options, callback);","\t\t}.bind(this));","\t}","\t// Uses a Mandrill template directly","\telse {","\t\tthis.buildOptions.call(this, null, options, callback);","\t}","};","","/**"," * Build an options object"," *"," * @param  {Object}   options  Input options"," * @param  {Function} callback(err, callback)"," *"," * @api private"," */","Email.prototype.buildOptions = function(err, options, callback) {","\tcallback = ('function' === typeof callback) ? callback : function() {};","","\tif (err) {","\t\treturn callback(err);","\t}","","\tif (!utils.isObject(options)) {","\t\treturn callback({","\t\t\tfrom: 'Email.send',","\t\t\tkey: 'invalid options',","\t\t\tmessage: 'options object is required'","\t\t});","\t}","","\tif ('string' === typeof options.from) {","\t\toptions.fromName = options.from;","\t\toptions.fromEmail = options.from;","\t} else if (utils.isObject(options.from)) {","\t\toptions.fromName = utils.isObject(options.from.name) ? options.from.name.full : options.from.name;","\t\toptions.fromEmail = options.from.email;","\t}","","\tif (!options.fromName || !options.fromEmail) {","\t\treturn callback({","\t\t\tfrom: 'Email.send',","\t\t\tkey: 'invalid options',","\t\t\tmessage: 'options.fromName and options.fromEmail are required'","\t\t});","\t}","\tif (_.isEqual(keystone.get('email transport'), 'mailgun')) {","\t\tif (!options.mailgun) {","\t\t\tif (!keystone.get('mailgun api key')) {","\t\t\t\treturn callback({","\t\t\t\t\tfrom: 'Email.send',","\t\t\t\t\tkey: 'missing api key',","\t\t\t\t\tmessage: 'You must either provide a Mailgun API Instance or set the mandrill api key before sending email.',","\t\t\t\t});","\t\t\t}","\t\t\tvar api_key = keystone.get('mailgun api key');","\t\t\tvar domain = keystone.get('mailgun domain');","\t\t\toptions.mailgun = new mailgunapi({ apiKey: api_key, domain: domain });","\t\t}","\t} else {","\t\tif (!options.mandrill) {","\t\t\tif (!keystone.get('mandrill api key')) {","\t\t\t\treturn callback({","\t\t\t\t\tfrom: 'Email.send',","\t\t\t\t\tkey: 'missing api key',","\t\t\t\t\tmessage: 'You must either provide a Mandrill API Instance or set the mandrill api key before sending email.',","\t\t\t\t});","\t\t\t}","\t\t\toptions.mandrill = new mandrillapi.Mandrill(keystone.get('mandrill api key'));","\t\t}","\t}","","\toptions.tags = utils.isArray(options.tags) ? options.tags : [];","\toptions.tags.push('sent:' + moment().format('YYYY-MM-DD'));","\toptions.tags.push(this.templateName);","","\tif (keystone.get('env') === 'development') {","\t\toptions.tags.push('development');","\t}","","\t/**","\t * Convert and concat globalMergeVars","\t */","\tif (options.globalMergeVars) {","\t\toptions.global_merge_vars = (options.global_merge_vars || []).concat(objToMandrillVars(options.globalMergeVars));","\t}","","\tvar recipients = [];","\tvar mergeVars = [];","","\toptions.to = Array.isArray(options.to) ? options.to : [options.to];","","\tfor (var i = 0; i < options.to.length; i++) {","\t\tif (typeof options.to[i] === 'string') {","\t\t\toptions.to[i] = { email: options.to[i] };","\t\t} else if (typeof options.to[i] === 'object' && options.to[i] !== null) {","\t\t\tif (!options.to[i].email) {","\t\t\t\treturn callback({","\t\t\t\t\tfrom: 'Email.send',","\t\t\t\t\tkey: 'invalid recipient',","\t\t\t\t\tmessage: 'Recipient ' + (i + 1) + ' does not have a valid email address.',","\t\t\t\t});","\t\t\t}","","\t\t} else {","\t\t\treturn callback({","\t\t\t\tfrom: 'Email.send',","\t\t\t\tkey: 'invalid recipient',","\t\t\t\tmessage: 'Recipient ' + (i + 1) + ' is not a string or an object.',","\t\t\t});","","\t\t}","","\t\tvar recipient = { email: options.to[i].email };","\t\tvar vars = [{ name: 'email', content: recipient.email }];","","\t\tif (typeof options.to[i].name === 'string') {","\t\t\trecipient.name = options.to[i].name;","\t\t\tvars.push({ name: 'name', content: options.to[i].name });","\t\t} else if (typeof options.to[i].name === 'object') {","\t\t\trecipient.name = options.to[i].name.full || '';","\t\t\tvars.push({ name: 'name', content: options.to[i].name.full || '' });","\t\t\tvars.push({ name: 'first_name', content: options.to[i].name.first || '' });","\t\t\tvars.push({ name: 'last_name', content: options.to[i].name.last || '' });","\t\t}","","\t\t// Mandrill template","\t\tif (recipient.vars) {","\t\t\tvars.concat(objToMandrillVars(recipient.vars));","\t\t}","","\t\trecipients.push(recipient);","","\t\tmergeVars.push({","\t\t\trcpt: recipient.email,","\t\t\tvars: vars,","\t\t});","\t}","","\tvar message = {","\t\theaders: options.headers,","\t\tfrom_name: options.fromName,","\t\tfrom_email: options.fromEmail,","\t\ttags: options.tags,","\t\tattachments: options.attachments,","\t\tto: recipients,","\t\tglobal_merge_vars: options.global_merge_vars,","\t\tmerge_vars: mergeVars,","\t\tasync: true,","\t};","","\tif (options.subject) {","\t\tmessage.subject = options.subject;","\t}","","\tif (options.html) {","\t\tmessage.html = options.html;","\t}","","\t_.defaults(message, options.mandrillOptions);","\t_.defaults(message, Email.defaults.mandrill);","","\tvar toSend = {","\t\tmessage: message,","\t};","","\tif (this.templateMandrillName) {","\t\ttoSend.template_name = this.templateMandrillName;","\t\ttoSend.template_content = this.templateMandrillContent;","\t\tif (_.isArray(options.templateMandrillContent)) {","\t\t\ttoSend.template_content = toSend.template_content.concat(options.templateMandrillContent);","\t\t}","\t}","","\tcallback(null, toSend);","};","","/**"," * Sends the email"," *"," * Options:"," *"," * - mandrill"," *   Initialised Mandrill API instance"," *"," * - tags"," *   Array of tags to send to Mandrill"," *"," * - to"," *   Object / String or Array of Objects / Strings to send to, e.g."," *   ['jed@team9.com.au', { email: 'jed.watson@gmail.com' }]"," *   { email: 'jed@team9.com.au' }"," *   'jed@team9.com.au'"," *"," * - fromName"," *   Name to send from"," *"," * - fromEmail"," *   Email address to send from"," *"," * - headers"," *   Headers to send through with the email"," *"," * For compatibility with older implementations, send supports providing"," * locals and options objects as the first and second arguments, and the"," * callback as the third."," *"," * @param {Object} options (passed to `email.render()`)"," * @param {Function} callback(err, info)"," *"," * @api private"," */","","Email.prototype.send = function (options, callback) {","\tvar locals = options;","\tvar prepareOptions = [locals];","","\tif (arguments.length === 3) {","\t\t// we expect locals, options, callback","\t\tif (_.isObject(arguments[1])) {","\t\t\tprepareOptions.push(arguments[1]);","\t\t}","\t\tcallback = arguments[2];","","\t} else if (arguments.length === 2 && !utils.isFunction(callback)) {","\t\t// no callback so we expect locals, options","\t\tif (_.isObject(arguments[1])) {","\t\t\tprepareOptions.push(arguments[1]);","\t\t}","\t\tcallback = function(err, info) {// eslint-disable-line no-unused-vars","\t\t\tif (err) console.log(err);","\t\t};","","\t} else if (arguments.length === 1) {","\t\t// we expect options here and it is pushed already","\t\tcallback = function (err, info) { // eslint-disable-line no-unused-vars","\t\t\tif (err) console.log(err);","\t\t};","\t}","","\tprepareOptions.push(function (err, toSend) {","\t\tif (err) {","\t\t\treturn callback(err, null);","\t\t}","","\t\tvar onSuccess = function (info) {","\t\t\tcallback(null, info);","\t\t};","","\t\tvar onFail = function (info) {","\t\t\tcallback({","\t\t\t\tfrom: 'Email.send',","\t\t\t\tkey: 'send error',","\t\t\t\tmessage: 'Email transport encountered an error and did not send the emails.',","\t\t\t\tinfo: info,","\t\t\t});","\t\t};","\t\tif (_.isEqual(keystone.get('email transport'), 'mailgun')) {","\t\t\tvar msg = toSend.message;","\t\t\tvar data = {","\t\t\t\tfrom: buildAddress(msg.from_email, msg.from_name),","\t\t\t\tto: buildAddress(msg.to),","\t\t\t\tsubject: msg.subject,","\t\t\t\thtml: juice(msg.html),","\t\t\t\tattachment: msg.attachments,","\t\t\t};","\t\t\treturn process.nextTick(function () {","\t\t\t\toptions.mailgun.messages().send(data, function (err, body) {","\t\t\t\t\tif (err) return onFail(err);","\t\t\t\t\tonSuccess(body);","\t\t\t\t});","\t\t\t});","\t\t} else {","\t\t\tif (this.templateMandrillName) {","\t\t\t\treturn process.nextTick(function () {","\t\t\t\t\toptions.mandrill.messages.sendTemplate(toSend, onSuccess, onFail);","\t\t\t\t});","\t\t\t} else {","\t\t\t\treturn process.nextTick(function () {","\t\t\t\t\toptions.mandrill.messages.send(toSend, onSuccess, onFail);","\t\t\t\t});","\t\t\t}","\t\t}","\t}.bind(this));","","\tthis.prepare.apply(this, prepareOptions);","};","","/**"," * Renders a Mandrill template"," * @param  {Object}   options  Same options that sendTemplate"," * @param  {Function} callback(err, info)"," */","Email.prototype.renderMandrill = function (options, callback) {","\tvar locals = options;","\tvar prepareOptions = [locals];","","\tif (arguments.length === 3 || !utils.isFunction(callback)) {","\t\tcallback = arguments[2];","\t\toptions = arguments[1] || arguments[0];","\t\tprepareOptions.push(options);","\t}","","\tcallback = ('function' === typeof callback) ? callback : function() {};","","\tprepareOptions.push(function (err, toSend) {","\t\tif (err) {","\t\t\treturn callback(err, null);","\t\t}","","\t\t/**","\t\t * The object sent to render is not the same as for the sendTemplate","\t\t * method, so it needs to be changed accordingly.","\t\t *","\t\t * https://mandrillapp.com/api/docs/templates.JSON.html#method=render","\t\t * https://mandrillapp.com/api/docs/messages.JSON.html#method=send-template","\t\t */","","\t\tif (toSend.message.merge_vars && toSend.message.merge_vars.length) {","\t\t\ttoSend.merge_vars = toSend.message.merge_vars[0].vars;","\t\t}","","\t\tif (toSend.message.global_merge_vars) {","\t\t\ttoSend.global_merge_vars = toSend.message.global_merge_vars;","\t\t}","","\t\tvar onSuccess = function (info) {","\t\t\tcallback(null, info);","\t\t};","","\t\tvar onFail = function (info) {","\t\t\tcallback({","\t\t\t\tfrom: 'Email.renderMandrill',","\t\t\t\tkey: 'render error',","\t\t\t\tmessage: 'Mandrill encountered an error rendering the email.',","\t\t\t\tinfo: info,","\t\t\t});","\t\t};","","\t\toptions.mandrill.templates.render(toSend, onSuccess, onFail);","\t});","","\tthis.prepare.apply(this, prepareOptions);","};","","Email.getEmailsPath = getEmailsPath;","Email.templateCache = templateCache;","Email.templateCSSMethods = templateCSSMethods;","Email.defaults = defaultConfig;","","exports = module.exports = Email;",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"12":1,"15":1,"16":1,"17":0,"18":0,"20":1,"21":1,"24":1,"29":1,"30":1,"36":1,"37":1,"45":1,"46":0,"47":0,"48":0,"49":0,"51":1,"53":1,"54":0,"55":0,"56":0,"57":0,"59":1,"61":1,"62":0,"63":0,"64":0,"65":0,"67":1,"71":1,"72":0,"73":0,"74":0,"76":0,"79":1,"80":0,"81":0,"83":0,"93":1,"94":0,"95":0,"97":0,"98":0,"100":0,"101":0,"102":0,"103":0,"105":0,"108":0,"111":0,"121":1,"122":0,"123":0,"124":0,"125":0,"126":0,"128":0,"130":0,"135":1,"138":0,"139":0,"164":1,"166":0,"167":0,"170":0,"171":0,"174":0,"175":0,"177":0,"178":0,"179":0,"180":0,"181":0,"182":0,"184":0,"185":0,"188":0,"202":1,"204":0,"205":0,"206":0,"209":0,"210":0,"212":0,"213":0,"216":0,"227":0,"228":0,"231":0,"232":0,"233":0,"236":0,"237":0,"238":0,"239":0,"240":0,"241":0,"242":0,"243":0,"245":0,"253":0,"254":0,"258":0,"260":0,"262":0,"263":0,"266":0,"267":0,"269":0,"272":0,"273":0,"276":0,"282":0,"299":1,"301":0,"303":0,"305":0,"306":0,"307":0,"308":0,"310":0,"311":0,"315":0,"318":0,"333":1,"334":0,"336":0,"337":0,"340":0,"341":0,"343":0,"344":0,"345":0,"347":0,"350":0,"352":0,"366":1,"367":0,"369":0,"370":0,"371":0,"374":0,"377":0,"379":0,"381":0,"382":0,"387":0,"399":1,"400":0,"402":0,"403":0,"406":0,"407":0,"414":0,"415":0,"416":0,"417":0,"418":0,"419":0,"422":0,"423":0,"429":0,"430":0,"431":0,"432":0,"438":0,"439":0,"440":0,"443":0,"444":0,"445":0,"451":0,"455":0,"456":0,"457":0,"459":0,"460":0,"466":0,"467":0,"470":0,"471":0,"473":0,"475":0,"476":0,"477":0,"478":0,"479":0,"480":0,"488":0,"496":0,"497":0,"499":0,"500":0,"501":0,"502":0,"503":0,"504":0,"505":0,"506":0,"510":0,"511":0,"514":0,"516":0,"522":0,"534":0,"535":0,"538":0,"539":0,"542":0,"543":0,"545":0,"549":0,"550":0,"551":0,"552":0,"553":0,"557":0,"596":1,"597":0,"598":0,"600":0,"602":0,"603":0,"605":0,"607":0,"609":0,"610":0,"612":0,"613":0,"616":0,"618":0,"619":0,"623":0,"624":0,"625":0,"628":0,"629":0,"632":0,"633":0,"640":0,"641":0,"642":0,"649":0,"650":0,"651":0,"652":0,"656":0,"657":0,"658":0,"661":0,"662":0,"668":0,"676":1,"677":0,"678":0,"680":0,"681":0,"682":0,"683":0,"686":0,"688":0,"689":0,"690":0,"701":0,"702":0,"705":0,"706":0,"709":0,"710":0,"713":0,"714":0,"722":0,"725":0,"728":1,"729":1,"730":1,"731":1,"733":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/Type.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/Type.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":1,"49":0,"50":1,"51":0,"52":1,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":1,"91":1,"92":0,"93":1,"94":0,"95":1,"96":0,"97":1,"98":0,"99":1,"100":0,"101":1,"102":0,"103":1,"104":0,"105":1,"106":0,"107":1,"108":0,"109":1,"110":0,"111":1,"112":0,"113":1,"114":0,"115":1,"116":0,"117":0,"118":0,"119":1,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":1,"130":0,"131":0,"132":1,"133":0,"134":1,"135":0,"136":1,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":1,"146":0,"147":0,"148":0,"149":1,"150":0},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0],"16":[0,0],"17":[0,0,0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0},"fnMap":{"1":{"name":"Field","line":38,"loc":{"start":{"line":38,"column":0},"end":{"line":38,"column":36}}},"2":{"name":"(anonymous_2)","line":76,"loc":{"start":{"line":76,"column":7},"end":{"line":76,"column":18}}},"3":{"name":"(anonymous_3)","line":86,"loc":{"start":{"line":86,"column":29},"end":{"line":86,"column":40}}},"4":{"name":"(anonymous_4)","line":93,"loc":{"start":{"line":93,"column":21},"end":{"line":93,"column":35}}},"5":{"name":"(anonymous_5)","line":113,"loc":{"start":{"line":113,"column":26},"end":{"line":113,"column":37}}},"6":{"name":"(anonymous_6)","line":127,"loc":{"start":{"line":127,"column":34},"end":{"line":127,"column":45}}},"7":{"name":"(anonymous_7)","line":134,"loc":{"start":{"line":134,"column":26},"end":{"line":134,"column":41}}},"8":{"name":"(anonymous_8)","line":141,"loc":{"start":{"line":141,"column":36},"end":{"line":141,"column":47}}},"9":{"name":"(anonymous_9)","line":147,"loc":{"start":{"line":147,"column":15},"end":{"line":147,"column":26}}},"10":{"name":"(anonymous_10)","line":156,"loc":{"start":{"line":156,"column":16},"end":{"line":156,"column":31}}},"11":{"name":"(anonymous_11)","line":158,"loc":{"start":{"line":158,"column":32},"end":{"line":158,"column":47}}},"12":{"name":"(anonymous_12)","line":164,"loc":{"start":{"line":164,"column":16},"end":{"line":164,"column":31}}},"13":{"name":"(anonymous_13)","line":166,"loc":{"start":{"line":166,"column":32},"end":{"line":166,"column":54}}},"14":{"name":"(anonymous_14)","line":186,"loc":{"start":{"line":186,"column":8},"end":{"line":186,"column":23}}},"15":{"name":"(anonymous_15)","line":190,"loc":{"start":{"line":190,"column":37},"end":{"line":190,"column":55}}},"16":{"name":"(anonymous_16)","line":205,"loc":{"start":{"line":205,"column":54},"end":{"line":205,"column":65}}},"17":{"name":"(anonymous_17)","line":206,"loc":{"start":{"line":206,"column":57},"end":{"line":206,"column":68}}},"18":{"name":"(anonymous_18)","line":207,"loc":{"start":{"line":207,"column":58},"end":{"line":207,"column":69}}},"19":{"name":"(anonymous_19)","line":208,"loc":{"start":{"line":208,"column":54},"end":{"line":208,"column":65}}},"20":{"name":"(anonymous_20)","line":209,"loc":{"start":{"line":209,"column":53},"end":{"line":209,"column":64}}},"21":{"name":"(anonymous_21)","line":210,"loc":{"start":{"line":210,"column":56},"end":{"line":210,"column":67}}},"22":{"name":"(anonymous_22)","line":211,"loc":{"start":{"line":211,"column":55},"end":{"line":211,"column":66}}},"23":{"name":"(anonymous_23)","line":212,"loc":{"start":{"line":212,"column":56},"end":{"line":212,"column":67}}},"24":{"name":"(anonymous_24)","line":213,"loc":{"start":{"line":213,"column":58},"end":{"line":213,"column":69}}},"25":{"name":"(anonymous_25)","line":214,"loc":{"start":{"line":214,"column":58},"end":{"line":214,"column":69}}},"26":{"name":"(anonymous_26)","line":215,"loc":{"start":{"line":215,"column":56},"end":{"line":215,"column":67}}},"27":{"name":"(anonymous_27)","line":216,"loc":{"start":{"line":216,"column":59},"end":{"line":216,"column":70}}},"28":{"name":"(anonymous_28)","line":224,"loc":{"start":{"line":224,"column":30},"end":{"line":224,"column":41}}},"29":{"name":"(anonymous_29)","line":230,"loc":{"start":{"line":230,"column":40},"end":{"line":230,"column":58}}},"30":{"name":"(anonymous_30)","line":234,"loc":{"start":{"line":234,"column":101},"end":{"line":234,"column":118}}},"31":{"name":"(anonymous_31)","line":241,"loc":{"start":{"line":241,"column":36},"end":{"line":241,"column":47}}},"32":{"name":"(anonymous_32)","line":254,"loc":{"start":{"line":254,"column":35},"end":{"line":254,"column":54}}},"33":{"name":"(anonymous_33)","line":255,"loc":{"start":{"line":255,"column":52},"end":{"line":255,"column":63}}},"34":{"name":"(anonymous_34)","line":266,"loc":{"start":{"line":266,"column":25},"end":{"line":266,"column":40}}},"35":{"name":"(anonymous_35)","line":276,"loc":{"start":{"line":276,"column":29},"end":{"line":276,"column":44}}},"36":{"name":"(anonymous_36)","line":286,"loc":{"start":{"line":286,"column":32},"end":{"line":286,"column":63}}},"37":{"name":"(anonymous_37)","line":303,"loc":{"start":{"line":303,"column":29},"end":{"line":303,"column":50}}},"38":{"name":"(anonymous_38)","line":316,"loc":{"start":{"line":316,"column":35},"end":{"line":316,"column":50}}}},"statementMap":{"1":{"start":{"line":4,"column":0},"end":{"line":4,"column":30}},"2":{"start":{"line":5,"column":0},"end":{"line":5,"column":28}},"3":{"start":{"line":6,"column":0},"end":{"line":6,"column":31}},"4":{"start":{"line":7,"column":0},"end":{"line":7,"column":37}},"5":{"start":{"line":8,"column":0},"end":{"line":8,"column":38}},"6":{"start":{"line":10,"column":0},"end":{"line":28,"column":2}},"7":{"start":{"line":38,"column":0},"end":{"line":81,"column":1}},"8":{"start":{"line":41,"column":1},"end":{"line":41,"column":18}},"9":{"start":{"line":42,"column":1},"end":{"line":42,"column":29}},"10":{"start":{"line":43,"column":1},"end":{"line":43,"column":18}},"11":{"start":{"line":45,"column":1},"end":{"line":45,"column":35}},"12":{"start":{"line":46,"column":1},"end":{"line":46,"column":54}},"13":{"start":{"line":47,"column":1},"end":{"line":47,"column":59}},"14":{"start":{"line":48,"column":1},"end":{"line":48,"column":85}},"15":{"start":{"line":51,"column":1},"end":{"line":51,"column":25}},"16":{"start":{"line":52,"column":1},"end":{"line":52,"column":20}},"17":{"start":{"line":55,"column":1},"end":{"line":66,"column":2}},"18":{"start":{"line":62,"column":2},"end":{"line":64,"column":109}},"19":{"start":{"line":65,"column":2},"end":{"line":65,"column":18}},"20":{"start":{"line":69,"column":1},"end":{"line":71,"column":2}},"21":{"start":{"line":70,"column":2},"end":{"line":70,"column":57}},"22":{"start":{"line":74,"column":1},"end":{"line":74,"column":17}},"23":{"start":{"line":75,"column":1},"end":{"line":79,"column":4}},"24":{"start":{"line":77,"column":3},"end":{"line":77,"column":97}},"25":{"start":{"line":86,"column":0},"end":{"line":107,"column":2}},"26":{"start":{"line":87,"column":1},"end":{"line":105,"column":2}},"27":{"start":{"line":88,"column":2},"end":{"line":88,"column":22}},"28":{"start":{"line":89,"column":2},"end":{"line":89,"column":39}},"29":{"start":{"line":90,"column":2},"end":{"line":92,"column":3}},"30":{"start":{"line":91,"column":3},"end":{"line":91,"column":52}},"31":{"start":{"line":93,"column":2},"end":{"line":99,"column":11}},"32":{"start":{"line":94,"column":3},"end":{"line":98,"column":4}},"33":{"start":{"line":95,"column":4},"end":{"line":95,"column":36}},"34":{"start":{"line":96,"column":10},"end":{"line":98,"column":4}},"35":{"start":{"line":97,"column":4},"end":{"line":97,"column":44}},"36":{"start":{"line":100,"column":2},"end":{"line":102,"column":3}},"37":{"start":{"line":101,"column":3},"end":{"line":101,"column":50}},"38":{"start":{"line":103,"column":2},"end":{"line":103,"column":72}},"39":{"start":{"line":104,"column":2},"end":{"line":104,"column":55}},"40":{"start":{"line":106,"column":1},"end":{"line":106,"column":23}},"41":{"start":{"line":113,"column":0},"end":{"line":122,"column":2}},"42":{"start":{"line":114,"column":1},"end":{"line":120,"column":2}},"43":{"start":{"line":115,"column":2},"end":{"line":115,"column":72}},"44":{"start":{"line":116,"column":2},"end":{"line":118,"column":3}},"45":{"start":{"line":117,"column":3},"end":{"line":117,"column":39}},"46":{"start":{"line":119,"column":2},"end":{"line":119,"column":21}},"47":{"start":{"line":121,"column":1},"end":{"line":121,"column":20}},"48":{"start":{"line":127,"column":0},"end":{"line":129,"column":2}},"49":{"start":{"line":128,"column":1},"end":{"line":128,"column":35}},"50":{"start":{"line":134,"column":0},"end":{"line":136,"column":2}},"51":{"start":{"line":135,"column":1},"end":{"line":135,"column":28}},"52":{"start":{"line":141,"column":0},"end":{"line":201,"column":2}},"53":{"start":{"line":142,"column":1},"end":{"line":142,"column":18}},"54":{"start":{"line":143,"column":1},"end":{"line":143,"column":16}},"55":{"start":{"line":145,"column":1},"end":{"line":172,"column":2}},"56":{"start":{"line":147,"column":2},"end":{"line":147,"column":43}},"57":{"start":{"line":147,"column":28},"end":{"line":147,"column":40}},"58":{"start":{"line":150,"column":2},"end":{"line":152,"column":3}},"59":{"start":{"line":151,"column":3},"end":{"line":151,"column":54}},"60":{"start":{"line":153,"column":2},"end":{"line":171,"column":3}},"61":{"start":{"line":154,"column":3},"end":{"line":154,"column":35}},"62":{"start":{"line":155,"column":9},"end":{"line":171,"column":3}},"63":{"start":{"line":156,"column":3},"end":{"line":162,"column":5}},"64":{"start":{"line":157,"column":4},"end":{"line":157,"column":21}},"65":{"start":{"line":158,"column":4},"end":{"line":160,"column":7}},"66":{"start":{"line":159,"column":5},"end":{"line":159,"column":44}},"67":{"start":{"line":159,"column":32},"end":{"line":159,"column":44}},"68":{"start":{"line":161,"column":4},"end":{"line":161,"column":16}},"69":{"start":{"line":163,"column":9},"end":{"line":171,"column":3}},"70":{"start":{"line":164,"column":3},"end":{"line":170,"column":5}},"71":{"start":{"line":165,"column":4},"end":{"line":165,"column":21}},"72":{"start":{"line":166,"column":4},"end":{"line":168,"column":7}},"73":{"start":{"line":167,"column":5},"end":{"line":167,"column":72}},"74":{"start":{"line":167,"column":60},"end":{"line":167,"column":72}},"75":{"start":{"line":169,"column":4},"end":{"line":169,"column":16}},"76":{"start":{"line":174,"column":1},"end":{"line":178,"column":2}},"77":{"start":{"line":175,"column":2},"end":{"line":176,"column":128}},"78":{"start":{"line":177,"column":2},"end":{"line":177,"column":18}},"79":{"start":{"line":180,"column":1},"end":{"line":184,"column":2}},"80":{"start":{"line":181,"column":2},"end":{"line":182,"column":110}},"81":{"start":{"line":183,"column":2},"end":{"line":183,"column":18}},"82":{"start":{"line":186,"column":1},"end":{"line":199,"column":3}},"83":{"start":{"line":187,"column":2},"end":{"line":189,"column":3}},"84":{"start":{"line":188,"column":3},"end":{"line":188,"column":17}},"85":{"start":{"line":190,"column":2},"end":{"line":198,"column":16}},"86":{"start":{"line":191,"column":3},"end":{"line":196,"column":4}},"87":{"start":{"line":192,"column":4},"end":{"line":193,"column":122}},"88":{"start":{"line":195,"column":4},"end":{"line":195,"column":30}},"89":{"start":{"line":197,"column":3},"end":{"line":197,"column":10}},"90":{"start":{"line":202,"column":0},"end":{"line":202,"column":33}},"91":{"start":{"line":205,"column":0},"end":{"line":205,"column":95}},"92":{"start":{"line":205,"column":67},"end":{"line":205,"column":89}},"93":{"start":{"line":206,"column":0},"end":{"line":206,"column":113}},"94":{"start":{"line":206,"column":70},"end":{"line":206,"column":107}},"95":{"start":{"line":207,"column":0},"end":{"line":207,"column":115}},"96":{"start":{"line":207,"column":71},"end":{"line":207,"column":109}},"97":{"start":{"line":208,"column":0},"end":{"line":208,"column":104}},"98":{"start":{"line":208,"column":67},"end":{"line":208,"column":98}},"99":{"start":{"line":209,"column":0},"end":{"line":209,"column":105}},"100":{"start":{"line":209,"column":66},"end":{"line":209,"column":99}},"101":{"start":{"line":210,"column":0},"end":{"line":210,"column":111}},"102":{"start":{"line":210,"column":69},"end":{"line":210,"column":105}},"103":{"start":{"line":211,"column":0},"end":{"line":211,"column":109}},"104":{"start":{"line":211,"column":68},"end":{"line":211,"column":103}},"105":{"start":{"line":212,"column":0},"end":{"line":212,"column":111}},"106":{"start":{"line":212,"column":69},"end":{"line":212,"column":105}},"107":{"start":{"line":213,"column":0},"end":{"line":213,"column":115}},"108":{"start":{"line":213,"column":71},"end":{"line":213,"column":109}},"109":{"start":{"line":214,"column":0},"end":{"line":214,"column":115}},"110":{"start":{"line":214,"column":71},"end":{"line":214,"column":109}},"111":{"start":{"line":215,"column":0},"end":{"line":215,"column":111}},"112":{"start":{"line":215,"column":69},"end":{"line":215,"column":105}},"113":{"start":{"line":216,"column":0},"end":{"line":216,"column":117}},"114":{"start":{"line":216,"column":72},"end":{"line":216,"column":111}},"115":{"start":{"line":224,"column":0},"end":{"line":228,"column":2}},"116":{"start":{"line":225,"column":1},"end":{"line":225,"column":100}},"117":{"start":{"line":226,"column":1},"end":{"line":226,"column":39}},"118":{"start":{"line":227,"column":1},"end":{"line":227,"column":30}},"119":{"start":{"line":230,"column":0},"end":{"line":246,"column":2}},"120":{"start":{"line":231,"column":1},"end":{"line":231,"column":18}},"121":{"start":{"line":234,"column":1},"end":{"line":245,"column":4}},"122":{"start":{"line":235,"column":2},"end":{"line":237,"column":3}},"123":{"start":{"line":236,"column":3},"end":{"line":236,"column":39}},"124":{"start":{"line":238,"column":2},"end":{"line":240,"column":3}},"125":{"start":{"line":239,"column":3},"end":{"line":239,"column":142}},"126":{"start":{"line":241,"column":2},"end":{"line":244,"column":5}},"127":{"start":{"line":242,"column":3},"end":{"line":242,"column":67}},"128":{"start":{"line":243,"column":3},"end":{"line":243,"column":46}},"129":{"start":{"line":254,"column":0},"end":{"line":258,"column":2}},"130":{"start":{"line":255,"column":1},"end":{"line":257,"column":4}},"131":{"start":{"line":256,"column":2},"end":{"line":256,"column":35}},"132":{"start":{"line":266,"column":0},"end":{"line":268,"column":2}},"133":{"start":{"line":267,"column":1},"end":{"line":267,"column":28}},"134":{"start":{"line":276,"column":0},"end":{"line":278,"column":2}},"135":{"start":{"line":277,"column":1},"end":{"line":277,"column":35}},"136":{"start":{"line":286,"column":0},"end":{"line":295,"column":2}},"137":{"start":{"line":287,"column":1},"end":{"line":287,"column":28}},"138":{"start":{"line":287,"column":16},"end":{"line":287,"column":28}},"139":{"start":{"line":288,"column":1},"end":{"line":288,"column":41}},"140":{"start":{"line":289,"column":1},"end":{"line":289,"column":69}},"141":{"start":{"line":289,"column":57},"end":{"line":289,"column":69}},"142":{"start":{"line":290,"column":1},"end":{"line":294,"column":2}},"143":{"start":{"line":291,"column":2},"end":{"line":291,"column":49}},"144":{"start":{"line":293,"column":2},"end":{"line":293,"column":42}},"145":{"start":{"line":303,"column":0},"end":{"line":309,"column":2}},"146":{"start":{"line":304,"column":1},"end":{"line":304,"column":41}},"147":{"start":{"line":306,"column":1},"end":{"line":308,"column":2}},"148":{"start":{"line":307,"column":2},"end":{"line":307,"column":29}},"149":{"start":{"line":316,"column":0},"end":{"line":318,"column":2}},"150":{"start":{"line":317,"column":1},"end":{"line":317,"column":67}}},"branchMap":{"1":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":14},"end":{"line":47,"column":27}},{"start":{"line":47,"column":31},"end":{"line":47,"column":58}}]},"2":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":24},"end":{"line":48,"column":47}},{"start":{"line":48,"column":51},"end":{"line":48,"column":71}},{"start":{"line":48,"column":75},"end":{"line":48,"column":84}}]},"3":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},{"start":{"line":55,"column":1},"end":{"line":55,"column":1}}]},"4":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":5},"end":{"line":55,"column":26}},{"start":{"line":56,"column":8},"end":{"line":56,"column":42}},{"start":{"line":57,"column":8},"end":{"line":57,"column":42}},{"start":{"line":58,"column":8},"end":{"line":58,"column":27}},{"start":{"line":59,"column":8},"end":{"line":59,"column":34}},{"start":{"line":60,"column":8},"end":{"line":60,"column":45}}]},"5":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},{"start":{"line":69,"column":1},"end":{"line":69,"column":1}}]},"6":{"line":77,"type":"cond-expr","locations":[{"start":{"line":77,"column":29},"end":{"line":77,"column":88}},{"start":{"line":77,"column":92},"end":{"line":77,"column":96}}]},"7":{"line":77,"type":"cond-expr","locations":[{"start":{"line":77,"column":58},"end":{"line":77,"column":83}},{"start":{"line":77,"column":86},"end":{"line":77,"column":88}}]},"8":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},{"start":{"line":87,"column":1},"end":{"line":87,"column":1}}]},"9":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":2},"end":{"line":90,"column":2}},{"start":{"line":90,"column":2},"end":{"line":90,"column":2}}]},"10":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":3},"end":{"line":94,"column":3}},{"start":{"line":94,"column":3},"end":{"line":94,"column":3}}]},"11":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":10},"end":{"line":96,"column":10}},{"start":{"line":96,"column":10},"end":{"line":96,"column":10}}]},"12":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":2},"end":{"line":100,"column":2}},{"start":{"line":100,"column":2},"end":{"line":100,"column":2}}]},"13":{"line":103,"type":"cond-expr","locations":[{"start":{"line":103,"column":59},"end":{"line":103,"column":63}},{"start":{"line":103,"column":66},"end":{"line":103,"column":71}}]},"14":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},{"start":{"line":114,"column":1},"end":{"line":114,"column":1}}]},"15":{"line":115,"type":"binary-expr","locations":[{"start":{"line":115,"column":13},"end":{"line":115,"column":28}},{"start":{"line":115,"column":32},"end":{"line":115,"column":49}},{"start":{"line":115,"column":53},"end":{"line":115,"column":71}}]},"16":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":2},"end":{"line":116,"column":2}},{"start":{"line":116,"column":2},"end":{"line":116,"column":2}}]},"17":{"line":116,"type":"binary-expr","locations":[{"start":{"line":116,"column":6},"end":{"line":116,"column":22}},{"start":{"line":116,"column":26},"end":{"line":116,"column":43}},{"start":{"line":116,"column":47},"end":{"line":116,"column":63}},{"start":{"line":116,"column":67},"end":{"line":116,"column":82}}]},"18":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":10},"end":{"line":117,"column":27}},{"start":{"line":117,"column":31},"end":{"line":117,"column":38}}]},"19":{"line":128,"type":"binary-expr","locations":[{"start":{"line":128,"column":8},"end":{"line":128,"column":28}},{"start":{"line":128,"column":32},"end":{"line":128,"column":34}}]},"20":{"line":145,"type":"if","locations":[{"start":{"line":145,"column":1},"end":{"line":145,"column":1}},{"start":{"line":145,"column":1},"end":{"line":145,"column":1}}]},"21":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":2},"end":{"line":150,"column":2}},{"start":{"line":150,"column":2},"end":{"line":150,"column":2}}]},"22":{"line":153,"type":"if","locations":[{"start":{"line":153,"column":2},"end":{"line":153,"column":2}},{"start":{"line":153,"column":2},"end":{"line":153,"column":2}}]},"23":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":9},"end":{"line":155,"column":9}},{"start":{"line":155,"column":9},"end":{"line":155,"column":9}}]},"24":{"line":159,"type":"if","locations":[{"start":{"line":159,"column":5},"end":{"line":159,"column":5}},{"start":{"line":159,"column":5},"end":{"line":159,"column":5}}]},"25":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":9},"end":{"line":163,"column":9}},{"start":{"line":163,"column":9},"end":{"line":163,"column":9}}]},"26":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":5},"end":{"line":167,"column":5}},{"start":{"line":167,"column":5},"end":{"line":167,"column":5}}]},"27":{"line":167,"type":"binary-expr","locations":[{"start":{"line":167,"column":9},"end":{"line":167,"column":30}},{"start":{"line":167,"column":34},"end":{"line":167,"column":58}}]},"28":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},{"start":{"line":174,"column":1},"end":{"line":174,"column":1}}]},"29":{"line":180,"type":"if","locations":[{"start":{"line":180,"column":1},"end":{"line":180,"column":1}},{"start":{"line":180,"column":1},"end":{"line":180,"column":1}}]},"30":{"line":187,"type":"if","locations":[{"start":{"line":187,"column":2},"end":{"line":187,"column":2}},{"start":{"line":187,"column":2},"end":{"line":187,"column":2}}]},"31":{"line":191,"type":"if","locations":[{"start":{"line":191,"column":3},"end":{"line":191,"column":3}},{"start":{"line":191,"column":3},"end":{"line":191,"column":3}}]},"32":{"line":206,"type":"binary-expr","locations":[{"start":{"line":206,"column":77},"end":{"line":206,"column":97}},{"start":{"line":206,"column":101},"end":{"line":206,"column":106}}]},"33":{"line":207,"type":"binary-expr","locations":[{"start":{"line":207,"column":78},"end":{"line":207,"column":99}},{"start":{"line":207,"column":103},"end":{"line":207,"column":108}}]},"34":{"line":208,"type":"binary-expr","locations":[{"start":{"line":208,"column":74},"end":{"line":208,"column":91}},{"start":{"line":208,"column":95},"end":{"line":208,"column":97}}]},"35":{"line":209,"type":"binary-expr","locations":[{"start":{"line":209,"column":73},"end":{"line":209,"column":89}},{"start":{"line":209,"column":93},"end":{"line":209,"column":98}}]},"36":{"line":210,"type":"binary-expr","locations":[{"start":{"line":210,"column":76},"end":{"line":210,"column":95}},{"start":{"line":210,"column":99},"end":{"line":210,"column":104}}]},"37":{"line":211,"type":"binary-expr","locations":[{"start":{"line":211,"column":75},"end":{"line":211,"column":93}},{"start":{"line":211,"column":97},"end":{"line":211,"column":102}}]},"38":{"line":212,"type":"binary-expr","locations":[{"start":{"line":212,"column":76},"end":{"line":212,"column":95}},{"start":{"line":212,"column":99},"end":{"line":212,"column":104}}]},"39":{"line":213,"type":"binary-expr","locations":[{"start":{"line":213,"column":78},"end":{"line":213,"column":99}},{"start":{"line":213,"column":103},"end":{"line":213,"column":108}}]},"40":{"line":214,"type":"binary-expr","locations":[{"start":{"line":214,"column":78},"end":{"line":214,"column":99}},{"start":{"line":214,"column":103},"end":{"line":214,"column":108}}]},"41":{"line":215,"type":"binary-expr","locations":[{"start":{"line":215,"column":76},"end":{"line":215,"column":95}},{"start":{"line":215,"column":99},"end":{"line":215,"column":104}}]},"42":{"line":216,"type":"binary-expr","locations":[{"start":{"line":216,"column":79},"end":{"line":216,"column":101}},{"start":{"line":216,"column":105},"end":{"line":216,"column":110}}]},"43":{"line":225,"type":"cond-expr","locations":[{"start":{"line":225,"column":32},"end":{"line":225,"column":84}},{"start":{"line":225,"column":87},"end":{"line":225,"column":99}}]},"44":{"line":234,"type":"binary-expr","locations":[{"start":{"line":234,"column":2},"end":{"line":234,"column":25}},{"start":{"line":234,"column":29},"end":{"line":234,"column":31}}]},"45":{"line":234,"type":"binary-expr","locations":[{"start":{"line":234,"column":77},"end":{"line":234,"column":84}},{"start":{"line":234,"column":88},"end":{"line":234,"column":90}}]},"46":{"line":235,"type":"if","locations":[{"start":{"line":235,"column":2},"end":{"line":235,"column":2}},{"start":{"line":235,"column":2},"end":{"line":235,"column":2}}]},"47":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":2},"end":{"line":238,"column":2}},{"start":{"line":238,"column":2},"end":{"line":238,"column":2}}]},"48":{"line":287,"type":"if","locations":[{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},{"start":{"line":287,"column":1},"end":{"line":287,"column":1}}]},"49":{"line":289,"type":"if","locations":[{"start":{"line":289,"column":1},"end":{"line":289,"column":1}},{"start":{"line":289,"column":1},"end":{"line":289,"column":1}}]},"50":{"line":289,"type":"binary-expr","locations":[{"start":{"line":289,"column":5},"end":{"line":289,"column":24}},{"start":{"line":289,"column":28},"end":{"line":289,"column":32}},{"start":{"line":289,"column":36},"end":{"line":289,"column":55}}]},"51":{"line":290,"type":"if","locations":[{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},{"start":{"line":290,"column":1},"end":{"line":290,"column":1}}]},"52":{"line":291,"type":"cond-expr","locations":[{"start":{"line":291,"column":36},"end":{"line":291,"column":40}},{"start":{"line":291,"column":43},"end":{"line":291,"column":48}}]},"53":{"line":293,"type":"cond-expr","locations":[{"start":{"line":293,"column":29},"end":{"line":293,"column":33}},{"start":{"line":293,"column":36},"end":{"line":293,"column":41}}]},"54":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},{"start":{"line":306,"column":1},"end":{"line":306,"column":1}}]},"55":{"line":306,"type":"binary-expr","locations":[{"start":{"line":306,"column":5},"end":{"line":306,"column":24}},{"start":{"line":306,"column":28},"end":{"line":306,"column":56}}]},"56":{"line":317,"type":"cond-expr","locations":[{"start":{"line":317,"column":28},"end":{"line":317,"column":43}},{"start":{"line":317,"column":46},"end":{"line":317,"column":66}}]}},"code":["/*!"," * Module dependencies."," */","var _ = require('underscore');","var di = require('asyncdi');","var marked = require('marked');","var Path = require('../../lib/path');","var utils = require('keystone-utils');","","var DEFAULT_OPTION_KEYS = [","\t'path',","\t'paths',","\t'type',","\t'label',","\t'note',","\t'size',","\t'initial',","\t'required',","\t'col',","\t'noedit',","\t'nocol',","\t'nosort',","\t'nofilter',","\t'indent',","\t'hidden',","\t'collapse',","\t'dependsOn'","];","","/**"," * Field Constructor"," * ================="," *"," * Extended by fieldType Classes, should not be used directly."," *"," * @api public"," */","function Field(list, path, options) {","","\t// Set field properties and options","\tthis.list = list;","\tthis._path = new Path(path);","\tthis.path = path;","","\tthis.type = this.constructor.name;","\tthis.options = utils.options(this.defaults, options);","\tthis.label = options.label || utils.keyToLabel(this.path);","\tthis.typeDescription = options.typeDescription || this.typeDescription || this.type;","","\t// Add the field to the schema","\tthis.list.automap(this);","\tthis.addToSchema();","","\t// Warn on required fields that aren't initial","\tif (this.options.required &&","        this.options.initial === undefined &&","        this.options.default === undefined &&","        !this.options.value &&","        !this.list.get('nocreate') &&","        this.path !== this.list.mappings.name","\t) {","\t\tconsole.error('\\nError: Invalid Configuration\\n\\n' +","\t\t\t'Field (' + list.key + '.' + path + ') is required but not initial, and has no default or generated value.\\n' +","\t\t\t'Please provide a default, remove the required setting, or set initial: false to override this error.\\n');","\t\tprocess.exit(1);","\t}","","\t// Add pre-save handler to the list if this field watches others","\tif (this.options.watch) {","\t\tthis.list.schema.pre('save', this.getPreSaveWatcher());","\t}","","\t// Convert notes from markdown to html","\tvar note = null;","\tObject.defineProperty(this, 'note', {","\t\tget: function() {","\t\t\treturn (note === null) ? (note = (this.options.note) ? marked(this.options.note) : '') : note;","\t\t}","\t});","","}","","/**"," * Gets the options for the Field, as used by the React components"," */","Field.prototype.getOptions = function() {","\tif (!this.__options) {","\t\tthis.__options = {};","\t\tvar optionKeys = DEFAULT_OPTION_KEYS;","\t\tif (_.isArray(this._properties)) {","\t\t\toptionKeys = optionKeys.concat(this._properties);","\t\t}","\t\toptionKeys.forEach(function(key) {","\t\t\tif (this[key]) {","\t\t\t\tthis.__options[key] = this[key];","\t\t\t} else if (this.options[key]){","\t\t\t\tthis.__options[key] = this.options[key];","\t\t\t}","\t\t}, this);","\t\tif (this.getProperties) {","\t\t\t_.extend(this.__options, this.getProperties());","\t\t}","\t\tthis.__options.hasFilterMethod = this.addFilterToQuery ? true : false;","\t\tthis.__options.defaultValue = this.getDefaultValue();","\t}","\treturn this.__options;","};","","/**"," * Validates and returns the size of the field."," * Defaults to deprecated 'width' option."," */","Field.prototype.getSize = function() {","\tif (!this.__size) {","\t\tvar size = this._fixedSize || this.options.size || this.options.width;","\t\tif (size !== 'small' && size !== 'medium' && size !== 'large' && size !== 'full') {","\t\t\tsize = this._defaultSize || 'large';","\t\t}","\t\tthis.__size = size;","\t}","\treturn this.__size;","};","","/**"," * Gets default value for the field, based on the option or default for the type"," */","Field.prototype.getDefaultValue = function() {","\treturn this.options.default || '';","};","","/**"," * Gets the field's data from an Item, as used by the React components"," */","Field.prototype.getData = function(item) {","\treturn item.get(this.path);","};","","/**"," * Field watching implementation"," */","Field.prototype.getPreSaveWatcher = function() {","\tvar field = this;","\tvar applyValue;","","\tif (this.options.watch === true) {","\t\t// watch == true means always apply the value method","\t\tapplyValue = function() { return true; };","\t} else {","\t\t// if watch is a string, convert it to a list of paths to watch","\t\tif (_.isString(this.options.watch)) {","\t\t\tthis.options.watch = this.options.watch.split(' ');","\t\t}","\t\tif (_.isFunction(this.options.watch)) {","\t\t\tapplyValue = this.options.watch;","\t\t} else if (_.isArray(this.options.watch)) {","\t\t\tapplyValue = function(item) {","\t\t\t\tvar pass = false;","\t\t\t\tfield.options.watch.forEach(function(path) {","\t\t\t\t\tif (item.isModified(path)) pass = true;","\t\t\t\t});","\t\t\t\treturn pass;","\t\t\t};","\t\t} else if (_.isObject(this.options.watch)) {","\t\t\tapplyValue = function(item) {","\t\t\t\tvar pass = false;","\t\t\t\t_.each(field.options.watch, function(value, path) {","\t\t\t\t\tif (item.isModified(path) && item.get(path) === value) pass = true;","\t\t\t\t});","\t\t\t\treturn pass;","\t\t\t};","\t\t}","\t}","","\tif (!applyValue) {","\t\tconsole.error('\\nError: Invalid Configuration\\n\\n' +","\t\t\t'Invalid watch value (' + this.options.watch + ') provided for ' + this.list.key + '.' + this.path + ' (' + this.type + ')');","\t\tprocess.exit(1);","\t}","","\tif (!_.isFunction(this.options.value)) {","\t\tconsole.error('\\nError: Invalid Configuration\\n\\n' +","\t\t\t'Watch set with no value method provided for ' + this.list.key + '.' + this.path + ' (' + this.type + ')');","\t\tprocess.exit(1);","\t}","","\treturn function(next) {","\t\tif (!applyValue(this)) {","\t\t\treturn next();","\t\t}","\t\tdi(field.options.value).call(this, function(err, val){","\t\t\tif(err){","\t\t\t\tconsole.error('\\nError: ' +","\t\t\t\t'Watch set with value method for ' + field.list.key + '.' + field.path + ' (' + field.type + ') throws error:' + err);","\t\t\t}else{","\t\t\t\tthis.set(field.path, val);","\t\t\t}","\t\t\tnext();","\t\t}.bind(this));","\t};","","};","exports = module.exports = Field;","","/** Getter properties for the Field prototype */","Object.defineProperty(Field.prototype, 'size', { get: function() { return this.getSize(); } });","Object.defineProperty(Field.prototype, 'initial', { get: function() { return this.options.initial || false; } });","Object.defineProperty(Field.prototype, 'required', { get: function() { return this.options.required || false; } });","Object.defineProperty(Field.prototype, 'note', { get: function() { return this.options.note || ''; } });","Object.defineProperty(Field.prototype, 'col', { get: function() { return this.options.col || false; } });","Object.defineProperty(Field.prototype, 'noedit', { get: function() { return this.options.noedit || false; } });","Object.defineProperty(Field.prototype, 'nocol', { get: function() { return this.options.nocol || false; } });","Object.defineProperty(Field.prototype, 'nosort', { get: function() { return this.options.nosort || false; } });","Object.defineProperty(Field.prototype, 'nofilter', { get: function() { return this.options.nofilter || false; } });","Object.defineProperty(Field.prototype, 'collapse', { get: function() { return this.options.collapse || false; } });","Object.defineProperty(Field.prototype, 'hidden', { get: function() { return this.options.hidden || false; } });","Object.defineProperty(Field.prototype, 'dependsOn', { get: function() { return this.options.dependsOn || false; } });","","/**"," * Default method to register the field on the List's Mongoose Schema."," * Overridden by some fieldType Classes"," *"," * @api public"," */","Field.prototype.addToSchema = function() {","\tvar ops = (this._nativeType) ? _.defaults({ type: this._nativeType }, this.options) : this.options;","\tthis.list.schema.path(this.path, ops);","\tthis.bindUnderscoreMethods();","};","","Field.prototype.bindUnderscoreMethods = function(methods) {","\tvar field = this;","\t// automatically bind underscore methods specified by the _underscoreMethods property","\t// always include the 'update' method","\t(this._underscoreMethods || []).concat({ fn: 'updateItem', as: 'update' }, (methods || [])).forEach(function(method) {","\t\tif ('string' === typeof method) {","\t\t\tmethod = { fn: method, as: method };","\t\t}","\t\tif ('function' !== typeof field[method.fn]) {","\t\t\tthrow new Error('Invalid underscore method (' + method.fn + ') applied to ' + field.list.key + '.' + field.path + ' (' + field.type + ')');","\t\t}","\t\tfield.underscoreMethod(method.as, function() {","\t\t\tvar args = [this].concat(Array.prototype.slice.call(arguments));","\t\t\treturn field[method.fn].apply(field, args);","\t\t});","\t});","};","","/**"," * Adds a method to the underscoreMethods collection on the field's list,"," * with a path prefix to match this field's path and bound to the document"," *"," * @api public"," */","Field.prototype.underscoreMethod = function(path, fn) {","\tthis.list.underscoreMethod(this.path + '.' + path, function() {","\t\treturn fn.apply(this, arguments);","\t});","};","","/**"," * Default method to format the field value for display"," * Overridden by some fieldType Classes"," *"," * @api public"," */","Field.prototype.format = function(item) {","\treturn item.get(this.path);","};","","/**"," * Default method to detect whether the field has been modified in an item"," * Overridden by some fieldType Classes"," *"," * @api public"," */","Field.prototype.isModified = function(item) {","\treturn item.isModified(this.path);","};","","/**"," * Validates that a value for this field has been provided in a data object"," * Overridden by some fieldType Classes"," *"," * @api public"," */","Field.prototype.validateInput = function(data, required, item) {","\tif (!required) return true;","\tvar value = this.getValueFromData(data);","\tif (value === undefined && item && item.get(this.path)) return true;","\tif ('string' === typeof data[this.path]) {","\t\treturn (data[this.path].trim()) ? true : false;","\t} else {","\t\treturn (data[this.path]) ? true : false;","\t}","};","","/**"," * Updates the value for this field in the item from a data object"," * Overridden by some fieldType Classes"," *"," * @api public"," */","Field.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\t// This is a deliberate type coercion so that numbers from forms play nice","\tif (value !== undefined && value != item.get(this.path)) { // eslint-disable-line eqeqeq","\t\titem.set(this.path, value);","\t}","};","","/**"," * Retrieves the value from an object, whether the path is nested or flattened"," *"," * @api public"," */","Field.prototype.getValueFromData = function(data) {","\treturn this.path in data ? data[this.path] : this._path.get(data);","};"],"l":{"4":1,"5":1,"6":1,"7":1,"8":1,"10":1,"38":1,"41":0,"42":0,"43":0,"45":0,"46":0,"47":0,"48":0,"51":0,"52":0,"55":0,"62":0,"65":0,"69":0,"70":0,"74":0,"75":0,"77":0,"86":1,"87":0,"88":0,"89":0,"90":0,"91":0,"93":0,"94":0,"95":0,"96":0,"97":0,"100":0,"101":0,"103":0,"104":0,"106":0,"113":1,"114":0,"115":0,"116":0,"117":0,"119":0,"121":0,"127":1,"128":0,"134":1,"135":0,"141":1,"142":0,"143":0,"145":0,"147":0,"150":0,"151":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"161":0,"163":0,"164":0,"165":0,"166":0,"167":0,"169":0,"174":0,"175":0,"177":0,"180":0,"181":0,"183":0,"186":0,"187":0,"188":0,"190":0,"191":0,"192":0,"195":0,"197":0,"202":1,"205":1,"206":1,"207":1,"208":1,"209":1,"210":1,"211":1,"212":1,"213":1,"214":1,"215":1,"216":1,"224":1,"225":0,"226":0,"227":0,"230":1,"231":0,"234":0,"235":0,"236":0,"238":0,"239":0,"241":0,"242":0,"243":0,"254":1,"255":0,"256":0,"266":1,"267":0,"276":1,"277":0,"286":1,"287":0,"288":0,"289":0,"290":0,"291":0,"293":0,"303":1,"304":0,"306":0,"307":0,"316":1,"317":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/path.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/path.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"Path","line":9,"loc":{"start":{"line":9,"column":27},"end":{"line":9,"column":46}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":14},"end":{"line":27,"column":33}}},"3":{"name":"(anonymous_3)","line":39,"loc":{"start":{"line":39,"column":12},"end":{"line":39,"column":26}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":22},"end":{"line":48,"column":51}}},"5":{"name":"(anonymous_5)","line":56,"loc":{"start":{"line":56,"column":15},"end":{"line":56,"column":32}}},"6":{"name":"(anonymous_6)","line":60,"loc":{"start":{"line":60,"column":16},"end":{"line":60,"column":36}}},"7":{"name":"(anonymous_7)","line":64,"loc":{"start":{"line":64,"column":22},"end":{"line":64,"column":42}}},"8":{"name":"(anonymous_8)","line":68,"loc":{"start":{"line":68,"column":24},"end":{"line":68,"column":44}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":38}},"2":{"start":{"line":9,"column":0},"end":{"line":74,"column":2}},"3":{"start":{"line":11,"column":1},"end":{"line":13,"column":2}},"4":{"start":{"line":12,"column":2},"end":{"line":12,"column":23}},"5":{"start":{"line":15,"column":1},"end":{"line":15,"column":21}},"6":{"start":{"line":17,"column":1},"end":{"line":17,"column":41}},"7":{"start":{"line":18,"column":1},"end":{"line":18,"column":58}},"8":{"start":{"line":19,"column":1},"end":{"line":19,"column":21}},"9":{"start":{"line":21,"column":1},"end":{"line":23,"column":2}},"10":{"start":{"line":22,"column":2},"end":{"line":22,"column":28}},"11":{"start":{"line":25,"column":1},"end":{"line":25,"column":40}},"12":{"start":{"line":27,"column":1},"end":{"line":37,"column":3}},"13":{"start":{"line":28,"column":2},"end":{"line":28,"column":14}},"14":{"start":{"line":29,"column":2},"end":{"line":34,"column":3}},"15":{"start":{"line":30,"column":3},"end":{"line":32,"column":4}},"16":{"start":{"line":31,"column":4},"end":{"line":31,"column":21}},"17":{"start":{"line":33,"column":3},"end":{"line":33,"column":19}},"18":{"start":{"line":35,"column":2},"end":{"line":35,"column":16}},"19":{"start":{"line":36,"column":2},"end":{"line":36,"column":13}},"20":{"start":{"line":39,"column":1},"end":{"line":46,"column":3}},"21":{"start":{"line":40,"column":2},"end":{"line":40,"column":14}},"22":{"start":{"line":41,"column":2},"end":{"line":44,"column":3}},"23":{"start":{"line":42,"column":3},"end":{"line":42,"column":47}},"24":{"start":{"line":42,"column":30},"end":{"line":42,"column":47}},"25":{"start":{"line":43,"column":3},"end":{"line":43,"column":19}},"26":{"start":{"line":45,"column":2},"end":{"line":45,"column":11}},"27":{"start":{"line":48,"column":1},"end":{"line":54,"column":3}},"28":{"start":{"line":49,"column":2},"end":{"line":49,"column":15}},"29":{"start":{"line":50,"column":2},"end":{"line":52,"column":3}},"30":{"start":{"line":51,"column":3},"end":{"line":51,"column":25}},"31":{"start":{"line":53,"column":2},"end":{"line":53,"column":73}},"32":{"start":{"line":56,"column":1},"end":{"line":58,"column":3}},"33":{"start":{"line":57,"column":2},"end":{"line":57,"column":22}},"34":{"start":{"line":60,"column":1},"end":{"line":62,"column":3}},"35":{"start":{"line":61,"column":2},"end":{"line":61,"column":68}},"36":{"start":{"line":64,"column":1},"end":{"line":66,"column":3}},"37":{"start":{"line":65,"column":2},"end":{"line":65,"column":111}},"38":{"start":{"line":68,"column":1},"end":{"line":70,"column":3}},"39":{"start":{"line":69,"column":2},"end":{"line":69,"column":113}},"40":{"start":{"line":72,"column":1},"end":{"line":72,"column":13}}},"branchMap":{"1":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},{"start":{"line":11,"column":1},"end":{"line":11,"column":1}}]},"2":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":3},"end":{"line":30,"column":3}},{"start":{"line":30,"column":3},"end":{"line":30,"column":3}}]},"3":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":3},"end":{"line":42,"column":3}},{"start":{"line":42,"column":3},"end":{"line":42,"column":3}}]},"4":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":16},"end":{"line":53,"column":23}},{"start":{"line":53,"column":27},"end":{"line":53,"column":29}}]},"5":{"line":53,"type":"cond-expr","locations":[{"start":{"line":53,"column":46},"end":{"line":53,"column":64}},{"start":{"line":53,"column":67},"end":{"line":53,"column":71}}]},"6":{"line":61,"type":"cond-expr","locations":[{"start":{"line":61,"column":54},"end":{"line":61,"column":58}},{"start":{"line":61,"column":61},"end":{"line":61,"column":66}}]},"7":{"line":65,"type":"cond-expr","locations":[{"start":{"line":65,"column":97},"end":{"line":65,"column":101}},{"start":{"line":65,"column":104},"end":{"line":65,"column":109}}]},"8":{"line":69,"type":"cond-expr","locations":[{"start":{"line":69,"column":99},"end":{"line":69,"column":103}},{"start":{"line":69,"column":106},"end":{"line":69,"column":111}}]}},"code":["var utils = require('keystone-utils');","","/**"," * Path Class"," *"," * @api public"," */","","exports = module.exports = function Path(str) {","","\tif (!(this instanceof Path)) {","\t\treturn new Path(str);","\t}","","\tthis.original = str;","","\tvar parts = this.parts = str.split('.');","\tvar last = this.last = this.parts[this.parts.length - 1];","\tvar exceptLast = [];","","\tfor (var i = 0; i < parts.length - 1; i++) {","\t\texceptLast.push(parts[i]);","\t}","","\tthis.exceptLast = exceptLast.join('.');","","\tthis.addTo = function(obj, val) {","\t\tvar o = obj;","\t\tfor (var i = 0; i < parts.length - 1; i++) {","\t\t\tif (!utils.isObject(o[parts[i]])) {","\t\t\t\to[parts[i]] = {};","\t\t\t}","\t\t\to = o[parts[i]];","\t\t}","\t\to[last] = val;","\t\treturn obj;","\t};","","\tthis.get = function(obj) {","\t\tvar o = obj;","\t\tfor (var i = 0; i < parts.length; i++) {","\t\t\tif (typeof o !== 'object') return undefined;","\t\t\to = o[parts[i]];","\t\t}","\t\treturn o;","\t};","","\tthis.prependToLast = function(prepend, titlecase) {","\t\tvar rtn = '';","\t\tfor (var i = 0; i < parts.length - 1; i++) {","\t\t\trtn += parts[i] + '.';","\t\t}","\t\treturn rtn + (prepend || '') + (titlecase ? utils.upcase(last) : last);","\t};","","\tthis.append = function(append) {","\t\treturn str + append;","\t};","","\tthis.flatten = function(titlecase) {","\t\treturn utils.camelcase(parts.join('_'), titlecase ? true : false);","\t};","","\tthis.flattenplural = function(titlecase) {","\t\treturn utils.camelcase([].concat(exceptLast).concat(utils.plural(last)).join('_'), titlecase ? true : false);","\t};","","\tthis.flattensingular = function(titlecase) {","\t\treturn utils.camelcase([].concat(exceptLast).concat(utils.singular(last)).join('_'), titlecase ? true : false);","\t};","","\treturn this;","","};",""],"l":{"1":1,"9":1,"11":0,"12":0,"15":0,"17":0,"18":0,"19":0,"21":0,"22":0,"25":0,"27":0,"28":0,"29":0,"30":0,"31":0,"33":0,"35":0,"36":0,"39":0,"40":0,"41":0,"42":0,"43":0,"45":0,"48":0,"49":0,"50":0,"51":0,"53":0,"56":0,"57":0,"60":0,"61":0,"64":0,"65":0,"68":0,"69":0,"72":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/fieldTypes.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/fieldTypes.js","s":{"1":1,"2":8,"3":6,"4":6,"5":6,"6":6,"7":6,"8":6,"9":6,"10":6,"11":6,"12":6,"13":6,"14":6,"15":6,"16":6,"17":6,"18":6,"19":6,"20":6,"21":6,"22":6,"23":6,"24":6,"25":6,"26":6,"27":6,"28":6,"29":6,"30":6,"31":6,"32":1},"b":{},"f":{"1":8,"2":6,"3":6,"4":6,"5":6,"6":6,"7":6,"8":6,"9":6,"10":6,"11":6,"12":6,"13":6,"14":6,"15":6,"16":6,"17":6,"18":6,"19":6,"20":6,"21":6,"22":6,"23":6,"24":6,"25":6,"26":6,"27":6,"28":6,"29":6,"30":6},"fnMap":{"1":{"name":"(anonymous_1)","line":2,"loc":{"start":{"line":2,"column":15},"end":{"line":2,"column":18}}},"2":{"name":"(anonymous_2)","line":3,"loc":{"start":{"line":3,"column":13},"end":{"line":3,"column":16}}},"3":{"name":"(anonymous_3)","line":4,"loc":{"start":{"line":4,"column":21},"end":{"line":4,"column":24}}},"4":{"name":"(anonymous_4)","line":5,"loc":{"start":{"line":5,"column":22},"end":{"line":5,"column":25}}},"5":{"name":"(anonymous_5)","line":6,"loc":{"start":{"line":6,"column":10},"end":{"line":6,"column":13}}},"6":{"name":"(anonymous_6)","line":7,"loc":{"start":{"line":7,"column":11},"end":{"line":7,"column":14}}},"7":{"name":"(anonymous_7)","line":8,"loc":{"start":{"line":8,"column":10},"end":{"line":8,"column":13}}},"8":{"name":"(anonymous_8)","line":9,"loc":{"start":{"line":9,"column":15},"end":{"line":9,"column":18}}},"9":{"name":"(anonymous_9)","line":10,"loc":{"start":{"line":10,"column":14},"end":{"line":10,"column":17}}},"10":{"name":"(anonymous_10)","line":11,"loc":{"start":{"line":11,"column":11},"end":{"line":11,"column":14}}},"11":{"name":"(anonymous_11)","line":12,"loc":{"start":{"line":12,"column":13},"end":{"line":12,"column":16}}},"12":{"name":"(anonymous_12)","line":13,"loc":{"start":{"line":13,"column":14},"end":{"line":13,"column":17}}},"13":{"name":"(anonymous_13)","line":14,"loc":{"start":{"line":14,"column":10},"end":{"line":14,"column":13}}},"14":{"name":"(anonymous_14)","line":15,"loc":{"start":{"line":15,"column":9},"end":{"line":15,"column":12}}},"15":{"name":"(anonymous_15)","line":16,"loc":{"start":{"line":16,"column":15},"end":{"line":16,"column":18}}},"16":{"name":"(anonymous_16)","line":17,"loc":{"start":{"line":17,"column":16},"end":{"line":17,"column":19}}},"17":{"name":"(anonymous_17)","line":18,"loc":{"start":{"line":18,"column":14},"end":{"line":18,"column":17}}},"18":{"name":"(anonymous_18)","line":19,"loc":{"start":{"line":19,"column":14},"end":{"line":19,"column":17}}},"19":{"name":"(anonymous_19)","line":20,"loc":{"start":{"line":20,"column":11},"end":{"line":20,"column":14}}},"20":{"name":"(anonymous_20)","line":21,"loc":{"start":{"line":21,"column":10},"end":{"line":21,"column":13}}},"21":{"name":"(anonymous_21)","line":22,"loc":{"start":{"line":22,"column":12},"end":{"line":22,"column":15}}},"22":{"name":"(anonymous_22)","line":23,"loc":{"start":{"line":23,"column":17},"end":{"line":23,"column":20}}},"23":{"name":"(anonymous_23)","line":24,"loc":{"start":{"line":24,"column":14},"end":{"line":24,"column":17}}},"24":{"name":"(anonymous_24)","line":25,"loc":{"start":{"line":25,"column":18},"end":{"line":25,"column":21}}},"25":{"name":"(anonymous_25)","line":26,"loc":{"start":{"line":26,"column":12},"end":{"line":26,"column":15}}},"26":{"name":"(anonymous_26)","line":27,"loc":{"start":{"line":27,"column":12},"end":{"line":27,"column":15}}},"27":{"name":"(anonymous_27)","line":28,"loc":{"start":{"line":28,"column":10},"end":{"line":28,"column":13}}},"28":{"name":"(anonymous_28)","line":29,"loc":{"start":{"line":29,"column":15},"end":{"line":29,"column":18}}},"29":{"name":"(anonymous_29)","line":30,"loc":{"start":{"line":30,"column":14},"end":{"line":30,"column":17}}},"30":{"name":"(anonymous_30)","line":31,"loc":{"start":{"line":31,"column":9},"end":{"line":31,"column":12}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":32,"column":2}},"2":{"start":{"line":2,"column":20},"end":{"line":2,"column":78}},"3":{"start":{"line":3,"column":18},"end":{"line":3,"column":72}},"4":{"start":{"line":4,"column":26},"end":{"line":4,"column":96}},"5":{"start":{"line":5,"column":27},"end":{"line":5,"column":99}},"6":{"start":{"line":6,"column":15},"end":{"line":6,"column":63}},"7":{"start":{"line":7,"column":16},"end":{"line":7,"column":66}},"8":{"start":{"line":8,"column":15},"end":{"line":8,"column":63}},"9":{"start":{"line":9,"column":20},"end":{"line":9,"column":78}},"10":{"start":{"line":10,"column":19},"end":{"line":10,"column":75}},"11":{"start":{"line":11,"column":16},"end":{"line":11,"column":66}},"12":{"start":{"line":12,"column":18},"end":{"line":12,"column":72}},"13":{"start":{"line":13,"column":19},"end":{"line":13,"column":75}},"14":{"start":{"line":14,"column":15},"end":{"line":14,"column":63}},"15":{"start":{"line":15,"column":14},"end":{"line":15,"column":60}},"16":{"start":{"line":16,"column":20},"end":{"line":16,"column":78}},"17":{"start":{"line":17,"column":21},"end":{"line":17,"column":81}},"18":{"start":{"line":18,"column":19},"end":{"line":18,"column":75}},"19":{"start":{"line":19,"column":19},"end":{"line":19,"column":75}},"20":{"start":{"line":20,"column":16},"end":{"line":20,"column":66}},"21":{"start":{"line":21,"column":15},"end":{"line":21,"column":63}},"22":{"start":{"line":22,"column":17},"end":{"line":22,"column":69}},"23":{"start":{"line":23,"column":22},"end":{"line":23,"column":84}},"24":{"start":{"line":24,"column":19},"end":{"line":24,"column":75}},"25":{"start":{"line":25,"column":23},"end":{"line":25,"column":87}},"26":{"start":{"line":26,"column":17},"end":{"line":26,"column":69}},"27":{"start":{"line":27,"column":17},"end":{"line":27,"column":69}},"28":{"start":{"line":28,"column":15},"end":{"line":28,"column":63}},"29":{"start":{"line":29,"column":20},"end":{"line":29,"column":78}},"30":{"start":{"line":30,"column":19},"end":{"line":30,"column":75}},"31":{"start":{"line":31,"column":14},"end":{"line":31,"column":60}},"32":{"start":{"line":34,"column":0},"end":{"line":34,"column":24}}},"branchMap":{},"code":["var fields = {","\tget AzureFile () { return require('../fields/types/azurefile/AzureFileType'); },","\tget Boolean () { return require('../fields/types/boolean/BooleanType'); },","\tget CloudinaryImage () { return require('../fields/types/cloudinaryimage/CloudinaryImageType'); },","\tget CloudinaryImages () { return require('../fields/types/cloudinaryimages/CloudinaryImagesType'); },","\tget Code () { return require('../fields/types/code/CodeType'); },","\tget Color () { return require('../fields/types/color/ColorType'); },","\tget Date () { return require('../fields/types/date/DateType'); },","\tget DateArray () { return require('../fields/types/datearray/DateArrayType'); },","\tget Datetime () { return require('../fields/types/datetime/DatetimeType'); },","\tget Email () { return require('../fields/types/email/EmailType'); },","\tget Embedly () { return require('../fields/types/embedly/EmbedlyType'); },","\tget GeoPoint () { return require('../fields/types/geopoint/GeoPointType'); },","\tget Html () { return require('../fields/types/html/HtmlType'); },","\tget Key () { return require('../fields/types/key/KeyType'); },","\tget LocalFile () { return require('../fields/types/localfile/LocalFileType'); },","\tget LocalFiles () { return require('../fields/types/localfiles/LocalFilesType'); },","\tget Location () { return require('../fields/types/location/LocationType'); },","\tget Markdown () { return require('../fields/types/markdown/MarkdownType'); },","\tget Money () { return require('../fields/types/money/MoneyType'); },","\tget Name () { return require('../fields/types/name/NameType'); },","\tget Number () { return require('../fields/types/number/NumberType'); },","\tget NumberArray () { return require('../fields/types/numberarray/NumberArrayType'); },","\tget Password () { return require('../fields/types/password/PasswordType'); },","\tget Relationship () { return require('../fields/types/relationship/RelationshipType'); },","\tget S3File () { return require('../fields/types/s3file/S3FileType'); },","\tget Select () { return require('../fields/types/select/SelectType'); },","\tget Text () { return require('../fields/types/text/TextType'); },","\tget TextArray () { return require('../fields/types/textarray/TextArrayType'); },","\tget Textarea () { return require('../fields/types/textarea/TextareaType'); },","\tget Url () { return require('../fields/types/url/UrlType'); }","};","","module.exports = fields;",""],"l":{"1":1,"2":8,"3":6,"4":6,"5":6,"6":6,"7":6,"8":6,"9":6,"10":6,"11":6,"12":6,"13":6,"14":6,"15":6,"16":6,"17":6,"18":6,"19":6,"20":6,"21":6,"22":6,"23":6,"24":6,"25":6,"26":6,"27":6,"28":6,"29":6,"30":6,"31":6,"34":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":1,"58":0,"59":0,"60":0,"61":0,"62":0,"63":1,"64":0,"65":0,"66":0,"67":1,"68":0,"69":0,"70":0,"71":0,"72":0,"73":1,"74":1,"75":1,"76":1,"77":1,"78":1,"79":1,"80":1,"81":1,"82":1,"83":1,"84":1,"85":1,"86":1,"87":1,"88":1,"89":1,"90":1,"91":1,"92":1,"93":1,"94":1,"95":1,"96":1,"97":1,"98":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"fnMap":{"1":{"name":"List","line":13,"loc":{"start":{"line":13,"column":0},"end":{"line":13,"column":28}}},"2":{"name":"(anonymous_2)","line":65,"loc":{"start":{"line":65,"column":26},"end":{"line":65,"column":45}}},"3":{"name":"(anonymous_3)","line":68,"loc":{"start":{"line":68,"column":45},"end":{"line":68,"column":56}}},"4":{"name":"(anonymous_4)","line":71,"loc":{"start":{"line":71,"column":48},"end":{"line":71,"column":59}}},"5":{"name":"(anonymous_5)","line":74,"loc":{"start":{"line":74,"column":46},"end":{"line":74,"column":57}}},"6":{"name":"(anonymous_6)","line":77,"loc":{"start":{"line":77,"column":48},"end":{"line":77,"column":59}}},"7":{"name":"(anonymous_7)","line":80,"loc":{"start":{"line":80,"column":49},"end":{"line":80,"column":60}}},"8":{"name":"(anonymous_8)","line":83,"loc":{"start":{"line":83,"column":53},"end":{"line":83,"column":64}}},"9":{"name":"(anonymous_9)","line":86,"loc":{"start":{"line":86,"column":54},"end":{"line":86,"column":65}}},"10":{"name":"(anonymous_10)","line":89,"loc":{"start":{"line":89,"column":53},"end":{"line":89,"column":64}}},"11":{"name":"(anonymous_11)","line":92,"loc":{"start":{"line":92,"column":53},"end":{"line":92,"column":64}}},"12":{"name":"(anonymous_12)","line":93,"loc":{"start":{"line":93,"column":65},"end":{"line":93,"column":77}}},"13":{"name":"(anonymous_13)","line":115,"loc":{"start":{"line":115,"column":6},"end":{"line":115,"column":17}}},"14":{"name":"(anonymous_14)","line":120,"loc":{"start":{"line":120,"column":9},"end":{"line":120,"column":25}}},"15":{"name":"(anonymous_15)","line":128,"loc":{"start":{"line":128,"column":6},"end":{"line":128,"column":17}}},"16":{"name":"(anonymous_16)","line":131,"loc":{"start":{"line":131,"column":9},"end":{"line":131,"column":25}}},"17":{"name":"(anonymous_17)","line":138,"loc":{"start":{"line":138,"column":6},"end":{"line":138,"column":17}}},"18":{"name":"(anonymous_18)","line":143,"loc":{"start":{"line":143,"column":9},"end":{"line":143,"column":25}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":30}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":47}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":13,"column":0},"end":{"line":111,"column":1}},"6":{"start":{"line":14,"column":1},"end":{"line":14,"column":60}},"7":{"start":{"line":14,"column":30},"end":{"line":14,"column":60}},"8":{"start":{"line":16,"column":1},"end":{"line":31,"column":3}},"9":{"start":{"line":34,"column":1},"end":{"line":34,"column":19}},"10":{"start":{"line":37,"column":1},"end":{"line":42,"column":2}},"11":{"start":{"line":38,"column":2},"end":{"line":40,"column":3}},"12":{"start":{"line":39,"column":3},"end":{"line":39,"column":70}},"13":{"start":{"line":41,"column":2},"end":{"line":41,"column":75}},"14":{"start":{"line":44,"column":1},"end":{"line":44,"column":55}},"15":{"start":{"line":47,"column":1},"end":{"line":47,"column":16}},"16":{"start":{"line":48,"column":1},"end":{"line":48,"column":60}},"17":{"start":{"line":49,"column":1},"end":{"line":49,"column":69}},"18":{"start":{"line":50,"column":1},"end":{"line":50,"column":24}},"19":{"start":{"line":51,"column":1},"end":{"line":51,"column":22}},"20":{"start":{"line":52,"column":1},"end":{"line":52,"column":29}},"21":{"start":{"line":53,"column":1},"end":{"line":53,"column":18}},"22":{"start":{"line":54,"column":1},"end":{"line":54,"column":22}},"23":{"start":{"line":55,"column":1},"end":{"line":55,"column":25}},"24":{"start":{"line":56,"column":1},"end":{"line":62,"column":3}},"25":{"start":{"line":65,"column":1},"end":{"line":65,"column":76}},"26":{"start":{"line":65,"column":47},"end":{"line":65,"column":66}},"27":{"start":{"line":68,"column":1},"end":{"line":70,"column":6}},"28":{"start":{"line":69,"column":2},"end":{"line":69,"column":85}},"29":{"start":{"line":71,"column":1},"end":{"line":73,"column":6}},"30":{"start":{"line":72,"column":2},"end":{"line":72,"column":82}},"31":{"start":{"line":74,"column":1},"end":{"line":76,"column":6}},"32":{"start":{"line":75,"column":2},"end":{"line":75,"column":79}},"33":{"start":{"line":77,"column":1},"end":{"line":79,"column":6}},"34":{"start":{"line":78,"column":2},"end":{"line":78,"column":37}},"35":{"start":{"line":80,"column":1},"end":{"line":82,"column":6}},"36":{"start":{"line":81,"column":2},"end":{"line":81,"column":41}},"37":{"start":{"line":83,"column":1},"end":{"line":85,"column":6}},"38":{"start":{"line":84,"column":2},"end":{"line":84,"column":71}},"39":{"start":{"line":86,"column":1},"end":{"line":88,"column":6}},"40":{"start":{"line":87,"column":2},"end":{"line":87,"column":144}},"41":{"start":{"line":89,"column":1},"end":{"line":91,"column":6}},"42":{"start":{"line":90,"column":2},"end":{"line":90,"column":108}},"43":{"start":{"line":92,"column":1},"end":{"line":94,"column":6}},"44":{"start":{"line":93,"column":2},"end":{"line":93,"column":101}},"45":{"start":{"line":93,"column":79},"end":{"line":93,"column":96}},"46":{"start":{"line":95,"column":1},"end":{"line":97,"column":2}},"47":{"start":{"line":96,"column":2},"end":{"line":96,"column":37}},"48":{"start":{"line":98,"column":1},"end":{"line":100,"column":2}},"49":{"start":{"line":99,"column":2},"end":{"line":99,"column":36}},"50":{"start":{"line":101,"column":1},"end":{"line":103,"column":2}},"51":{"start":{"line":102,"column":2},"end":{"line":102,"column":34}},"52":{"start":{"line":104,"column":1},"end":{"line":106,"column":2}},"53":{"start":{"line":105,"column":2},"end":{"line":105,"column":36}},"54":{"start":{"line":107,"column":1},"end":{"line":110,"column":2}},"55":{"start":{"line":108,"column":2},"end":{"line":108,"column":55}},"56":{"start":{"line":109,"column":2},"end":{"line":109,"column":37}},"57":{"start":{"line":114,"column":0},"end":{"line":124,"column":3}},"58":{"start":{"line":116,"column":2},"end":{"line":118,"column":3}},"59":{"start":{"line":117,"column":3},"end":{"line":117,"column":67}},"60":{"start":{"line":119,"column":2},"end":{"line":119,"column":28}},"61":{"start":{"line":121,"column":2},"end":{"line":121,"column":34}},"62":{"start":{"line":122,"column":2},"end":{"line":122,"column":28}},"63":{"start":{"line":127,"column":0},"end":{"line":134,"column":3}},"64":{"start":{"line":129,"column":2},"end":{"line":129,"column":35}},"65":{"start":{"line":130,"column":2},"end":{"line":130,"column":92}},"66":{"start":{"line":132,"column":2},"end":{"line":132,"column":33}},"67":{"start":{"line":137,"column":0},"end":{"line":147,"column":3}},"68":{"start":{"line":139,"column":2},"end":{"line":141,"column":3}},"69":{"start":{"line":140,"column":3},"end":{"line":140,"column":73}},"70":{"start":{"line":142,"column":2},"end":{"line":142,"column":30}},"71":{"start":{"line":144,"column":2},"end":{"line":144,"column":36}},"72":{"start":{"line":145,"column":2},"end":{"line":145,"column":30}},"73":{"start":{"line":150,"column":0},"end":{"line":150,"column":43}},"74":{"start":{"line":151,"column":0},"end":{"line":151,"column":40}},"75":{"start":{"line":152,"column":0},"end":{"line":152,"column":43}},"76":{"start":{"line":153,"column":0},"end":{"line":153,"column":43}},"77":{"start":{"line":154,"column":0},"end":{"line":154,"column":51}},"78":{"start":{"line":155,"column":0},"end":{"line":155,"column":47}},"79":{"start":{"line":156,"column":0},"end":{"line":156,"column":61}},"80":{"start":{"line":157,"column":0},"end":{"line":157,"column":69}},"81":{"start":{"line":158,"column":0},"end":{"line":158,"column":53}},"82":{"start":{"line":159,"column":0},"end":{"line":159,"column":51}},"83":{"start":{"line":160,"column":0},"end":{"line":160,"column":57}},"84":{"start":{"line":161,"column":0},"end":{"line":161,"column":59}},"85":{"start":{"line":162,"column":0},"end":{"line":162,"column":67}},"86":{"start":{"line":163,"column":0},"end":{"line":163,"column":69}},"87":{"start":{"line":164,"column":0},"end":{"line":164,"column":71}},"88":{"start":{"line":165,"column":0},"end":{"line":165,"column":57}},"89":{"start":{"line":166,"column":0},"end":{"line":166,"column":63}},"90":{"start":{"line":167,"column":0},"end":{"line":167,"column":59}},"91":{"start":{"line":168,"column":0},"end":{"line":168,"column":63}},"92":{"start":{"line":169,"column":0},"end":{"line":169,"column":65}},"93":{"start":{"line":170,"column":0},"end":{"line":170,"column":69}},"94":{"start":{"line":171,"column":0},"end":{"line":171,"column":55}},"95":{"start":{"line":172,"column":0},"end":{"line":172,"column":65}},"96":{"start":{"line":173,"column":0},"end":{"line":173,"column":53}},"97":{"start":{"line":174,"column":0},"end":{"line":174,"column":53}},"98":{"start":{"line":179,"column":0},"end":{"line":179,"column":32}}},"branchMap":{"1":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},{"start":{"line":14,"column":1},"end":{"line":14,"column":1}}]},"2":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},{"start":{"line":37,"column":1},"end":{"line":37,"column":1}}]},"3":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":5},"end":{"line":37,"column":12}},{"start":{"line":37,"column":16},"end":{"line":37,"column":32}}]},"4":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":2},"end":{"line":38,"column":2}},{"start":{"line":38,"column":2},"end":{"line":38,"column":2}}]},"5":{"line":38,"type":"binary-expr","locations":[{"start":{"line":38,"column":6},"end":{"line":38,"column":30}},{"start":{"line":38,"column":34},"end":{"line":38,"column":67}}]},"6":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":13},"end":{"line":48,"column":29}},{"start":{"line":48,"column":33},"end":{"line":48,"column":59}}]},"7":{"line":69,"type":"binary-expr","locations":[{"start":{"line":69,"column":9},"end":{"line":69,"column":26}},{"start":{"line":69,"column":30},"end":{"line":69,"column":84}}]},"8":{"line":72,"type":"binary-expr","locations":[{"start":{"line":72,"column":9},"end":{"line":72,"column":29}},{"start":{"line":72,"column":33},"end":{"line":72,"column":81}}]},"9":{"line":75,"type":"binary-expr","locations":[{"start":{"line":75,"column":9},"end":{"line":75,"column":27}},{"start":{"line":75,"column":31},"end":{"line":75,"column":78}}]},"10":{"line":78,"type":"binary-expr","locations":[{"start":{"line":78,"column":9},"end":{"line":78,"column":27}},{"start":{"line":78,"column":31},"end":{"line":78,"column":36}}]},"11":{"line":84,"type":"cond-expr","locations":[{"start":{"line":84,"column":58},"end":{"line":84,"column":62}},{"start":{"line":84,"column":65},"end":{"line":84,"column":70}}]},"12":{"line":87,"type":"cond-expr","locations":[{"start":{"line":87,"column":96},"end":{"line":87,"column":135}},{"start":{"line":87,"column":138},"end":{"line":87,"column":143}}]},"13":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":10},"end":{"line":87,"column":41}},{"start":{"line":87,"column":45},"end":{"line":87,"column":92}}]},"14":{"line":90,"type":"binary-expr","locations":[{"start":{"line":90,"column":10},"end":{"line":90,"column":41}},{"start":{"line":90,"column":45},"end":{"line":90,"column":106}}]},"15":{"line":93,"type":"binary-expr","locations":[{"start":{"line":93,"column":9},"end":{"line":93,"column":22}},{"start":{"line":93,"column":27},"end":{"line":93,"column":99}}]},"16":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},{"start":{"line":95,"column":1},"end":{"line":95,"column":1}}]},"17":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},{"start":{"line":98,"column":1},"end":{"line":98,"column":1}}]},"18":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},{"start":{"line":101,"column":1},"end":{"line":101,"column":1}}]},"19":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},{"start":{"line":104,"column":1},"end":{"line":104,"column":1}}]},"20":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},{"start":{"line":107,"column":1},"end":{"line":107,"column":1}}]},"21":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":2},"end":{"line":116,"column":2}},{"start":{"line":116,"column":2},"end":{"line":116,"column":2}}]},"22":{"line":130,"type":"cond-expr","locations":[{"start":{"line":130,"column":35},"end":{"line":130,"column":85}},{"start":{"line":130,"column":89},"end":{"line":130,"column":91}}]},"23":{"line":130,"type":"cond-expr","locations":[{"start":{"line":130,"column":58},"end":{"line":130,"column":69}},{"start":{"line":130,"column":72},"end":{"line":130,"column":85}}]},"24":{"line":139,"type":"if","locations":[{"start":{"line":139,"column":2},"end":{"line":139,"column":2}},{"start":{"line":139,"column":2},"end":{"line":139,"column":2}}]}},"code":["var _ = require('underscore');","var keystone = require('../');","var schemaPlugins = require('./schemaPlugins');","var utils = require('keystone-utils');","","/**"," * List Class"," *"," * @param {String} key"," * @param {Object} options"," */","","function List(key, options) {","\tif (!(this instanceof List)) return new List(key, options);","","\tvar defaultOptions = {","\t\tschema: {","\t\t\tcollection: keystone.prefixModel(key)","\t\t},","\t\tnoedit: false,","\t\tnocreate: false,","\t\tnodelete: false,","\t\tautocreate: false,","\t\tsortable: false,","\t\thidden: false,","\t\ttrack: false,","\t\tinherits: false,","\t\tsearchFields: '__name__',","\t\tdefaultSort: '__default__',","\t\tdefaultColumns: '__name__'","\t};","","\t// initialFields values are initialised on demand by the getter","\tvar initialFields;","","\t// Inherit default options from parent list if it exists","\tif (options && options.inherits) {","\t\tif (options.inherits.options && options.inherits.options.inherits) {","\t\t\tthrow new Error('Inherited Lists may not contain any inheritance');","\t\t}","\t\tdefaultOptions = utils.options(defaultOptions, options.inherits.options);","\t}","","\tthis.options = utils.options(defaultOptions, options);","","\t// init properties","\tthis.key = key;","\tthis.path = this.get('path') || utils.keyToPath(key, true);","\tthis.schema = new keystone.mongoose.Schema({}, this.options.schema);","\tthis.schemaFields = [];","\tthis.uiElements = [];","\tthis.underscoreMethods = {};","\tthis.fields = {};","\tthis.fieldTypes = {};","\tthis.relationships = {};","\tthis.mappings = {","\t\tname: null,","\t\tcreatedBy: null,","\t\tcreatedOn: null,","\t\tmodifiedBy: null,","\t\tmodifiedOn: null","\t};","","\t// init mappings","\t_.each(this.options.map, function(val, key) { this.map(key, val); }, this);","","\t// define property getters","\tObject.defineProperty(this, 'label', { get: function() {","\t\treturn this.get('label') || this.set('label', utils.plural(utils.keyToLabel(key)));","\t} });","\tObject.defineProperty(this, 'singular', { get: function() {","\t\treturn this.get('singular') || this.set('singular', utils.singular(this.label));","\t} });","\tObject.defineProperty(this, 'plural', { get: function() {","\t\treturn this.get('plural') || this.set('plural', utils.plural(this.singular));","\t} });","\tObject.defineProperty(this, 'namePath', { get: function() {","\t\treturn this.mappings.name || '_id';","\t} });","\tObject.defineProperty(this, 'nameField', { get: function() {","\t\treturn this.fields[this.mappings.name];","\t} });","\tObject.defineProperty(this, 'nameIsVirtual', { get: function() {","\t\treturn this.model.schema.virtuals[this.mappings.name] ? true : false;","\t} });","\tObject.defineProperty(this, 'nameIsEditable', { get: function() {","\t\treturn (this.fields[this.mappings.name] && this.fields[this.mappings.name].type === 'text') ? !this.fields[this.mappings.name].noedit : false;","\t} });","\tObject.defineProperty(this, 'nameIsInitial', { get: function() {","\t\treturn (this.fields[this.mappings.name] && this.fields[this.mappings.name].options.initial === undefined);","\t} });","\tObject.defineProperty(this, 'initialFields', { get: function() {","\t\treturn initialFields || (initialFields = _.filter(this.fields, function(i) { return i.initial; }));","\t} });","\tif (this.get('sortable')) {","\t\tschemaPlugins.sortable.apply(this);","\t}","\tif (this.get('autokey')) {","\t\tschemaPlugins.autokey.apply(this);","\t}","\tif (this.get('track')) {","\t\tschemaPlugins.track.apply(this);","\t}","\tif (this.get('history')) {","\t\tschemaPlugins.history.apply(this);","\t}","\tif (this.get('inherits')) {","\t\tvar parentFields = this.get('inherits').schemaFields;","\t\tthis.add.apply(this, parentFields);","\t}","}","","// Search Fields","Object.defineProperty(List.prototype, 'searchFields', {","\tget: function() {","\t\tif (!this._searchFields) {","\t\t\tthis._searchFields = this.expandPaths(this.get('searchFields'));","\t\t}","\t\treturn this._searchFields;","\t}, set: function(value) {","\t\tthis.set('searchFields', value);","\t\tdelete this._searchFields;","\t}","});","","// Default Sort Field","Object.defineProperty(List.prototype, 'defaultSort', {","\tget: function() {","\t\tvar ds = this.get('defaultSort');","\t\treturn (ds === '__default__') ? (this.get('sortable') ? 'sortOrder' : this.namePath) : ds;","\t}, set: function(value) {","\t\tthis.set('defaultSort', value);","\t}","});","","// Default Column Fields","Object.defineProperty(List.prototype, 'defaultColumns', {","\tget: function() {","\t\tif (!this._defaultColumns) {","\t\t\tthis._defaultColumns = this.expandColumns(this.get('defaultColumns'));","\t\t}","\t\treturn this._defaultColumns;","\t}, set: function(value) {","\t\tthis.set('defaultColumns', value);","\t\tdelete this._defaultColumns;","\t}","});","","// Add prototype methods","List.prototype.set = require('./list/set');","List.prototype.get = List.prototype.set;","List.prototype.add = require('./list/add');","List.prototype.map = require('./list/map');","List.prototype.automap = require('./list/automap');","List.prototype.field = require('./list/field');","List.prototype.relationship = require('./list/relationship');","List.prototype.underscoreMethod = require('./list/underscoreMethod');","List.prototype.register = require('./list/register');","List.prototype.getData = require('./list/getData');","List.prototype.getOptions = require('./list/getOptions');","List.prototype.getAdminURL = require('./list/getAdminURL');","List.prototype.getDocumentName = require('./list/getDocumentName');","List.prototype.addSearchToQuery = require('./list/addSearchToQuery');","List.prototype.addFiltersToQuery = require('./list/addFiltersToQuery');","List.prototype.isReserved = require('./list/isReserved');","List.prototype.expandColumns = require('./list/expandColumns');","List.prototype.expandPaths = require('./list/expandPaths');","List.prototype.selectColumns = require('./list/selectColumns');","List.prototype.processFilters = require('./list/processFilters');","List.prototype.getSearchFilters = require('./list/getSearchFilters');","List.prototype.updateAll = require('./list/updateAll');","List.prototype.getUniqueValue = require('./list/getUniqueValue');","List.prototype.getPages = require('./list/getPages');","List.prototype.paginate = require('./list/paginate');","","/*!"," * Export class"," */","exports = module.exports = List;",""],"l":{"1":1,"2":1,"3":1,"4":1,"13":1,"14":0,"16":0,"34":0,"37":0,"38":0,"39":0,"41":0,"44":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"65":0,"68":0,"69":0,"71":0,"72":0,"74":0,"75":0,"77":0,"78":0,"80":0,"81":0,"83":0,"84":0,"86":0,"87":0,"89":0,"90":0,"92":0,"93":0,"95":0,"96":0,"98":0,"99":0,"101":0,"102":0,"104":0,"105":0,"107":0,"108":0,"109":0,"114":1,"116":0,"117":0,"119":0,"121":0,"122":0,"127":1,"129":0,"130":0,"132":0,"137":1,"139":0,"140":0,"142":0,"144":0,"145":0,"150":1,"151":1,"152":1,"153":1,"154":1,"155":1,"156":1,"157":1,"158":1,"159":1,"160":1,"161":1,"162":1,"163":1,"164":1,"165":1,"166":1,"167":1,"168":1,"169":1,"170":1,"171":1,"172":1,"173":1,"174":1,"179":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":55}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":53}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":49}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":53}},"5":{"start":{"line":6,"column":0},"end":{"line":9,"column":2}},"6":{"start":{"line":11,"column":0},"end":{"line":13,"column":2}}},"branchMap":{},"code":["exports.sortable = require('./schemaPlugins/sortable');","exports.autokey = require('./schemaPlugins/autokey');","exports.track = require('./schemaPlugins/track');","exports.history = require('./schemaPlugins/history');","","exports.methods = {","\tgetRelated: require('./schemaPlugins/methods/getRelated'),","\tpopulateRelated: require('./schemaPlugins/methods/populateRelated')","};","","exports.options = {","\ttransform: require('./schemaPlugins/options/transform')","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"6":1,"11":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/sortable.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/sortable.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"sortable","line":1,"loc":{"start":{"line":1,"column":17},"end":{"line":1,"column":37}}},"2":{"name":"(anonymous_2)","line":9,"loc":{"start":{"line":9,"column":25},"end":{"line":9,"column":40}}},"3":{"name":"(anonymous_3)","line":16,"loc":{"start":{"line":16,"column":47},"end":{"line":16,"column":66}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":23,"column":2}},"2":{"start":{"line":3,"column":1},"end":{"line":3,"column":17}},"3":{"start":{"line":5,"column":1},"end":{"line":7,"column":4}},"4":{"start":{"line":9,"column":1},"end":{"line":21,"column":4}},"5":{"start":{"line":11,"column":2},"end":{"line":13,"column":3}},"6":{"start":{"line":12,"column":3},"end":{"line":12,"column":17}},"7":{"start":{"line":15,"column":2},"end":{"line":15,"column":18}},"8":{"start":{"line":16,"column":2},"end":{"line":19,"column":5}},"9":{"start":{"line":17,"column":3},"end":{"line":17,"column":67}},"10":{"start":{"line":18,"column":3},"end":{"line":18,"column":10}}},"branchMap":{"1":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":2},"end":{"line":11,"column":2}},{"start":{"line":11,"column":2},"end":{"line":11,"column":2}}]},"2":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":45},"end":{"line":17,"column":62}},{"start":{"line":17,"column":65},"end":{"line":17,"column":66}}]},"3":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":21},"end":{"line":17,"column":24}},{"start":{"line":17,"column":28},"end":{"line":17,"column":41}}]}},"code":["module.exports = function sortable() {","","\tvar list = this;","","\tthis.schema.add({","\t\tsortOrder: { type: Number, index: true }","\t});","","\tthis.schema.pre('save', function(next) {","","\t\tif (typeof this.sortOrder === 'number') {","\t\t\treturn next();","\t\t}","","\t\tvar item = this;","\t\tlist.model.findOne().sort('-sortOrder').exec(function(err, max) {// eslint-disable-line no-unused-vars, handle-callback-err","\t\t\titem.sortOrder = (max && max.sortOrder) ? max.sortOrder + 1 : 1;","\t\t\tnext();","\t\t});","","\t});","","};",""],"l":{"1":1,"3":0,"5":0,"9":0,"11":0,"12":0,"15":0,"16":0,"17":0,"18":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/autokey.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/autokey.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0,0],"17":[0,0],"18":[0,0,0],"19":[0,0],"20":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"autokey","line":4,"loc":{"start":{"line":4,"column":17},"end":{"line":4,"column":36}}},"2":{"name":"(anonymous_2)","line":23,"loc":{"start":{"line":23,"column":33},"end":{"line":23,"column":45}}},"3":{"name":"(anonymous_3)","line":39,"loc":{"start":{"line":39,"column":20},"end":{"line":39,"column":49}}},"4":{"name":"(anonymous_4)","line":44,"loc":{"start":{"line":44,"column":26},"end":{"line":44,"column":41}}},"5":{"name":"(anonymous_5)","line":53,"loc":{"start":{"line":53,"column":9},"end":{"line":53,"column":32}}},"6":{"name":"(anonymous_6)","line":73,"loc":{"start":{"line":73,"column":25},"end":{"line":73,"column":40}}},"7":{"name":"(anonymous_7)","line":78,"loc":{"start":{"line":78,"column":23},"end":{"line":78,"column":37}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":38}},"3":{"start":{"line":4,"column":0},"end":{"line":107,"column":2}},"4":{"start":{"line":6,"column":1},"end":{"line":6,"column":59}},"5":{"start":{"line":7,"column":1},"end":{"line":7,"column":14}},"6":{"start":{"line":8,"column":1},"end":{"line":8,"column":17}},"7":{"start":{"line":10,"column":1},"end":{"line":13,"column":2}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":90}},"9":{"start":{"line":12,"column":2},"end":{"line":12,"column":27}},"10":{"start":{"line":14,"column":1},"end":{"line":17,"column":2}},"11":{"start":{"line":15,"column":2},"end":{"line":15,"column":90}},"12":{"start":{"line":16,"column":2},"end":{"line":16,"column":27}},"13":{"start":{"line":19,"column":1},"end":{"line":21,"column":2}},"14":{"start":{"line":20,"column":2},"end":{"line":20,"column":41}},"15":{"start":{"line":23,"column":1},"end":{"line":26,"column":4}},"16":{"start":{"line":24,"column":2},"end":{"line":24,"column":19}},"17":{"start":{"line":25,"column":2},"end":{"line":25,"column":38}},"18":{"start":{"line":28,"column":1},"end":{"line":31,"column":3}},"19":{"start":{"line":33,"column":1},"end":{"line":35,"column":2}},"20":{"start":{"line":34,"column":2},"end":{"line":34,"column":45}},"21":{"start":{"line":37,"column":1},"end":{"line":37,"column":22}},"22":{"start":{"line":39,"column":1},"end":{"line":71,"column":3}},"23":{"start":{"line":41,"column":2},"end":{"line":41,"column":53}},"24":{"start":{"line":43,"column":2},"end":{"line":51,"column":3}},"25":{"start":{"line":44,"column":3},"end":{"line":50,"column":6}},"26":{"start":{"line":45,"column":4},"end":{"line":49,"column":5}},"27":{"start":{"line":46,"column":5},"end":{"line":46,"column":38}},"28":{"start":{"line":48,"column":5},"end":{"line":48,"column":19}},"29":{"start":{"line":53,"column":2},"end":{"line":70,"column":5}},"30":{"start":{"line":54,"column":3},"end":{"line":69,"column":4}},"31":{"start":{"line":55,"column":4},"end":{"line":55,"column":18}},"32":{"start":{"line":57,"column":10},"end":{"line":69,"column":4}},"33":{"start":{"line":58,"column":4},"end":{"line":58,"column":41}},"34":{"start":{"line":59,"column":4},"end":{"line":64,"column":5}},"35":{"start":{"line":60,"column":5},"end":{"line":60,"column":18}},"36":{"start":{"line":61,"column":5},"end":{"line":61,"column":36}},"37":{"start":{"line":63,"column":5},"end":{"line":63,"column":16}},"38":{"start":{"line":65,"column":4},"end":{"line":65,"column":50}},"39":{"start":{"line":67,"column":4},"end":{"line":67,"column":31}},"40":{"start":{"line":68,"column":4},"end":{"line":68,"column":22}},"41":{"start":{"line":73,"column":1},"end":{"line":105,"column":4}},"42":{"start":{"line":75,"column":2},"end":{"line":75,"column":23}},"43":{"start":{"line":76,"column":2},"end":{"line":76,"column":18}},"44":{"start":{"line":78,"column":2},"end":{"line":91,"column":11}},"45":{"start":{"line":79,"column":3},"end":{"line":90,"column":4}},"46":{"start":{"line":80,"column":4},"end":{"line":80,"column":64}},"47":{"start":{"line":81,"column":4},"end":{"line":83,"column":5}},"48":{"start":{"line":82,"column":5},"end":{"line":82,"column":21}},"49":{"start":{"line":85,"column":4},"end":{"line":85,"column":36}},"50":{"start":{"line":87,"column":4},"end":{"line":89,"column":5}},"51":{"start":{"line":88,"column":5},"end":{"line":88,"column":21}},"52":{"start":{"line":94,"column":2},"end":{"line":96,"column":3}},"53":{"start":{"line":95,"column":3},"end":{"line":95,"column":17}},"54":{"start":{"line":97,"column":2},"end":{"line":97,"column":89}},"55":{"start":{"line":98,"column":2},"end":{"line":103,"column":3}},"56":{"start":{"line":99,"column":3},"end":{"line":99,"column":43}},"57":{"start":{"line":101,"column":3},"end":{"line":101,"column":34}},"58":{"start":{"line":102,"column":3},"end":{"line":102,"column":17}}},"branchMap":{"1":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},{"start":{"line":10,"column":1},"end":{"line":10,"column":1}}]},"2":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},{"start":{"line":14,"column":1},"end":{"line":14,"column":1}}]},"3":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},{"start":{"line":19,"column":1},"end":{"line":19,"column":1}}]},"4":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},{"start":{"line":33,"column":1},"end":{"line":33,"column":1}}]},"5":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"6":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":45,"column":4}},{"start":{"line":45,"column":4},"end":{"line":45,"column":4}}]},"7":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":21}},{"start":{"line":45,"column":25},"end":{"line":45,"column":44}}]},"8":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":3},"end":{"line":54,"column":3}},{"start":{"line":54,"column":3},"end":{"line":54,"column":3}}]},"9":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":10},"end":{"line":57,"column":10}},{"start":{"line":57,"column":10},"end":{"line":57,"column":10}}]},"10":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":14},"end":{"line":57,"column":28}},{"start":{"line":57,"column":33},"end":{"line":57,"column":51}},{"start":{"line":57,"column":55},"end":{"line":57,"column":78}}]},"11":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":4},"end":{"line":59,"column":4}},{"start":{"line":59,"column":4},"end":{"line":59,"column":4}}]},"12":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":8},"end":{"line":59,"column":11}},{"start":{"line":59,"column":15},"end":{"line":59,"column":31}}]},"13":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":3},"end":{"line":79,"column":3}},{"start":{"line":79,"column":3},"end":{"line":79,"column":3}}]},"14":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":4},"end":{"line":81,"column":4}},{"start":{"line":81,"column":4},"end":{"line":81,"column":4}}]},"15":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":4},"end":{"line":87,"column":4}},{"start":{"line":87,"column":4},"end":{"line":87,"column":4}}]},"16":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":8},"end":{"line":87,"column":25}},{"start":{"line":87,"column":29},"end":{"line":87,"column":73}},{"start":{"line":87,"column":77},"end":{"line":87,"column":102}}]},"17":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":2},"end":{"line":94,"column":2}},{"start":{"line":94,"column":2},"end":{"line":94,"column":2}}]},"18":{"line":94,"type":"binary-expr","locations":[{"start":{"line":94,"column":7},"end":{"line":94,"column":16}},{"start":{"line":94,"column":20},"end":{"line":94,"column":33}},{"start":{"line":94,"column":38},"end":{"line":94,"column":60}}]},"19":{"line":97,"type":"binary-expr","locations":[{"start":{"line":97,"column":15},"end":{"line":97,"column":77}},{"start":{"line":97,"column":81},"end":{"line":97,"column":88}}]},"20":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":2},"end":{"line":98,"column":2}},{"start":{"line":98,"column":2},"end":{"line":98,"column":2}}]}},"code":["var _ = require('underscore');","var utils = require('keystone-utils');","","module.exports = function autokey() {","","\tvar autokey = this.autokey = _.clone(this.get('autokey'));","\tvar def = {};","\tvar list = this;","","\tif (!autokey.from) {","\t\tvar fromMsg = 'Invalid List Option (autokey) for ' + list.key + ' (from is required)\\n';","\t\tthrow new Error(fromMsg);","\t}","\tif (!autokey.path) {","\t\tvar pathMsg = 'Invalid List Option (autokey) for ' + list.key + ' (path is required)\\n';","\t\tthrow new Error(pathMsg);","\t}","","\tif ('string' === typeof autokey.from) {","\t\tautokey.from = autokey.from.split(' ');","\t}","","\tautokey.from = autokey.from.map(function(i) {","\t\ti = i.split(':');","\t\treturn { path: i[0], format: i[1] };","\t});","","\tdef[autokey.path] = {","\t\ttype: String,","\t\tindex: true","\t};","","\tif (autokey.unique) {","\t\tdef[autokey.path].index = { unique: true };","\t}","","\tthis.schema.add(def);","","\tvar getUniqueKey = function(doc, src, callback) {","","\t\tvar q = list.model.find().where(autokey.path, src);","","\t\tif (_.isObject(autokey.unique)) {","\t\t\t_.each(autokey.unique, function(k, v) {","\t\t\t\tif (_.isString(v) && v.charAt(0) === ':') {","\t\t\t\t\tq.where(k, doc.get(v.substr(1)));","\t\t\t\t} else {","\t\t\t\t\tq.where(k, v);","\t\t\t\t}","\t\t\t});","\t\t}","","\t\tq.exec(function(err, results) {","\t\t\tif (err) {","\t\t\t\tcallback(err);","\t\t\t// deliberate use of implicit type coercion with == because doc.id may need to become a String","\t\t\t} else if (results.length && (results.length > 1 || results[0].id != doc.id)) { // eslint-disable-line eqeqeq","\t\t\t\tvar inc = src.match(/^(.+)\\-(\\d+)$/);","\t\t\t\tif (inc && inc.length === 3) {","\t\t\t\t\tsrc = inc[1];","\t\t\t\t\tinc = '-' + ((inc[2] * 1) + 1);","\t\t\t\t} else {","\t\t\t\t\tinc = '-1';","\t\t\t\t}","\t\t\t\treturn getUniqueKey(doc, src + inc, callback);","\t\t\t} else {","\t\t\t\tdoc.set(autokey.path, src);","\t\t\t\treturn callback();","\t\t\t}","\t\t});","\t};","","\tthis.schema.pre('save', function(next) {","","\t\tvar modified = false;","\t\tvar values = [];","","\t\tautokey.from.forEach(function(ops) {","\t\t\tif (list.fields[ops.path]) {","\t\t\t\tvalues.push(list.fields[ops.path].format(this, ops.format));","\t\t\t\tif (list.fields[ops.path].isModified(this)) {","\t\t\t\t\tmodified = true;","\t\t\t\t}","\t\t\t} else {","\t\t\t\tvalues.push(this.get(ops.path));","\t\t\t\t// virtual paths are always assumed to have changed, except 'id'","\t\t\t\tif (ops.path !== 'id' && list.schema.pathType(ops.path) === 'virtual' || this.isModified(ops.path)) {","\t\t\t\t\tmodified = true;","\t\t\t\t}","\t\t\t}","\t\t}, this);","","\t\t// if has a value and is unmodified or fixed, don't update it","\t\tif ((!modified || autokey.fixed) && this.get(autokey.path)) {","\t\t\treturn next();","\t\t}","\t\tvar newKey = utils.slug(values.join(' '), null, { locale: autokey.locale }) || this.id;","\t\tif (autokey.unique) {","\t\t\treturn getUniqueKey(this, newKey, next);","\t\t} else {","\t\t\tthis.set(autokey.path, newKey);","\t\t\treturn next();","\t\t}","","\t});","","};",""],"l":{"1":1,"2":1,"4":1,"6":0,"7":0,"8":0,"10":0,"11":0,"12":0,"14":0,"15":0,"16":0,"19":0,"20":0,"23":0,"24":0,"25":0,"28":0,"33":0,"34":0,"37":0,"39":0,"41":0,"43":0,"44":0,"45":0,"46":0,"48":0,"53":0,"54":0,"55":0,"57":0,"58":0,"59":0,"60":0,"61":0,"63":0,"65":0,"67":0,"68":0,"73":0,"75":0,"76":0,"78":0,"79":0,"80":0,"81":0,"82":0,"85":0,"87":0,"88":0,"94":0,"95":0,"97":0,"98":0,"99":0,"101":0,"102":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/track.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/track.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"track","line":12,"loc":{"start":{"line":12,"column":17},"end":{"line":12,"column":34}}},"2":{"name":"(anonymous_2)","line":56,"loc":{"start":{"line":56,"column":17},"end":{"line":56,"column":38}}},"3":{"name":"(anonymous_3)","line":108,"loc":{"start":{"line":108,"column":25},"end":{"line":108,"column":41}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":33}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":37}},"4":{"start":{"line":12,"column":0},"end":{"line":136,"column":2}},"5":{"start":{"line":14,"column":1},"end":{"line":14,"column":17}},"6":{"start":{"line":15,"column":1},"end":{"line":15,"column":33}},"7":{"start":{"line":16,"column":1},"end":{"line":16,"column":44}},"8":{"start":{"line":17,"column":1},"end":{"line":22,"column":4}},"9":{"start":{"line":23,"column":1},"end":{"line":23,"column":17}},"10":{"start":{"line":26,"column":1},"end":{"line":30,"column":2}},"11":{"start":{"line":27,"column":2},"end":{"line":29,"column":83}},"12":{"start":{"line":32,"column":1},"end":{"line":45,"column":2}},"13":{"start":{"line":34,"column":2},"end":{"line":44,"column":3}},"14":{"start":{"line":35,"column":3},"end":{"line":40,"column":5}},"15":{"start":{"line":43,"column":3},"end":{"line":43,"column":10}},"16":{"start":{"line":48,"column":1},"end":{"line":50,"column":2}},"17":{"start":{"line":49,"column":2},"end":{"line":49,"column":9}},"18":{"start":{"line":53,"column":1},"end":{"line":53,"column":49}},"19":{"start":{"line":56,"column":1},"end":{"line":100,"column":4}},"20":{"start":{"line":58,"column":2},"end":{"line":58,"column":16}},"21":{"start":{"line":61,"column":2},"end":{"line":64,"column":3}},"22":{"start":{"line":62,"column":3},"end":{"line":63,"column":55}},"23":{"start":{"line":67,"column":2},"end":{"line":98,"column":3}},"24":{"start":{"line":70,"column":3},"end":{"line":74,"column":4}},"25":{"start":{"line":71,"column":4},"end":{"line":73,"column":85}},"26":{"start":{"line":76,"column":3},"end":{"line":93,"column":4}},"27":{"start":{"line":78,"column":4},"end":{"line":78,"column":45}},"28":{"start":{"line":79,"column":4},"end":{"line":79,"column":29}},"29":{"start":{"line":80,"column":4},"end":{"line":80,"column":29}},"30":{"start":{"line":82,"column":4},"end":{"line":92,"column":5}},"31":{"start":{"line":85,"column":6},"end":{"line":85,"column":68}},"32":{"start":{"line":86,"column":5},"end":{"line":86,"column":11}},"33":{"start":{"line":90,"column":6},"end":{"line":90,"column":98}},"34":{"start":{"line":91,"column":5},"end":{"line":91,"column":11}},"35":{"start":{"line":95,"column":3},"end":{"line":97,"column":84}},"36":{"start":{"line":103,"column":1},"end":{"line":103,"column":18}},"37":{"start":{"line":105,"column":1},"end":{"line":105,"column":25}},"38":{"start":{"line":108,"column":1},"end":{"line":134,"column":4}},"39":{"start":{"line":110,"column":2},"end":{"line":110,"column":23}},"40":{"start":{"line":113,"column":2},"end":{"line":120,"column":3}},"41":{"start":{"line":114,"column":3},"end":{"line":116,"column":4}},"42":{"start":{"line":115,"column":4},"end":{"line":115,"column":37}},"43":{"start":{"line":117,"column":3},"end":{"line":119,"column":4}},"44":{"start":{"line":118,"column":4},"end":{"line":118,"column":52}},"45":{"start":{"line":123,"column":2},"end":{"line":130,"column":3}},"46":{"start":{"line":124,"column":3},"end":{"line":126,"column":4}},"47":{"start":{"line":125,"column":4},"end":{"line":125,"column":37}},"48":{"start":{"line":127,"column":3},"end":{"line":129,"column":4}},"49":{"start":{"line":128,"column":4},"end":{"line":128,"column":52}},"50":{"start":{"line":132,"column":2},"end":{"line":132,"column":9}}},"branchMap":{"1":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},{"start":{"line":26,"column":1},"end":{"line":26,"column":1}}]},"2":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":5},"end":{"line":26,"column":26}},{"start":{"line":26,"column":30},"end":{"line":26,"column":50}}]},"3":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},{"start":{"line":32,"column":1},"end":{"line":32,"column":1}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"5":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},{"start":{"line":48,"column":1},"end":{"line":48,"column":1}}]},"6":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":5},"end":{"line":48,"column":23}},{"start":{"line":48,"column":27},"end":{"line":48,"column":45}},{"start":{"line":48,"column":49},"end":{"line":48,"column":67}},{"start":{"line":48,"column":71},"end":{"line":48,"column":89}}]},"7":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":2},"end":{"line":61,"column":2}},{"start":{"line":61,"column":2},"end":{"line":61,"column":2}}]},"8":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":2},"end":{"line":67,"column":2}},{"start":{"line":67,"column":2},"end":{"line":67,"column":2}}]},"9":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":3},"end":{"line":70,"column":3}},{"start":{"line":70,"column":3},"end":{"line":70,"column":3}}]},"10":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":7},"end":{"line":70,"column":26}},{"start":{"line":70,"column":30},"end":{"line":70,"column":48}}]},"11":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":3},"end":{"line":76,"column":3}},{"start":{"line":76,"column":3},"end":{"line":76,"column":3}}]},"12":{"line":78,"type":"cond-expr","locations":[{"start":{"line":78,"column":33},"end":{"line":78,"column":36}},{"start":{"line":78,"column":39},"end":{"line":78,"column":44}}]},"13":{"line":82,"type":"switch","locations":[{"start":{"line":83,"column":5},"end":{"line":83,"column":22}},{"start":{"line":84,"column":5},"end":{"line":86,"column":11}},{"start":{"line":88,"column":5},"end":{"line":88,"column":22}},{"start":{"line":89,"column":5},"end":{"line":91,"column":11}}]},"14":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":2},"end":{"line":113,"column":2}},{"start":{"line":113,"column":2},"end":{"line":113,"column":2}}]},"15":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":3},"end":{"line":114,"column":3}},{"start":{"line":114,"column":3},"end":{"line":114,"column":3}}]},"16":{"line":114,"type":"binary-expr","locations":[{"start":{"line":114,"column":7},"end":{"line":114,"column":24}},{"start":{"line":114,"column":28},"end":{"line":114,"column":56}}]},"17":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":3},"end":{"line":117,"column":3}},{"start":{"line":117,"column":3},"end":{"line":117,"column":3}}]},"18":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":7},"end":{"line":117,"column":24}},{"start":{"line":117,"column":28},"end":{"line":117,"column":42}},{"start":{"line":117,"column":46},"end":{"line":117,"column":74}}]},"19":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":2},"end":{"line":123,"column":2}},{"start":{"line":123,"column":2},"end":{"line":123,"column":2}}]},"20":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":6},"end":{"line":123,"column":16}},{"start":{"line":123,"column":20},"end":{"line":123,"column":37}}]},"21":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":3},"end":{"line":124,"column":3}},{"start":{"line":124,"column":3},"end":{"line":124,"column":3}}]},"22":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":3},"end":{"line":127,"column":3}},{"start":{"line":127,"column":3},"end":{"line":127,"column":3}}]},"23":{"line":127,"type":"binary-expr","locations":[{"start":{"line":127,"column":7},"end":{"line":127,"column":24}},{"start":{"line":127,"column":28},"end":{"line":127,"column":42}}]}},"code":["var _ = require('underscore');","var keystone = require('../../');","var Types = require('../fieldTypes');","","/**"," * List track option"," *"," * When enabled, it tracks when a document are created/updated, "," * as well as the user who created/updated it."," */","","module.exports = function track() {","\t","\tvar list = this;","\tvar options = list.get('track');","\tvar userModel = keystone.get('user model');","\tvar defaultOptions = { ","\t\t\tcreatedAt: false, ","\t\t\tcreatedBy: false,","\t\t\tupdatedAt: false,","\t\t\tupdatedBy: false","\t\t};","\tvar fields = {};","\t","\t// ensure track is a boolean or an object","\tif (!_.isBoolean(options) && !_.isObject(options) ) {","\t\tthrow new Error('Invalid List \"track\" option for ' + list.key + '\\n' +","\t\t\t'\"track\" must be a boolean or an object.\\n\\n' +","\t\t\t'See http://keystonejs.com/docs/database/#lists-options for more information.');\t\t\t\t","\t}","","\tif (_.isBoolean(options)) {","\t\t// shorthand: { track: true } sets all tracked fields to true","\t\tif (options) {","\t\t\toptions = { ","\t\t\t\tcreatedAt: true, ","\t\t\t\tcreatedBy: true,","\t\t\t\tupdatedAt: true,","\t\t\t\tupdatedBy: true","\t\t\t};","\t\t} else {","\t\t\t// otherwise user doesn't want tracking","\t\t\treturn;","\t\t}","\t}","","\t// if all track fields are set to false, then user doesn't want to track anything","\tif (!options.createdAt && !options.createdBy && !options.updatedAt && !options.updatedBy) {","\t\treturn;","\t}","","\t// merge user options with default options","\toptions = _.extend({}, defaultOptions, options);","","\t// validate option fields","\t_.each(options, function(value, key) {","\t\t","\t\tvar fieldName;","\t\t","\t\t// make sure the key isn't already defined as a field","\t\tif (_.has(list.fields, key)) {","\t\t\tthrow new Error('Invalid List \"track\" option for ' + list.key + '\\n' +","\t\t\t\t'\"' + key + '\" is already defined in the Schema.');","\t\t}","","\t\t// make sure it's a valid track option field","\t\tif (_.has(defaultOptions, key)) {","\t\t\t","\t\t\t// make sure the option field value is either a boolean or a string","\t\t\tif (!_.isBoolean(value) && !_.isString(value)) {","\t\t\t\tthrow new Error('Invalid List \"track\" option for ' + list.key + '\\n' +","\t\t\t\t\t'\"' + key + '\" must be a boolean or a string.\\n\\n' +","\t\t\t\t\t'See http://keystonejs.com/docs/database/#lists-options for more information.');","\t\t\t}","","\t\t\tif (value) {","\t\t\t\t// determine ","\t\t\t\tfieldName = value === true ? key : value;","\t\t\t\toptions[key] = fieldName;","\t\t\t\tlist.map(key, fieldName);","","\t\t\t\tswitch(key) {","\t\t\t\t\tcase 'createdAt':","\t\t\t\t\tcase 'updatedAt':","\t\t\t\t\t\tfields[fieldName] = { type: Date, hidden: true, index: true };","\t\t\t\t\tbreak;","","\t\t\t\t\tcase 'createdBy':","\t\t\t\t\tcase 'updatedBy':","\t\t\t\t\t\tfields[fieldName] = { type: Types.Relationship, ref: userModel, hidden: true, index: true };","\t\t\t\t\tbreak;","\t\t\t\t}","\t\t\t}","\t\t} else {","\t\t\tthrow new Error('Invalid List \"track\" option for ' + list.key + '\\n' +","\t\t\t\t'valid field options are \"createdAt\", \"createdBy\", \"updatedAt\", an \"updatedBy\".\\n\\n' +","\t\t\t\t'See http://keystonejs.com/docs/database/#lists-options for more information.');\t\t\t\t","\t\t}","","\t});","","\t// add track fields to schema","\tlist.add(fields);","\t","\tlist.tracking = options;","","\t// add the pre-save schema plugin","\tlist.schema.pre('save', function (next) {","\t\t","\t\tvar now = new Date();","","\t\t// set createdAt/createdBy on new docs","\t\tif (this.isNew) {","\t\t\tif (options.createdAt && !this.get(options.createdAt)) {","\t\t\t\tthis.set(options.createdAt, now);","\t\t\t}","\t\t\tif (options.createdBy && this._req_user && !this.get(options.createdBy)) {","\t\t\t\tthis.set(options.createdBy, this._req_user._id);","\t\t\t}","\t\t}","","\t\t// set updatedAt/updatedBy when doc is modified","\t\tif (this.isNew || this.isModified()) {","\t\t\tif (options.updatedAt) {","\t\t\t\tthis.set(options.updatedAt, now);","\t\t\t}","\t\t\tif (options.updatedBy && this._req_user) {","\t\t\t\tthis.set(options.updatedBy, this._req_user._id);","\t\t\t}","\t\t}","","\t\tnext();","\t\t","\t});","","};",""],"l":{"1":1,"2":1,"3":1,"12":1,"14":0,"15":0,"16":0,"17":0,"23":0,"26":0,"27":0,"32":0,"34":0,"35":0,"43":0,"48":0,"49":0,"53":0,"56":0,"58":0,"61":0,"62":0,"67":0,"70":0,"71":0,"76":0,"78":0,"79":0,"80":0,"82":0,"85":0,"86":0,"90":0,"91":0,"95":0,"103":0,"105":0,"108":0,"110":0,"113":0,"114":0,"115":0,"117":0,"118":0,"123":0,"124":0,"125":0,"127":0,"128":0,"132":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/history.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/history.js","s":{"1":1,"2":1,"3":1,"4":0,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"getHistoryModelName","line":5,"loc":{"start":{"line":5,"column":0},"end":{"line":5,"column":36}}},"2":{"name":"getHistoryModel","line":9,"loc":{"start":{"line":9,"column":0},"end":{"line":9,"column":42}}},"3":{"name":"history","line":40,"loc":{"start":{"line":40,"column":17},"end":{"line":40,"column":36}}},"4":{"name":"(anonymous_4)","line":61,"loc":{"start":{"line":61,"column":25},"end":{"line":61,"column":40}}},"5":{"name":"(anonymous_5)","line":96,"loc":{"start":{"line":96,"column":27},"end":{"line":96,"column":42}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":33}},"2":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"3":{"start":{"line":5,"column":0},"end":{"line":7,"column":1}},"4":{"start":{"line":6,"column":1},"end":{"line":6,"column":60}},"5":{"start":{"line":9,"column":0},"end":{"line":32,"column":1}},"6":{"start":{"line":11,"column":1},"end":{"line":11,"column":44}},"7":{"start":{"line":13,"column":1},"end":{"line":22,"column":4}},"8":{"start":{"line":24,"column":1},"end":{"line":28,"column":2}},"9":{"start":{"line":25,"column":2},"end":{"line":27,"column":5}},"10":{"start":{"line":30,"column":1},"end":{"line":30,"column":64}},"11":{"start":{"line":40,"column":0},"end":{"line":113,"column":2}},"12":{"start":{"line":42,"column":1},"end":{"line":42,"column":17}},"13":{"start":{"line":45,"column":1},"end":{"line":45,"column":48}},"14":{"start":{"line":46,"column":1},"end":{"line":51,"column":2}},"15":{"start":{"line":49,"column":2},"end":{"line":49,"column":111}},"16":{"start":{"line":50,"column":2},"end":{"line":50,"column":9}},"17":{"start":{"line":53,"column":1},"end":{"line":53,"column":44}},"18":{"start":{"line":55,"column":1},"end":{"line":55,"column":73}},"19":{"start":{"line":57,"column":1},"end":{"line":59,"column":4}},"20":{"start":{"line":61,"column":1},"end":{"line":94,"column":4}},"21":{"start":{"line":62,"column":2},"end":{"line":62,"column":69}},"22":{"start":{"line":64,"column":2},"end":{"line":64,"column":29}},"23":{"start":{"line":65,"column":2},"end":{"line":65,"column":18}},"24":{"start":{"line":66,"column":2},"end":{"line":66,"column":18}},"25":{"start":{"line":67,"column":2},"end":{"line":67,"column":20}},"26":{"start":{"line":69,"column":2},"end":{"line":75,"column":4}},"27":{"start":{"line":77,"column":2},"end":{"line":81,"column":3}},"28":{"start":{"line":78,"column":3},"end":{"line":80,"column":4}},"29":{"start":{"line":79,"column":4},"end":{"line":79,"column":21}},"30":{"start":{"line":83,"column":2},"end":{"line":87,"column":3}},"31":{"start":{"line":84,"column":3},"end":{"line":86,"column":4}},"32":{"start":{"line":85,"column":4},"end":{"line":85,"column":34}},"33":{"start":{"line":89,"column":2},"end":{"line":91,"column":3}},"34":{"start":{"line":90,"column":3},"end":{"line":90,"column":26}},"35":{"start":{"line":93,"column":2},"end":{"line":93,"column":35}},"36":{"start":{"line":96,"column":1},"end":{"line":111,"column":4}},"37":{"start":{"line":97,"column":2},"end":{"line":97,"column":29}},"38":{"start":{"line":98,"column":2},"end":{"line":98,"column":23}},"39":{"start":{"line":100,"column":2},"end":{"line":104,"column":4}},"40":{"start":{"line":106,"column":2},"end":{"line":108,"column":3}},"41":{"start":{"line":107,"column":3},"end":{"line":107,"column":26}},"42":{"start":{"line":110,"column":2},"end":{"line":110,"column":35}}},"branchMap":{"1":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},{"start":{"line":24,"column":1},"end":{"line":24,"column":1}}]},"2":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},{"start":{"line":46,"column":1},"end":{"line":46,"column":1}}]},"3":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":5},"end":{"line":46,"column":25}},{"start":{"line":47,"column":2},"end":{"line":47,"column":102}},{"start":{"line":48,"column":2},"end":{"line":48,"column":42}}]},"4":{"line":62,"type":"cond-expr","locations":[{"start":{"line":62,"column":50},"end":{"line":62,"column":64}},{"start":{"line":62,"column":67},"end":{"line":62,"column":68}}]},"5":{"line":72,"type":"cond-expr","locations":[{"start":{"line":72,"column":19},"end":{"line":72,"column":22}},{"start":{"line":72,"column":25},"end":{"line":72,"column":28}}]},"6":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":3},"end":{"line":78,"column":3}},{"start":{"line":78,"column":3},"end":{"line":78,"column":3}}]},"7":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":2},"end":{"line":83,"column":2}},{"start":{"line":83,"column":2},"end":{"line":83,"column":2}}]},"8":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":3},"end":{"line":84,"column":3}},{"start":{"line":84,"column":3},"end":{"line":84,"column":3}}]},"9":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":2},"end":{"line":89,"column":2}},{"start":{"line":89,"column":2},"end":{"line":89,"column":2}}]},"10":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":6},"end":{"line":89,"column":15}},{"start":{"line":89,"column":19},"end":{"line":89,"column":33}}]},"11":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":2},"end":{"line":106,"column":2}},{"start":{"line":106,"column":2},"end":{"line":106,"column":2}}]},"12":{"line":106,"type":"binary-expr","locations":[{"start":{"line":106,"column":6},"end":{"line":106,"column":15}},{"start":{"line":106,"column":19},"end":{"line":106,"column":33}}]}},"code":["var keystone = require('../../');","","var historyModelSuffix = '_revisions'; ","","function getHistoryModelName (list) {","\treturn list.options.schema.collection + historyModelSuffix;","}","","function getHistoryModel(list, userModel) {","\t","\tvar collection = getHistoryModelName(list);","\t","\tvar schema = new keystone.mongoose.Schema({","\t\ti: { type: keystone.mongoose.Schema.Types.ObjectId, ref: collection },","\t\tt: { type: Date, index: true, required: true },","\t\to: { type: String, index: true, required: true },","\t\tc: { type: [String], index: true },","\t\td: { type: keystone.mongoose.Schema.Types.Mixed, required: true }","\t}, {","\t\tid: true,","\t\tversionKey: false","\t});","\t","\tif (userModel) {","\t\tschema.add({","\t\t\tu: { type: keystone.mongoose.Schema.Types.ObjectId, ref: userModel }","\t\t});","\t}","\t","\treturn keystone.mongoose.model(collection, schema, collection);","\t","}","","/**"," * List history option"," *"," * When enabled, it tracks changes to each document on save or remove."," */","","module.exports = function history() {","","\tvar list = this;","\t","\t//If model already exists for a '_revisions' in an inherited model, log a warning but skip creating the new model (inherited _revisions model will be used).","\tvar collectionName = getHistoryModelName(list);","\tif (list.get('inherits') &&","\t\tcollectionName.indexOf(historyModelSuffix, collectionName.length - historyModelSuffix.length) !== -1 &&","\t\tkeystone.mongoose.models[collectionName]) {","\t\tconsole.log('List/model already exists for ' + collectionName + '.\\nWon\\'t re-create, keystone continuing.');","\t\treturn;","\t}","","\tvar userModel = keystone.get('user model');","\t","\tvar HistoryModel = list.HistoryModel = getHistoryModel(this, userModel);","\t","\tlist.schema.add({","\t\t__rev: Number","\t});","\t","\tlist.schema.pre('save', function(next) {","\t\tthis.__rev = (typeof this.__rev === 'number') ? this.__rev + 1 : 1;","\t\t","\t\tvar data = this.toObject();","\t\tdelete data._id;","\t\tdelete data.__v;","\t\tdelete data.__rev;","\t\t","\t\tvar doc = {","\t\t\ti: this.id,","\t\t\tt: Date.now(),","\t\t\to: this.isNew ? 'c' : 'u',","\t\t\tc: [],","\t\t\td: data","\t\t};","\t\t","\t\tfor (var path in list.fields) {","\t\t\tif (this.isModified(path)) {","\t\t\t\tdoc.c.push(path);","\t\t\t}","\t\t}","\t\t","\t\tif (list.autokey) {","\t\t\tif (this.isModified(list.autokey.path)) {","\t\t\t\tdoc.c.push(list.autokey.path);","\t\t\t}","\t\t}","\t\t","\t\tif (userModel && this._req_user) {","\t\t\tdoc.u = this._req_user;","\t\t}","\t\t","\t\tnew HistoryModel(doc).save(next);","\t});","\t","\tlist.schema.pre('remove', function(next) {","\t\tvar data = this.toObject();","\t\tdata.__v = undefined;","\t\t","\t\tvar doc = {","\t\t\tt: Date.now(),","\t\t\to: 'd',","\t\t\td: data","\t\t};","\t\t","\t\tif (userModel && this._req_user) {","\t\t\tdoc.u = this._req_user;","\t\t}","\t\t","\t\tnew HistoryModel(doc).save(next);","\t});","","};",""],"l":{"1":1,"3":1,"5":1,"6":0,"9":1,"11":0,"13":0,"24":0,"25":0,"30":0,"40":1,"42":0,"45":0,"46":0,"49":0,"50":0,"53":0,"55":0,"57":0,"61":0,"62":0,"64":0,"65":0,"66":0,"67":0,"69":0,"77":0,"78":0,"79":0,"83":0,"84":0,"85":0,"89":0,"90":0,"93":0,"96":0,"97":0,"98":0,"100":0,"106":0,"107":0,"110":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/methods/getRelated.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/methods/getRelated.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"getRelated","line":5,"loc":{"start":{"line":5,"column":17},"end":{"line":5,"column":66}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":15},"end":{"line":28,"column":33}}},"3":{"name":"(anonymous_3)","line":53,"loc":{"start":{"line":53,"column":37},"end":{"line":53,"column":51}}},"4":{"name":"(anonymous_4)","line":63,"loc":{"start":{"line":63,"column":29},"end":{"line":63,"column":44}}},"5":{"name":"(anonymous_5)","line":80,"loc":{"start":{"line":80,"column":15},"end":{"line":80,"column":38}}},"6":{"name":"(anonymous_6)","line":84,"loc":{"start":{"line":84,"column":32},"end":{"line":84,"column":47}}},"7":{"name":"(anonymous_7)","line":85,"loc":{"start":{"line":85,"column":14},"end":{"line":85,"column":29}}},"8":{"name":"(anonymous_8)","line":89,"loc":{"start":{"line":89,"column":6},"end":{"line":89,"column":20}}},"9":{"name":"(anonymous_9)","line":105,"loc":{"start":{"line":105,"column":23},"end":{"line":105,"column":46}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":36}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":30}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"4":{"start":{"line":5,"column":0},"end":{"line":112,"column":2}},"5":{"start":{"line":7,"column":1},"end":{"line":7,"column":17}},"6":{"start":{"line":8,"column":1},"end":{"line":8,"column":22}},"7":{"start":{"line":9,"column":1},"end":{"line":9,"column":16}},"8":{"start":{"line":11,"column":1},"end":{"line":13,"column":2}},"9":{"start":{"line":12,"column":2},"end":{"line":12,"column":96}},"10":{"start":{"line":15,"column":1},"end":{"line":26,"column":2}},"11":{"start":{"line":16,"column":2},"end":{"line":16,"column":34}},"12":{"start":{"line":17,"column":2},"end":{"line":17,"column":20}},"13":{"start":{"line":18,"column":2},"end":{"line":18,"column":13}},"14":{"start":{"line":19,"column":2},"end":{"line":25,"column":3}},"15":{"start":{"line":20,"column":3},"end":{"line":20,"column":58}},"16":{"start":{"line":21,"column":3},"end":{"line":24,"column":4}},"17":{"start":{"line":22,"column":4},"end":{"line":22,"column":25}},"18":{"start":{"line":23,"column":4},"end":{"line":23,"column":18}},"19":{"start":{"line":28,"column":1},"end":{"line":103,"column":4}},"20":{"start":{"line":30,"column":2},"end":{"line":30,"column":26}},"21":{"start":{"line":32,"column":2},"end":{"line":38,"column":3}},"22":{"start":{"line":33,"column":3},"end":{"line":36,"column":4}},"23":{"start":{"line":34,"column":4},"end":{"line":34,"column":87}},"24":{"start":{"line":35,"column":4},"end":{"line":35,"column":54}},"25":{"start":{"line":37,"column":3},"end":{"line":37,"column":31}},"26":{"start":{"line":39,"column":2},"end":{"line":39,"column":44}},"27":{"start":{"line":40,"column":2},"end":{"line":40,"column":42}},"28":{"start":{"line":42,"column":2},"end":{"line":42,"column":54}},"29":{"start":{"line":43,"column":2},"end":{"line":43,"column":130}},"30":{"start":{"line":43,"column":21},"end":{"line":43,"column":130}},"31":{"start":{"line":45,"column":2},"end":{"line":45,"column":48}},"32":{"start":{"line":46,"column":2},"end":{"line":46,"column":98}},"33":{"start":{"line":46,"column":16},"end":{"line":46,"column":98}},"34":{"start":{"line":48,"column":2},"end":{"line":48,"column":54}},"35":{"start":{"line":49,"column":2},"end":{"line":49,"column":235}},"36":{"start":{"line":49,"column":53},"end":{"line":49,"column":235}},"37":{"start":{"line":51,"column":2},"end":{"line":61,"column":3}},"38":{"start":{"line":53,"column":3},"end":{"line":59,"column":6}},"39":{"start":{"line":54,"column":4},"end":{"line":58,"column":5}},"40":{"start":{"line":55,"column":5},"end":{"line":55,"column":31}},"41":{"start":{"line":57,"column":5},"end":{"line":57,"column":32}},"42":{"start":{"line":63,"column":2},"end":{"line":98,"column":4}},"43":{"start":{"line":65,"column":3},"end":{"line":65,"column":57}},"44":{"start":{"line":67,"column":3},"end":{"line":69,"column":4}},"45":{"start":{"line":68,"column":4},"end":{"line":68,"column":37}},"46":{"start":{"line":71,"column":3},"end":{"line":75,"column":4}},"47":{"start":{"line":72,"column":4},"end":{"line":72,"column":24}},"48":{"start":{"line":74,"column":4},"end":{"line":74,"column":26}},"49":{"start":{"line":77,"column":3},"end":{"line":77,"column":72}},"50":{"start":{"line":79,"column":3},"end":{"line":96,"column":4}},"51":{"start":{"line":80,"column":4},"end":{"line":93,"column":7}},"52":{"start":{"line":81,"column":5},"end":{"line":83,"column":6}},"53":{"start":{"line":82,"column":6},"end":{"line":82,"column":32}},"54":{"start":{"line":84,"column":5},"end":{"line":92,"column":7}},"55":{"start":{"line":85,"column":7},"end":{"line":87,"column":9}},"56":{"start":{"line":86,"column":8},"end":{"line":86,"column":52}},"57":{"start":{"line":90,"column":7},"end":{"line":90,"column":26}},"58":{"start":{"line":95,"column":4},"end":{"line":95,"column":21}},"59":{"start":{"line":100,"column":2},"end":{"line":100,"column":71}},"60":{"start":{"line":100,"column":37},"end":{"line":100,"column":71}},"61":{"start":{"line":101,"column":2},"end":{"line":101,"column":57}},"62":{"start":{"line":105,"column":1},"end":{"line":110,"column":4}},"63":{"start":{"line":106,"column":2},"end":{"line":108,"column":3}},"64":{"start":{"line":107,"column":3},"end":{"line":107,"column":31}},"65":{"start":{"line":109,"column":2},"end":{"line":109,"column":25}}},"branchMap":{"1":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},{"start":{"line":11,"column":1},"end":{"line":11,"column":1}}]},"2":{"line":15,"type":"if","locations":[{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},{"start":{"line":15,"column":1},"end":{"line":15,"column":1}}]},"3":{"line":20,"type":"cond-expr","locations":[{"start":{"line":20,"column":34},"end":{"line":20,"column":37}},{"start":{"line":20,"column":40},"end":{"line":20,"column":42}}]},"4":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":3},"end":{"line":21,"column":3}},{"start":{"line":21,"column":3},"end":{"line":21,"column":3}}]},"5":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":7},"end":{"line":21,"column":32}},{"start":{"line":21,"column":36},"end":{"line":21,"column":80}}]},"6":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"7":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":3},"end":{"line":33,"column":3}},{"start":{"line":33,"column":3},"end":{"line":33,"column":3}}]},"8":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":21},"end":{"line":39,"column":37}},{"start":{"line":39,"column":41},"end":{"line":39,"column":43}}]},"9":{"line":40,"type":"binary-expr","locations":[{"start":{"line":40,"column":20},"end":{"line":40,"column":35}},{"start":{"line":40,"column":39},"end":{"line":40,"column":41}}]},"10":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":2},"end":{"line":43,"column":2}},{"start":{"line":43,"column":2},"end":{"line":43,"column":2}}]},"11":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":2},"end":{"line":46,"column":2}},{"start":{"line":46,"column":2},"end":{"line":46,"column":2}}]},"12":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":2},"end":{"line":49,"column":2}},{"start":{"line":49,"column":2},"end":{"line":49,"column":2}}]},"13":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":6},"end":{"line":49,"column":15}},{"start":{"line":49,"column":19},"end":{"line":49,"column":51}}]},"14":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":2},"end":{"line":51,"column":2}},{"start":{"line":51,"column":2},"end":{"line":51,"column":2}}]},"15":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"16":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":3},"end":{"line":67,"column":3}},{"start":{"line":67,"column":3},"end":{"line":67,"column":3}}]},"17":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":3},"end":{"line":71,"column":3}},{"start":{"line":71,"column":3},"end":{"line":71,"column":3}}]},"18":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":14},"end":{"line":77,"column":26}},{"start":{"line":77,"column":30},"end":{"line":77,"column":47}},{"start":{"line":77,"column":51},"end":{"line":77,"column":70}}]},"19":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":3},"end":{"line":79,"column":3}},{"start":{"line":79,"column":3},"end":{"line":79,"column":3}}]},"20":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":5},"end":{"line":81,"column":5}},{"start":{"line":81,"column":5},"end":{"line":81,"column":5}}]},"21":{"line":81,"type":"binary-expr","locations":[{"start":{"line":81,"column":9},"end":{"line":81,"column":12}},{"start":{"line":81,"column":16},"end":{"line":81,"column":31}}]},"22":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":2},"end":{"line":100,"column":2}},{"start":{"line":100,"column":2},"end":{"line":100,"column":2}}]},"23":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":2},"end":{"line":106,"column":2}},{"start":{"line":106,"column":2},"end":{"line":106,"column":2}}]},"24":{"line":106,"type":"binary-expr","locations":[{"start":{"line":106,"column":6},"end":{"line":106,"column":17}},{"start":{"line":106,"column":21},"end":{"line":106,"column":28}},{"start":{"line":106,"column":32},"end":{"line":106,"column":50}}]}},"code":["var keystone = require('../../../');","var _ = require('underscore');","var async = require('async');","","module.exports = function getRelated(paths, callback, nocollapse) {","","\tvar item = this;","\tvar list = this.list;","\tvar queue = {};","","\tif ('function' !== typeof callback) {","\t\tthrow new Error('List.getRelated(paths, callback, nocollapse) requires a callback function.');","\t}","","\tif ('string' === typeof paths) {","\t\tvar pathsArr = paths.split(' ');","\t\tvar lastPath = '';","\t\tpaths = [];","\t\tfor (var i = 0; i < pathsArr.length; i++) {","\t\t\tlastPath += (lastPath.length ? ' ' : '') + pathsArr[i];","\t\t\tif (lastPath.indexOf('[') < 0 || lastPath.charAt(lastPath.length - 1) === ']') {","\t\t\t\tpaths.push(lastPath);","\t\t\t\tlastPath = '';","\t\t\t}","\t\t}","\t}","","\t_.each(paths, function(options) {","","\t\tvar populateString = '';","","\t\tif ('string' === typeof options) {","\t\t\tif (options.indexOf('[') > 0) {","\t\t\t\tpopulateString = options.substring(options.indexOf('[') + 1, options.indexOf(']'));","\t\t\t\toptions = options.substr(0, options.indexOf('['));","\t\t\t}","\t\t\toptions = { path: options };","\t\t}","\t\toptions.populate = options.populate || [];","\t\toptions.related = options.related || [];","","\t\tvar relationship = list.relationships[options.path];","\t\tif (!relationship) throw new Error('List.getRelated: list ' + list.key + ' does not have a relationship ' + options.path + '.');","","\t\tvar refList = keystone.list(relationship.ref);","\t\tif (!refList) throw new Error('List.getRelated: list ' + relationship.ref + ' does not exist.');","","\t\tvar relField = refList.fields[relationship.refPath];","\t\tif (!relField || relField.type !== 'relationship') throw new Error('List.getRelated: relationship ' + relationship.ref + ' on list ' + list.key + ' refers to a path (' + relationship.refPath + ') which is not a relationship field.');","","\t\tif (populateString.length) {","","\t\t\t_.each(populateString.split(' '), function(key) {","\t\t\t\tif (refList.relationships[key]) {","\t\t\t\t\toptions.related.push(key);","\t\t\t\t} else {","\t\t\t\t\toptions.populate.push(key);","\t\t\t\t}","\t\t\t});","","\t\t}","","\t\tqueue[relationship.path] = function(done) {","","\t\t\tvar query = refList.model.find().where(relField.path);","","\t\t\tif (options.populate) {","\t\t\t\tquery.populate(options.populate);","\t\t\t}","","\t\t\tif (relField.many) {","\t\t\t\tquery.in([item.id]);","\t\t\t} else {","\t\t\t\tquery.equals(item.id);","\t\t\t}","","\t\t\tquery.sort(options.sort || relationship.sort || refList.defaultSort);","","\t\t\tif (options.related.length) {","\t\t\t\tquery.exec(function(err, results) {","\t\t\t\t\tif (err || !results.length) {","\t\t\t\t\t\treturn done(err, results);","\t\t\t\t\t}","\t\t\t\t\tasync.parallel(results.map(function(item) {","\t\t\t\t\t\t\treturn function(done) {","\t\t\t\t\t\t\t\titem.populateRelated(options.related, done);","\t\t\t\t\t\t\t};","\t\t\t\t\t\t}),","\t\t\t\t\t\tfunction(err) {","\t\t\t\t\t\t\tdone(err, results);","\t\t\t\t\t\t}","\t\t\t\t\t);","\t\t\t\t});","\t\t\t} else {","\t\t\t\tquery.exec(done);","\t\t\t}","","\t\t};","","\t\tif (!item._populatedRelationships) item._populatedRelationships = {};","\t\titem._populatedRelationships[relationship.path] = true;","","\t});","","\tasync.parallel(queue, function(err, results) {","\t\tif (!nocollapse && results && paths.length === 1) {","\t\t\tresults = results[paths[0]];","\t\t}","\t\tcallback(err, results);","\t});","","};",""],"l":{"1":1,"2":1,"3":1,"5":1,"7":0,"8":0,"9":0,"11":0,"12":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"28":0,"30":0,"32":0,"33":0,"34":0,"35":0,"37":0,"39":0,"40":0,"42":0,"43":0,"45":0,"46":0,"48":0,"49":0,"51":0,"53":0,"54":0,"55":0,"57":0,"63":0,"65":0,"67":0,"68":0,"71":0,"72":0,"74":0,"77":0,"79":0,"80":0,"81":0,"82":0,"84":0,"85":0,"86":0,"90":0,"95":0,"100":0,"101":0,"105":0,"106":0,"107":0,"109":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/methods/populateRelated.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/methods/populateRelated.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"b":{"1":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"populateRelated","line":3,"loc":{"start":{"line":3,"column":17},"end":{"line":3,"column":57}}},"2":{"name":"(anonymous_2)","line":11,"loc":{"start":{"line":11,"column":22},"end":{"line":11,"column":45}}},"3":{"name":"(anonymous_3)","line":12,"loc":{"start":{"line":12,"column":18},"end":{"line":12,"column":38}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":3,"column":0},"end":{"line":18,"column":2}},"3":{"start":{"line":5,"column":1},"end":{"line":5,"column":17}},"4":{"start":{"line":7,"column":1},"end":{"line":9,"column":2}},"5":{"start":{"line":8,"column":2},"end":{"line":8,"column":87}},"6":{"start":{"line":11,"column":1},"end":{"line":16,"column":10}},"7":{"start":{"line":12,"column":2},"end":{"line":14,"column":5}},"8":{"start":{"line":13,"column":3},"end":{"line":13,"column":20}},"9":{"start":{"line":15,"column":2},"end":{"line":15,"column":25}}},"branchMap":{"1":{"line":7,"type":"if","locations":[{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},{"start":{"line":7,"column":1},"end":{"line":7,"column":1}}]}},"code":["var _ = require('underscore');","","module.exports = function populateRelated(rel, callback) {","","\tvar item = this;","","\tif ('function' !== typeof callback) {","\t\tthrow new Error('List.populateRelated(rel, callback) requires a callback function.');","\t}","","\tthis.getRelated(rel, function(err, results) {","\t\t_.each(results, function(data, key) {","\t\t\titem[key] = data;","\t\t});","\t\tcallback(err, results);","\t}, true);","","};",""],"l":{"1":1,"3":1,"5":0,"7":0,"8":0,"11":0,"12":0,"13":0,"15":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/options/transform.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/schemaPlugins/options/transform.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"transform","line":3,"loc":{"start":{"line":3,"column":17},"end":{"line":3,"column":46}}},"2":{"name":"(anonymous_2)","line":5,"loc":{"start":{"line":5,"column":38},"end":{"line":5,"column":56}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":3,"column":0},"end":{"line":10,"column":2}},"3":{"start":{"line":4,"column":1},"end":{"line":9,"column":2}},"4":{"start":{"line":5,"column":2},"end":{"line":8,"column":5}},"5":{"start":{"line":6,"column":3},"end":{"line":6,"column":19}},"6":{"start":{"line":6,"column":12},"end":{"line":6,"column":19}},"7":{"start":{"line":7,"column":3},"end":{"line":7,"column":23}}},"branchMap":{"1":{"line":4,"type":"if","locations":[{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},{"start":{"line":4,"column":1},"end":{"line":4,"column":1}}]},"2":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":3},"end":{"line":6,"column":3}},{"start":{"line":6,"column":3},"end":{"line":6,"column":3}}]}},"code":["var _ = require('underscore');","","module.exports = function transform(doc, ret) {","\tif (doc._populatedRelationships) {","\t\t_.each(doc._populatedRelationships, function(on, key) {","\t\t\tif (!on) return;","\t\t\tret[key] = doc[key];","\t\t});","\t}","};",""],"l":{"1":1,"3":1,"4":0,"5":0,"6":0,"7":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/set.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/set.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":1},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"set","line":8,"loc":{"start":{"line":8,"column":0},"end":{"line":8,"column":25}}}},"statementMap":{"1":{"start":{"line":8,"column":0},"end":{"line":14,"column":1}},"2":{"start":{"line":9,"column":1},"end":{"line":11,"column":2}},"3":{"start":{"line":10,"column":2},"end":{"line":10,"column":27}},"4":{"start":{"line":12,"column":1},"end":{"line":12,"column":27}},"5":{"start":{"line":13,"column":1},"end":{"line":13,"column":14}},"6":{"start":{"line":16,"column":0},"end":{"line":16,"column":21}}},"branchMap":{"1":{"line":9,"type":"if","locations":[{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},{"start":{"line":9,"column":1},"end":{"line":9,"column":1}}]}},"code":["/**"," * Gets and Sets list options. Aliased as .get()"," *"," * Example:"," *     list.set('test') // returns the 'test' value"," *     list.set('test', value) // sets the 'test' option to `value`"," */","function set(key, value) {","\tif (arguments.length === 1) {","\t\treturn this.options[key];","\t}","\tthis.options[key] = value;","\treturn value;","}","","module.exports = set;",""],"l":{"8":1,"9":0,"10":0,"12":0,"13":0,"16":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/add.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/add.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0,0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"add","line":8,"loc":{"start":{"line":8,"column":0},"end":{"line":8,"column":16}}},"2":{"name":"(anonymous_2)","line":9,"loc":{"start":{"line":9,"column":11},"end":{"line":9,"column":33}}},"3":{"name":"(anonymous_3)","line":35,"loc":{"start":{"line":35,"column":16},"end":{"line":35,"column":40}}},"4":{"name":"(anonymous_4)","line":45,"loc":{"start":{"line":45,"column":19},"end":{"line":45,"column":33}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":38}},"3":{"start":{"line":8,"column":0},"end":{"line":77,"column":1}},"4":{"start":{"line":9,"column":1},"end":{"line":33,"column":14}},"5":{"start":{"line":10,"column":2},"end":{"line":10,"column":24}},"6":{"start":{"line":11,"column":2},"end":{"line":11,"column":30}},"7":{"start":{"line":12,"column":2},"end":{"line":32,"column":3}},"8":{"start":{"line":13,"column":3},"end":{"line":13,"column":21}},"9":{"start":{"line":14,"column":3},"end":{"line":19,"column":4}},"10":{"start":{"line":15,"column":4},"end":{"line":18,"column":6}},"11":{"start":{"line":20,"column":3},"end":{"line":31,"column":4}},"12":{"start":{"line":21,"column":4},"end":{"line":28,"column":5}},"13":{"start":{"line":24,"column":5},"end":{"line":24,"column":42}},"14":{"start":{"line":25,"column":5},"end":{"line":25,"column":39}},"15":{"start":{"line":27,"column":5},"end":{"line":27,"column":38}},"16":{"start":{"line":30,"column":4},"end":{"line":30,"column":37}},"17":{"start":{"line":35,"column":1},"end":{"line":43,"column":14}},"18":{"start":{"line":36,"column":2},"end":{"line":38,"column":3}},"19":{"start":{"line":37,"column":3},"end":{"line":37,"column":84}},"20":{"start":{"line":39,"column":2},"end":{"line":42,"column":5}},"21":{"start":{"line":45,"column":1},"end":{"line":74,"column":10}},"22":{"start":{"line":46,"column":2},"end":{"line":46,"column":30}},"23":{"start":{"line":47,"column":2},"end":{"line":73,"column":3}},"24":{"start":{"line":48,"column":3},"end":{"line":62,"column":4}},"25":{"start":{"line":49,"column":4},"end":{"line":51,"column":7}},"26":{"start":{"line":52,"column":10},"end":{"line":62,"column":4}},"27":{"start":{"line":53,"column":4},"end":{"line":55,"column":7}},"28":{"start":{"line":57,"column":4},"end":{"line":61,"column":7}},"29":{"start":{"line":64,"column":3},"end":{"line":72,"column":4}},"30":{"start":{"line":65,"column":4},"end":{"line":69,"column":7}},"31":{"start":{"line":71,"column":4},"end":{"line":71,"column":13}},"32":{"start":{"line":76,"column":1},"end":{"line":76,"column":13}},"33":{"start":{"line":79,"column":0},"end":{"line":79,"column":21}}},"branchMap":{"1":{"line":10,"type":"binary-expr","locations":[{"start":{"line":10,"column":11},"end":{"line":10,"column":17}},{"start":{"line":10,"column":21},"end":{"line":10,"column":23}}]},"2":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":3},"end":{"line":14,"column":3}},{"start":{"line":14,"column":3},"end":{"line":14,"column":3}}]},"3":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":3},"end":{"line":20,"column":3}},{"start":{"line":20,"column":3},"end":{"line":20,"column":3}}]},"4":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":7},"end":{"line":20,"column":31}},{"start":{"line":20,"column":36},"end":{"line":20,"column":57}},{"start":{"line":20,"column":61},"end":{"line":20,"column":99}},{"start":{"line":20,"column":105},"end":{"line":20,"column":119}},{"start":{"line":20,"column":123},"end":{"line":20,"column":141}}]},"5":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":4},"end":{"line":21,"column":4}},{"start":{"line":21,"column":4},"end":{"line":21,"column":4}}]},"6":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"7":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":2},"end":{"line":47,"column":2}},{"start":{"line":47,"column":2},"end":{"line":47,"column":2}}]},"8":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":3},"end":{"line":48,"column":3}},{"start":{"line":48,"column":3},"end":{"line":48,"column":3}}]},"9":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":10},"end":{"line":52,"column":10}},{"start":{"line":52,"column":10},"end":{"line":52,"column":10}}]},"10":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":3},"end":{"line":64,"column":3}},{"start":{"line":64,"column":3},"end":{"line":64,"column":3}}]},"11":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":7},"end":{"line":64,"column":18}},{"start":{"line":64,"column":22},"end":{"line":64,"column":53}}]}},"code":["var _ = require('underscore');","var utils = require('keystone-utils');","","/**"," * Adds one or more fields to the List"," * Based on Mongoose's Schema.add"," */","function add () {","\tvar add = function(obj, prefix) {","\t\tprefix = prefix || '';","\t\tvar keys = Object.keys(obj);","\t\tfor (var i = 0; i < keys.length; ++i) {","\t\t\tvar key = keys[i];","\t\t\tif (!obj[key]) {","\t\t\t\tthrow new Error(","\t\t\t\t\t'Invalid value for schema path `' + prefix + key + '` in `' + this.key + '`.\\n' +","\t\t\t\t\t'Did you misspell the field type?\\n'","\t\t\t\t);","\t\t\t}","\t\t\tif (utils.isObject(obj[key]) && (!obj[key].constructor || 'Object' === obj[key].constructor.name) && (!obj[key].type || obj[key].type.type)) {","\t\t\t\tif (Object.keys(obj[key]).length) {","\t\t\t\t\t// nested object, e.g. { last: { name: String }}","\t\t\t\t\t// matches logic in mongoose/Schema:add","\t\t\t\t\tthis.schema.nested[this.path] = true;","\t\t\t\t\tadd(obj[key], prefix + key + '.');","\t\t\t\t} else {","\t\t\t\t\taddField(prefix + key, obj[key]); // mixed type field","\t\t\t\t}","\t\t\t} else {","\t\t\t\taddField(prefix + key, obj[key]);","\t\t\t}","\t\t}","\t}.bind(this);","","\tvar addField = function(path, options) {","\t\tif (this.isReserved(path)) {","\t\t\tthrow new Error('Path ' + path + ' on list ' + this.key + ' is a reserved path');","\t\t}","\t\tthis.uiElements.push({","\t\t\ttype: 'field',","\t\t\tfield: this.field(path, options)","\t\t});","\t}.bind(this);","","\t_.each(arguments, function(def) {","\t\tthis.schemaFields.push(def);","\t\tif ('string' === typeof def) {","\t\t\tif (def === '>>>') {","\t\t\t\tthis.uiElements.push({","\t\t\t\t\ttype: 'indent'","\t\t\t\t});","\t\t\t} else if (def === '<<<') {","\t\t\t\tthis.uiElements.push({","\t\t\t\t\ttype: 'outdent'","\t\t\t\t});","\t\t\t} else {","\t\t\t\tthis.uiElements.push({","\t\t\t\t\ttype: 'heading',","\t\t\t\t\theading: def,","\t\t\t\t\toptions: {}","\t\t\t\t});","\t\t\t}","\t\t} else {","\t\t\tif (def.heading && 'string' === typeof def.heading) {","\t\t\t\tthis.uiElements.push({","\t\t\t\t\ttype: 'heading',","\t\t\t\t\theading: def.heading,","\t\t\t\t\toptions: def","\t\t\t\t});","\t\t\t} else {","\t\t\t\tadd(def);","\t\t\t}","\t\t}","\t}, this);","","\treturn this;","}","","module.exports = add;",""],"l":{"1":1,"2":1,"8":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"20":0,"21":0,"24":0,"25":0,"27":0,"30":0,"35":0,"36":0,"37":0,"39":0,"45":0,"46":0,"47":0,"48":0,"49":0,"52":0,"53":0,"57":0,"64":0,"65":0,"71":0,"76":0,"79":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/map.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/map.js","s":{"1":1,"2":0,"3":0,"4":0,"5":1},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"map","line":4,"loc":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}}}},"statementMap":{"1":{"start":{"line":4,"column":0},"end":{"line":9,"column":1}},"2":{"start":{"line":5,"column":1},"end":{"line":7,"column":2}},"3":{"start":{"line":6,"column":2},"end":{"line":6,"column":30}},"4":{"start":{"line":8,"column":1},"end":{"line":8,"column":29}},"5":{"start":{"line":11,"column":0},"end":{"line":11,"column":21}}},"branchMap":{"1":{"line":5,"type":"if","locations":[{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},{"start":{"line":5,"column":1},"end":{"line":5,"column":1}}]}},"code":["/**"," * Maps a built-in field (e.g. name) to a specific path"," */","function map (field, path) {","\tif (path) {","\t\tthis.mappings[field] = path;","\t}","\treturn this.mappings[field];","}","","module.exports = map;",""],"l":{"4":1,"5":0,"6":0,"8":0,"11":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/automap.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/automap.js","s":{"1":1,"2":0,"3":0,"4":0,"5":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"automap","line":5,"loc":{"start":{"line":5,"column":0},"end":{"line":5,"column":25}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":10,"column":1}},"2":{"start":{"line":6,"column":1},"end":{"line":8,"column":2}},"3":{"start":{"line":7,"column":2},"end":{"line":7,"column":35}},"4":{"start":{"line":9,"column":1},"end":{"line":9,"column":13}},"5":{"start":{"line":12,"column":0},"end":{"line":12,"column":25}}},"branchMap":{"1":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},{"start":{"line":6,"column":1},"end":{"line":6,"column":1}}]},"2":{"line":6,"type":"binary-expr","locations":[{"start":{"line":6,"column":6},"end":{"line":6,"column":33}},{"start":{"line":6,"column":38},"end":{"line":6,"column":64}}]}},"code":["/**"," * Checks to see if a field path matches a currently unmapped path, and"," * if so, adds a mapping for it."," */","function automap (field) {","\tif ((field.path in this.mappings) && !this.mappings[field.path]) {","\t\tthis.map(field.path, field.path);","\t}","\treturn this;","}","","module.exports = automap;",""],"l":{"5":1,"6":0,"7":0,"9":0,"12":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/field.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/field.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"field","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":31}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":47}},"2":{"start":{"line":7,"column":0},"end":{"line":49,"column":1}},"3":{"start":{"line":8,"column":1},"end":{"line":10,"column":2}},"4":{"start":{"line":9,"column":2},"end":{"line":9,"column":27}},"5":{"start":{"line":11,"column":1},"end":{"line":13,"column":2}},"6":{"start":{"line":12,"column":2},"end":{"line":12,"column":30}},"7":{"start":{"line":14,"column":1},"end":{"line":16,"column":2}},"8":{"start":{"line":15,"column":2},"end":{"line":15,"column":24}},"9":{"start":{"line":17,"column":1},"end":{"line":19,"column":2}},"10":{"start":{"line":18,"column":2},"end":{"line":18,"column":41}},"11":{"start":{"line":20,"column":1},"end":{"line":22,"column":2}},"12":{"start":{"line":21,"column":2},"end":{"line":21,"column":67}},"13":{"start":{"line":23,"column":1},"end":{"line":36,"column":2}},"14":{"start":{"line":25,"column":2},"end":{"line":35,"column":3}},"15":{"start":{"line":26,"column":3},"end":{"line":26,"column":35}},"16":{"start":{"line":27,"column":9},"end":{"line":35,"column":3}},"17":{"start":{"line":28,"column":3},"end":{"line":28,"column":37}},"18":{"start":{"line":29,"column":9},"end":{"line":35,"column":3}},"19":{"start":{"line":30,"column":3},"end":{"line":30,"column":38}},"20":{"start":{"line":31,"column":9},"end":{"line":35,"column":3}},"21":{"start":{"line":32,"column":3},"end":{"line":32,"column":39}},"22":{"start":{"line":34,"column":3},"end":{"line":34,"column":70}},"23":{"start":{"line":39,"column":1},"end":{"line":39,"column":43}},"24":{"start":{"line":42,"column":1},"end":{"line":44,"column":2}},"25":{"start":{"line":43,"column":2},"end":{"line":43,"column":33}},"26":{"start":{"line":46,"column":1},"end":{"line":46,"column":51}},"27":{"start":{"line":47,"column":1},"end":{"line":47,"column":27}},"28":{"start":{"line":48,"column":1},"end":{"line":48,"column":14}},"29":{"start":{"line":51,"column":0},"end":{"line":51,"column":23}}},"branchMap":{"1":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},{"start":{"line":8,"column":1},"end":{"line":8,"column":1}}]},"2":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},{"start":{"line":11,"column":1},"end":{"line":11,"column":1}}]},"3":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},{"start":{"line":14,"column":1},"end":{"line":14,"column":1}}]},"4":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},{"start":{"line":17,"column":1},"end":{"line":17,"column":1}}]},"5":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":5},"end":{"line":17,"column":18}},{"start":{"line":17,"column":22},"end":{"line":17,"column":39}}]},"6":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},{"start":{"line":20,"column":1},"end":{"line":20,"column":1}}]},"7":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},{"start":{"line":23,"column":1},"end":{"line":23,"column":1}}]},"8":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"9":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":9},"end":{"line":27,"column":9}},{"start":{"line":27,"column":9},"end":{"line":27,"column":9}}]},"10":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":9},"end":{"line":29,"column":9}},{"start":{"line":29,"column":9},"end":{"line":29,"column":9}}]},"11":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":9},"end":{"line":31,"column":9}},{"start":{"line":31,"column":9},"end":{"line":31,"column":9}}]},"12":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},{"start":{"line":42,"column":1},"end":{"line":42,"column":1}}]},"13":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":5},"end":{"line":42,"column":33}},{"start":{"line":42,"column":37},"end":{"line":42,"column":52}}]}},"code":["var Field = require('../../fields/types/Type');","","/**"," * Creates a new field at the specified path, with the provided options."," * If no options are provides, returns the field at the specified path."," */","function field (path, options) {","\tif (arguments.length === 1) {","\t\treturn this.fields[path];","\t}","\tif ('function' === typeof options) {","\t\toptions = { type: options };","\t}","\tif (this.get('noedit')) {","\t\toptions.noedit = true;","\t}","\tif (!options.note && this.get('notes')) {","\t\toptions.note = this.get('notes')[path];","\t}","\tif ('function' !== typeof options.type) {","\t\tthrow new Error('Fields must be specified with a type function');","\t}","\tif (options.type.prototype.__proto__ !== Field.prototype) {","\t\t// Convert native field types to their default Keystone counterpart","\t\tif (options.type === String) {","\t\t\toptions.type = Field.Types.Text;","\t\t} else if (options.type === Number) {","\t\t\toptions.type = Field.Types.Number;","\t\t} else if (options.type === Boolean) {","\t\t\toptions.type = Field.Types.Boolean;","\t\t} else if (options.type === Date) {","\t\t\toptions.type = Field.Types.Datetime;","\t\t} else {","\t\t\tthrow new Error('Unrecognised field constructor: ' + options.type);","\t\t}","\t}","","\t// Note the presence of this field type for client-side script optimisation","\tthis.fieldTypes[options.type.name] = true;","","\t// Wysiwyg HTML fields are handled as a special case so we can include TinyMCE as required","\tif (options.type.name === 'html' && options.wysiwyg) {","\t\tthis.fieldTypes.wysiwyg = true;","\t}","","\tvar field = new options.type(this, path, options);","\tthis.fields[path] = field;","\treturn field;","}","","module.exports = field;",""],"l":{"1":1,"7":1,"8":0,"9":0,"11":0,"12":0,"14":0,"15":0,"17":0,"18":0,"20":0,"21":0,"23":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"34":0,"39":0,"42":0,"43":0,"46":0,"47":0,"48":0,"51":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/relationship.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/relationship.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"relationship","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":28}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":7},"end":{"line":27,"column":18}}},"3":{"name":"(anonymous_3)","line":32,"loc":{"start":{"line":32,"column":7},"end":{"line":32,"column":18}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":33}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":38}},"3":{"start":{"line":7,"column":0},"end":{"line":38,"column":1}},"4":{"start":{"line":8,"column":1},"end":{"line":13,"column":2}},"5":{"start":{"line":9,"column":2},"end":{"line":11,"column":3}},"6":{"start":{"line":10,"column":3},"end":{"line":10,"column":35}},"7":{"start":{"line":12,"column":2},"end":{"line":12,"column":14}},"8":{"start":{"line":14,"column":1},"end":{"line":16,"column":2}},"9":{"start":{"line":15,"column":2},"end":{"line":15,"column":21}},"10":{"start":{"line":17,"column":1},"end":{"line":19,"column":2}},"11":{"start":{"line":18,"column":2},"end":{"line":18,"column":107}},"12":{"start":{"line":20,"column":1},"end":{"line":22,"column":2}},"13":{"start":{"line":21,"column":2},"end":{"line":21,"column":41}},"14":{"start":{"line":23,"column":1},"end":{"line":25,"column":2}},"15":{"start":{"line":24,"column":2},"end":{"line":24,"column":48}},"16":{"start":{"line":26,"column":1},"end":{"line":30,"column":4}},"17":{"start":{"line":28,"column":3},"end":{"line":28,"column":33}},"18":{"start":{"line":31,"column":1},"end":{"line":35,"column":4}},"19":{"start":{"line":33,"column":3},"end":{"line":33,"column":48}},"20":{"start":{"line":36,"column":1},"end":{"line":36,"column":36}},"21":{"start":{"line":37,"column":1},"end":{"line":37,"column":13}},"22":{"start":{"line":40,"column":0},"end":{"line":40,"column":30}}},"branchMap":{"1":{"line":8,"type":"if","locations":[{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},{"start":{"line":8,"column":1},"end":{"line":8,"column":1}}]},"2":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},{"start":{"line":14,"column":1},"end":{"line":14,"column":1}}]},"3":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},{"start":{"line":17,"column":1},"end":{"line":17,"column":1}}]},"4":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},{"start":{"line":20,"column":1},"end":{"line":20,"column":1}}]},"5":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},{"start":{"line":23,"column":1},"end":{"line":23,"column":1}}]},"6":{"line":33,"type":"cond-expr","locations":[{"start":{"line":33,"column":35},"end":{"line":33,"column":39}},{"start":{"line":33,"column":42},"end":{"line":33,"column":47}}]}},"code":["var keystone = require('../../');","var utils = require('keystone-utils');","","/**"," * Registers relationships to this list defined on others"," */","function relationship (def) {","\tif (arguments.length > 1) {","\t\tfor (var i = 0; i < arguments.length; i++) {","\t\t\tthis.relationship(arguments[i]);","\t\t}","\t\treturn this;","\t}","\tif ('string' === typeof def) {","\t\tdef = { ref: def };","\t}","\tif (!def.ref) {","\t\tthrow new Error('List Relationships must be specified with an object containing ref (' + this.key + ')');","\t}","\tif (!def.refPath) {","\t\tdef.refPath = utils.downcase(this.key);","\t}","\tif (!def.path) {","\t\tdef.path = utils.keyToProperty(def.ref, true);","\t}","\tObject.defineProperty(def, 'refList', {","\t\tget: function() {","\t\t\treturn keystone.list(def.ref);","\t\t}","\t});","\tObject.defineProperty(def, 'isValid', {","\t\tget: function() {","\t\t\treturn keystone.list(def.ref) ? true : false;","\t\t}","\t});","\tthis.relationships[def.path] = def;","\treturn this;","}","","module.exports = relationship;",""],"l":{"1":1,"2":1,"7":1,"8":0,"9":0,"10":0,"12":0,"14":0,"15":0,"17":0,"18":0,"20":0,"21":0,"23":0,"24":0,"26":0,"28":0,"31":0,"33":0,"36":0,"37":0,"40":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/underscoreMethod.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/underscoreMethod.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"underscoreMethod","line":5,"loc":{"start":{"line":5,"column":0},"end":{"line":5,"column":37}}},"2":{"name":"(anonymous_2)","line":9,"loc":{"start":{"line":9,"column":14},"end":{"line":9,"column":29}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":15,"column":1}},"2":{"start":{"line":6,"column":1},"end":{"line":6,"column":37}},"3":{"start":{"line":7,"column":1},"end":{"line":7,"column":24}},"4":{"start":{"line":8,"column":1},"end":{"line":8,"column":23}},"5":{"start":{"line":9,"column":1},"end":{"line":12,"column":4}},"6":{"start":{"line":10,"column":2},"end":{"line":10,"column":39}},"7":{"start":{"line":10,"column":21},"end":{"line":10,"column":39}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":24}},"9":{"start":{"line":13,"column":1},"end":{"line":13,"column":19}},"10":{"start":{"line":14,"column":1},"end":{"line":14,"column":13}},"11":{"start":{"line":17,"column":0},"end":{"line":17,"column":34}}},"branchMap":{"1":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":2},"end":{"line":10,"column":2}},{"start":{"line":10,"column":2},"end":{"line":10,"column":2}}]}},"code":["/**"," * Adds a method to the underscoreMethods collection on the list, which is then"," * added to the schema before the list is registered with mongoose."," */","function underscoreMethod (path, fn) {","\tvar target = this.underscoreMethods;","\tpath = path.split('.');","\tvar last = path.pop();","\tpath.forEach(function(part) {","\t\tif (!target[part]) target[part] = {};","\t\ttarget = target[part];","\t});","\ttarget[last] = fn;","\treturn this;","}","","module.exports = underscoreMethod;",""],"l":{"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"13":0,"14":0,"17":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/register.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/register.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"register","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":20}}},"2":{"name":"(anonymous_2)","line":13,"loc":{"start":{"line":13,"column":33},"end":{"line":13,"column":45}}},"3":{"name":"(anonymous_3)","line":22,"loc":{"start":{"line":22,"column":30},"end":{"line":22,"column":41}}},"4":{"name":"(anonymous_4)","line":28,"loc":{"start":{"line":28,"column":40},"end":{"line":28,"column":64}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":33}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":48}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":48}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":11,"column":0},"end":{"line":38,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":17}},"7":{"start":{"line":13,"column":1},"end":{"line":15,"column":4}},"8":{"start":{"line":14,"column":2},"end":{"line":14,"column":14}},"9":{"start":{"line":16,"column":1},"end":{"line":21,"column":2}},"10":{"start":{"line":17,"column":2},"end":{"line":17,"column":68}},"11":{"start":{"line":18,"column":2},"end":{"line":18,"column":78}},"12":{"start":{"line":19,"column":2},"end":{"line":19,"column":71}},"13":{"start":{"line":19,"column":37},"end":{"line":19,"column":71}},"14":{"start":{"line":20,"column":2},"end":{"line":20,"column":75}},"15":{"start":{"line":22,"column":1},"end":{"line":27,"column":4}},"16":{"start":{"line":23,"column":2},"end":{"line":25,"column":3}},"17":{"start":{"line":24,"column":3},"end":{"line":24,"column":68}},"18":{"start":{"line":26,"column":2},"end":{"line":26,"column":24}},"19":{"start":{"line":28,"column":1},"end":{"line":30,"column":4}},"20":{"start":{"line":29,"column":2},"end":{"line":29,"column":54}},"21":{"start":{"line":31,"column":1},"end":{"line":35,"column":2}},"22":{"start":{"line":32,"column":2},"end":{"line":32,"column":79}},"23":{"start":{"line":34,"column":2},"end":{"line":34,"column":62}},"24":{"start":{"line":36,"column":1},"end":{"line":36,"column":21}},"25":{"start":{"line":37,"column":1},"end":{"line":37,"column":13}},"26":{"start":{"line":40,"column":0},"end":{"line":40,"column":26}}},"branchMap":{"1":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},{"start":{"line":16,"column":1},"end":{"line":16,"column":1}}]},"2":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":2},"end":{"line":19,"column":2}},{"start":{"line":19,"column":2},"end":{"line":19,"column":2}}]},"3":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"4":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},{"start":{"line":31,"column":1},"end":{"line":31,"column":1}}]}},"code":["var keystone = require('../../');","var schemaPlugins = require('../schemaPlugins');","var UpdateHandler = require('../updateHandler');","var utils = require('keystone-utils');","","/**"," * Registers the Schema with Mongoose, and the List with Keystone"," *"," * Also adds default fields and virtuals to the schema for the list"," */","function register() {","\tvar list = this;","\tthis.schema.virtual('list').get(function () {","\t\treturn list;","\t});","\tif (Object.keys(this.relationships).length) {","\t\tthis.schema.methods.getRelated = schemaPlugins.methods.getRelated;","\t\tthis.schema.methods.populateRelated = schemaPlugins.methods.populateRelated;","\t\tif (!this.schema.options.toObject) this.schema.options.toObject = {};","\t\tthis.schema.options.toObject.transform = schemaPlugins.options.transform;","\t}","\tthis.schema.virtual('_').get(function() {","\t\tif (!this.__methods) {","\t\t\tthis.__methods = utils.bindMethods(list.underscoreMethods, this);","\t\t}","\t\treturn this.__methods;","\t});","\tthis.schema.method('getUpdateHandler', function(req, res, ops) {","\t\treturn new UpdateHandler(list, this, req, res, ops);","\t});","\tif (this.get('inherits')) {","\t\tthis.model = this.get('inherits').model.discriminator(this.key, this.schema);","\t} else {","\t\tthis.model = keystone.mongoose.model(this.key, this.schema);","\t}","\tkeystone.list(this);","\treturn this;","}","","module.exports = register;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"16":0,"17":0,"18":0,"19":0,"20":0,"22":0,"23":0,"24":0,"26":0,"28":0,"29":0,"31":0,"32":0,"34":0,"36":0,"37":0,"40":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/updateHandler.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/updateHandler.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":0,"20":0,"21":1,"22":1,"23":0,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0,0],"35":[0,0,0,0,0,0,0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0,0],"48":[0,0],"49":[0,0,0,0],"50":[0,0,0],"51":[0,0],"52":[0,0],"53":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"UpdateHandler","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":54}}},"2":{"name":"(anonymous_2)","line":46,"loc":{"start":{"line":46,"column":35},"end":{"line":46,"column":54}}},"3":{"name":"(anonymous_3)","line":63,"loc":{"start":{"line":63,"column":45},"end":{"line":63,"column":71}}},"4":{"name":"(anonymous_4)","line":89,"loc":{"start":{"line":89,"column":34},"end":{"line":89,"column":68}}},"5":{"name":"(anonymous_5)","line":99,"loc":{"start":{"line":99,"column":13},"end":{"line":99,"column":24}}},"6":{"name":"(anonymous_6)","line":114,"loc":{"start":{"line":114,"column":49},"end":{"line":114,"column":61}}},"7":{"name":"(anonymous_7)","line":124,"loc":{"start":{"line":124,"column":55},"end":{"line":124,"column":67}}},"8":{"name":"(anonymous_8)","line":126,"loc":{"start":{"line":126,"column":25},"end":{"line":126,"column":40}}},"9":{"name":"(anonymous_9)","line":132,"loc":{"start":{"line":132,"column":24},"end":{"line":132,"column":39}}},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":16},"end":{"line":144,"column":30}}},"11":{"name":"(anonymous_11)","line":172,"loc":{"start":{"line":172,"column":16},"end":{"line":172,"column":27}}},"12":{"name":"(anonymous_12)","line":177,"loc":{"start":{"line":177,"column":17},"end":{"line":177,"column":31}}},"13":{"name":"(anonymous_13)","line":210,"loc":{"start":{"line":210,"column":24},"end":{"line":210,"column":39}}},"14":{"name":"(anonymous_14)","line":237,"loc":{"start":{"line":237,"column":81},"end":{"line":237,"column":95}}},"15":{"name":"(anonymous_15)","line":246,"loc":{"start":{"line":246,"column":81},"end":{"line":246,"column":95}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":30}},"3":{"start":{"line":11,"column":0},"end":{"line":35,"column":1}},"4":{"start":{"line":13,"column":1},"end":{"line":15,"column":2}},"5":{"start":{"line":14,"column":2},"end":{"line":14,"column":39}},"6":{"start":{"line":17,"column":1},"end":{"line":17,"column":18}},"7":{"start":{"line":18,"column":1},"end":{"line":18,"column":18}},"8":{"start":{"line":19,"column":1},"end":{"line":19,"column":16}},"9":{"start":{"line":20,"column":1},"end":{"line":20,"column":16}},"10":{"start":{"line":21,"column":1},"end":{"line":21,"column":22}},"11":{"start":{"line":22,"column":1},"end":{"line":22,"column":30}},"12":{"start":{"line":24,"column":1},"end":{"line":26,"column":2}},"13":{"start":{"line":25,"column":2},"end":{"line":25,"column":73}},"14":{"start":{"line":28,"column":1},"end":{"line":30,"column":2}},"15":{"start":{"line":29,"column":2},"end":{"line":29,"column":32}},"16":{"start":{"line":32,"column":1},"end":{"line":32,"column":29}},"17":{"start":{"line":33,"column":1},"end":{"line":33,"column":28}},"18":{"start":{"line":46,"column":0},"end":{"line":49,"column":2}},"19":{"start":{"line":47,"column":1},"end":{"line":47,"column":35}},"20":{"start":{"line":48,"column":1},"end":{"line":48,"column":13}},"21":{"start":{"line":62,"column":0},"end":{"line":62,"column":53}},"22":{"start":{"line":63,"column":0},"end":{"line":71,"column":2}},"23":{"start":{"line":64,"column":1},"end":{"line":69,"column":3}},"24":{"start":{"line":70,"column":1},"end":{"line":70,"column":13}},"25":{"start":{"line":89,"column":0},"end":{"line":301,"column":2}},"26":{"start":{"line":91,"column":1},"end":{"line":91,"column":32}},"27":{"start":{"line":93,"column":1},"end":{"line":96,"column":2}},"28":{"start":{"line":94,"column":2},"end":{"line":94,"column":21}},"29":{"start":{"line":95,"column":2},"end":{"line":95,"column":17}},"30":{"start":{"line":98,"column":1},"end":{"line":100,"column":2}},"31":{"start":{"line":99,"column":2},"end":{"line":99,"column":27}},"32":{"start":{"line":104,"column":1},"end":{"line":108,"column":2}},"33":{"start":{"line":105,"column":2},"end":{"line":105,"column":15}},"34":{"start":{"line":106,"column":8},"end":{"line":108,"column":2}},"35":{"start":{"line":107,"column":2},"end":{"line":107,"column":32}},"36":{"start":{"line":110,"column":1},"end":{"line":115,"column":2}},"37":{"start":{"line":111,"column":2},"end":{"line":111,"column":44}},"38":{"start":{"line":112,"column":2},"end":{"line":112,"column":28}},"39":{"start":{"line":113,"column":8},"end":{"line":115,"column":2}},"40":{"start":{"line":114,"column":2},"end":{"line":114,"column":83}},"41":{"start":{"line":114,"column":63},"end":{"line":114,"column":79}},"42":{"start":{"line":117,"column":1},"end":{"line":117,"column":43}},"43":{"start":{"line":118,"column":1},"end":{"line":118,"column":74}},"44":{"start":{"line":119,"column":1},"end":{"line":119,"column":57}},"45":{"start":{"line":120,"column":1},"end":{"line":120,"column":59}},"46":{"start":{"line":123,"column":1},"end":{"line":129,"column":2}},"47":{"start":{"line":124,"column":2},"end":{"line":124,"column":89}},"48":{"start":{"line":124,"column":69},"end":{"line":124,"column":85}},"49":{"start":{"line":125,"column":2},"end":{"line":125,"column":24}},"50":{"start":{"line":126,"column":2},"end":{"line":128,"column":5}},"51":{"start":{"line":127,"column":3},"end":{"line":127,"column":33}},"52":{"start":{"line":132,"column":1},"end":{"line":137,"column":10}},"53":{"start":{"line":133,"column":2},"end":{"line":133,"column":78}},"54":{"start":{"line":134,"column":2},"end":{"line":136,"column":3}},"55":{"start":{"line":135,"column":3},"end":{"line":135,"column":39}},"56":{"start":{"line":140,"column":1},"end":{"line":142,"column":43}},"57":{"start":{"line":144,"column":1},"end":{"line":170,"column":14}},"58":{"start":{"line":145,"column":2},"end":{"line":169,"column":3}},"59":{"start":{"line":146,"column":3},"end":{"line":149,"column":4}},"60":{"start":{"line":147,"column":4},"end":{"line":147,"column":97}},"61":{"start":{"line":148,"column":4},"end":{"line":148,"column":21}},"62":{"start":{"line":150,"column":3},"end":{"line":150,"column":34}},"63":{"start":{"line":151,"column":9},"end":{"line":169,"column":3}},"64":{"start":{"line":152,"column":3},"end":{"line":158,"column":4}},"65":{"start":{"line":153,"column":4},"end":{"line":157,"column":7}},"66":{"start":{"line":159,"column":3},"end":{"line":163,"column":23}},"67":{"start":{"line":164,"column":9},"end":{"line":169,"column":3}},"68":{"start":{"line":166,"column":3},"end":{"line":166,"column":23}},"69":{"start":{"line":168,"column":3},"end":{"line":168,"column":14}},"70":{"start":{"line":172,"column":1},"end":{"line":208,"column":14}},"71":{"start":{"line":175,"column":2},"end":{"line":175,"column":34}},"72":{"start":{"line":177,"column":2},"end":{"line":207,"column":16}},"73":{"start":{"line":178,"column":3},"end":{"line":204,"column":4}},"74":{"start":{"line":179,"column":4},"end":{"line":196,"column":5}},"75":{"start":{"line":181,"column":5},"end":{"line":187,"column":6}},"76":{"start":{"line":182,"column":6},"end":{"line":186,"column":9}},"77":{"start":{"line":189,"column":5},"end":{"line":192,"column":6}},"78":{"start":{"line":190,"column":6},"end":{"line":190,"column":99}},"79":{"start":{"line":191,"column":6},"end":{"line":191,"column":23}},"80":{"start":{"line":193,"column":5},"end":{"line":195,"column":6}},"81":{"start":{"line":194,"column":6},"end":{"line":194,"column":148}},"82":{"start":{"line":197,"column":4},"end":{"line":197,"column":56}},"83":{"start":{"line":199,"column":4},"end":{"line":203,"column":6}},"84":{"start":{"line":206,"column":3},"end":{"line":206,"column":41}},"85":{"start":{"line":210,"column":1},"end":{"line":297,"column":10}},"86":{"start":{"line":213,"column":2},"end":{"line":213,"column":14}},"87":{"start":{"line":215,"column":2},"end":{"line":216,"column":23}},"88":{"start":{"line":218,"column":2},"end":{"line":220,"column":3}},"89":{"start":{"line":219,"column":3},"end":{"line":219,"column":84}},"90":{"start":{"line":223,"column":2},"end":{"line":226,"column":3}},"91":{"start":{"line":225,"column":3},"end":{"line":225,"column":10}},"92":{"start":{"line":229,"column":2},"end":{"line":268,"column":3}},"93":{"start":{"line":237,"column":4},"end":{"line":242,"column":19}},"94":{"start":{"line":238,"column":5},"end":{"line":240,"column":6}},"95":{"start":{"line":239,"column":6},"end":{"line":239,"column":79}},"96":{"start":{"line":241,"column":5},"end":{"line":241,"column":19}},"97":{"start":{"line":243,"column":3},"end":{"line":243,"column":9}},"98":{"start":{"line":246,"column":4},"end":{"line":251,"column":19}},"99":{"start":{"line":247,"column":5},"end":{"line":249,"column":6}},"100":{"start":{"line":248,"column":6},"end":{"line":248,"column":100}},"101":{"start":{"line":250,"column":5},"end":{"line":250,"column":19}},"102":{"start":{"line":252,"column":3},"end":{"line":252,"column":9}},"103":{"start":{"line":257,"column":4},"end":{"line":259,"column":5}},"104":{"start":{"line":258,"column":5},"end":{"line":258,"column":12}},"105":{"start":{"line":261,"column":4},"end":{"line":265,"column":5}},"106":{"start":{"line":262,"column":5},"end":{"line":262,"column":88}},"107":{"start":{"line":263,"column":5},"end":{"line":263,"column":45}},"108":{"start":{"line":264,"column":5},"end":{"line":264,"column":24}},"109":{"start":{"line":266,"column":3},"end":{"line":266,"column":9}},"110":{"start":{"line":271,"column":2},"end":{"line":276,"column":3}},"111":{"start":{"line":273,"column":3},"end":{"line":273,"column":170}},"112":{"start":{"line":274,"column":3},"end":{"line":274,"column":43}},"113":{"start":{"line":275,"column":3},"end":{"line":275,"column":22}},"114":{"start":{"line":279,"column":2},"end":{"line":284,"column":3}},"115":{"start":{"line":281,"column":3},"end":{"line":281,"column":115}},"116":{"start":{"line":282,"column":3},"end":{"line":282,"column":43}},"117":{"start":{"line":283,"column":3},"end":{"line":283,"column":22}},"118":{"start":{"line":287,"column":2},"end":{"line":293,"column":3}},"119":{"start":{"line":288,"column":3},"end":{"line":288,"column":54}},"120":{"start":{"line":289,"column":3},"end":{"line":291,"column":4}},"121":{"start":{"line":290,"column":4},"end":{"line":290,"column":44}},"122":{"start":{"line":292,"column":3},"end":{"line":292,"column":22}},"123":{"start":{"line":295,"column":2},"end":{"line":295,"column":36}},"124":{"start":{"line":299,"column":1},"end":{"line":299,"column":12}},"125":{"start":{"line":308,"column":0},"end":{"line":308,"column":41}}},"branchMap":{"1":{"line":13,"type":"if","locations":[{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},{"start":{"line":13,"column":1},"end":{"line":13,"column":1}}]},"2":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":16},"end":{"line":22,"column":23}},{"start":{"line":22,"column":27},"end":{"line":22,"column":29}}]},"3":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},{"start":{"line":24,"column":1},"end":{"line":24,"column":1}}]},"4":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},{"start":{"line":28,"column":1},"end":{"line":28,"column":1}}]},"5":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":8},"end":{"line":68,"column":12}},{"start":{"line":68,"column":16},"end":{"line":68,"column":26}}]},"6":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},{"start":{"line":93,"column":1},"end":{"line":93,"column":1}}]},"7":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},{"start":{"line":98,"column":1},"end":{"line":98,"column":1}}]},"8":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},{"start":{"line":104,"column":1},"end":{"line":104,"column":1}}]},"9":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":8},"end":{"line":106,"column":8}},{"start":{"line":106,"column":8},"end":{"line":106,"column":8}}]},"10":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},{"start":{"line":110,"column":1},"end":{"line":110,"column":1}}]},"11":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":8},"end":{"line":113,"column":8}},{"start":{"line":113,"column":8},"end":{"line":113,"column":8}}]},"12":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":20},"end":{"line":117,"column":36}},{"start":{"line":117,"column":40},"end":{"line":117,"column":42}}]},"13":{"line":118,"type":"binary-expr","locations":[{"start":{"line":118,"column":24},"end":{"line":118,"column":44}},{"start":{"line":118,"column":48},"end":{"line":118,"column":73}}]},"14":{"line":119,"type":"binary-expr","locations":[{"start":{"line":119,"column":27},"end":{"line":119,"column":50}},{"start":{"line":119,"column":54},"end":{"line":119,"column":56}}]},"15":{"line":120,"type":"binary-expr","locations":[{"start":{"line":120,"column":28},"end":{"line":120,"column":52}},{"start":{"line":120,"column":56},"end":{"line":120,"column":58}}]},"16":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},{"start":{"line":123,"column":1},"end":{"line":123,"column":1}}]},"17":{"line":133,"type":"cond-expr","locations":[{"start":{"line":133,"column":49},"end":{"line":133,"column":53}},{"start":{"line":133,"column":56},"end":{"line":133,"column":77}}]},"18":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":2},"end":{"line":134,"column":2}},{"start":{"line":134,"column":2},"end":{"line":134,"column":2}}]},"19":{"line":134,"type":"binary-expr","locations":[{"start":{"line":134,"column":6},"end":{"line":134,"column":11}},{"start":{"line":134,"column":15},"end":{"line":134,"column":29}}]},"20":{"line":145,"type":"if","locations":[{"start":{"line":145,"column":2},"end":{"line":145,"column":2}},{"start":{"line":145,"column":2},"end":{"line":145,"column":2}}]},"21":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":3},"end":{"line":146,"column":3}},{"start":{"line":146,"column":3},"end":{"line":146,"column":3}}]},"22":{"line":151,"type":"if","locations":[{"start":{"line":151,"column":9},"end":{"line":151,"column":9}},{"start":{"line":151,"column":9},"end":{"line":151,"column":9}}]},"23":{"line":152,"type":"if","locations":[{"start":{"line":152,"column":3},"end":{"line":152,"column":3}},{"start":{"line":152,"column":3},"end":{"line":152,"column":3}}]},"24":{"line":164,"type":"if","locations":[{"start":{"line":164,"column":9},"end":{"line":164,"column":9}},{"start":{"line":164,"column":9},"end":{"line":164,"column":9}}]},"25":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":3},"end":{"line":178,"column":3}},{"start":{"line":178,"column":3},"end":{"line":178,"column":3}}]},"26":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":4},"end":{"line":179,"column":4}},{"start":{"line":179,"column":4},"end":{"line":179,"column":4}}]},"27":{"line":181,"type":"if","locations":[{"start":{"line":181,"column":5},"end":{"line":181,"column":5}},{"start":{"line":181,"column":5},"end":{"line":181,"column":5}}]},"28":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":5},"end":{"line":189,"column":5}},{"start":{"line":189,"column":5},"end":{"line":189,"column":5}}]},"29":{"line":193,"type":"if","locations":[{"start":{"line":193,"column":5},"end":{"line":193,"column":5}},{"start":{"line":193,"column":5},"end":{"line":193,"column":5}}]},"30":{"line":194,"type":"cond-expr","locations":[{"start":{"line":194,"column":119},"end":{"line":194,"column":134}},{"start":{"line":194,"column":137},"end":{"line":194,"column":139}}]},"31":{"line":215,"type":"cond-expr","locations":[{"start":{"line":215,"column":49},"end":{"line":215,"column":53}},{"start":{"line":215,"column":56},"end":{"line":215,"column":77}}]},"32":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":2},"end":{"line":218,"column":2}},{"start":{"line":218,"column":2},"end":{"line":218,"column":2}}]},"33":{"line":223,"type":"if","locations":[{"start":{"line":223,"column":2},"end":{"line":223,"column":2}},{"start":{"line":223,"column":2},"end":{"line":223,"column":2}}]},"34":{"line":223,"type":"binary-expr","locations":[{"start":{"line":223,"column":6},"end":{"line":223,"column":24}},{"start":{"line":223,"column":28},"end":{"line":223,"column":40}},{"start":{"line":223,"column":44},"end":{"line":223,"column":65}}]},"35":{"line":229,"type":"switch","locations":[{"start":{"line":231,"column":3},"end":{"line":231,"column":20}},{"start":{"line":232,"column":3},"end":{"line":232,"column":21}},{"start":{"line":233,"column":3},"end":{"line":233,"column":26}},{"start":{"line":234,"column":3},"end":{"line":234,"column":27}},{"start":{"line":235,"column":3},"end":{"line":235,"column":20}},{"start":{"line":236,"column":3},"end":{"line":243,"column":9}},{"start":{"line":245,"column":3},"end":{"line":252,"column":9}},{"start":{"line":254,"column":3},"end":{"line":266,"column":9}}]},"36":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":5},"end":{"line":238,"column":5}},{"start":{"line":238,"column":5},"end":{"line":238,"column":5}}]},"37":{"line":238,"type":"binary-expr","locations":[{"start":{"line":238,"column":9},"end":{"line":238,"column":12}},{"start":{"line":238,"column":16},"end":{"line":238,"column":35}}]},"38":{"line":247,"type":"if","locations":[{"start":{"line":247,"column":5},"end":{"line":247,"column":5}},{"start":{"line":247,"column":5},"end":{"line":247,"column":5}}]},"39":{"line":247,"type":"binary-expr","locations":[{"start":{"line":247,"column":9},"end":{"line":247,"column":12}},{"start":{"line":247,"column":16},"end":{"line":247,"column":35}}]},"40":{"line":248,"type":"binary-expr","locations":[{"start":{"line":248,"column":68},"end":{"line":248,"column":83}},{"start":{"line":248,"column":87},"end":{"line":248,"column":97}}]},"41":{"line":257,"type":"if","locations":[{"start":{"line":257,"column":4},"end":{"line":257,"column":4}},{"start":{"line":257,"column":4},"end":{"line":257,"column":4}}]},"42":{"line":257,"type":"binary-expr","locations":[{"start":{"line":257,"column":8},"end":{"line":257,"column":25}},{"start":{"line":257,"column":30},"end":{"line":257,"column":59}},{"start":{"line":257,"column":63},"end":{"line":257,"column":88}}]},"43":{"line":261,"type":"if","locations":[{"start":{"line":261,"column":4},"end":{"line":261,"column":4}},{"start":{"line":261,"column":4},"end":{"line":261,"column":4}}]},"44":{"line":262,"type":"binary-expr","locations":[{"start":{"line":262,"column":15},"end":{"line":262,"column":61}},{"start":{"line":262,"column":65},"end":{"line":262,"column":87}}]},"45":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":2},"end":{"line":271,"column":2}},{"start":{"line":271,"column":2},"end":{"line":271,"column":2}}]},"46":{"line":271,"type":"binary-expr","locations":[{"start":{"line":271,"column":6},"end":{"line":271,"column":18}},{"start":{"line":271,"column":22},"end":{"line":271,"column":48}}]},"47":{"line":273,"type":"binary-expr","locations":[{"start":{"line":273,"column":13},"end":{"line":273,"column":48}},{"start":{"line":273,"column":52},"end":{"line":273,"column":80}},{"start":{"line":273,"column":84},"end":{"line":273,"column":169}}]},"48":{"line":279,"type":"if","locations":[{"start":{"line":279,"column":2},"end":{"line":279,"column":2}},{"start":{"line":279,"column":2},"end":{"line":279,"column":2}}]},"49":{"line":279,"type":"binary-expr","locations":[{"start":{"line":279,"column":6},"end":{"line":279,"column":18}},{"start":{"line":279,"column":22},"end":{"line":279,"column":50}},{"start":{"line":279,"column":54},"end":{"line":279,"column":97}},{"start":{"line":279,"column":101},"end":{"line":279,"column":130}}]},"50":{"line":281,"type":"binary-expr","locations":[{"start":{"line":281,"column":13},"end":{"line":281,"column":49}},{"start":{"line":281,"column":53},"end":{"line":281,"column":82}},{"start":{"line":281,"column":86},"end":{"line":281,"column":114}}]},"51":{"line":287,"type":"if","locations":[{"start":{"line":287,"column":2},"end":{"line":287,"column":2}},{"start":{"line":287,"column":2},"end":{"line":287,"column":2}}]},"52":{"line":287,"type":"binary-expr","locations":[{"start":{"line":287,"column":6},"end":{"line":287,"column":18}},{"start":{"line":287,"column":22},"end":{"line":287,"column":56}}]},"53":{"line":289,"type":"if","locations":[{"start":{"line":289,"column":3},"end":{"line":289,"column":3}},{"start":{"line":289,"column":3},"end":{"line":289,"column":3}}]}},"code":["var _ = require('underscore');","var keystone = require('../');","","/**"," * UpdateHandler Class"," *"," * @param {Object} item to update"," * @api public"," */","","function UpdateHandler(list, item, req, res, options) {","","\tif (!(this instanceof UpdateHandler)) {","\t\treturn new UpdateHandler(list, item);","\t}","","\tthis.list = list;","\tthis.item = item;","\tthis.req = req;","\tthis.res = res;","\tthis.user = req.user;","\tthis.options = options || {};","","\tif (!this.options.errorMessage) {","\t\tthis.options.errorMessage = 'There was a problem saving your changes:';","\t}","","\tif (this.options.user) {","\t\tthis.user = this.options.user;","\t}","","\tthis.validationMethods = {};","\tthis.validationErrors = {};","","}","","","/**"," * Adds a custom validation method for a given path"," *"," * @param {string} path to call method for"," * @param {function} method to call"," * @api public"," */","","UpdateHandler.prototype.validate = function(path, fn) {","\tthis.validationMethods[path] = fn;","\treturn this;","};","","","/**"," * Adds a validationError to the updateHandler; can be used before"," * `.process()` is called to handle errors generated by custom pre-"," * processing."," *"," * @param {string} path that failed validation"," * @param {string} message to display"," * @param {string} error type (defaults to 'required')"," * @api public"," */","UpdateHandler.ValidationErrorName = 'ValidatorError';","UpdateHandler.prototype.addValidationError = function(path, msg, type) {","\tthis.validationErrors[path] = {","\t\tname: UpdateHandler.ValidationErrorName,","\t\tpath: path,","\t\tmessage: msg,","\t\ttype: type || 'required'","\t};","\treturn this;","};","","","/**"," * Processes data from req.body, req.query, or any data source."," *"," * Options:"," * - fields (comma-delimited list or array of field paths)"," * - flashErrors (boolean, default false; whether to push validation errors to req.flash)"," * - ignoreNoedit (boolean, default false; whether to ignore noedit settings on fields)"," * - validationErrors (object; validation errors from previous form handling that should be included)"," *"," * @param {Object} data"," * @param {Object} options (can be comma-delimited list of fields) (optional)"," * @param {Function} callback (optional)"," * @api public"," */","","UpdateHandler.prototype.process = function(data, options, callback) {","\t","\tvar usingDefaultFields = false;","\t","\tif ('function' === typeof options) {","\t\tcallback = options;","\t\toptions = null;","\t}","","\tif ('function' !== typeof callback) {","\t\tcallback = function() {};","\t}","\t","\t// Initialise options","\t","\tif (!options) {","\t\toptions = {};","\t} else if ('string' === typeof options) {","\t\toptions = { fields: options };","\t}","\t","\tif (!options.fields) {","\t\toptions.fields = _.keys(this.list.fields);","\t\tusingDefaultFields = true;","\t} else if ('string' === typeof options.fields) {","\t\toptions.fields = options.fields.split(',').map(function(i) { return i.trim(); });","\t}","\t","\toptions.required = options.required || {};","\toptions.errorMessage = options.errorMessage || this.options.errorMessage;","\toptions.invalidMessages = options.invalidMessages || {};","\toptions.requiredMessages = options.requiredMessages || {};","\t","\t// Parse a string of required fields into field paths","\tif ('string' === typeof options.required) {","\t\tvar requiredFields = options.required.split(',').map(function(i) { return i.trim(); });","\t\toptions.required = {};","\t\trequiredFields.forEach(function(path) {","\t\t\toptions.required[path] = true;","\t\t});","\t}","\t","\t// Make sure fields with the required option set are included in the required paths","\toptions.fields.forEach(function(path) {","\t\tvar field = (path instanceof keystone.Field) ? path : this.list.field(path);","\t\tif (field && field.required) {","\t\t\toptions.required[field.path] = true;","\t\t}","\t}, this);","\t","\t// TODO: The whole progress queue management code could be a lot neater...","\tvar actionQueue = [],","\t\taddValidationError = this.addValidationError.bind(this),","\t\tvalidationErrors = this.validationErrors;","","\tvar progress = function(err) {","\t\tif (err) {","\t\t\tif (options.logErrors) {","\t\t\t\tconsole.log('Error saving changes to ' + this.item.list.singular + ' ' + this.item.id + ':');","\t\t\t\tconsole.log(err);","\t\t\t}","\t\t\tcallback(err, this.item, this);","\t\t} else if (_.size(validationErrors)) {","\t\t\tif (options.flashErrors) {","\t\t\t\tthis.req.flash('error', {","\t\t\t\t\ttype: UpdateHandler.ValidationErrorName,","\t\t\t\t\ttitle: options.errorMessage,","\t\t\t\t\tlist: _.pluck(validationErrors, 'message')","\t\t\t\t});","\t\t\t}","\t\t\tcallback({","\t\t\t\tmessage: 'Validation failed',","\t\t\t\tname: UpdateHandler.ValidationErrorName,","\t\t\t\terrors: validationErrors","\t\t\t}, this.item, this);","\t\t} else if (actionQueue.length) {","\t\t\t// TODO: parallel queue handling for cloudinary uploads?","\t\t\tactionQueue.pop()();","\t\t} else {","\t\t\tsaveItem();","\t\t}","\t}.bind(this);","\t","\tvar saveItem = function() {","\t\t","\t\t// Make current user available to pre/post save events","\t\tthis.item._req_user = this.user;","\t\t","\t\tthis.item.save(function(err) {","\t\t\tif (err) {","\t\t\t\tif (err.name === UpdateHandler.ValidationErrorName) {","\t\t\t\t\t// don't log simple validation errors","\t\t\t\t\tif (options.flashErrors) {","\t\t\t\t\t\tthis.req.flash('error', {","\t\t\t\t\t\t\ttype: UpdateHandler.ValidationErrorName,","\t\t\t\t\t\t\ttitle: options.errorMessage,","\t\t\t\t\t\t\tlist: _.pluck(err.errors, 'message')","\t\t\t\t\t\t});","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tif (options.logErrors) {","\t\t\t\t\t\tconsole.log('Error saving changes to ' + this.item.list.singular + ' ' + this.item.id + ':');","\t\t\t\t\t\tconsole.log(err);","\t\t\t\t\t}","\t\t\t\t\tif (options.flashErrors) {","\t\t\t\t\t\tthis.req.flash('error', 'There was an error saving your changes: ' + err.message + ' (' + err.name + (err.type ? ': ' + err.type : '') + ')');","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\taddValidationError(err.path, err.message, err.type);","","\t\t\t\terr = {","\t\t\t\t\tmessage: 'Validation failed',","\t\t\t\t\tname: UpdateHandler.ValidationErrorName,","\t\t\t\t\terrors: validationErrors","\t\t\t\t};","\t\t\t}","","\t\t\treturn callback(err, this.item, this);","\t\t}.bind(this));","\t}.bind(this);","\t","\toptions.fields.forEach(function(path) {","\t\t","\t\t// console.log('Processing field ' + path);","\t\tvar message;","\t\t","\t\tvar field = (path instanceof keystone.Field) ? path : this.list.field(path),","\t\t\tinvalidated = false;","\t\t","\t\tif (!field) {","\t\t\tthrow new Error('UpdateHandler.process called with invalid field path: ' + path);","\t\t}","\t\t","\t\t// skip uneditable fields","\t\tif (usingDefaultFields && field.noedit && !options.ignoreNoedit) {","\t\t\t// console.log('Skipping field ' + path + ' (noedit: true)');","\t\t\treturn;","\t\t}","\t\t","\t\t// Some field types have custom behaviours for queueing or validation","\t\tswitch (field.type) {","\t\t\t","\t\t\tcase 'localfile':","\t\t\tcase 'localfiles':","\t\t\tcase 'cloudinaryimage':","\t\t\tcase 'cloudinaryimages':","\t\t\tcase 'azurefile':","\t\t\tcase 's3file':","\t\t\t\tactionQueue.push(field.getRequestHandler(this.item, this.req, options.paths, function(err) {","\t\t\t\t\tif (err && options.flashErrors) {","\t\t\t\t\t\tthis.req.flash('error', field.label + ' upload failed - ' + err.message);","\t\t\t\t\t}","\t\t\t\t\tprogress(err);","\t\t\t\t}.bind(this)));","\t\t\tbreak;","\t\t\t","\t\t\tcase 'location':","\t\t\t\tactionQueue.push(field.getRequestHandler(this.item, this.req, options.paths, function(err) {","\t\t\t\t\tif (err && options.flashErrors) {","\t\t\t\t\t\tthis.req.flash('error', field.label + ' improve failed - ' + (err.status_text || err.status));","\t\t\t\t\t}","\t\t\t\t\tprogress(err);","\t\t\t\t}.bind(this)));","\t\t\tbreak;","\t\t\t","\t\t\tcase 'password':","\t\t\t\t// passwords should only be set if a value is provided.","\t\t\t\t// if no value is provided, as long as the field isn't required or empty, bail.","\t\t\t\tif (!data[field.path] && (!options.required[field.path] || this.item.get(field.path))) {","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\t// validate the password fields match, with a custom error message.","\t\t\t\tif (data[field.path] !== data[field.paths.confirm]) {","\t\t\t\t\tmessage = options.invalidMessages[field.path + '_match'] || 'Passwords must match';","\t\t\t\t\taddValidationError(field.path, message);","\t\t\t\t\tinvalidated = true;","\t\t\t\t}","\t\t\tbreak;","\t\t\t","\t\t}","\t\t","\t\t// validate field input, unless it's already been invalidated by field-specific behaviour","\t\tif (!invalidated && !field.validateInput(data)) {","\t\t\t// console.log('Field ' + field.path + ' is invalid');","\t\t\tmessage = options.invalidMessages[field.path] || field.options.invalidMessage || 'Please enter a valid ' + field.typeDescription + ' in the ' + field.label + ' field';","\t\t\taddValidationError(field.path, message);","\t\t\tinvalidated = true;","\t\t}","\t\t","\t\t// validate required fields, unless they've already been invalidated by field-specific behaviour","\t\tif (!invalidated && options.required[field.path] && !field.validateInput(data, true, this.item) && !validationErrors[field.path]) {","\t\t\t// console.log('Field ' + field.path + ' is required, but not provided.');","\t\t\tmessage = options.requiredMessages[field.path] || field.options.requiredMessage || field.label + ' is required';","\t\t\taddValidationError(field.path, message);","\t\t\tinvalidated = true;","\t\t}","\t\t","\t\t// check for a custom validation rule at the path, and run it (unless the field is already invalid)","\t\tif (!invalidated && this.validationMethods[field.path]) {","\t\t\tmessage = this.validationMethods[field.path](data);","\t\t\tif (message) {","\t\t\t\taddValidationError(field.path, message);","\t\t\t}","\t\t\tinvalidated = true;","\t\t}","\t\t","\t\tfield.updateItem(this.item, data);","\t\t","\t}, this);","","\tprogress();","\t","};","","","/*!"," * Export class"," */","","exports = module.exports = UpdateHandler;",""],"l":{"1":1,"2":1,"11":1,"13":0,"14":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"24":0,"25":0,"28":0,"29":0,"32":0,"33":0,"46":1,"47":0,"48":0,"62":1,"63":1,"64":0,"70":0,"89":1,"91":0,"93":0,"94":0,"95":0,"98":0,"99":0,"104":0,"105":0,"106":0,"107":0,"110":0,"111":0,"112":0,"113":0,"114":0,"117":0,"118":0,"119":0,"120":0,"123":0,"124":0,"125":0,"126":0,"127":0,"132":0,"133":0,"134":0,"135":0,"140":0,"144":0,"145":0,"146":0,"147":0,"148":0,"150":0,"151":0,"152":0,"153":0,"159":0,"164":0,"166":0,"168":0,"172":0,"175":0,"177":0,"178":0,"179":0,"181":0,"182":0,"189":0,"190":0,"191":0,"193":0,"194":0,"197":0,"199":0,"206":0,"210":0,"213":0,"215":0,"218":0,"219":0,"223":0,"225":0,"229":0,"237":0,"238":0,"239":0,"241":0,"243":0,"246":0,"247":0,"248":0,"250":0,"252":0,"257":0,"258":0,"261":0,"262":0,"263":0,"264":0,"266":0,"271":0,"273":0,"274":0,"275":0,"279":0,"281":0,"282":0,"283":0,"287":0,"288":0,"289":0,"290":0,"292":0,"295":0,"299":0,"308":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getData.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getData.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"getData","line":8,"loc":{"start":{"line":8,"column":0},"end":{"line":8,"column":32}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":17},"end":{"line":27,"column":33}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":43}},"2":{"start":{"line":8,"column":0},"end":{"line":37,"column":1}},"3":{"start":{"line":9,"column":1},"end":{"line":12,"column":3}},"4":{"start":{"line":13,"column":1},"end":{"line":15,"column":2}},"5":{"start":{"line":14,"column":2},"end":{"line":14,"column":56}},"6":{"start":{"line":16,"column":1},"end":{"line":18,"column":2}},"7":{"start":{"line":17,"column":2},"end":{"line":17,"column":36}},"8":{"start":{"line":19,"column":1},"end":{"line":35,"column":2}},"9":{"start":{"line":20,"column":2},"end":{"line":22,"column":3}},"10":{"start":{"line":21,"column":3},"end":{"line":21,"column":32}},"11":{"start":{"line":23,"column":2},"end":{"line":25,"column":3}},"12":{"start":{"line":24,"column":3},"end":{"line":24,"column":85}},"13":{"start":{"line":26,"column":2},"end":{"line":26,"column":19}},"14":{"start":{"line":27,"column":2},"end":{"line":34,"column":11}},"15":{"start":{"line":28,"column":3},"end":{"line":28,"column":33}},"16":{"start":{"line":29,"column":3},"end":{"line":33,"column":4}},"17":{"start":{"line":30,"column":4},"end":{"line":30,"column":44}},"18":{"start":{"line":32,"column":4},"end":{"line":32,"column":39}},"19":{"start":{"line":36,"column":1},"end":{"line":36,"column":13}},"20":{"start":{"line":39,"column":0},"end":{"line":39,"column":25}}},"branchMap":{"1":{"line":13,"type":"if","locations":[{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},{"start":{"line":13,"column":1},"end":{"line":13,"column":1}}]},"2":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},{"start":{"line":16,"column":1},"end":{"line":16,"column":1}}]},"3":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},{"start":{"line":19,"column":1},"end":{"line":19,"column":1}}]},"4":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":2},"end":{"line":20,"column":2}},{"start":{"line":20,"column":2},"end":{"line":20,"column":2}}]},"5":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]},"6":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":3},"end":{"line":29,"column":3}},{"start":{"line":29,"column":3},"end":{"line":29,"column":3}}]}},"code":["var listToArray = require('list-to-array');","","/**"," * Gets the data from an Item ready to be serialised for client-side use, as"," * used by the React components"," */","","function getData (item, fields) {","\tvar data = {","\t\tid: item.id,","\t\tname: this.getDocumentName(item)","\t};","\tif (this.autokey) {","\t\tdata[this.autokey.path] = item.get(this.autokey.path);","\t}","\tif (fields === undefined) {","\t\tfields = Object.keys(this.fields);","\t}","\tif (fields) {","\t\tif (typeof fields === 'string') {","\t\t\tfields = listToArray(fields);","\t\t}","\t\tif (!Array.isArray(fields)) {","\t\t\tthrow new Error('List.getData: fields must be undefined, a string, or an array.');","\t\t}","\t\tdata.fields = {};","\t\tfields.forEach(function (path) {","\t\t\tvar field = this.fields[path];","\t\t\tif (field) {","\t\t\t\tdata.fields[path] = field.getData(item);","\t\t\t} else {","\t\t\t\tdata.fields[path] = item.get(path);","\t\t\t}","\t\t}, this);","\t}","\treturn data;","}","","module.exports = getData;",""],"l":{"1":1,"8":1,"9":0,"13":0,"14":0,"16":0,"17":0,"19":0,"20":0,"21":0,"23":0,"24":0,"26":0,"27":0,"28":0,"29":0,"30":0,"32":0,"36":0,"39":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getOptions.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getOptions.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"getOptions","line":6,"loc":{"start":{"line":6,"column":0},"end":{"line":6,"column":23}}},"2":{"name":"(anonymous_2)","line":35,"loc":{"start":{"line":35,"column":25},"end":{"line":35,"column":39}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":6,"column":0},"end":{"line":66,"column":1}},"3":{"start":{"line":7,"column":1},"end":{"line":34,"column":3}},"4":{"start":{"line":35,"column":1},"end":{"line":64,"column":10}},"5":{"start":{"line":36,"column":2},"end":{"line":63,"column":3}},"6":{"start":{"line":40,"column":4},"end":{"line":40,"column":54}},"7":{"start":{"line":43,"column":4},"end":{"line":45,"column":5}},"8":{"start":{"line":44,"column":5},"end":{"line":44,"column":12}},"9":{"start":{"line":47,"column":4},"end":{"line":49,"column":5}},"10":{"start":{"line":48,"column":5},"end":{"line":48,"column":12}},"11":{"start":{"line":51,"column":4},"end":{"line":54,"column":7}},"12":{"start":{"line":55,"column":3},"end":{"line":55,"column":9}},"13":{"start":{"line":57,"column":4},"end":{"line":61,"column":7}},"14":{"start":{"line":62,"column":3},"end":{"line":62,"column":9}},"15":{"start":{"line":65,"column":1},"end":{"line":65,"column":12}},"16":{"start":{"line":68,"column":0},"end":{"line":68,"column":28}}},"branchMap":{"1":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":30},"end":{"line":17,"column":57}},{"start":{"line":17,"column":60},"end":{"line":17,"column":64}}]},"2":{"line":36,"type":"switch","locations":[{"start":{"line":38,"column":3},"end":{"line":55,"column":9}},{"start":{"line":56,"column":3},"end":{"line":62,"column":9}}]},"3":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]},"4":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":8},"end":{"line":43,"column":35}},{"start":{"line":43,"column":39},"end":{"line":43,"column":58}}]},"5":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":4},"end":{"line":47,"column":4}},{"start":{"line":47,"column":4},"end":{"line":47,"column":4}}]},"6":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":8},"end":{"line":47,"column":23}},{"start":{"line":47,"column":27},"end":{"line":47,"column":54}}]}},"code":["var _ = require('underscore');","","/**"," * Gets the options for the List, as used by the React components"," */","function getOptions () {","\tvar ops = {","\t\tautocreate: this.options.autocreate,","\t\tautokey: this.autokey,","\t\tdefaultColumns: this.options.defaultColumns,","\t\tdefaultSort: this.options.defaultSort,","\t\tfields: {},","\t\thidden: this.options.hidden,","\t\tinitialFields: _.pluck(this.initialFields, 'path'),","\t\tkey: this.key,","\t\tlabel: this.label,","\t\tnameField: this.nameField ? this.nameField.getOptions() : null,","\t\tnameIsEditable: this.nameIsEditable,","\t\tnameIsInitial: this.nameIsInitial,","\t\tnameIsVirtual: this.nameIsVirtual,","\t\tnamePath: this.namePath,","\t\tnocreate: this.options.nocreate,","\t\tnodelete: this.options.nodelete,","\t\tnoedit: this.options.noedit,","\t\tpath: this.path,","\t\tplural: this.plural,","\t\tsearchFields: this.options.searchFields,","\t\tsingular: this.singular,","\t\tsortable: this.options.sortable,","\t\tsortContext: this.options.sortContext,","\t\ttrack: this.options.track,","\t\ttracking: this.tracking,","\t\tuiElements: []","\t};","\t_.each(this.uiElements, function (el) {","\t\tswitch (el.type) {","\t\t\t// TODO: handle indentation","\t\t\tcase 'field':","\t\t\t\t// add the field options by path","\t\t\t\tops.fields[el.field.path] = el.field.getOptions();","\t\t\t\t// don't output the name field as a ui element if it's editable as it'll","\t\t\t\t// appear as an input in the header","\t\t\t\tif (el.field === this.nameField && this.nameIsEditable) {","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\t// don't output hidden fields","\t\t\t\tif (el.field.hidden && el.field.type !== 'boolean') {","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\t// add the field to the elements array","\t\t\t\tops.uiElements.push({","\t\t\t\t\ttype: 'field',","\t\t\t\t\tfield: el.field.path","\t\t\t\t});","\t\t\tbreak;","\t\t\tcase 'heading':","\t\t\t\tops.uiElements.push({","\t\t\t\t\ttype: 'heading',","\t\t\t\t\tcontent: el.heading,","\t\t\t\t\toptions: el.options","\t\t\t\t});","\t\t\tbreak;","\t\t}","\t}, this);","\treturn ops;","}","","module.exports = getOptions;",""],"l":{"1":1,"6":1,"7":0,"35":0,"36":0,"40":0,"43":0,"44":0,"47":0,"48":0,"51":0,"55":0,"57":0,"62":0,"65":0,"68":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getAdminURL.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getAdminURL.js","s":{"1":1,"2":0,"3":1},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"getAdminURL","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":27}}}},"statementMap":{"1":{"start":{"line":10,"column":0},"end":{"line":12,"column":1}},"2":{"start":{"line":11,"column":1},"end":{"line":11,"column":63}},"3":{"start":{"line":14,"column":0},"end":{"line":14,"column":29}}},"branchMap":{"1":{"line":11,"type":"cond-expr","locations":[{"start":{"line":11,"column":43},"end":{"line":11,"column":56}},{"start":{"line":11,"column":59},"end":{"line":11,"column":61}}]}},"code":["/**"," * Gets the Admin URL to view the list (or an item if provided)"," *"," * Example:"," *     var listURL = list.getAdminURL()"," *     var itemURL = list.getAdminURL(item)"," *"," * @param {Object} item"," */","function getAdminURL(item) {","\treturn '/keystone/' + this.path + (item ? '/' + item.id : '');","}","","module.exports = getAdminURL;",""],"l":{"10":1,"11":0,"14":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getDocumentName.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getDocumentName.js","s":{"1":1,"2":1,"3":0,"4":0,"5":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"getDocumentName","line":12,"loc":{"start":{"line":12,"column":0},"end":{"line":12,"column":38}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":38}},"2":{"start":{"line":12,"column":0},"end":{"line":15,"column":1}},"3":{"start":{"line":13,"column":1},"end":{"line":13,"column":89}},"4":{"start":{"line":14,"column":1},"end":{"line":14,"column":57}},"5":{"start":{"line":17,"column":0},"end":{"line":17,"column":33}}},"branchMap":{"1":{"line":13,"type":"cond-expr","locations":[{"start":{"line":13,"column":36},"end":{"line":13,"column":62}},{"start":{"line":13,"column":65},"end":{"line":13,"column":87}}]},"2":{"line":14,"type":"cond-expr","locations":[{"start":{"line":14,"column":19},"end":{"line":14,"column":49}},{"start":{"line":14,"column":52},"end":{"line":14,"column":56}}]}},"code":["var utils = require('keystone-utils');","","/**"," * Gets the name of the provided document from the correct path"," *"," * Example:"," *     var name = list.getDocumentName(item)"," *"," * @param {Object} item"," * @param {Boolean} escape - causes HTML entities to be encoded"," */","function getDocumentName(doc, escape) {","\tvar name = String(this.nameField ? this.nameField.format(doc) : doc.get(this.namePath));","\treturn (escape) ? utils.encodeHTMLEntities(name) : name;","}","","module.exports = getDocumentName;",""],"l":{"1":1,"12":1,"13":0,"14":0,"17":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/addSearchToQuery.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/addSearchToQuery.js","s":{"1":1,"2":1,"3":1,"4":0,"5":1,"6":0,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"trim","line":4,"loc":{"start":{"line":4,"column":0},"end":{"line":4,"column":17}}},"2":{"name":"truthy","line":5,"loc":{"start":{"line":5,"column":0},"end":{"line":5,"column":19}}},"3":{"name":"getNameFilter","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":44}}},"4":{"name":"getStringFilter","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":45}}},"5":{"name":"addSearchToQuery","line":25,"loc":{"start":{"line":25,"column":0},"end":{"line":25,"column":48}}},"6":{"name":"(anonymous_6)","line":31,"loc":{"start":{"line":31,"column":43},"end":{"line":31,"column":56}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":38}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":38}},"3":{"start":{"line":4,"column":0},"end":{"line":4,"column":37}},"4":{"start":{"line":4,"column":19},"end":{"line":4,"column":35}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":32}},"6":{"start":{"line":5,"column":21},"end":{"line":5,"column":30}},"7":{"start":{"line":7,"column":0},"end":{"line":17,"column":1}},"8":{"start":{"line":8,"column":1},"end":{"line":8,"column":92}},"9":{"start":{"line":9,"column":1},"end":{"line":9,"column":63}},"10":{"start":{"line":10,"column":1},"end":{"line":10,"column":16}},"11":{"start":{"line":11,"column":1},"end":{"line":11,"column":45}},"12":{"start":{"line":12,"column":1},"end":{"line":12,"column":15}},"13":{"start":{"line":13,"column":1},"end":{"line":13,"column":43}},"14":{"start":{"line":14,"column":1},"end":{"line":16,"column":3}},"15":{"start":{"line":19,"column":0},"end":{"line":23,"column":1}},"16":{"start":{"line":20,"column":1},"end":{"line":20,"column":17}},"17":{"start":{"line":21,"column":1},"end":{"line":21,"column":29}},"18":{"start":{"line":22,"column":1},"end":{"line":22,"column":15}},"19":{"start":{"line":25,"column":0},"end":{"line":58,"column":1}},"20":{"start":{"line":26,"column":1},"end":{"line":26,"column":50}},"21":{"start":{"line":27,"column":1},"end":{"line":27,"column":21}},"22":{"start":{"line":28,"column":1},"end":{"line":28,"column":33}},"23":{"start":{"line":28,"column":20},"end":{"line":28,"column":33}},"24":{"start":{"line":30,"column":1},"end":{"line":30,"column":70}},"25":{"start":{"line":31,"column":1},"end":{"line":37,"column":10}},"26":{"start":{"line":32,"column":2},"end":{"line":36,"column":3}},"27":{"start":{"line":33,"column":3},"end":{"line":33,"column":47}},"28":{"start":{"line":35,"column":3},"end":{"line":35,"column":48}},"29":{"start":{"line":39,"column":1},"end":{"line":43,"column":2}},"30":{"start":{"line":40,"column":2},"end":{"line":40,"column":25}},"31":{"start":{"line":41,"column":2},"end":{"line":41,"column":50}},"32":{"start":{"line":42,"column":2},"end":{"line":42,"column":36}},"33":{"start":{"line":45,"column":1},"end":{"line":49,"column":2}},"34":{"start":{"line":46,"column":2},"end":{"line":46,"column":20}},"35":{"start":{"line":47,"column":2},"end":{"line":47,"column":30}},"36":{"start":{"line":48,"column":2},"end":{"line":48,"column":31}},"37":{"start":{"line":51,"column":1},"end":{"line":55,"column":2}},"38":{"start":{"line":52,"column":2},"end":{"line":52,"column":28}},"39":{"start":{"line":53,"column":8},"end":{"line":55,"column":2}},"40":{"start":{"line":54,"column":2},"end":{"line":54,"column":34}},"41":{"start":{"line":57,"column":1},"end":{"line":57,"column":14}},"42":{"start":{"line":60,"column":0},"end":{"line":60,"column":34}}},"branchMap":{"1":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":23},"end":{"line":26,"column":35}},{"start":{"line":26,"column":39},"end":{"line":26,"column":41}}]},"2":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":9},"end":{"line":27,"column":14}},{"start":{"line":27,"column":18},"end":{"line":27,"column":20}}]},"3":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},{"start":{"line":28,"column":1},"end":{"line":28,"column":1}}]},"4":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"5":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":6},"end":{"line":32,"column":13}},{"start":{"line":32,"column":17},"end":{"line":32,"column":40}}]},"6":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},{"start":{"line":39,"column":1},"end":{"line":39,"column":1}}]},"7":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},{"start":{"line":45,"column":1},"end":{"line":45,"column":1}}]},"8":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},{"start":{"line":51,"column":1},"end":{"line":51,"column":1}}]},"9":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":8},"end":{"line":53,"column":8}},{"start":{"line":53,"column":8},"end":{"line":53,"column":8}}]}},"code":["var assign = require('object-assign');","var utils = require('keystone-utils');","","function trim(i) { return i.trim(); }","function truthy(i) { return i; }","","function getNameFilter(field, searchString) {","\tvar searchWords = searchString.split(' ').map(trim).filter(truthy).map(utils.escapeRegExp);","\tvar nameSearchRegExp = new RegExp(searchWords.join('|'), 'i');","\tvar first = {};","\tfirst[field.paths.first] = nameSearchRegExp;","\tvar last = {};","\tlast[field.paths.last] = nameSearchRegExp;","\treturn {","\t\t$or: [first, last]","\t};","}","","function getStringFilter(path, searchRegExp) {","\tvar filter = {};","\tfilter[path] = searchRegExp;","\treturn filter;","}","","function addSearchToQuery (searchString, query) {","\tsearchString = String(searchString || '').trim();","\tquery = query || {};","\tif (!searchString) return query;","","\tvar searchRegExp = new RegExp(utils.escapeRegExp(searchString), 'i');","\tvar searchFilters = this.searchFields.map(function (i) {","\t\tif (i.field && i.field.type === 'name') {","\t\t\treturn getNameFilter(i.field, searchString);","\t\t} else {","\t\t\treturn getStringFilter(i.path, searchRegExp);","\t\t}","\t}, this);","","\tif (this.autokey) {","\t\tvar autokeyFilter = {};","\t\tautokeyFilter[this.autokey.path] = searchRegExp;","\t\tsearchFilters.push(autokeyFilter);","\t}","","\tif (utils.isValidObjectId(searchString)) {","\t\tvar idFilter = {};","\t\tidFilter._id = searchString;","\t\tsearchFilters.push(idFilter);","\t}","","\tif (searchFilters.length > 1) {","\t\tquery.$or = searchFilters;","\t} else if (searchFilters.length) {","\t\tassign(query, searchFilters[0]);","\t}","","\treturn query;","}","","module.exports = addSearchToQuery;",""],"l":{"1":1,"2":1,"4":1,"5":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"19":1,"20":0,"21":0,"22":0,"25":1,"26":0,"27":0,"28":0,"30":0,"31":0,"32":0,"33":0,"35":0,"39":0,"40":0,"41":0,"42":0,"45":0,"46":0,"47":0,"48":0,"51":0,"52":0,"53":0,"54":0,"57":0,"60":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/addFiltersToQuery.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/addFiltersToQuery.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"addFiltersToQuery","line":1,"loc":{"start":{"line":1,"column":0},"end":{"line":1,"column":44}}},"2":{"name":"(anonymous_2)","line":4,"loc":{"start":{"line":4,"column":16},"end":{"line":4,"column":32}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":10,"column":1}},"2":{"start":{"line":2,"column":1},"end":{"line":2,"column":39}},"3":{"start":{"line":3,"column":1},"end":{"line":3,"column":21}},"4":{"start":{"line":4,"column":1},"end":{"line":8,"column":10}},"5":{"start":{"line":5,"column":2},"end":{"line":5,"column":32}},"6":{"start":{"line":6,"column":2},"end":{"line":6,"column":62}},"7":{"start":{"line":6,"column":55},"end":{"line":6,"column":62}},"8":{"start":{"line":7,"column":2},"end":{"line":7,"column":53}},"9":{"start":{"line":9,"column":1},"end":{"line":9,"column":14}},"10":{"start":{"line":12,"column":0},"end":{"line":12,"column":35}}},"branchMap":{"1":{"line":3,"type":"binary-expr","locations":[{"start":{"line":3,"column":9},"end":{"line":3,"column":14}},{"start":{"line":3,"column":18},"end":{"line":3,"column":20}}]},"2":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":2},"end":{"line":6,"column":2}},{"start":{"line":6,"column":2},"end":{"line":6,"column":2}}]},"3":{"line":6,"type":"binary-expr","locations":[{"start":{"line":6,"column":6},"end":{"line":6,"column":29}},{"start":{"line":6,"column":33},"end":{"line":6,"column":53}}]}},"code":["function addFiltersToQuery (filters, query) {","\tvar fields = Object.keys(this.fields);","\tquery = query || {};","\tfields.forEach(function (path) {","\t\tvar field = this.fields[path];","\t\tif (!field.addFilterToQuery || !filters[field.path]) return;","\t\tfield.addFilterToQuery(filters[field.path], query);","\t}, this);","\treturn query;","}","","module.exports = addFiltersToQuery;",""],"l":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"9":0,"12":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/isReserved.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/isReserved.js","s":{"1":1,"2":1,"3":0,"4":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"isReserved","line":24,"loc":{"start":{"line":24,"column":0},"end":{"line":24,"column":27}}}},"statementMap":{"1":{"start":{"line":6,"column":0},"end":{"line":22,"column":2}},"2":{"start":{"line":24,"column":0},"end":{"line":26,"column":1}},"3":{"start":{"line":25,"column":1},"end":{"line":25,"column":41}},"4":{"start":{"line":28,"column":0},"end":{"line":28,"column":28}}},"branchMap":{},"code":["/**"," * Check whether or not a `path` is a reserved path. This restricts the use"," * of `Object.prototype` method keys as well as internal mongo paths."," */","","var reservedPaths = [","\t'id',","\t'_id',","\t'_',","\t'prototype',","\t'__proto__',","\t'hasOwnProperty',","\t'toString',","\t'__defineGetter__',","\t'__defineSetter__',","\t'__lookupGetter__',","\t'__lookupSetter__',","\t'isPrototypeOf',","\t'propertyIsEnumerable',","\t'toLocaleString',","\t'valueOf'","];","","function isReserved (path) {","\treturn reservedPaths.indexOf(path) >= 0;","}","","module.exports = isReserved;",""],"l":{"6":1,"24":1,"25":0,"28":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/expandColumns.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/expandColumns.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"expandColumns","line":18,"loc":{"start":{"line":18,"column":0},"end":{"line":18,"column":29}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":14},"end":{"line":28,"column":28}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":38}},"2":{"start":{"line":18,"column":0},"end":{"line":96,"column":1}},"3":{"start":{"line":19,"column":1},"end":{"line":21,"column":2}},"4":{"start":{"line":20,"column":2},"end":{"line":20,"column":25}},"5":{"start":{"line":22,"column":1},"end":{"line":24,"column":2}},"6":{"start":{"line":23,"column":2},"end":{"line":23,"column":64}},"7":{"start":{"line":25,"column":1},"end":{"line":25,"column":17}},"8":{"start":{"line":26,"column":1},"end":{"line":26,"column":19}},"9":{"start":{"line":27,"column":1},"end":{"line":27,"column":21}},"10":{"start":{"line":28,"column":1},"end":{"line":71,"column":3}},"11":{"start":{"line":29,"column":2},"end":{"line":31,"column":3}},"12":{"start":{"line":30,"column":3},"end":{"line":30,"column":28}},"13":{"start":{"line":32,"column":2},"end":{"line":32,"column":36}},"14":{"start":{"line":33,"column":2},"end":{"line":33,"column":17}},"15":{"start":{"line":34,"column":2},"end":{"line":59,"column":3}},"16":{"start":{"line":35,"column":3},"end":{"line":40,"column":5}},"17":{"start":{"line":41,"column":3},"end":{"line":51,"column":4}},"18":{"start":{"line":42,"column":4},"end":{"line":42,"column":36}},"19":{"start":{"line":43,"column":4},"end":{"line":47,"column":5}},"20":{"start":{"line":44,"column":5},"end":{"line":44,"column":55}},"21":{"start":{"line":45,"column":5},"end":{"line":45,"column":52}},"22":{"start":{"line":46,"column":5},"end":{"line":46,"column":67}},"23":{"start":{"line":48,"column":4},"end":{"line":50,"column":5}},"24":{"start":{"line":49,"column":5},"end":{"line":49,"column":106}},"25":{"start":{"line":52,"column":9},"end":{"line":59,"column":3}},"26":{"start":{"line":55,"column":3},"end":{"line":58,"column":5}},"27":{"start":{"line":60,"column":2},"end":{"line":69,"column":3}},"28":{"start":{"line":61,"column":3},"end":{"line":61,"column":25}},"29":{"start":{"line":62,"column":3},"end":{"line":65,"column":4}},"30":{"start":{"line":63,"column":4},"end":{"line":63,"column":22}},"31":{"start":{"line":64,"column":4},"end":{"line":64,"column":18}},"32":{"start":{"line":66,"column":3},"end":{"line":68,"column":4}},"33":{"start":{"line":67,"column":4},"end":{"line":67,"column":29}},"34":{"start":{"line":70,"column":2},"end":{"line":70,"column":13}},"35":{"start":{"line":72,"column":1},"end":{"line":88,"column":2}},"36":{"start":{"line":73,"column":2},"end":{"line":73,"column":15}},"37":{"start":{"line":74,"column":2},"end":{"line":80,"column":3}},"38":{"start":{"line":75,"column":3},"end":{"line":75,"column":41}},"39":{"start":{"line":76,"column":3},"end":{"line":76,"column":33}},"40":{"start":{"line":77,"column":3},"end":{"line":77,"column":31}},"41":{"start":{"line":78,"column":3},"end":{"line":78,"column":23}},"42":{"start":{"line":79,"column":3},"end":{"line":79,"column":26}},"43":{"start":{"line":81,"column":2},"end":{"line":83,"column":3}},"44":{"start":{"line":82,"column":3},"end":{"line":82,"column":81}},"45":{"start":{"line":84,"column":2},"end":{"line":84,"column":24}},"46":{"start":{"line":85,"column":2},"end":{"line":87,"column":3}},"47":{"start":{"line":86,"column":3},"end":{"line":86,"column":22}},"48":{"start":{"line":89,"column":1},"end":{"line":94,"column":2}},"49":{"start":{"line":90,"column":2},"end":{"line":90,"column":44}},"50":{"start":{"line":91,"column":2},"end":{"line":93,"column":3}},"51":{"start":{"line":92,"column":3},"end":{"line":92,"column":29}},"52":{"start":{"line":95,"column":1},"end":{"line":95,"column":17}},"53":{"start":{"line":98,"column":0},"end":{"line":98,"column":31}}},"branchMap":{"1":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},{"start":{"line":19,"column":1},"end":{"line":19,"column":1}}]},"2":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},{"start":{"line":22,"column":1},"end":{"line":22,"column":1}}]},"3":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"4":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"5":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":11},"end":{"line":39,"column":20}},{"start":{"line":39,"column":24},"end":{"line":39,"column":35}}]},"6":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":3},"end":{"line":41,"column":3}},{"start":{"line":41,"column":3},"end":{"line":41,"column":3}}]},"7":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":4},"end":{"line":43,"column":4}},{"start":{"line":43,"column":4},"end":{"line":43,"column":4}}]},"8":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":19},"end":{"line":44,"column":30}},{"start":{"line":44,"column":34},"end":{"line":44,"column":54}}]},"9":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":4},"end":{"line":48,"column":4}},{"start":{"line":48,"column":4},"end":{"line":48,"column":4}}]},"10":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":8},"end":{"line":48,"column":18}},{"start":{"line":48,"column":22},"end":{"line":48,"column":33}}]},"11":{"line":49,"type":"cond-expr","locations":[{"start":{"line":49,"column":54},"end":{"line":49,"column":72}},{"start":{"line":49,"column":75},"end":{"line":49,"column":104}}]},"12":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":9},"end":{"line":52,"column":9}},{"start":{"line":52,"column":9},"end":{"line":52,"column":9}}]},"13":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":13},"end":{"line":52,"column":46}},{"start":{"line":52,"column":50},"end":{"line":52,"column":86}}]},"14":{"line":57,"type":"binary-expr","locations":[{"start":{"line":57,"column":11},"end":{"line":57,"column":20}},{"start":{"line":57,"column":24},"end":{"line":57,"column":50}}]},"15":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":2},"end":{"line":60,"column":2}},{"start":{"line":60,"column":2},"end":{"line":60,"column":2}}]},"16":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":3},"end":{"line":62,"column":3}},{"start":{"line":62,"column":3},"end":{"line":62,"column":3}}]},"17":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":3},"end":{"line":66,"column":3}},{"start":{"line":66,"column":3},"end":{"line":66,"column":3}}]},"18":{"line":66,"type":"binary-expr","locations":[{"start":{"line":66,"column":7},"end":{"line":66,"column":12}},{"start":{"line":66,"column":16},"end":{"line":66,"column":25}}]},"19":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":2},"end":{"line":74,"column":2}},{"start":{"line":74,"column":2},"end":{"line":74,"column":2}}]},"20":{"line":76,"type":"binary-expr","locations":[{"start":{"line":76,"column":15},"end":{"line":76,"column":23}},{"start":{"line":76,"column":27},"end":{"line":76,"column":32}}]},"21":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":2},"end":{"line":81,"column":2}},{"start":{"line":81,"column":2},"end":{"line":81,"column":2}}]},"22":{"line":81,"type":"binary-expr","locations":[{"start":{"line":81,"column":6},"end":{"line":81,"column":26}},{"start":{"line":81,"column":30},"end":{"line":81,"column":39}}]},"23":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":2},"end":{"line":85,"column":2}},{"start":{"line":85,"column":2},"end":{"line":85,"column":2}}]},"24":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},{"start":{"line":89,"column":1},"end":{"line":89,"column":1}}]},"25":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":2},"end":{"line":91,"column":2}},{"start":{"line":91,"column":2},"end":{"line":91,"column":2}}]}},"code":["var utils = require('keystone-utils');","","/**"," * Expands a comma-separated string or array of columns into valid column objects."," *"," * Columns can be:"," *    - A Field, in the format \"field|width\""," *    - A Field in a single related List, in the format \"list:field|width\""," *    - Any valid path in the Schema, in the format \"path|width\""," *"," * The width part is optional, and can be in the format \"n%\" or \"npx\"."," *"," * The path __name__ is automatically mapped to the namePath of the List."," *"," * The field or path for the name of the item (defaults to ID if not set or detected)"," * is automatically prepended if not explicitly included."," */","function expandColumns(cols) {","\tif (typeof cols === 'string') {","\t\tcols = cols.split(',');","\t}","\tif (!Array.isArray(cols)) {","\t\tthrow new Error('List.expandColumns: cols must be an array.');","\t}","\tvar list = this;","\tvar expanded = [];","\tvar nameCol = false;","\tvar getCol = function(def) {","\t\tif (def.path === '__name__') {","\t\t\tdef.path = list.namePath;","\t\t}","\t\tvar field = list.fields[def.path];","\t\tvar col = null;","\t\tif (field) {","\t\t\tcol = {","\t\t\t\tfield: field,","\t\t\t\tpath: field.path,","\t\t\t\ttype: field.type,","\t\t\t\tlabel: def.label || field.label","\t\t\t};","\t\t\tif (col.type === 'relationship') {","\t\t\t\tcol.refList = col.field.refList;","\t\t\t\tif (col.refList) {","\t\t\t\t\tcol.refPath = def.subpath || col.refList.namePath;","\t\t\t\t\tcol.subField = col.refList.fields[col.refPath];","\t\t\t\t\tcol.populate = { path: col.field.path, subpath: col.refPath };","\t\t\t\t}","\t\t\t\tif (!def.label && def.subpath) {","\t\t\t\t\tcol.label = field.label + ': ' + (col.subField ? col.subField.label : utils.keyToLabel(def.subpath));","\t\t\t\t}","\t\t\t}","\t\t} else if (list.model.schema.paths[def.path] || list.model.schema.virtuals[def.path]) {","\t\t\t// column refers to a path in the schema","\t\t\t// TODO: this needs to handle sophisticated types, including arrays, nested Schemas, and mixed types","\t\t\tcol = {","\t\t\t\tpath: def.path,","\t\t\t\tlabel: def.label || utils.keyToLabel(def.path)","\t\t\t};","\t\t}","\t\tif (col) {","\t\t\tcol.width = def.width;","\t\t\tif (col.path === list.namePath) {","\t\t\t\tcol.isName = true;","\t\t\t\tnameCol = col;","\t\t\t}","\t\t\tif (field && field.col) {","\t\t\t\t_.extend(col, field.col);","\t\t\t}","\t\t}","\t\treturn col;","\t};","\tfor (var i = 0; i < cols.length; i++) {","\t\tvar def = {};","\t\tif (typeof cols[i] === 'string') {","\t\t\tvar parts = cols[i].trim().split('|');","\t\t\tdef.width = parts[1] || false;","\t\t\tparts = parts[0].split(':');","\t\t\tdef.path = parts[0];","\t\t\tdef.subpath = parts[1];","\t\t}","\t\tif (!utils.isObject(def) || !def.path) {","\t\t\tthrow new Error('List.expandColumns: column definition must contain a path.');","\t\t}","\t\tvar col = getCol(def);","\t\tif (col) {","\t\t\texpanded.push(col);","\t\t}","\t}","\tif (!nameCol) {","\t\tnameCol = getCol({ path: list.namePath });","\t\tif (nameCol) {","\t\t\texpanded.unshift(nameCol);","\t\t}","\t}","\treturn expanded;","}","","module.exports = expandColumns;",""],"l":{"1":1,"18":1,"19":0,"20":0,"22":0,"23":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"32":0,"33":0,"34":0,"35":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"48":0,"49":0,"52":0,"55":0,"60":0,"61":0,"62":0,"63":0,"64":0,"66":0,"67":0,"70":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"81":0,"82":0,"84":0,"85":0,"86":0,"89":0,"90":0,"91":0,"92":0,"95":0,"98":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/expandPaths.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/expandPaths.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":1},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"expandPaths","line":3,"loc":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}}},"2":{"name":"(anonymous_2)","line":4,"loc":{"start":{"line":4,"column":31},"end":{"line":4,"column":47}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":43}},"2":{"start":{"line":3,"column":0},"end":{"line":13,"column":1}},"3":{"start":{"line":4,"column":1},"end":{"line":12,"column":10}},"4":{"start":{"line":5,"column":2},"end":{"line":7,"column":3}},"5":{"start":{"line":6,"column":3},"end":{"line":6,"column":29}},"6":{"start":{"line":8,"column":2},"end":{"line":11,"column":4}},"7":{"start":{"line":15,"column":0},"end":{"line":15,"column":29}}},"branchMap":{"1":{"line":5,"type":"if","locations":[{"start":{"line":5,"column":2},"end":{"line":5,"column":2}},{"start":{"line":5,"column":2},"end":{"line":5,"column":2}}]}},"code":["var listToArray = require('list-to-array');","","function expandPaths (paths) {","\treturn listToArray(paths).map(function (path) {","\t\tif (path === '__name__') {","\t\t\tpath = this.mappings.name;","\t\t}","\t\treturn {","\t\t\tpath: path,","\t\t\tfield: this.fields[path]","\t\t};","\t}, this);","}","","module.exports = expandPaths;",""],"l":{"1":1,"3":1,"4":0,"5":0,"6":0,"8":0,"15":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/selectColumns.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/selectColumns.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"selectColumns","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":33}}},"2":{"name":"(anonymous_2)","line":12,"loc":{"start":{"line":12,"column":14},"end":{"line":12,"column":28}}}},"statementMap":{"1":{"start":{"line":7,"column":0},"end":{"line":27,"column":1}},"2":{"start":{"line":9,"column":1},"end":{"line":9,"column":17}},"3":{"start":{"line":10,"column":1},"end":{"line":10,"column":19}},"4":{"start":{"line":11,"column":1},"end":{"line":11,"column":10}},"5":{"start":{"line":12,"column":1},"end":{"line":20,"column":4}},"6":{"start":{"line":13,"column":2},"end":{"line":13,"column":24}},"7":{"start":{"line":14,"column":2},"end":{"line":19,"column":3}},"8":{"start":{"line":15,"column":3},"end":{"line":17,"column":4}},"9":{"start":{"line":16,"column":4},"end":{"line":16,"column":37}},"10":{"start":{"line":18,"column":3},"end":{"line":18,"column":58}},"11":{"start":{"line":21,"column":1},"end":{"line":21,"column":28}},"12":{"start":{"line":22,"column":1},"end":{"line":26,"column":2}},"13":{"start":{"line":23,"column":2},"end":{"line":25,"column":3}},"14":{"start":{"line":24,"column":3},"end":{"line":24,"column":46}},"15":{"start":{"line":29,"column":0},"end":{"line":29,"column":31}}},"branchMap":{"1":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":2},"end":{"line":14,"column":2}},{"start":{"line":14,"column":2},"end":{"line":14,"column":2}}]},"2":{"line":15,"type":"if","locations":[{"start":{"line":15,"column":3},"end":{"line":15,"column":3}},{"start":{"line":15,"column":3},"end":{"line":15,"column":3}}]},"3":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":2},"end":{"line":23,"column":2}},{"start":{"line":23,"column":2},"end":{"line":23,"column":2}}]}},"code":["/**"," * Specified select and populate options for a query based the provided columns."," *"," * @param {Query} query"," * @param {Array} columns"," */","function selectColumns (q, cols) {","\t// Populate relationship columns","\tvar select = [];","\tvar populate = {};","\tvar path;","\tcols.forEach(function(col) {","\t\tselect.push(col.path);","\t\tif (col.populate) {","\t\t\tif (!populate[col.populate.path]) {","\t\t\t\tpopulate[col.populate.path] = [];","\t\t\t}","\t\t\tpopulate[col.populate.path].push(col.populate.subpath);","\t\t}","\t});","\tq.select(select.join(' '));","\tfor (path in populate) {","\t\tif (populate.hasOwnProperty(path)) {","\t\t\tq.populate(path, populate[path].join(' '));","\t\t}","\t}","}","","module.exports = selectColumns;",""],"l":{"7":1,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"18":0,"21":0,"22":0,"23":0,"24":0,"29":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/processFilters.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/processFilters.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1},"b":{},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"processFilters","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":28}}},"2":{"name":"(anonymous_2)","line":14,"loc":{"start":{"line":14,"column":60},"end":{"line":14,"column":76}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":44}},"2":{"start":{"line":11,"column":0},"end":{"line":20,"column":1}},"3":{"start":{"line":12,"column":1},"end":{"line":12,"column":17}},"4":{"start":{"line":13,"column":1},"end":{"line":13,"column":18}},"5":{"start":{"line":14,"column":1},"end":{"line":18,"column":4}},"6":{"start":{"line":15,"column":2},"end":{"line":15,"column":27}},"7":{"start":{"line":16,"column":2},"end":{"line":16,"column":41}},"8":{"start":{"line":17,"column":2},"end":{"line":17,"column":32}},"9":{"start":{"line":19,"column":1},"end":{"line":19,"column":16}},"10":{"start":{"line":22,"column":0},"end":{"line":22,"column":32}}},"branchMap":{},"code":["var queryfilterlib = require('queryfilter');","","/**"," * Processes a filter string into a filters object"," *"," * NOTE: This function is deprecated in favor of List.prototype.addFiltersToQuery"," * and will be removed in a later version."," *"," * @param {String} filters"," */","function processFilters (q) {","\tvar list = this;","\tvar filters = {};","\tqueryfilterlib.QueryFilters.create(q).getFilters().forEach(function(filter){","\t\tfilter.path = filter.key; // alias for b/c","\t\tfilter.field = list.fields[filter.key];","\t\tfilters[filter.path] = filter;","\t});","\treturn filters;","}","","module.exports = processFilters;",""],"l":{"1":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"19":0,"22":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getSearchFilters.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getSearchFilters.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0,0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"getSearchFilters","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":40}}},"2":{"name":"(anonymous_2)","line":40,"loc":{"start":{"line":40,"column":23},"end":{"line":40,"column":39}}},"3":{"name":"(anonymous_3)","line":85,"loc":{"start":{"line":85,"column":14},"end":{"line":85,"column":31}}},"4":{"name":"(anonymous_4)","line":109,"loc":{"start":{"line":109,"column":67},"end":{"line":109,"column":88}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":31}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"4":{"start":{"line":21,"column":0},"end":{"line":233,"column":1}},"5":{"start":{"line":22,"column":1},"end":{"line":22,"column":18}},"6":{"start":{"line":23,"column":1},"end":{"line":23,"column":17}},"7":{"start":{"line":25,"column":1},"end":{"line":25,"column":38}},"8":{"start":{"line":27,"column":1},"end":{"line":82,"column":2}},"9":{"start":{"line":28,"column":2},"end":{"line":28,"column":19}},"10":{"start":{"line":29,"column":2},"end":{"line":29,"column":38}},"11":{"start":{"line":30,"column":2},"end":{"line":30,"column":61}},"12":{"start":{"line":31,"column":2},"end":{"line":31,"column":124}},"13":{"start":{"line":32,"column":2},"end":{"line":32,"column":46}},"14":{"start":{"line":33,"column":2},"end":{"line":33,"column":25}},"15":{"start":{"line":34,"column":2},"end":{"line":34,"column":52}},"16":{"start":{"line":36,"column":2},"end":{"line":38,"column":3}},"17":{"start":{"line":37,"column":3},"end":{"line":37,"column":42}},"18":{"start":{"line":40,"column":2},"end":{"line":62,"column":5}},"19":{"start":{"line":41,"column":3},"end":{"line":41,"column":22}},"20":{"start":{"line":43,"column":3},"end":{"line":45,"column":4}},"21":{"start":{"line":44,"column":4},"end":{"line":44,"column":30}},"22":{"start":{"line":47,"column":3},"end":{"line":47,"column":33}},"23":{"start":{"line":49,"column":3},"end":{"line":61,"column":4}},"24":{"start":{"line":50,"column":4},"end":{"line":50,"column":19}},"25":{"start":{"line":51,"column":4},"end":{"line":51,"column":45}},"26":{"start":{"line":52,"column":4},"end":{"line":52,"column":18}},"27":{"start":{"line":53,"column":4},"end":{"line":53,"column":43}},"28":{"start":{"line":54,"column":4},"end":{"line":54,"column":22}},"29":{"start":{"line":55,"column":4},"end":{"line":55,"column":37}},"30":{"start":{"line":56,"column":4},"end":{"line":56,"column":37}},"31":{"start":{"line":58,"column":4},"end":{"line":58,"column":22}},"32":{"start":{"line":59,"column":4},"end":{"line":59,"column":34}},"33":{"start":{"line":60,"column":4},"end":{"line":60,"column":37}},"34":{"start":{"line":64,"column":2},"end":{"line":68,"column":3}},"35":{"start":{"line":65,"column":3},"end":{"line":65,"column":21}},"36":{"start":{"line":66,"column":3},"end":{"line":66,"column":46}},"37":{"start":{"line":67,"column":3},"end":{"line":67,"column":36}},"38":{"start":{"line":70,"column":2},"end":{"line":74,"column":3}},"39":{"start":{"line":71,"column":3},"end":{"line":71,"column":21}},"40":{"start":{"line":72,"column":3},"end":{"line":72,"column":29}},"41":{"start":{"line":73,"column":3},"end":{"line":73,"column":36}},"42":{"start":{"line":76,"column":2},"end":{"line":80,"column":3}},"43":{"start":{"line":77,"column":3},"end":{"line":77,"column":31}},"44":{"start":{"line":78,"column":9},"end":{"line":80,"column":3}},"45":{"start":{"line":79,"column":3},"end":{"line":79,"column":30}},"46":{"start":{"line":84,"column":1},"end":{"line":231,"column":2}},"47":{"start":{"line":85,"column":2},"end":{"line":230,"column":5}},"48":{"start":{"line":86,"column":3},"end":{"line":86,"column":12}},"49":{"start":{"line":87,"column":3},"end":{"line":87,"column":25}},"50":{"start":{"line":88,"column":3},"end":{"line":88,"column":28}},"51":{"start":{"line":90,"column":3},"end":{"line":229,"column":4}},"52":{"start":{"line":92,"column":5},"end":{"line":96,"column":6}},"53":{"start":{"line":93,"column":6},"end":{"line":93,"column":36}},"54":{"start":{"line":95,"column":6},"end":{"line":95,"column":27}},"55":{"start":{"line":97,"column":5},"end":{"line":97,"column":11}},"56":{"start":{"line":106,"column":5},"end":{"line":106,"column":11}},"57":{"start":{"line":109,"column":5},"end":{"line":114,"column":8}},"58":{"start":{"line":110,"column":6},"end":{"line":110,"column":34}},"59":{"start":{"line":111,"column":6},"end":{"line":113,"column":7}},"60":{"start":{"line":112,"column":7},"end":{"line":112,"column":89}},"61":{"start":{"line":115,"column":5},"end":{"line":115,"column":11}},"62":{"start":{"line":118,"column":5},"end":{"line":130,"column":6}},"63":{"start":{"line":119,"column":6},"end":{"line":123,"column":7}},"64":{"start":{"line":120,"column":7},"end":{"line":120,"column":79}},"65":{"start":{"line":122,"column":7},"end":{"line":122,"column":65}},"66":{"start":{"line":125,"column":6},"end":{"line":129,"column":7}},"67":{"start":{"line":126,"column":7},"end":{"line":126,"column":80}},"68":{"start":{"line":128,"column":7},"end":{"line":128,"column":63}},"69":{"start":{"line":131,"column":5},"end":{"line":131,"column":11}},"70":{"start":{"line":134,"column":5},"end":{"line":138,"column":6}},"71":{"start":{"line":135,"column":6},"end":{"line":135,"column":64}},"72":{"start":{"line":137,"column":6},"end":{"line":137,"column":84}},"73":{"start":{"line":139,"column":5},"end":{"line":139,"column":11}},"74":{"start":{"line":143,"column":5},"end":{"line":173,"column":6}},"75":{"start":{"line":144,"column":6},"end":{"line":147,"column":8}},"76":{"start":{"line":148,"column":6},"end":{"line":156,"column":7}},"77":{"start":{"line":149,"column":7},"end":{"line":152,"column":9}},"78":{"start":{"line":155,"column":7},"end":{"line":155,"column":28}},"79":{"start":{"line":158,"column":6},"end":{"line":158,"column":34}},"80":{"start":{"line":159,"column":6},"end":{"line":172,"column":7}},"81":{"start":{"line":160,"column":7},"end":{"line":168,"column":8}},"82":{"start":{"line":161,"column":8},"end":{"line":161,"column":39}},"83":{"start":{"line":163,"column":12},"end":{"line":168,"column":8}},"84":{"start":{"line":164,"column":8},"end":{"line":164,"column":39}},"85":{"start":{"line":167,"column":8},"end":{"line":167,"column":30}},"86":{"start":{"line":171,"column":7},"end":{"line":171,"column":28}},"87":{"start":{"line":174,"column":4},"end":{"line":174,"column":10}},"88":{"start":{"line":178,"column":5},"end":{"line":202,"column":6}},"89":{"start":{"line":179,"column":6},"end":{"line":182,"column":8}},"90":{"start":{"line":183,"column":6},"end":{"line":188,"column":7}},"91":{"start":{"line":184,"column":7},"end":{"line":187,"column":9}},"92":{"start":{"line":190,"column":6},"end":{"line":190,"column":28}},"93":{"start":{"line":191,"column":6},"end":{"line":201,"column":7}},"94":{"start":{"line":192,"column":7},"end":{"line":192,"column":57}},"95":{"start":{"line":193,"column":7},"end":{"line":193,"column":53}},"96":{"start":{"line":194,"column":7},"end":{"line":200,"column":8}},"97":{"start":{"line":195,"column":8},"end":{"line":195,"column":37}},"98":{"start":{"line":196,"column":14},"end":{"line":200,"column":8}},"99":{"start":{"line":197,"column":8},"end":{"line":197,"column":39}},"100":{"start":{"line":199,"column":8},"end":{"line":199,"column":51}},"101":{"start":{"line":203,"column":5},"end":{"line":203,"column":11}},"102":{"start":{"line":211,"column":5},"end":{"line":226,"column":6}},"103":{"start":{"line":212,"column":6},"end":{"line":222,"column":7}},"104":{"start":{"line":215,"column":7},"end":{"line":215,"column":64}},"105":{"start":{"line":217,"column":7},"end":{"line":221,"column":8}},"106":{"start":{"line":218,"column":8},"end":{"line":218,"column":45}},"107":{"start":{"line":220,"column":8},"end":{"line":220,"column":44}},"108":{"start":{"line":223,"column":12},"end":{"line":226,"column":6}},"109":{"start":{"line":224,"column":6},"end":{"line":224,"column":56}},"110":{"start":{"line":225,"column":6},"end":{"line":225,"column":61}},"111":{"start":{"line":227,"column":5},"end":{"line":227,"column":11}},"112":{"start":{"line":232,"column":1},"end":{"line":232,"column":16}},"113":{"start":{"line":235,"column":0},"end":{"line":235,"column":34}}},"branchMap":{"1":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":17},"end":{"line":25,"column":23}},{"start":{"line":25,"column":27},"end":{"line":25,"column":29}}]},"2":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},{"start":{"line":27,"column":1},"end":{"line":27,"column":1}}]},"3":{"line":31,"type":"cond-expr","locations":[{"start":{"line":31,"column":60},"end":{"line":31,"column":108}},{"start":{"line":31,"column":111},"end":{"line":31,"column":117}}]},"4":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"5":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":3},"end":{"line":43,"column":3}},{"start":{"line":43,"column":3},"end":{"line":43,"column":3}}]},"6":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":3},"end":{"line":49,"column":3}},{"start":{"line":49,"column":3},"end":{"line":49,"column":3}}]},"7":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":7},"end":{"line":49,"column":12}},{"start":{"line":49,"column":16},"end":{"line":49,"column":37}}]},"8":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":2},"end":{"line":64,"column":2}},{"start":{"line":64,"column":2},"end":{"line":64,"column":2}}]},"9":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":2},"end":{"line":70,"column":2}},{"start":{"line":70,"column":2},"end":{"line":70,"column":2}}]},"10":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":2},"end":{"line":76,"column":2}},{"start":{"line":76,"column":2},"end":{"line":76,"column":2}}]},"11":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":9},"end":{"line":78,"column":9}},{"start":{"line":78,"column":9},"end":{"line":78,"column":9}}]},"12":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},{"start":{"line":84,"column":1},"end":{"line":84,"column":1}}]},"13":{"line":90,"type":"switch","locations":[{"start":{"line":91,"column":4},"end":{"line":97,"column":11}},{"start":{"line":99,"column":4},"end":{"line":99,"column":21}},{"start":{"line":100,"column":4},"end":{"line":100,"column":27}},{"start":{"line":101,"column":4},"end":{"line":101,"column":28}},{"start":{"line":102,"column":4},"end":{"line":102,"column":18}},{"start":{"line":103,"column":4},"end":{"line":103,"column":16}},{"start":{"line":104,"column":4},"end":{"line":106,"column":11}},{"start":{"line":108,"column":4},"end":{"line":115,"column":11}},{"start":{"line":117,"column":4},"end":{"line":131,"column":11}},{"start":{"line":133,"column":4},"end":{"line":139,"column":11}},{"start":{"line":141,"column":4},"end":{"line":141,"column":18}},{"start":{"line":142,"column":4},"end":{"line":174,"column":10}},{"start":{"line":176,"column":4},"end":{"line":176,"column":16}},{"start":{"line":177,"column":4},"end":{"line":203,"column":11}},{"start":{"line":205,"column":4},"end":{"line":205,"column":16}},{"start":{"line":206,"column":4},"end":{"line":206,"column":20}},{"start":{"line":207,"column":4},"end":{"line":207,"column":16}},{"start":{"line":208,"column":4},"end":{"line":208,"column":17}},{"start":{"line":209,"column":4},"end":{"line":209,"column":15}},{"start":{"line":210,"column":4},"end":{"line":227,"column":11}}]},"14":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":5},"end":{"line":92,"column":5}},{"start":{"line":92,"column":5},"end":{"line":92,"column":5}}]},"15":{"line":92,"type":"binary-expr","locations":[{"start":{"line":92,"column":9},"end":{"line":92,"column":15}},{"start":{"line":92,"column":19},"end":{"line":92,"column":36}}]},"16":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":6},"end":{"line":111,"column":6}},{"start":{"line":111,"column":6},"end":{"line":111,"column":6}}]},"17":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":5},"end":{"line":118,"column":5}},{"start":{"line":118,"column":5},"end":{"line":118,"column":5}}]},"18":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":6},"end":{"line":119,"column":6}},{"start":{"line":119,"column":6},"end":{"line":119,"column":6}}]},"19":{"line":120,"type":"cond-expr","locations":[{"start":{"line":120,"column":42},"end":{"line":120,"column":59}},{"start":{"line":120,"column":62},"end":{"line":120,"column":78}}]},"20":{"line":122,"type":"cond-expr","locations":[{"start":{"line":122,"column":42},"end":{"line":122,"column":56}},{"start":{"line":122,"column":59},"end":{"line":122,"column":64}}]},"21":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":6},"end":{"line":125,"column":6}},{"start":{"line":125,"column":6},"end":{"line":125,"column":6}}]},"22":{"line":126,"type":"cond-expr","locations":[{"start":{"line":126,"column":42},"end":{"line":126,"column":64}},{"start":{"line":126,"column":67},"end":{"line":126,"column":79}}]},"23":{"line":128,"type":"cond-expr","locations":[{"start":{"line":128,"column":42},"end":{"line":128,"column":55}},{"start":{"line":128,"column":58},"end":{"line":128,"column":62}}]},"24":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":5},"end":{"line":134,"column":5}},{"start":{"line":134,"column":5},"end":{"line":134,"column":5}}]},"25":{"line":135,"type":"cond-expr","locations":[{"start":{"line":135,"column":41},"end":{"line":135,"column":55}},{"start":{"line":135,"column":58},"end":{"line":135,"column":63}}]},"26":{"line":137,"type":"cond-expr","locations":[{"start":{"line":137,"column":41},"end":{"line":137,"column":61}},{"start":{"line":137,"column":64},"end":{"line":137,"column":83}}]},"27":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":5},"end":{"line":143,"column":5}},{"start":{"line":143,"column":5},"end":{"line":143,"column":5}}]},"28":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":6},"end":{"line":148,"column":6}},{"start":{"line":148,"column":6},"end":{"line":148,"column":6}}]},"29":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":11},"end":{"line":148,"column":27}},{"start":{"line":148,"column":31},"end":{"line":148,"column":47}}]},"30":{"line":159,"type":"if","locations":[{"start":{"line":159,"column":6},"end":{"line":159,"column":6}},{"start":{"line":159,"column":6},"end":{"line":159,"column":6}}]},"31":{"line":160,"type":"if","locations":[{"start":{"line":160,"column":7},"end":{"line":160,"column":7}},{"start":{"line":160,"column":7},"end":{"line":160,"column":7}}]},"32":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":12},"end":{"line":163,"column":12}},{"start":{"line":163,"column":12},"end":{"line":163,"column":12}}]},"33":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":5},"end":{"line":178,"column":5}},{"start":{"line":178,"column":5},"end":{"line":178,"column":5}}]},"34":{"line":183,"type":"if","locations":[{"start":{"line":183,"column":6},"end":{"line":183,"column":6}},{"start":{"line":183,"column":6},"end":{"line":183,"column":6}}]},"35":{"line":183,"type":"binary-expr","locations":[{"start":{"line":183,"column":12},"end":{"line":183,"column":20}},{"start":{"line":183,"column":24},"end":{"line":183,"column":42}},{"start":{"line":183,"column":48},"end":{"line":183,"column":56}},{"start":{"line":183,"column":60},"end":{"line":183,"column":78}}]},"36":{"line":191,"type":"if","locations":[{"start":{"line":191,"column":6},"end":{"line":191,"column":6}},{"start":{"line":191,"column":6},"end":{"line":191,"column":6}}]},"37":{"line":191,"type":"binary-expr","locations":[{"start":{"line":191,"column":10},"end":{"line":191,"column":15}},{"start":{"line":191,"column":19},"end":{"line":191,"column":34}}]},"38":{"line":194,"type":"if","locations":[{"start":{"line":194,"column":7},"end":{"line":194,"column":7}},{"start":{"line":194,"column":7},"end":{"line":194,"column":7}}]},"39":{"line":196,"type":"if","locations":[{"start":{"line":196,"column":14},"end":{"line":196,"column":14}},{"start":{"line":196,"column":14},"end":{"line":196,"column":14}}]},"40":{"line":211,"type":"if","locations":[{"start":{"line":211,"column":5},"end":{"line":211,"column":5}},{"start":{"line":211,"column":5},"end":{"line":211,"column":5}}]},"41":{"line":212,"type":"if","locations":[{"start":{"line":212,"column":6},"end":{"line":212,"column":6}},{"start":{"line":212,"column":6},"end":{"line":212,"column":6}}]},"42":{"line":215,"type":"cond-expr","locations":[{"start":{"line":215,"column":40},"end":{"line":215,"column":55}},{"start":{"line":215,"column":58},"end":{"line":215,"column":63}}]},"43":{"line":217,"type":"if","locations":[{"start":{"line":217,"column":7},"end":{"line":217,"column":7}},{"start":{"line":217,"column":7},"end":{"line":217,"column":7}}]},"44":{"line":223,"type":"if","locations":[{"start":{"line":223,"column":12},"end":{"line":223,"column":12}},{"start":{"line":223,"column":12},"end":{"line":223,"column":12}}]},"45":{"line":225,"type":"cond-expr","locations":[{"start":{"line":225,"column":39},"end":{"line":225,"column":53}},{"start":{"line":225,"column":56},"end":{"line":225,"column":60}}]}},"code":["var _ = require('underscore');","var moment = require('moment');","var utils = require('keystone-utils');","","/**"," * Gets filters for a Mongoose query that will search for the provided string,"," * based on the searchFields List option."," *"," * Also accepts a filters object from `processFilters()`, any of which may"," * override the search string."," *"," * NOTE: This function is deprecated in favor of List.prototype.addSearchToQuery"," * and will be removed in a later version."," *"," * Example:"," *     list.getSearchFilters('jed') // returns { name: /jed/i }"," *"," * @param {String} query"," * @param {Object} additional filters"," */","function getSearchFilters (search, add) {","\tvar filters = {};","\tvar list = this;","","\tsearch = String(search || '').trim();","","\tif (search.length) {","\t\tvar searchFilter;","\t\tvar searchParts = search.split(' ');","\t\tvar searchRx = new RegExp(utils.escapeRegExp(search), 'i');","\t\tvar splitSearchRx = new RegExp((searchParts.length > 1) ? _.map(searchParts, utils.escapeRegExp).join('|') : search, 'i');","\t\tvar searchFields = this.get('searchFields');","\t\tvar searchFilters = [];","\t\tvar searchIdField = utils.isValidObjectId(search);","","\t\tif ('string' === typeof searchFields) {","\t\t\tsearchFields = searchFields.split(',');","\t\t}","","\t\tsearchFields.forEach(function (path) {","\t\t\tpath = path.trim();","","\t\t\tif (path === '__name__') {","\t\t\t\tpath = list.mappings.name;","\t\t\t}","","\t\t\tvar field = list.fields[path];","","\t\t\tif (field && field.type === 'name') {","\t\t\t\tvar first = {};","\t\t\t\tfirst[field.paths.first] = splitSearchRx;","\t\t\t\tvar last = {};","\t\t\t\tlast[field.paths.last] = splitSearchRx;","\t\t\t\tsearchFilter = {};","\t\t\t\tsearchFilter.$or = [first, last];","\t\t\t\tsearchFilters.push(searchFilter);","\t\t\t} else {","\t\t\t\tsearchFilter = {};","\t\t\t\tsearchFilter[path] = searchRx;","\t\t\t\tsearchFilters.push(searchFilter);","\t\t\t}","\t\t});","","\t\tif (list.autokey) {","\t\t\tsearchFilter = {};","\t\t\tsearchFilter[list.autokey.path] = searchRx;","\t\t\tsearchFilters.push(searchFilter);","\t\t}","","\t\tif (searchIdField) {","\t\t\tsearchFilter = {};","\t\t\tsearchFilter._id = search;","\t\t\tsearchFilters.push(searchFilter);","\t\t}","","\t\tif (searchFilters.length > 1) {","\t\t\tfilters.$or = searchFilters;","\t\t} else if (searchFilters.length) {","\t\t\tfilters = searchFilters[0];","\t\t}","","\t}","","\tif (add) {","\t\t_.each(add, function(filter) {","\t\t\tvar cond;","\t\t\tvar path = filter.key;","\t\t\tvar value = filter.value;","","\t\t\tswitch (filter.field.type) {","\t\t\t\tcase 'boolean':","\t\t\t\t\tif (!value || value === 'false') {","\t\t\t\t\t\tfilters[path] = { $ne: true };","\t\t\t\t\t} else {","\t\t\t\t\t\tfilters[path] = true;","\t\t\t\t\t}","\t\t\t\t\tbreak;","","\t\t\t\tcase 'localfile':","\t\t\t\tcase 'cloudinaryimage':","\t\t\t\tcase 'cloudinaryimages':","\t\t\t\tcase 's3file':","\t\t\t\tcase 'name':","\t\t\t\tcase 'password':","\t\t\t\t\t// TODO","\t\t\t\t\tbreak;","","\t\t\t\tcase 'location':","\t\t\t\t\t_.each(['street1', 'suburb', 'state', 'postcode', 'country'], function(pathKey, i) {","\t\t\t\t\t\tvar value = filter.value[i];","\t\t\t\t\t\tif (value) {","\t\t\t\t\t\t\tfilters[filter.field.paths[pathKey]] = new RegExp(utils.escapeRegExp(value), 'i');","\t\t\t\t\t\t}","\t\t\t\t\t});","\t\t\t\t\tbreak;","","\t\t\t\tcase 'relationship':","\t\t\t\t\tif (value) {","\t\t\t\t\t\tif (filter.field.many) {","\t\t\t\t\t\t\tfilters[path] = (filter.inverse) ? { $nin: [value] } : { $in: [value] };","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfilters[path] = (filter.inverse) ? { $ne: value } : value;","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tif (filter.field.many) {","\t\t\t\t\t\t\tfilters[path] = (filter.inverse) ? { $not: { $size: 0 } } : { $size: 0 };","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfilters[path] = (filter.inverse) ? { $ne: null } : null;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tbreak;","","\t\t\t\tcase 'select':","\t\t\t\t\tif (filter.value) {","\t\t\t\t\t\tfilters[path] = (filter.inverse) ? { $ne: value } : value;","\t\t\t\t\t} else {","\t\t\t\t\t\tfilters[path] = (filter.inverse) ? { $nin: ['', null] } : { $in: ['', null] };","\t\t\t\t\t}","\t\t\t\t\tbreak;","","\t\t\t\tcase 'number':","\t\t\t\tcase 'money':","\t\t\t\t\tif (filter.operator === 'bt') {","\t\t\t\t\t\tvalue = [","\t\t\t\t\t\t\tutils.number(value[0]),","\t\t\t\t\t\t\tutils.number(value[1])","\t\t\t\t\t\t];","\t\t\t\t\t\tif ( !isNaN(value[0]) && !isNaN(value[1]) ) {","\t\t\t\t\t\t\tfilters[path] = {","\t\t\t\t\t\t\t\t$gte: value[0],","\t\t\t\t\t\t\t\t$lte: value[1]","\t\t\t\t\t\t\t};","\t\t\t\t\t\t}","\t\t\t\t\t\telse {","\t\t\t\t\t\t\tfilters[path] = null;","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tvalue = utils.number(value);","\t\t\t\t\t\tif ( !isNaN(value) ) {","\t\t\t\t\t\t\tif (filter.operator === 'gt') {","\t\t\t\t\t\t\t\tfilters[path] = { $gt: value };","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\telse if (filter.operator === 'lt') {","\t\t\t\t\t\t\t\tfilters[path] = { $lt: value };","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\telse {","\t\t\t\t\t\t\t\tfilters[path] = value;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\telse {","\t\t\t\t\t\t\tfilters[path] = null;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\tbreak;","","\t\t\t\tcase 'date':","\t\t\t\tcase 'datetime':","\t\t\t\t\tif (filter.operator === 'bt') {","\t\t\t\t\t\tvalue = [","\t\t\t\t\t\t\tmoment(value[0]),","\t\t\t\t\t\t\tmoment(value[1])","\t\t\t\t\t\t];","\t\t\t\t\t\tif ( (value[0] && value[0].isValid()) && (value[1] && value[0].isValid()) ) {","\t\t\t\t\t\t\tfilters[path] = {","\t\t\t\t\t\t\t\t$gte: moment(value[0]).startOf('day').toDate(),","\t\t\t\t\t\t\t\t$lte: moment(value[1]).endOf('day').toDate()","\t\t\t\t\t\t\t};","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tvalue = moment(value);","\t\t\t\t\t\tif (value && value.isValid()) {","\t\t\t\t\t\t\tvar start = moment(value).startOf('day').toDate();","\t\t\t\t\t\t\tvar end = moment(value).endOf('day').toDate();","\t\t\t\t\t\t\tif (filter.operator === 'gt') {","\t\t\t\t\t\t\t\tfilters[path] = { $gt: end };","\t\t\t\t\t\t\t} else if (filter.operator === 'lt') {","\t\t\t\t\t\t\t\tfilters[path] = { $lt: start };","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tfilters[path] = { $lte: end, $gte: start };","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tbreak;","","\t\t\t\tcase 'text':","\t\t\t\tcase 'textarea':","\t\t\t\tcase 'html':","\t\t\t\tcase 'email':","\t\t\t\tcase 'url':","\t\t\t\tcase 'key':","\t\t\t\t\tif (filter.exact) {","\t\t\t\t\t\tif (value) {","\t\t\t\t\t\t\t// Don't use regex when searching for an exact match on a string value","\t\t\t\t\t\t\t// Regex makes the search case-insensitive but prevents indexes from being used","\t\t\t\t\t\t\tfilters[path] = filter.inverse ? { $not: value } : value;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tif (filter.inverse) {","\t\t\t\t\t\t\t\tfilters[path] = { $nin: ['', null] };","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tfilters[path] = { $in: ['', null] };","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else if (value) {","\t\t\t\t\t\tcond = new RegExp(utils.escapeRegExp(value), 'i');","\t\t\t\t\t\tfilters[path] = filter.inverse ? { $not: cond } : cond;","\t\t\t\t\t}","\t\t\t\t\tbreak;","","\t\t\t}","\t\t});","\t}","\treturn filters;","}","","module.exports = getSearchFilters;",""],"l":{"1":1,"2":1,"3":1,"21":1,"22":0,"23":0,"25":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"36":0,"37":0,"40":0,"41":0,"43":0,"44":0,"47":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"58":0,"59":0,"60":0,"64":0,"65":0,"66":0,"67":0,"70":0,"71":0,"72":0,"73":0,"76":0,"77":0,"78":0,"79":0,"84":0,"85":0,"86":0,"87":0,"88":0,"90":0,"92":0,"93":0,"95":0,"97":0,"106":0,"109":0,"110":0,"111":0,"112":0,"115":0,"118":0,"119":0,"120":0,"122":0,"125":0,"126":0,"128":0,"131":0,"134":0,"135":0,"137":0,"139":0,"143":0,"144":0,"148":0,"149":0,"155":0,"158":0,"159":0,"160":0,"161":0,"163":0,"164":0,"167":0,"171":0,"174":0,"178":0,"179":0,"183":0,"184":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":0,"196":0,"197":0,"199":0,"203":0,"211":0,"212":0,"215":0,"217":0,"218":0,"220":0,"223":0,"224":0,"225":0,"227":0,"232":0,"235":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/updateAll.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/updateAll.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"updateAll","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":36}}},"2":{"name":"(anonymous_2)","line":15,"loc":{"start":{"line":15,"column":24},"end":{"line":15,"column":36}}},"3":{"name":"(anonymous_3)","line":16,"loc":{"start":{"line":16,"column":17},"end":{"line":16,"column":41}}},"4":{"name":"(anonymous_4)","line":18,"loc":{"start":{"line":18,"column":28},"end":{"line":18,"column":49}}},"5":{"name":"(anonymous_5)","line":23,"loc":{"start":{"line":23,"column":5},"end":{"line":23,"column":20}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":29}},"2":{"start":{"line":10,"column":0},"end":{"line":27,"column":1}},"3":{"start":{"line":11,"column":1},"end":{"line":14,"column":2}},"4":{"start":{"line":12,"column":2},"end":{"line":12,"column":18}},"5":{"start":{"line":13,"column":2},"end":{"line":13,"column":14}},"6":{"start":{"line":15,"column":1},"end":{"line":15,"column":39}},"7":{"start":{"line":16,"column":1},"end":{"line":26,"column":4}},"8":{"start":{"line":17,"column":2},"end":{"line":17,"column":32}},"9":{"start":{"line":17,"column":11},"end":{"line":17,"column":32}},"10":{"start":{"line":18,"column":2},"end":{"line":25,"column":5}},"11":{"start":{"line":19,"column":3},"end":{"line":21,"column":4}},"12":{"start":{"line":20,"column":4},"end":{"line":20,"column":18}},"13":{"start":{"line":22,"column":3},"end":{"line":22,"column":18}},"14":{"start":{"line":24,"column":3},"end":{"line":24,"column":17}},"15":{"start":{"line":29,"column":0},"end":{"line":29,"column":27}}},"branchMap":{"1":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},{"start":{"line":11,"column":1},"end":{"line":11,"column":1}}]},"2":{"line":15,"type":"binary-expr","locations":[{"start":{"line":15,"column":12},"end":{"line":15,"column":20}},{"start":{"line":15,"column":24},"end":{"line":15,"column":38}}]},"3":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":2},"end":{"line":17,"column":2}},{"start":{"line":17,"column":2},"end":{"line":17,"column":2}}]},"4":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":3},"end":{"line":19,"column":3}},{"start":{"line":19,"column":3},"end":{"line":19,"column":3}}]}},"code":["var async = require('async');","","/**"," * Updates every document in a List,"," * setting the provided data on each."," *"," * @param {Object} data"," * @param {Function} callback (optional)"," */","function updateAll (data, callback) {","\tif ('function' === typeof data) {","\t\tcallback = data;","\t\tdata = null;","\t}","\tcallback = callback || function () {};","\tthis.model.find(function (err, results) {","\t\tif (err) return callback(err);","\t\tasync.eachSeries(results, function (doc, next) {","\t\t\tif (data) {","\t\t\t\tdoc.set(data);","\t\t\t}","\t\t\tdoc.save(next);","\t\t}, function (err) {","\t\t\tcallback(err);","\t\t});","\t});","}","","module.exports = updateAll;",""],"l":{"1":1,"10":1,"11":0,"12":0,"13":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"22":0,"24":0,"29":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getUniqueValue.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getUniqueValue.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"getUniqueValue","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":59}}},"2":{"name":"(anonymous_2)","line":30,"loc":{"start":{"line":30,"column":14},"end":{"line":30,"column":26}}},"3":{"name":"(anonymous_3)","line":34,"loc":{"start":{"line":34,"column":13},"end":{"line":34,"column":25}}},"4":{"name":"(anonymous_4)","line":39,"loc":{"start":{"line":39,"column":40},"end":{"line":39,"column":64}}}},"statementMap":{"1":{"start":{"line":19,"column":0},"end":{"line":46,"column":1}},"2":{"start":{"line":20,"column":1},"end":{"line":20,"column":24}},"3":{"start":{"line":21,"column":1},"end":{"line":21,"column":15}},"4":{"start":{"line":22,"column":1},"end":{"line":22,"column":11}},"5":{"start":{"line":23,"column":1},"end":{"line":26,"column":2}},"6":{"start":{"line":24,"column":2},"end":{"line":24,"column":19}},"7":{"start":{"line":25,"column":2},"end":{"line":25,"column":13}},"8":{"start":{"line":27,"column":1},"end":{"line":33,"column":2}},"9":{"start":{"line":28,"column":2},"end":{"line":28,"column":24}},"10":{"start":{"line":29,"column":2},"end":{"line":29,"column":32}},"11":{"start":{"line":30,"column":2},"end":{"line":32,"column":4}},"12":{"start":{"line":31,"column":3},"end":{"line":31,"column":31}},"13":{"start":{"line":34,"column":1},"end":{"line":44,"column":3}},"14":{"start":{"line":35,"column":2},"end":{"line":37,"column":3}},"15":{"start":{"line":36,"column":3},"end":{"line":36,"column":41}},"16":{"start":{"line":38,"column":2},"end":{"line":38,"column":22}},"17":{"start":{"line":39,"column":2},"end":{"line":43,"column":5}},"18":{"start":{"line":40,"column":3},"end":{"line":40,"column":33}},"19":{"start":{"line":40,"column":12},"end":{"line":40,"column":33}},"20":{"start":{"line":41,"column":3},"end":{"line":41,"column":31}},"21":{"start":{"line":41,"column":16},"end":{"line":41,"column":31}},"22":{"start":{"line":42,"column":3},"end":{"line":42,"column":30}},"23":{"start":{"line":45,"column":1},"end":{"line":45,"column":9}},"24":{"start":{"line":48,"column":0},"end":{"line":48,"column":32}}},"branchMap":{"1":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},{"start":{"line":23,"column":1},"end":{"line":23,"column":1}}]},"2":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},{"start":{"line":27,"column":1},"end":{"line":27,"column":1}}]},"3":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":35,"column":2}},{"start":{"line":35,"column":2},"end":{"line":35,"column":2}}]},"4":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":3},"end":{"line":40,"column":3}},{"start":{"line":40,"column":3},"end":{"line":40,"column":3}}]},"5":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":3},"end":{"line":41,"column":3}},{"start":{"line":41,"column":3},"end":{"line":41,"column":3}}]}},"code":["/**"," * Gets a unique value from a generator method by checking for documents with the same value."," *"," * To avoid infinite loops when a unique value cannot be found, it will bail and pass back an"," * undefined value after 10 attemptes."," *"," * WARNING: Because there will always be a small amount of time between checking for an"," * existing value and saving a document, race conditions can occur and it is possible that"," * another document has the 'unique' value assigned at the same time."," *"," * Because of this, if true uniqueness is required, you should also create a unique index on"," * the database path, and handle duplicate errors thrown on save."," *"," * @param {String} path to check for uniqueness"," * @param {Function} generator method to call to generate a new value"," * @param {Number} the maximum number of attempts (optional, defaults to 10)"," * @param {Function} callback(err, uniqueValue)"," */","function getUniqueValue (path, generator, limit, callback) {","\tvar model = this.model;","\tvar count = 0;","\tvar value;","\tif (typeof limit === 'function') {","\t\tcallback = limit;","\t\tlimit = 10;","\t}","\tif (Array.isArray(generator)) {","\t\tvar fn = generator[0];","\t\tvar args = generator.slice(1);","\t\tgenerator = function () {","\t\t\treturn fn.apply(this, args);","\t\t};","\t}","\tvar check = function () {","\t\tif (count++ > 10) {","\t\t\treturn callback(undefined, undefined);","\t\t}","\t\tvalue = generator();","\t\tmodel.count().where(path, value).exec(function (err, matches) {","\t\t\tif (err) return callback(err);","\t\t\tif (matches) return check();","\t\t\tcallback(undefined, value);","\t\t});","\t};","\tcheck();","}","","module.exports = getUniqueValue;",""],"l":{"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"27":0,"28":0,"29":0,"30":0,"31":0,"34":0,"35":0,"36":0,"38":0,"39":0,"40":0,"41":0,"42":0,"45":0,"48":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getPages.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/getPages.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"getPages","line":7,"loc":{"start":{"line":7,"column":0},"end":{"line":7,"column":38}}}},"statementMap":{"1":{"start":{"line":7,"column":0},"end":{"line":26,"column":1}},"2":{"start":{"line":8,"column":1},"end":{"line":8,"column":41}},"3":{"start":{"line":9,"column":1},"end":{"line":9,"column":76}},"4":{"start":{"line":10,"column":1},"end":{"line":10,"column":73}},"5":{"start":{"line":11,"column":1},"end":{"line":11,"column":120}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":74}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":20}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":67}},"9":{"start":{"line":15,"column":1},"end":{"line":17,"column":2}},"10":{"start":{"line":16,"column":2},"end":{"line":16,"column":24}},"11":{"start":{"line":18,"column":1},"end":{"line":21,"column":2}},"12":{"start":{"line":19,"column":2},"end":{"line":19,"column":24}},"13":{"start":{"line":20,"column":2},"end":{"line":20,"column":31}},"14":{"start":{"line":22,"column":1},"end":{"line":25,"column":2}},"15":{"start":{"line":23,"column":2},"end":{"line":23,"column":22}},"16":{"start":{"line":24,"column":2},"end":{"line":24,"column":28}},"17":{"start":{"line":28,"column":0},"end":{"line":28,"column":26}}},"branchMap":{"1":{"line":9,"type":"cond-expr","locations":[{"start":{"line":9,"column":28},"end":{"line":9,"column":71}},{"start":{"line":9,"column":74},"end":{"line":9,"column":75}}]},"2":{"line":11,"type":"cond-expr","locations":[{"start":{"line":11,"column":27},"end":{"line":11,"column":98}},{"start":{"line":11,"column":101},"end":{"line":11,"column":119}}]},"3":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},{"start":{"line":18,"column":1},"end":{"line":18,"column":1}}]},"4":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},{"start":{"line":22,"column":1},"end":{"line":22,"column":1}}]}},"code":["/**"," * Generate page array for pagination"," *"," * @param {Number} the maximum number pages to display in the pagination"," * @param {Object} page options"," */","function getPages (options, maxPages) {","\tvar surround = Math.floor(maxPages / 2);","\tvar firstPage = maxPages ? Math.max(1, options.currentPage - surround) : 1;","\tvar padRight = Math.max(((options.currentPage - surround) - 1) * -1, 0);","\tvar lastPage = maxPages ? Math.min(options.totalPages, options.currentPage + surround + padRight) : options.totalPages;","\tvar padLeft = Math.max(((options.currentPage + surround) - lastPage), 0);","\toptions.pages = [];","\tfirstPage = Math.max(Math.min(firstPage, firstPage - padLeft), 1);","\tfor (var i = firstPage; i <= lastPage; i++) {","\t\toptions.pages.push(i);","\t}","\tif (firstPage !== 1) {","\t\toptions.pages.shift();","\t\toptions.pages.unshift('...');","\t}","\tif (lastPage !== Number(options.totalPages)) {","\t\toptions.pages.pop();","\t\toptions.pages.push('...');","\t}","}","","module.exports = getPages;",""],"l":{"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"18":0,"19":0,"20":0,"22":0,"23":0,"24":0,"28":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/paginate.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/list/paginate.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"paginate","line":16,"loc":{"start":{"line":16,"column":0},"end":{"line":16,"column":38}}},"2":{"name":"(anonymous_2)","line":38,"loc":{"start":{"line":38,"column":16},"end":{"line":38,"column":28}}},"3":{"name":"(anonymous_3)","line":43,"loc":{"start":{"line":43,"column":14},"end":{"line":43,"column":26}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":14},"end":{"line":48,"column":34}}},"5":{"name":"(anonymous_5)","line":49,"loc":{"start":{"line":49,"column":14},"end":{"line":49,"column":36}}},"6":{"name":"(anonymous_6)","line":63,"loc":{"start":{"line":63,"column":24},"end":{"line":63,"column":48}}}},"statementMap":{"1":{"start":{"line":16,"column":0},"end":{"line":89,"column":1}},"2":{"start":{"line":17,"column":1},"end":{"line":17,"column":17}},"3":{"start":{"line":18,"column":1},"end":{"line":18,"column":24}},"4":{"start":{"line":20,"column":1},"end":{"line":20,"column":25}},"5":{"start":{"line":22,"column":1},"end":{"line":22,"column":41}},"6":{"start":{"line":24,"column":1},"end":{"line":24,"column":35}},"7":{"start":{"line":25,"column":1},"end":{"line":25,"column":35}},"8":{"start":{"line":26,"column":1},"end":{"line":26,"column":39}},"9":{"start":{"line":28,"column":1},"end":{"line":28,"column":45}},"10":{"start":{"line":29,"column":1},"end":{"line":29,"column":52}},"11":{"start":{"line":30,"column":1},"end":{"line":30,"column":47}},"12":{"start":{"line":31,"column":1},"end":{"line":31,"column":47}},"13":{"start":{"line":33,"column":1},"end":{"line":33,"column":42}},"14":{"start":{"line":38,"column":1},"end":{"line":41,"column":3}},"15":{"start":{"line":39,"column":2},"end":{"line":39,"column":32}},"16":{"start":{"line":40,"column":2},"end":{"line":40,"column":15}},"17":{"start":{"line":43,"column":1},"end":{"line":46,"column":3}},"18":{"start":{"line":44,"column":2},"end":{"line":44,"column":30}},"19":{"start":{"line":45,"column":2},"end":{"line":45,"column":15}},"20":{"start":{"line":48,"column":1},"end":{"line":82,"column":3}},"21":{"start":{"line":49,"column":2},"end":{"line":80,"column":5}},"22":{"start":{"line":50,"column":3},"end":{"line":50,"column":33}},"23":{"start":{"line":50,"column":12},"end":{"line":50,"column":33}},"24":{"start":{"line":52,"column":3},"end":{"line":52,"column":49}},"25":{"start":{"line":55,"column":3},"end":{"line":57,"column":4}},"26":{"start":{"line":56,"column":4},"end":{"line":56,"column":43}},"27":{"start":{"line":59,"column":3},"end":{"line":61,"column":4}},"28":{"start":{"line":60,"column":4},"end":{"line":60,"column":39}},"29":{"start":{"line":63,"column":3},"end":{"line":79,"column":6}},"30":{"start":{"line":64,"column":4},"end":{"line":64,"column":34}},"31":{"start":{"line":64,"column":13},"end":{"line":64,"column":34}},"32":{"start":{"line":65,"column":4},"end":{"line":65,"column":55}},"33":{"start":{"line":66,"column":4},"end":{"line":76,"column":6}},"34":{"start":{"line":77,"column":4},"end":{"line":77,"column":33}},"35":{"start":{"line":78,"column":4},"end":{"line":78,"column":23}},"36":{"start":{"line":84,"column":1},"end":{"line":88,"column":2}},"37":{"start":{"line":85,"column":2},"end":{"line":85,"column":25}},"38":{"start":{"line":87,"column":2},"end":{"line":87,"column":15}},"39":{"start":{"line":91,"column":0},"end":{"line":91,"column":26}}},"branchMap":{"1":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":11},"end":{"line":20,"column":18}},{"start":{"line":20,"column":22},"end":{"line":20,"column":24}}]},"2":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":19},"end":{"line":28,"column":39}},{"start":{"line":28,"column":43},"end":{"line":28,"column":44}}]},"3":{"line":29,"type":"binary-expr","locations":[{"start":{"line":29,"column":22},"end":{"line":29,"column":45}},{"start":{"line":29,"column":49},"end":{"line":29,"column":51}}]},"4":{"line":30,"type":"binary-expr","locations":[{"start":{"line":30,"column":16},"end":{"line":30,"column":40}},{"start":{"line":30,"column":44},"end":{"line":30,"column":46}}]},"5":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":3},"end":{"line":50,"column":3}},{"start":{"line":50,"column":3},"end":{"line":50,"column":3}}]},"6":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":3},"end":{"line":55,"column":3}},{"start":{"line":55,"column":3},"end":{"line":55,"column":3}}]},"7":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":3},"end":{"line":59,"column":3}},{"start":{"line":59,"column":3},"end":{"line":59,"column":3}}]},"8":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":4},"end":{"line":64,"column":4}},{"start":{"line":64,"column":4},"end":{"line":64,"column":4}}]},"9":{"line":72,"type":"cond-expr","locations":[{"start":{"line":72,"column":36},"end":{"line":72,"column":51}},{"start":{"line":72,"column":55},"end":{"line":72,"column":60}}]},"10":{"line":73,"type":"cond-expr","locations":[{"start":{"line":73,"column":41},"end":{"line":73,"column":56}},{"start":{"line":73,"column":60},"end":{"line":73,"column":65}}]},"11":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},{"start":{"line":84,"column":1},"end":{"line":84,"column":1}}]}},"code":["/**"," * Gets a special Query object that will paginate documents in the list"," *"," * Example:"," *     list.paginate({"," *         page: 1,"," *         perPage: 100,"," *         maxPages: 10"," *     }).exec(function(err, results) {"," *         // do something"," *     });"," *"," * @param {Object} options"," * @param {Function} callback (optional)"," */","function paginate (options, callback) {","\tvar list = this;","\tvar model = this.model;","","\toptions = options || {};","","\tvar query = model.find(options.filters);","","\tquery._original_exec = query.exec;","\tquery._original_sort = query.sort;","\tquery._original_select = query.select;","","\tvar currentPage = Number(options.page) || 1;","\tvar resultsPerPage = Number(options.perPage) || 50;","\tvar maxPages = Number(options.maxPages) || 10;","\tvar skip = (currentPage - 1) * resultsPerPage;","","\tlist.pagination = { maxPages: maxPages };","","\t// as of mongoose 3.7.x, we need to defer sorting and field selection","\t// until after the count has been executed","","\tquery.select = function () {","\t\toptions.select = arguments[0];","\t\treturn query;","\t};","","\tquery.sort = function () {","\t\toptions.sort = arguments[0];","\t\treturn query;","\t};","","\tquery.exec = function (callback) {","\t\tquery.count(function (err, count) {","\t\t\tif (err) return callback(err);","","\t\t\tquery.find().limit(resultsPerPage).skip(skip);","","\t\t\t// apply the select and sort options before calling exec","\t\t\tif (options.select) {","\t\t\t\tquery._original_select(options.select);","\t\t\t}","","\t\t\tif (options.sort) {","\t\t\t\tquery._original_sort(options.sort);","\t\t\t}","","\t\t\tquery._original_exec(function (err, results) {","\t\t\t\tif (err) return callback(err);","\t\t\t\tvar totalPages = Math.ceil(count / resultsPerPage);","\t\t\t\tvar rtn = {","\t\t\t\t\ttotal: count,","\t\t\t\t\tresults: results,","\t\t\t\t\tcurrentPage: currentPage,","\t\t\t\t\ttotalPages: totalPages,","\t\t\t\t\tpages: [],","\t\t\t\t\tprevious: (currentPage > 1) ? (currentPage - 1) : false,","\t\t\t\t\tnext: (currentPage < totalPages) ? (currentPage + 1) : false,","\t\t\t\t\tfirst: skip + 1,","\t\t\t\t\tlast: skip + results.length","\t\t\t\t};","\t\t\t\tlist.getPages(rtn, maxPages);","\t\t\t\tcallback(err, rtn);","\t\t\t});","\t\t});","","\t};","","\tif (callback) {","\t\treturn query(callback);","\t} else {","\t\treturn query;","\t}","}","","module.exports = paginate;",""],"l":{"16":1,"17":0,"18":0,"20":0,"22":0,"24":0,"25":0,"26":0,"28":0,"29":0,"30":0,"31":0,"33":0,"38":0,"39":0,"40":0,"43":0,"44":0,"45":0,"48":0,"49":0,"50":0,"52":0,"55":0,"56":0,"59":0,"60":0,"63":0,"64":0,"65":0,"66":0,"77":0,"78":0,"84":0,"85":0,"87":0,"91":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/view.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/view.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":1,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":1,"68":0,"69":1,"70":0,"71":0,"72":1,"73":0,"74":0,"75":1,"76":0,"77":0,"78":1,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":1,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0,0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},"fnMap":{"1":{"name":"View","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":24}}},"2":{"name":"(anonymous_2)","line":49,"loc":{"start":{"line":49,"column":20},"end":{"line":49,"column":33}}},"3":{"name":"(anonymous_3)","line":89,"loc":{"start":{"line":89,"column":14},"end":{"line":89,"column":36}}},"4":{"name":"(anonymous_4)","line":155,"loc":{"start":{"line":155,"column":29},"end":{"line":155,"column":51}}},"5":{"name":"(anonymous_5)","line":195,"loc":{"start":{"line":195,"column":21},"end":{"line":195,"column":39}}},"6":{"name":"(anonymous_6)","line":208,"loc":{"start":{"line":208,"column":31},"end":{"line":208,"column":44}}},"7":{"name":"(anonymous_7)","line":209,"loc":{"start":{"line":209,"column":31},"end":{"line":209,"column":44}}},"8":{"name":"(anonymous_8)","line":210,"loc":{"start":{"line":210,"column":32},"end":{"line":210,"column":45}}},"9":{"name":"(anonymous_9)","line":211,"loc":{"start":{"line":211,"column":32},"end":{"line":211,"column":45}}},"10":{"name":"(anonymous_10)","line":249,"loc":{"start":{"line":249,"column":23},"end":{"line":249,"column":53}}},"11":{"name":"(anonymous_11)","line":264,"loc":{"start":{"line":264,"column":22},"end":{"line":264,"column":37}}},"12":{"name":"(anonymous_12)","line":265,"loc":{"start":{"line":265,"column":13},"end":{"line":265,"column":36}}},"13":{"name":"(anonymous_13)","line":326,"loc":{"start":{"line":326,"column":24},"end":{"line":326,"column":61}}},"14":{"name":"(anonymous_14)","line":333,"loc":{"start":{"line":333,"column":13},"end":{"line":333,"column":24}}},"15":{"name":"(anonymous_15)","line":352,"loc":{"start":{"line":352,"column":47},"end":{"line":352,"column":60}}},"16":{"name":"(anonymous_16)","line":353,"loc":{"start":{"line":353,"column":22},"end":{"line":353,"column":37}}},"17":{"name":"(anonymous_17)","line":361,"loc":{"start":{"line":361,"column":34},"end":{"line":361,"column":52}}},"18":{"name":"(anonymous_18)","line":371,"loc":{"start":{"line":371,"column":4},"end":{"line":371,"column":18}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":5,"column":30}},"2":{"start":{"line":6,"column":0},"end":{"line":6,"column":29}},"3":{"start":{"line":7,"column":0},"end":{"line":7,"column":30}},"4":{"start":{"line":8,"column":0},"end":{"line":8,"column":38}},"5":{"start":{"line":19,"column":0},"end":{"line":37,"column":1}},"6":{"start":{"line":21,"column":1},"end":{"line":23,"column":2}},"7":{"start":{"line":22,"column":2},"end":{"line":22,"column":78}},"8":{"start":{"line":25,"column":1},"end":{"line":27,"column":2}},"9":{"start":{"line":26,"column":2},"end":{"line":26,"column":79}},"10":{"start":{"line":29,"column":1},"end":{"line":29,"column":16}},"11":{"start":{"line":30,"column":1},"end":{"line":30,"column":16}},"12":{"start":{"line":32,"column":1},"end":{"line":32,"column":21}},"13":{"start":{"line":33,"column":1},"end":{"line":33,"column":23}},"14":{"start":{"line":34,"column":1},"end":{"line":34,"column":22}},"15":{"start":{"line":35,"column":1},"end":{"line":35,"column":23}},"16":{"start":{"line":39,"column":0},"end":{"line":39,"column":32}},"17":{"start":{"line":49,"column":0},"end":{"line":193,"column":2}},"18":{"start":{"line":51,"column":1},"end":{"line":51,"column":20}},"19":{"start":{"line":52,"column":1},"end":{"line":52,"column":29}},"20":{"start":{"line":53,"column":1},"end":{"line":53,"column":12}},"21":{"start":{"line":55,"column":1},"end":{"line":189,"column":2}},"22":{"start":{"line":73,"column":2},"end":{"line":75,"column":3}},"23":{"start":{"line":74,"column":3},"end":{"line":74,"column":35}},"24":{"start":{"line":77,"column":8},"end":{"line":189,"column":2}},"25":{"start":{"line":89,"column":2},"end":{"line":105,"column":4}},"26":{"start":{"line":91,"column":3},"end":{"line":91,"column":17}},"27":{"start":{"line":92,"column":3},"end":{"line":92,"column":31}},"28":{"start":{"line":94,"column":3},"end":{"line":99,"column":4}},"29":{"start":{"line":95,"column":4},"end":{"line":97,"column":5}},"30":{"start":{"line":96,"column":5},"end":{"line":96,"column":18}},"31":{"start":{"line":98,"column":4},"end":{"line":98,"column":24}},"32":{"start":{"line":101,"column":3},"end":{"line":101,"column":24}},"33":{"start":{"line":103,"column":3},"end":{"line":103,"column":73}},"34":{"start":{"line":107,"column":2},"end":{"line":109,"column":3}},"35":{"start":{"line":108,"column":3},"end":{"line":108,"column":35}},"36":{"start":{"line":111,"column":8},"end":{"line":189,"column":2}},"37":{"start":{"line":122,"column":2},"end":{"line":124,"column":3}},"38":{"start":{"line":123,"column":3},"end":{"line":123,"column":10}},"39":{"start":{"line":126,"column":2},"end":{"line":163,"column":3}},"40":{"start":{"line":144,"column":3},"end":{"line":149,"column":4}},"41":{"start":{"line":145,"column":4},"end":{"line":145,"column":16}},"42":{"start":{"line":146,"column":4},"end":{"line":146,"column":32}},"43":{"start":{"line":148,"column":4},"end":{"line":148,"column":26}},"44":{"start":{"line":151,"column":3},"end":{"line":151,"column":27}},"45":{"start":{"line":153,"column":3},"end":{"line":153,"column":68}},"46":{"start":{"line":155,"column":3},"end":{"line":159,"column":4}},"47":{"start":{"line":156,"column":4},"end":{"line":156,"column":74}},"48":{"start":{"line":158,"column":4},"end":{"line":158,"column":36}},"49":{"start":{"line":162,"column":3},"end":{"line":162,"column":35}},"50":{"start":{"line":165,"column":8},"end":{"line":189,"column":2}},"51":{"start":{"line":175,"column":2},"end":{"line":175,"column":32}},"52":{"start":{"line":177,"column":8},"end":{"line":189,"column":2}},"53":{"start":{"line":187,"column":2},"end":{"line":187,"column":34}},"54":{"start":{"line":191,"column":1},"end":{"line":191,"column":13}},"55":{"start":{"line":195,"column":0},"end":{"line":206,"column":2}},"56":{"start":{"line":196,"column":1},"end":{"line":200,"column":2}},"57":{"start":{"line":197,"column":2},"end":{"line":197,"column":30}},"58":{"start":{"line":199,"column":2},"end":{"line":199,"column":26}},"59":{"start":{"line":201,"column":1},"end":{"line":201,"column":21}},"60":{"start":{"line":202,"column":1},"end":{"line":202,"column":51}},"61":{"start":{"line":202,"column":18},"end":{"line":202,"column":51}},"62":{"start":{"line":203,"column":1},"end":{"line":203,"column":54}},"63":{"start":{"line":203,"column":19},"end":{"line":203,"column":54}},"64":{"start":{"line":204,"column":1},"end":{"line":204,"column":54}},"65":{"start":{"line":204,"column":19},"end":{"line":204,"column":54}},"66":{"start":{"line":205,"column":1},"end":{"line":205,"column":13}},"67":{"start":{"line":208,"column":0},"end":{"line":208,"column":79}},"68":{"start":{"line":208,"column":46},"end":{"line":208,"column":76}},"69":{"start":{"line":209,"column":0},"end":{"line":209,"column":86}},"70":{"start":{"line":209,"column":46},"end":{"line":209,"column":70}},"71":{"start":{"line":209,"column":71},"end":{"line":209,"column":83}},"72":{"start":{"line":210,"column":0},"end":{"line":210,"column":88}},"73":{"start":{"line":210,"column":47},"end":{"line":210,"column":72}},"74":{"start":{"line":210,"column":73},"end":{"line":210,"column":85}},"75":{"start":{"line":211,"column":0},"end":{"line":211,"column":88}},"76":{"start":{"line":211,"column":47},"end":{"line":211,"column":72}},"77":{"start":{"line":211,"column":73},"end":{"line":211,"column":85}},"78":{"start":{"line":249,"column":0},"end":{"line":310,"column":2}},"79":{"start":{"line":251,"column":1},"end":{"line":251,"column":30}},"80":{"start":{"line":252,"column":1},"end":{"line":252,"column":28}},"81":{"start":{"line":253,"column":1},"end":{"line":253,"column":41}},"82":{"start":{"line":255,"column":4},"end":{"line":255,"column":22}},"83":{"start":{"line":257,"column":1},"end":{"line":262,"column":2}},"84":{"start":{"line":258,"column":2},"end":{"line":260,"column":3}},"85":{"start":{"line":259,"column":3},"end":{"line":259,"column":25}},"86":{"start":{"line":261,"column":2},"end":{"line":261,"column":28}},"87":{"start":{"line":264,"column":1},"end":{"line":307,"column":4}},"88":{"start":{"line":265,"column":2},"end":{"line":306,"column":5}},"89":{"start":{"line":267,"column":3},"end":{"line":267,"column":25}},"90":{"start":{"line":268,"column":3},"end":{"line":268,"column":35}},"91":{"start":{"line":270,"column":3},"end":{"line":302,"column":4}},"92":{"start":{"line":271,"column":4},"end":{"line":282,"column":5}},"93":{"start":{"line":281,"column":5},"end":{"line":281,"column":37}},"94":{"start":{"line":284,"column":4},"end":{"line":301,"column":5}},"95":{"start":{"line":294,"column":5},"end":{"line":294,"column":33}},"96":{"start":{"line":295,"column":11},"end":{"line":301,"column":5}},"97":{"start":{"line":296,"column":5},"end":{"line":300,"column":6}},"98":{"start":{"line":297,"column":6},"end":{"line":297,"column":48}},"99":{"start":{"line":299,"column":6},"end":{"line":299,"column":69}},"100":{"start":{"line":304,"column":3},"end":{"line":304,"column":20}},"101":{"start":{"line":309,"column":1},"end":{"line":309,"column":14}},"102":{"start":{"line":326,"column":0},"end":{"line":375,"column":2}},"103":{"start":{"line":328,"column":1},"end":{"line":328,"column":20}},"104":{"start":{"line":329,"column":1},"end":{"line":329,"column":20}},"105":{"start":{"line":331,"column":1},"end":{"line":339,"column":2}},"106":{"start":{"line":332,"column":2},"end":{"line":332,"column":26}},"107":{"start":{"line":333,"column":2},"end":{"line":338,"column":15}},"108":{"start":{"line":334,"column":3},"end":{"line":336,"column":4}},"109":{"start":{"line":335,"column":4},"end":{"line":335,"column":22}},"110":{"start":{"line":337,"column":3},"end":{"line":337,"column":47}},"111":{"start":{"line":341,"column":1},"end":{"line":343,"column":2}},"112":{"start":{"line":342,"column":2},"end":{"line":342,"column":100}},"113":{"start":{"line":346,"column":1},"end":{"line":346,"column":39}},"114":{"start":{"line":347,"column":1},"end":{"line":347,"column":38}},"115":{"start":{"line":349,"column":1},"end":{"line":349,"column":25}},"116":{"start":{"line":352,"column":1},"end":{"line":356,"column":4}},"117":{"start":{"line":353,"column":2},"end":{"line":355,"column":5}},"118":{"start":{"line":354,"column":3},"end":{"line":354,"column":22}},"119":{"start":{"line":358,"column":1},"end":{"line":358,"column":37}},"120":{"start":{"line":359,"column":1},"end":{"line":359,"column":39}},"121":{"start":{"line":361,"column":1},"end":{"line":373,"column":4}},"122":{"start":{"line":362,"column":2},"end":{"line":370,"column":3}},"123":{"start":{"line":364,"column":3},"end":{"line":364,"column":27}},"124":{"start":{"line":365,"column":9},"end":{"line":370,"column":3}},"125":{"start":{"line":367,"column":3},"end":{"line":367,"column":11}},"126":{"start":{"line":369,"column":3},"end":{"line":369,"column":71}},"127":{"start":{"line":372,"column":2},"end":{"line":372,"column":26}}},"branchMap":{"1":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},{"start":{"line":21,"column":1},"end":{"line":21,"column":1}}]},"2":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":5},"end":{"line":21,"column":9}},{"start":{"line":21,"column":13},"end":{"line":21,"column":55}}]},"3":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},{"start":{"line":25,"column":1},"end":{"line":25,"column":1}}]},"4":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":5},"end":{"line":25,"column":9}},{"start":{"line":25,"column":13},"end":{"line":25,"column":54}}]},"5":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},{"start":{"line":55,"column":1},"end":{"line":55,"column":1}}]},"6":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":2},"end":{"line":73,"column":2}},{"start":{"line":73,"column":2},"end":{"line":73,"column":2}}]},"7":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":8},"end":{"line":77,"column":8}},{"start":{"line":77,"column":8},"end":{"line":77,"column":8}}]},"8":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":4},"end":{"line":95,"column":4}},{"start":{"line":95,"column":4},"end":{"line":95,"column":4}}]},"9":{"line":103,"type":"cond-expr","locations":[{"start":{"line":103,"column":44},"end":{"line":103,"column":48}},{"start":{"line":103,"column":52},"end":{"line":103,"column":71}}]},"10":{"line":103,"type":"binary-expr","locations":[{"start":{"line":103,"column":11},"end":{"line":103,"column":25}},{"start":{"line":103,"column":29},"end":{"line":103,"column":40}}]},"11":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":2},"end":{"line":107,"column":2}},{"start":{"line":107,"column":2},"end":{"line":107,"column":2}}]},"12":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":111,"column":8}},{"start":{"line":111,"column":8},"end":{"line":111,"column":8}}]},"13":{"line":111,"type":"binary-expr","locations":[{"start":{"line":111,"column":12},"end":{"line":111,"column":24}},{"start":{"line":111,"column":28},"end":{"line":111,"column":41}},{"start":{"line":111,"column":45},"end":{"line":111,"column":57}},{"start":{"line":111,"column":61},"end":{"line":111,"column":76}}]},"14":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":2},"end":{"line":122,"column":2}},{"start":{"line":122,"column":2},"end":{"line":122,"column":2}}]},"15":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":2},"end":{"line":126,"column":2}},{"start":{"line":126,"column":2},"end":{"line":126,"column":2}}]},"16":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":3},"end":{"line":144,"column":3}},{"start":{"line":144,"column":3},"end":{"line":144,"column":3}}]},"17":{"line":153,"type":"cond-expr","locations":[{"start":{"line":153,"column":47},"end":{"line":153,"column":55}},{"start":{"line":153,"column":58},"end":{"line":153,"column":67}}]},"18":{"line":153,"type":"binary-expr","locations":[{"start":{"line":153,"column":14},"end":{"line":153,"column":27}},{"start":{"line":153,"column":31},"end":{"line":153,"column":43}}]},"19":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":3},"end":{"line":155,"column":3}},{"start":{"line":155,"column":3},"end":{"line":155,"column":3}}]},"20":{"line":155,"type":"binary-expr","locations":[{"start":{"line":155,"column":15},"end":{"line":155,"column":21}},{"start":{"line":155,"column":25},"end":{"line":155,"column":27}}]},"21":{"line":156,"type":"cond-expr","locations":[{"start":{"line":156,"column":45},"end":{"line":156,"column":49}},{"start":{"line":156,"column":53},"end":{"line":156,"column":72}}]},"22":{"line":156,"type":"binary-expr","locations":[{"start":{"line":156,"column":12},"end":{"line":156,"column":26}},{"start":{"line":156,"column":30},"end":{"line":156,"column":41}}]},"23":{"line":165,"type":"if","locations":[{"start":{"line":165,"column":8},"end":{"line":165,"column":8}},{"start":{"line":165,"column":8},"end":{"line":165,"column":8}}]},"24":{"line":177,"type":"if","locations":[{"start":{"line":177,"column":8},"end":{"line":177,"column":8}},{"start":{"line":177,"column":8},"end":{"line":177,"column":8}}]},"25":{"line":196,"type":"if","locations":[{"start":{"line":196,"column":1},"end":{"line":196,"column":1}},{"start":{"line":196,"column":1},"end":{"line":196,"column":1}}]},"26":{"line":199,"type":"binary-expr","locations":[{"start":{"line":199,"column":12},"end":{"line":199,"column":19}},{"start":{"line":199,"column":23},"end":{"line":199,"column":25}}]},"27":{"line":202,"type":"if","locations":[{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},{"start":{"line":202,"column":1},"end":{"line":202,"column":1}}]},"28":{"line":203,"type":"if","locations":[{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},{"start":{"line":203,"column":1},"end":{"line":203,"column":1}}]},"29":{"line":204,"type":"if","locations":[{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},{"start":{"line":204,"column":1},"end":{"line":204,"column":1}}]},"30":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":2},"end":{"line":258,"column":2}},{"start":{"line":258,"column":2},"end":{"line":258,"column":2}}]},"31":{"line":270,"type":"if","locations":[{"start":{"line":270,"column":3},"end":{"line":270,"column":3}},{"start":{"line":270,"column":3},"end":{"line":270,"column":3}}]},"32":{"line":271,"type":"if","locations":[{"start":{"line":271,"column":4},"end":{"line":271,"column":4}},{"start":{"line":271,"column":4},"end":{"line":271,"column":4}}]},"33":{"line":284,"type":"if","locations":[{"start":{"line":284,"column":4},"end":{"line":284,"column":4}},{"start":{"line":284,"column":4},"end":{"line":284,"column":4}}]},"34":{"line":284,"type":"binary-expr","locations":[{"start":{"line":284,"column":9},"end":{"line":284,"column":17}},{"start":{"line":284,"column":22},"end":{"line":284,"column":44}},{"start":{"line":284,"column":48},"end":{"line":284,"column":63}},{"start":{"line":284,"column":69},"end":{"line":284,"column":88}}]},"35":{"line":295,"type":"if","locations":[{"start":{"line":295,"column":11},"end":{"line":295,"column":11}},{"start":{"line":295,"column":11},"end":{"line":295,"column":11}}]},"36":{"line":296,"type":"if","locations":[{"start":{"line":296,"column":5},"end":{"line":296,"column":5}},{"start":{"line":296,"column":5},"end":{"line":296,"column":5}}]},"37":{"line":331,"type":"if","locations":[{"start":{"line":331,"column":1},"end":{"line":331,"column":1}},{"start":{"line":331,"column":1},"end":{"line":331,"column":1}}]},"38":{"line":334,"type":"if","locations":[{"start":{"line":334,"column":3},"end":{"line":334,"column":3}},{"start":{"line":334,"column":3},"end":{"line":334,"column":3}}]},"39":{"line":341,"type":"if","locations":[{"start":{"line":341,"column":1},"end":{"line":341,"column":1}},{"start":{"line":341,"column":1},"end":{"line":341,"column":1}}]},"40":{"line":362,"type":"if","locations":[{"start":{"line":362,"column":2},"end":{"line":362,"column":2}},{"start":{"line":362,"column":2},"end":{"line":362,"column":2}}]},"41":{"line":365,"type":"if","locations":[{"start":{"line":365,"column":9},"end":{"line":365,"column":9}},{"start":{"line":365,"column":9},"end":{"line":365,"column":9}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore');","var async = require('async');","var keystone = require('../');","var utils = require('keystone-utils');","","/**"," * View Constructor"," * ================="," *"," * Helper to simplify view logic in a Keystone application"," *"," * @api public"," */","","function View(req, res) {","","\tif (!req || req.constructor.name !== 'IncomingMessage') {","\t\tthrow new Error('Keystone.View Error: Express request object is required.');","\t}","","\tif (!res || res.constructor.name !== 'ServerResponse') {","\t\tthrow new Error('Keystone.View Error: Express response object is required.');","\t}","","\tthis.req = req;","\tthis.res = res;","","\tthis.initQueue = [];\t// executed first in series","\tthis.actionQueue = [];\t// executed second in parallel, if optional conditions are met","\tthis.queryQueue = [];\t// executed third in parallel","\tthis.renderQueue = [];\t// executed fourth in parallel","","}","","module.exports = exports = View;","","","/**"," * Adds a method (or array of methods) to be executed in parallel"," * to the `init`, `action` or `render` queue."," *"," * @api public"," */","","View.prototype.on = function(on) {","\t","\tvar req = this.req;","\tvar callback = arguments[1];","\tvar values;","\t","\tif ('function' === typeof on) {","\t\t","\t\t/* If the first argument is a function that returns truthy then add the second","\t\t * argument to the action queue","\t\t * ","\t\t * Example:","\t\t * ","\t\t *     view.on(function() {","\t\t *             var thing = true;","\t\t *             return thing;","\t\t *         },","\t\t *         function(next) {","\t\t *             console.log('thing is true!');","\t\t *             next();","\t\t *         }","\t\t *     );","\t\t */","\t\t","\t\tif (on()) {","\t\t\tthis.actionQueue.push(callback);","\t\t}","","\t} else if (utils.isObject(on)) {","\t\t","\t\t/* Do certain actions depending on information in the response object.","\t\t * ","\t\t * Example:","\t\t * ","\t\t *     view.on({ 'user.name.first': 'Admin' }, function(next) {","\t\t *         console.log('Hello Admin!');","\t\t *         next();","\t\t *     });","\t\t */","\t\t","\t\tvar check = function(value, path) {","","\t\t\tvar ctx = req;","\t\t\tvar parts = path.split('.');","","\t\t\tfor (var i = 0; i < parts.length - 1; i++) {","\t\t\t\tif (!ctx[parts[i]]) {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t\tctx = ctx[parts[i]];","\t\t\t}","\t\t\t","\t\t\tpath = _.last(parts);","\t\t\t","\t\t\treturn (value === true && path in ctx) ? true : (ctx[path] === value);","","\t\t};","","\t\tif (_.every(on, check)) {","\t\t\tthis.actionQueue.push(callback);","\t\t}","\t\t","\t} else if (on === 'get' || on === 'post' || on === 'put' || on === 'delete') {","\t\t","\t\t/* Handle HTTP verbs","\t\t * ","\t\t * Example:","\t\t *     view.on('get', function(next) {","\t\t *         console.log('GOT!');","\t\t *         next();","\t\t *     });","\t\t */","\t\t","\t\tif (req.method !== on.toUpperCase()) {","\t\t\treturn;","\t\t}","\t\t","\t\tif (arguments.length === 3) {","\t\t\t","\t\t\t/* on a POST and PUT requests search the req.body for a matching value","\t\t\t * on every other request search the query.","\t\t\t * ","\t\t\t * Example:","\t\t\t *     view.on('post', { action: 'theAction' }, function(next) {","\t\t\t *         // respond to the action","\t\t\t *         next();","\t\t\t *     });","\t\t\t *     ","\t\t\t * Example:","\t\t\t *     view.on('get', { page: 2 }, function(next) {","\t\t\t *         // do something specifically on ?page=2","\t\t\t *         next();","\t\t\t *     });","\t\t\t */","\t\t\t","\t\t\tif (utils.isString(arguments[1])) {","\t\t\t\tvalues = {};","\t\t\t\tvalues[arguments[1]] = true;","\t\t\t} else {","\t\t\t\tvalues = arguments[1];","\t\t\t}","\t\t\t","\t\t\tcallback = arguments[2];","\t\t\t","\t\t\tvar ctx = (on === 'post' || on === 'put') ? req.body : req.query;","\t\t\t","\t\t\tif (_.every(values || {}, function(value, path) {","\t\t\t\treturn (value === true && path in ctx) ? true : (ctx[path] === value);","\t\t\t})) {","\t\t\t\tthis.actionQueue.push(callback);","\t\t\t}","\t\t\t","\t\t} else {","\t\t\tthis.actionQueue.push(callback);","\t\t}","","\t} else if (on === 'init') {","\t\t","\t\t/* Init events are always fired in series, before any other actions","\t\t * ","\t\t * Example:","\t\t *     view.on('init', function (next) {","\t\t *         // do something before any actions or queries have run","\t\t *     });","\t\t */","\t\t","\t\tthis.initQueue.push(callback);","\t\t","\t} else if (on === 'render') {","\t\t","\t\t/* Render events are always fired last in parallel, after any other actions","\t\t *  ","\t\t * Example:","\t\t *     view.on('render', function (next) {","\t\t *         // do something after init, action and query middleware has run","\t\t *     });","\t\t */","\t\t","\t\tthis.renderQueue.push(callback);","\t\t","\t}","","\treturn this;","\t","};","","var QueryCallbacks = function(options) {","\tif (utils.isString(options)) {","\t\toptions = { then: options };","\t} else {","\t\toptions = options || {};","\t}","\tthis.callbacks = {};","\tif (options.err) this.callbacks.err = options.err;","\tif (options.none) this.callbacks.none = options.none;","\tif (options.then) this.callbacks.then = options.then;","\treturn this;","};","","QueryCallbacks.prototype.has = function(fn) { return (fn in this.callbacks); };","QueryCallbacks.prototype.err = function(fn) { this.callbacks.err = fn; return this; };","QueryCallbacks.prototype.none = function(fn) { this.callbacks.none = fn; return this; };","QueryCallbacks.prototype.then = function(fn) { this.callbacks.then = fn; return this; };","","","/**"," * Queues a mongoose query for execution before the view is rendered."," * The results of the query are set in `locals[key]`."," *"," * Keys can be nested paths, containing objects will be created as required."," *"," * The third argument `then` can be a method to call after the query is completed"," * like function(err, results, callback), or a `populatedRelated` definition"," * (string or array)."," * "," * Examples:"," * "," * view.query('books', keystone.list('Book').model.find());"," * "," *     an array of books from the database will be added to locals.books. You can"," *     also nest properties on the locals variable."," * "," * view.query("," *     'admin.books',"," *      keystone.list('Book').model.find().where('user', 'Admin')"," * );"," * "," *     locals.admin.books will be the result of the query"," *     views.query().then is always called if it is available"," * "," * view.query('books', keystone.list('Book').model.find())"," *     .then(function (err, results, next) {"," *         if (err) return next(err);"," *         console.log(results);"," *         next();"," *     });"," *"," * @api public"," */","","View.prototype.query = function(key, query, options) {","","\tvar locals = this.res.locals;","\tvar parts = key.split('.');","\tvar chain = new QueryCallbacks(options);","","    key = parts.pop();","","\tfor (var i = 0; i < parts.length; i++) {","\t\tif (!locals[parts[i]]) {","\t\t\tlocals[parts[i]] = {};","\t\t}","\t\tlocals = locals[parts[i]];","\t}","","\tthis.queryQueue.push(function(next) {","\t\tquery.exec(function(err, results) {","","\t\t\tlocals[key] = results;","\t\t\tvar callbacks = chain.callbacks;","","\t\t\tif (err) {","\t\t\t\tif ('err' in callbacks) {","\t\t\t\t\t/* Will pass errors into the err callback","\t\t\t\t\t * ","\t\t\t\t\t * Example:","\t\t\t\t\t *     view.query('books', keystone.list('Book'))","\t\t\t\t\t *         .err(function (err, next) {","\t\t\t\t\t *             console.log('ERROR: ', err);","\t\t\t\t\t *             next();","\t\t\t\t\t *         });","\t\t\t\t\t */","\t\t\t\t\treturn callbacks.err(err, next);","\t\t\t\t}","\t\t\t} else {","\t\t\t\tif ((!results || (utils.isArray(results) && !results.length)) && 'none' in callbacks) {","\t\t\t\t\t/* If there are no results view.query().none will be called","\t\t\t\t\t * ","\t\t\t\t\t * Example:","\t\t\t\t\t *     view.query('books', keystone.list('Book').model.find())","\t\t\t\t\t *         .none(function (next) {","\t\t\t\t\t *             console.log('no results');","\t\t\t\t\t *             next();","\t\t\t\t\t *         });","\t\t\t\t\t */","\t\t\t\t\treturn callbacks.none(next);","\t\t\t\t} else if ('then' in callbacks) {","\t\t\t\t\tif (utils.isFunction(callbacks.then)) {","\t\t\t\t\t\treturn callbacks.then(err, results, next);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn keystone.populateRelated(results, callbacks.then, next);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\treturn next(err);","","\t\t});","\t});","","\treturn chain;","};","","","/**"," * Executes the current queue of init and action methods in series, and"," * then executes the render function. If renderFn is a string, it is provided"," * to `res.render`."," *"," * It is expected that *most* init stacks require processing in series,"," * but it is safe to execute actions in parallel."," *"," * If there are several init methods that should be run in parallel, queue"," * them as an array, e.g. `view.on('init', [first, second])`."," *"," * @api public"," */","View.prototype.render = function(renderFn, locals, callback) {","","\tvar req = this.req;","\tvar res = this.res;","","\tif ('string' === typeof renderFn) {","\t\tvar viewPath = renderFn;","\t\trenderFn = function() {","\t\t\tif ('function' === typeof locals) {","\t\t\t\tlocals = locals();","\t\t\t}","\t\t\tthis.res.render(viewPath, locals, callback);","\t\t}.bind(this);","\t}","","\tif ('function' !== typeof renderFn) {","\t\tthrow new Error('Keystone.View.render() renderFn must be a templatePath (string) or a function.');","\t}","","\t// Add actions, queries & renderQueue to the end of the initQueue","\tthis.initQueue.push(this.actionQueue);","\tthis.initQueue.push(this.queryQueue);","","\tvar preRenderQueue = [];","","\t// Add Keystone's global pre('render') queue","\tkeystone.getMiddleware('pre:render').forEach( function(fn) {","\t\tpreRenderQueue.push(function(next) {","\t\t\tfn(req, res, next);","\t\t});","\t});","","\tthis.initQueue.push(preRenderQueue);","\tthis.initQueue.push(this.renderQueue);","","\tasync.eachSeries(this.initQueue, function(i, next) {","\t\tif (Array.isArray(i)) {","\t\t\t// process nested arrays in parallel","\t\t\tasync.parallel(i, next);","\t\t} else if ('function' === typeof i) {","\t\t\t// process single methods in series","\t\t\ti(next);","\t\t} else {","\t\t\tthrow new Error('Keystone.View.render() events must be functions.');","\t\t}","\t}, function(err) {","\t\trenderFn(err, req, res);","\t});","","};",""],"l":{"5":1,"6":1,"7":1,"8":1,"19":1,"21":0,"22":0,"25":0,"26":0,"29":0,"30":0,"32":0,"33":0,"34":0,"35":0,"39":1,"49":1,"51":0,"52":0,"53":0,"55":0,"73":0,"74":0,"77":0,"89":0,"91":0,"92":0,"94":0,"95":0,"96":0,"98":0,"101":0,"103":0,"107":0,"108":0,"111":0,"122":0,"123":0,"126":0,"144":0,"145":0,"146":0,"148":0,"151":0,"153":0,"155":0,"156":0,"158":0,"162":0,"165":0,"175":0,"177":0,"187":0,"191":0,"195":1,"196":0,"197":0,"199":0,"201":0,"202":0,"203":0,"204":0,"205":0,"208":1,"209":1,"210":1,"211":1,"249":1,"251":0,"252":0,"253":0,"255":0,"257":0,"258":0,"259":0,"261":0,"264":0,"265":0,"267":0,"268":0,"270":0,"271":0,"281":0,"284":0,"294":0,"295":0,"296":0,"297":0,"299":0,"304":0,"309":0,"326":1,"328":0,"329":0,"331":0,"332":0,"333":0,"334":0,"335":0,"337":0,"341":0,"342":0,"346":0,"347":0,"349":0,"352":0,"353":0,"354":0,"358":0,"359":0,"361":0,"362":0,"364":0,"365":0,"367":0,"369":0,"372":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/index.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":1,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":1,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":1,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":1,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":1,"74":1,"75":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0]},"f":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"fnMap":{"1":{"name":"(anonymous_1)","line":13,"loc":{"start":{"line":13,"column":14},"end":{"line":13,"column":25}}},"2":{"name":"(anonymous_2)","line":29,"loc":{"start":{"line":29,"column":26},"end":{"line":29,"column":51}}},"3":{"name":"(anonymous_3)","line":48,"loc":{"start":{"line":48,"column":41},"end":{"line":48,"column":63}}},"4":{"name":"(anonymous_4)","line":58,"loc":{"start":{"line":58,"column":23},"end":{"line":58,"column":46}}},"5":{"name":"(anonymous_5)","line":64,"loc":{"start":{"line":64,"column":19},"end":{"line":64,"column":31}}},"6":{"name":"(anonymous_6)","line":70,"loc":{"start":{"line":70,"column":25},"end":{"line":70,"column":37}}},"7":{"name":"(anonymous_7)","line":99,"loc":{"start":{"line":99,"column":26},"end":{"line":99,"column":60}}},"8":{"name":"(anonymous_8)","line":109,"loc":{"start":{"line":109,"column":40},"end":{"line":109,"column":59}}},"9":{"name":"(anonymous_9)","line":138,"loc":{"start":{"line":138,"column":25},"end":{"line":138,"column":45}}},"10":{"name":"(anonymous_10)","line":174,"loc":{"start":{"line":174,"column":30},"end":{"line":174,"column":41}}},"11":{"name":"(anonymous_11)","line":204,"loc":{"start":{"line":204,"column":29},"end":{"line":204,"column":53}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":3,"column":24}},"2":{"start":{"line":13,"column":0},"end":{"line":13,"column":28}},"3":{"start":{"line":29,"column":0},"end":{"line":82,"column":2}},"4":{"start":{"line":31,"column":1},"end":{"line":34,"column":2}},"5":{"start":{"line":32,"column":2},"end":{"line":32,"column":18}},"6":{"start":{"line":33,"column":2},"end":{"line":33,"column":14}},"7":{"start":{"line":36,"column":1},"end":{"line":36,"column":20}},"8":{"start":{"line":38,"column":1},"end":{"line":40,"column":2}},"9":{"start":{"line":39,"column":2},"end":{"line":39,"column":88}},"10":{"start":{"line":42,"column":1},"end":{"line":80,"column":2}},"11":{"start":{"line":44,"column":2},"end":{"line":46,"column":3}},"12":{"start":{"line":45,"column":3},"end":{"line":45,"column":96}},"13":{"start":{"line":48,"column":2},"end":{"line":54,"column":5}},"14":{"start":{"line":50,"column":3},"end":{"line":50,"column":33}},"15":{"start":{"line":50,"column":12},"end":{"line":50,"column":33}},"16":{"start":{"line":52,"column":3},"end":{"line":52,"column":90}},"17":{"start":{"line":58,"column":2},"end":{"line":78,"column":5}},"18":{"start":{"line":60,"column":3},"end":{"line":60,"column":33}},"19":{"start":{"line":60,"column":12},"end":{"line":60,"column":33}},"20":{"start":{"line":62,"column":3},"end":{"line":62,"column":17}},"21":{"start":{"line":64,"column":3},"end":{"line":68,"column":6}},"22":{"start":{"line":65,"column":4},"end":{"line":67,"column":5}},"23":{"start":{"line":66,"column":5},"end":{"line":66,"column":65}},"24":{"start":{"line":70,"column":3},"end":{"line":74,"column":6}},"25":{"start":{"line":71,"column":4},"end":{"line":73,"column":5}},"26":{"start":{"line":72,"column":5},"end":{"line":72,"column":32}},"27":{"start":{"line":76,"column":3},"end":{"line":76,"column":15}},"28":{"start":{"line":99,"column":0},"end":{"line":129,"column":2}},"29":{"start":{"line":101,"column":1},"end":{"line":103,"column":2}},"30":{"start":{"line":102,"column":2},"end":{"line":102,"column":95}},"31":{"start":{"line":105,"column":1},"end":{"line":105,"column":46}},"32":{"start":{"line":109,"column":1},"end":{"line":127,"column":4}},"33":{"start":{"line":111,"column":2},"end":{"line":111,"column":32}},"34":{"start":{"line":111,"column":11},"end":{"line":111,"column":32}},"35":{"start":{"line":113,"column":2},"end":{"line":120,"column":3}},"36":{"start":{"line":114,"column":3},"end":{"line":116,"column":4}},"37":{"start":{"line":115,"column":4},"end":{"line":115,"column":34}},"38":{"start":{"line":117,"column":3},"end":{"line":117,"column":36}},"39":{"start":{"line":119,"column":3},"end":{"line":119,"column":47}},"40":{"start":{"line":122,"column":2},"end":{"line":122,"column":58}},"41":{"start":{"line":123,"column":2},"end":{"line":123,"column":34}},"42":{"start":{"line":125,"column":2},"end":{"line":125,"column":21}},"43":{"start":{"line":138,"column":0},"end":{"line":164,"column":2}},"44":{"start":{"line":140,"column":1},"end":{"line":142,"column":2}},"45":{"start":{"line":141,"column":2},"end":{"line":141,"column":18}},"46":{"start":{"line":144,"column":1},"end":{"line":152,"column":2}},"47":{"start":{"line":146,"column":2},"end":{"line":148,"column":3}},"48":{"start":{"line":147,"column":3},"end":{"line":147,"column":107}},"49":{"start":{"line":150,"column":2},"end":{"line":150,"column":25}},"50":{"start":{"line":154,"column":1},"end":{"line":154,"column":18}},"51":{"start":{"line":156,"column":1},"end":{"line":158,"column":2}},"52":{"start":{"line":157,"column":2},"end":{"line":157,"column":106}},"53":{"start":{"line":160,"column":1},"end":{"line":160,"column":24}},"54":{"start":{"line":162,"column":1},"end":{"line":162,"column":13}},"55":{"start":{"line":174,"column":0},"end":{"line":194,"column":2}},"56":{"start":{"line":176,"column":1},"end":{"line":176,"column":29}},"57":{"start":{"line":176,"column":22},"end":{"line":176,"column":29}},"58":{"start":{"line":178,"column":1},"end":{"line":181,"column":3}},"59":{"start":{"line":183,"column":1},"end":{"line":183,"column":68}},"60":{"start":{"line":185,"column":1},"end":{"line":190,"column":35}},"61":{"start":{"line":192,"column":1},"end":{"line":192,"column":70}},"62":{"start":{"line":204,"column":0},"end":{"line":233,"column":2}},"63":{"start":{"line":206,"column":1},"end":{"line":208,"column":2}},"64":{"start":{"line":207,"column":2},"end":{"line":207,"column":19}},"65":{"start":{"line":210,"column":1},"end":{"line":231,"column":2}},"66":{"start":{"line":212,"column":2},"end":{"line":212,"column":41}},"67":{"start":{"line":214,"column":2},"end":{"line":216,"column":3}},"68":{"start":{"line":215,"column":3},"end":{"line":215,"column":67}},"69":{"start":{"line":218,"column":2},"end":{"line":223,"column":4}},"70":{"start":{"line":225,"column":2},"end":{"line":227,"column":3}},"71":{"start":{"line":226,"column":3},"end":{"line":226,"column":24}},"72":{"start":{"line":229,"column":2},"end":{"line":229,"column":30}},"73":{"start":{"line":242,"column":0},"end":{"line":242,"column":41}},"74":{"start":{"line":245,"column":0},"end":{"line":245,"column":33}},"75":{"start":{"line":246,"column":0},"end":{"line":246,"column":35}}},"branchMap":{"1":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},{"start":{"line":31,"column":1},"end":{"line":31,"column":1}}]},"2":{"line":38,"type":"if","locations":[{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},{"start":{"line":38,"column":1},"end":{"line":38,"column":1}}]},"3":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},{"start":{"line":42,"column":1},"end":{"line":42,"column":1}}]},"4":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":2},"end":{"line":44,"column":2}},{"start":{"line":44,"column":2},"end":{"line":44,"column":2}}]},"5":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":3},"end":{"line":50,"column":3}},{"start":{"line":50,"column":3},"end":{"line":50,"column":3}}]},"6":{"line":52,"type":"cond-expr","locations":[{"start":{"line":52,"column":63},"end":{"line":52,"column":82}},{"start":{"line":52,"column":85},"end":{"line":52,"column":87}}]},"7":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":3},"end":{"line":60,"column":3}},{"start":{"line":60,"column":3},"end":{"line":60,"column":3}}]},"8":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":4},"end":{"line":65,"column":4}},{"start":{"line":65,"column":4},"end":{"line":65,"column":4}}]},"9":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":71,"column":4}},{"start":{"line":71,"column":4},"end":{"line":71,"column":4}}]},"10":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":1},"end":{"line":101,"column":1}},{"start":{"line":101,"column":1},"end":{"line":101,"column":1}}]},"11":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":2},"end":{"line":111,"column":2}},{"start":{"line":111,"column":2},"end":{"line":111,"column":2}}]},"12":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":2},"end":{"line":113,"column":2}},{"start":{"line":113,"column":2},"end":{"line":113,"column":2}}]},"13":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":3},"end":{"line":114,"column":3}},{"start":{"line":114,"column":3},"end":{"line":114,"column":3}}]},"14":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},{"start":{"line":140,"column":1},"end":{"line":140,"column":1}}]},"15":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},{"start":{"line":144,"column":1},"end":{"line":144,"column":1}}]},"16":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":2},"end":{"line":146,"column":2}},{"start":{"line":146,"column":2},"end":{"line":146,"column":2}}]},"17":{"line":156,"type":"if","locations":[{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},{"start":{"line":156,"column":1},"end":{"line":156,"column":1}}]},"18":{"line":176,"type":"if","locations":[{"start":{"line":176,"column":1},"end":{"line":176,"column":1}},{"start":{"line":176,"column":1},"end":{"line":176,"column":1}}]},"19":{"line":206,"type":"if","locations":[{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},{"start":{"line":206,"column":1},"end":{"line":206,"column":1}}]},"20":{"line":206,"type":"binary-expr","locations":[{"start":{"line":206,"column":5},"end":{"line":206,"column":10}},{"start":{"line":206,"column":14},"end":{"line":206,"column":37}}]},"21":{"line":210,"type":"if","locations":[{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},{"start":{"line":210,"column":1},"end":{"line":210,"column":1}}]},"22":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":2},"end":{"line":214,"column":2}},{"start":{"line":214,"column":2},"end":{"line":214,"column":2}}]},"23":{"line":225,"type":"if","locations":[{"start":{"line":225,"column":2},"end":{"line":225,"column":2}},{"start":{"line":225,"column":2},"end":{"line":225,"column":2}}]}},"code":["var _ = require('underscore'),","\tkeystone = require('../../'),","\tutils = keystone.utils;","","/**"," * Content Class"," *"," * Accessed via `Keystone.content`"," *"," * @api public"," */","","var Content = function() {};","","/**"," * Loads page content by page key (optional)."," *"," * If page key is not provided, returns a hash of all page contents in the database."," *"," * ####Example:"," *"," *     keystone.content.fetch('home', function(err, content) { ... });"," *"," * @param {String} key (optional)"," * @param {Function} callback"," * @api public"," */","","Content.prototype.fetch = function(page, callback) {","","\tif (utils.isFunction(page)) {","\t\tcallback = page;","\t\tpage = null;","\t}","","\tvar content = this;","","\tif (!this.AppContent) {","\t\treturn callback({ error: 'invalid page', message: 'No pages have been registered.' });","\t}","","\tif (page) {","","\t\tif (!this.pages[page]) {","\t\t\treturn callback({ error: 'invalid page', message: 'The page ' + page + ' does not exist.' });","\t\t}","","\t\tthis.AppContent.findOne({ key: page }, function(err, result) {","","\t\t\tif (err) return callback(err);","","\t\t\treturn callback(null, content.pages[page].populate(result ? result.content.data : {}));","","\t\t});","","\t} else {","","\t\tthis.AppContent.find(function(err, results) {","","\t\t\tif (err) return callback(err);","","\t\t\tvar data = {};","","\t\t\tresults.forEach(function(i) {","\t\t\t\tif (content.pages[i.key]) {","\t\t\t\t\tdata[i.key] = content.pages[i.key].populate(i.content.data);","\t\t\t\t}","\t\t\t});","","\t\t\t_.each(content.pages, function(i) {","\t\t\t\tif (!data[i.key]) {","\t\t\t\t\tdata[i.key] = i.populate();","\t\t\t\t}","\t\t\t});","","\t\t\treturn data;","","\t\t});","","\t}","","};","","/**"," * Sets page content by page key."," *"," * Merges content with existing content."," *"," * ####Example:"," *"," *     keystone.content.store('home', { title: 'Welcome' }, function(err) { ... });"," *"," * @param {String} key"," * @param {Object} content"," * @param {Function} callback"," * @api public"," */","","Content.prototype.store = function(page, content, callback) {","","\tif (!this.pages[page]) {","\t\treturn callback({ error: 'invalid page', message: 'The page ' + page + ' does not exist.' });","\t}","","\tcontent = this.pages[page].validate(content);","","\t// TODO: Handle validation errors","","\tthis.AppContent.findOne({ key: page }, function(err, doc) {","","\t\tif (err) return callback(err);","","\t\tif (doc) {","\t\t\tif (doc.content) {","\t\t\t\tdoc.history.push(doc.content);","\t\t\t}","\t\t\t_.defaults(content, doc.content);","\t\t} else {","\t\t\tdoc = new content.AppContent({ key: page });","\t\t}","","\t\tdoc.content = { data: this.pages[page].clean(content) };","\t\tdoc.lastChangeDate = Date.now();","","\t\tdoc.save(callback);","","\t});","","};","","/**"," * Registers a page. Should not be called directly, use Page.register() instead."," *"," * @param {Page} page"," * @api private"," */","","Content.prototype.page = function(key, page) {","","\tif (!this.pages) {","\t\tthis.pages = {};","\t}","","\tif (arguments.length === 1) {","","\t\tif (!this.pages[key]) {","\t\t\tthrow new Error('keystone.content.page() Error: page ' + key + ' cannot be registered more than once.');","\t\t}","","\t\treturn this.pages[key];","","\t}","","\tthis.initModel();","","\tif (this.pages[key]) {","\t\tthrow new Error('keystone.content.page() Error: page ' + key + ' cannot be registered more than once.');","\t}","","\tthis.pages[key] = page;","","\treturn page;","","};","","/**"," * Ensures the Mongoose model for storing content is initialised."," *"," * Called automatically when pages are added."," *"," * @api private"," */","","Content.prototype.initModel = function() {","","\tif (this.AppContent) return;","","\tvar contentSchemaDef = {","\t\tcreatedAt: { type: Date, default: Date.now },","\t\tdata: { type: keystone.mongoose.Schema.Types.Mixed }","\t};","","\tvar ContentSchema = new keystone.mongoose.Schema(contentSchemaDef);","","\tvar PageSchema = new keystone.mongoose.Schema({","\t\tpage: { type: String, index: true },","\t\tlastChangeDate: { type: Date, index: true },","\t\tcontent: contentSchemaDef,","\t\thistory: [ContentSchema]","\t}, { collection: 'app_content' });","","\tthis.AppContent = keystone.mongoose.model('App_Content', PageSchema);","","};","","/**"," * Outputs client-side editable data for content management"," *"," * Called automatically when pages are added."," *"," * @api private"," */","","Content.prototype.editable = function(user, options) {","","\tif (!user || !user.canAccessKeystone) {","\t\treturn undefined;","\t}","","\tif (options.list) {","","\t\tvar list = keystone.list(options.list);","","\t\tif (!list) {","\t\t\treturn JSON.stringify({ type: 'error', err: 'list not found' });","\t\t}","","\t\tvar data = {","\t\t\ttype: 'list',","\t\t\tpath: list.path,","\t\t\tsingular: list.singular,","\t\t\tplural: list.plural","\t\t};","","\t\tif (options.id) {","\t\t\tdata.id = options.id;","\t\t}","","\t\treturn JSON.stringify(data);","","\t}","","};","","","/**"," * The exports object is an instance of Content."," *"," * @api public"," */","","module.exports = exports = new Content();","","// Expose Classes","exports.Page = require('./page');","exports.Types = require('./types');",""],"l":{"1":1,"13":1,"29":1,"31":0,"32":0,"33":0,"36":0,"38":0,"39":0,"42":0,"44":0,"45":0,"48":0,"50":0,"52":0,"58":0,"60":0,"62":0,"64":0,"65":0,"66":0,"70":0,"71":0,"72":0,"76":0,"99":1,"101":0,"102":0,"105":0,"109":0,"111":0,"113":0,"114":0,"115":0,"117":0,"119":0,"122":0,"123":0,"125":0,"138":1,"140":0,"141":0,"144":0,"146":0,"147":0,"150":0,"154":0,"156":0,"157":0,"160":0,"162":0,"174":1,"176":0,"178":0,"183":0,"185":0,"192":0,"204":1,"206":0,"207":0,"210":0,"212":0,"214":0,"215":0,"218":0,"225":0,"226":0,"229":0,"242":1,"245":1,"246":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/page.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/page.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":1,"9":0,"10":1,"11":0,"12":0,"13":0,"14":0,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1,"31":0,"32":1,"33":0,"34":0,"35":0,"36":1,"37":0,"38":0,"39":0,"40":1,"41":0,"42":0,"43":0,"44":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"Page","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":28}}},"2":{"name":"(anonymous_2)","line":30,"loc":{"start":{"line":30,"column":6},"end":{"line":30,"column":17}}},"3":{"name":"(anonymous_3)","line":47,"loc":{"start":{"line":47,"column":21},"end":{"line":47,"column":42}}},"4":{"name":"(anonymous_4)","line":79,"loc":{"start":{"line":79,"column":21},"end":{"line":79,"column":38}}},"5":{"name":"(anonymous_5)","line":86,"loc":{"start":{"line":86,"column":16},"end":{"line":86,"column":40}}},"6":{"name":"(anonymous_6)","line":141,"loc":{"start":{"line":141,"column":26},"end":{"line":141,"column":37}}},"7":{"name":"(anonymous_7)","line":151,"loc":{"start":{"line":151,"column":26},"end":{"line":151,"column":41}}},"8":{"name":"(anonymous_8)","line":169,"loc":{"start":{"line":169,"column":26},"end":{"line":169,"column":41}}},"9":{"name":"(anonymous_9)","line":187,"loc":{"start":{"line":187,"column":23},"end":{"line":187,"column":38}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":4,"column":26}},"2":{"start":{"line":14,"column":0},"end":{"line":27,"column":1}},"3":{"start":{"line":16,"column":1},"end":{"line":18,"column":2}},"4":{"start":{"line":17,"column":2},"end":{"line":17,"column":32}},"5":{"start":{"line":20,"column":1},"end":{"line":22,"column":13}},"6":{"start":{"line":24,"column":1},"end":{"line":24,"column":16}},"7":{"start":{"line":25,"column":1},"end":{"line":25,"column":18}},"8":{"start":{"line":29,"column":0},"end":{"line":33,"column":3}},"9":{"start":{"line":31,"column":2},"end":{"line":31,"column":74}},"10":{"start":{"line":47,"column":0},"end":{"line":56,"column":2}},"11":{"start":{"line":49,"column":1},"end":{"line":51,"column":2}},"12":{"start":{"line":50,"column":2},"end":{"line":50,"column":27}},"13":{"start":{"line":53,"column":1},"end":{"line":53,"column":27}},"14":{"start":{"line":54,"column":1},"end":{"line":54,"column":14}},"15":{"start":{"line":71,"column":0},"end":{"line":71,"column":40}},"16":{"start":{"line":79,"column":0},"end":{"line":124,"column":2}},"17":{"start":{"line":82,"column":1},"end":{"line":84,"column":2}},"18":{"start":{"line":83,"column":2},"end":{"line":83,"column":82}},"19":{"start":{"line":86,"column":1},"end":{"line":120,"column":10}},"20":{"start":{"line":88,"column":2},"end":{"line":90,"column":3}},"21":{"start":{"line":89,"column":3},"end":{"line":89,"column":31}},"22":{"start":{"line":92,"column":2},"end":{"line":94,"column":3}},"23":{"start":{"line":93,"column":3},"end":{"line":93,"column":73}},"24":{"start":{"line":96,"column":2},"end":{"line":116,"column":3}},"25":{"start":{"line":100,"column":3},"end":{"line":114,"column":4}},"26":{"start":{"line":101,"column":4},"end":{"line":101,"column":47}},"27":{"start":{"line":113,"column":4},"end":{"line":113,"column":71}},"28":{"start":{"line":118,"column":2},"end":{"line":118,"column":54}},"29":{"start":{"line":122,"column":1},"end":{"line":122,"column":13}},"30":{"start":{"line":141,"column":0},"end":{"line":143,"column":2}},"31":{"start":{"line":142,"column":1},"end":{"line":142,"column":46}},"32":{"start":{"line":151,"column":0},"end":{"line":161,"column":2}},"33":{"start":{"line":153,"column":1},"end":{"line":155,"column":2}},"34":{"start":{"line":154,"column":2},"end":{"line":154,"column":12}},"35":{"start":{"line":159,"column":1},"end":{"line":159,"column":13}},"36":{"start":{"line":169,"column":0},"end":{"line":179,"column":2}},"37":{"start":{"line":171,"column":1},"end":{"line":173,"column":2}},"38":{"start":{"line":172,"column":2},"end":{"line":172,"column":12}},"39":{"start":{"line":177,"column":1},"end":{"line":177,"column":13}},"40":{"start":{"line":187,"column":0},"end":{"line":197,"column":2}},"41":{"start":{"line":189,"column":1},"end":{"line":191,"column":2}},"42":{"start":{"line":190,"column":2},"end":{"line":190,"column":12}},"43":{"start":{"line":195,"column":1},"end":{"line":195,"column":13}},"44":{"start":{"line":204,"column":0},"end":{"line":204,"column":32}}},"branchMap":{"1":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},{"start":{"line":16,"column":1},"end":{"line":16,"column":1}}]},"2":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":9},"end":{"line":31,"column":25}},{"start":{"line":31,"column":29},"end":{"line":31,"column":73}}]},"3":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},{"start":{"line":49,"column":1},"end":{"line":49,"column":1}}]},"4":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},{"start":{"line":82,"column":1},"end":{"line":82,"column":1}}]},"5":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":2},"end":{"line":88,"column":2}},{"start":{"line":88,"column":2},"end":{"line":88,"column":2}}]},"6":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":2},"end":{"line":92,"column":2}},{"start":{"line":92,"column":2},"end":{"line":92,"column":2}}]},"7":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":2},"end":{"line":96,"column":2}},{"start":{"line":96,"column":2},"end":{"line":96,"column":2}}]},"8":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":3},"end":{"line":100,"column":3}},{"start":{"line":100,"column":3},"end":{"line":100,"column":3}}]},"9":{"line":153,"type":"if","locations":[{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},{"start":{"line":153,"column":1},"end":{"line":153,"column":1}}]},"10":{"line":171,"type":"if","locations":[{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},{"start":{"line":171,"column":1},"end":{"line":171,"column":1}}]},"11":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":1},"end":{"line":189,"column":1}},{"start":{"line":189,"column":1},"end":{"line":189,"column":1}}]}},"code":["var _ = require('underscore'),","\tkeystone = require('../../'),","\tutils = keystone.utils,","\tType = require('./type');","","/**"," * Page Class"," *"," * @param {String} key"," * @param {Object} options"," * @api public"," */","","function Page(key, options) {","\t","\tif (!(this instanceof Page)) {","\t\treturn new Page(key, options);","\t}","\t","\tthis.options = utils.options({","\t\t// ...","\t}, options);","\t","\tthis.key = key;","\tthis.fields = {};","\t","}","","Object.defineProperty(Page.prototype, 'name', {","\tget: function() {","\t\treturn this.get('name') || this.set('name', utils.keyToLabel(this.key));","\t}","});","","/**"," * Sets page options"," *"," * ####Example:"," *"," *     page.set('test', value) // sets the 'test' option to `value`"," *"," * @param {String} key"," * @param {String} value"," * @api public"," */","","Page.prototype.set = function(key, value) {","\t","\tif (arguments.length === 1) {","\t\treturn this.options[key];","\t}","\t","\tthis.options[key] = value;","\treturn value;","\t","};","","","/**"," * Gets page options"," *"," * ####Example:"," *"," *     page.get('test') // returns the 'test' value"," *"," * @param {String} key"," * @method get"," * @api public"," */","","Page.prototype.get = Page.prototype.set;","","/**"," * Adds one or more fields to the page"," * "," * @api public"," */","","Page.prototype.add = function(fields) {","\t","\t// TODO: nested paths","\tif (!utils.isObject(fields)) {","\t\tthrow new Error('keystone.content.Page.add() Error: fields must be an object.');","\t}","\t","\t_.each(fields, function(options, path) {","\t\t","\t\tif ('function' === typeof options) {","\t\t\toptions = { type: options };","\t\t}","\t\t","\t\tif ('function' !== typeof options.type) {","\t\t\tthrow new Error('Page fields must be specified with a type function');","\t\t}","\t\t","\t\tif (options.type.prototype.__proto__ !== Type.prototype) {","\t\t\t","\t\t\t// Convert native field types to their default Keystone counterpart","\t\t\t","\t\t\tif (options.type === String) {","\t\t\t\toptions.type = keystone.content.Types.Text;","\t\t\t}","\t\t\t","\t\t\t// TODO: More types","\t\t\t// else if (options.type == Number)","\t\t\t// \toptions.type = Field.Types.Number;","\t\t\t// else if (options.type == Boolean)","\t\t\t// \toptions.type = Field.Types.Boolean;","\t\t\t// else if (options.type == Date)","\t\t\t// \toptions.type = Field.Types.Datetime;","\t\t\t","\t\t\telse {","\t\t\t\tthrow new Error('Unrecognised field constructor: ' + options.type);","\t\t\t}","\t\t\t","\t\t}","\t\t","\t\tthis.fields[path] = new options.type(path, options);","\t\t","\t}, this);","\t","\treturn this;","\t","};","","/**"," * Registers the page with Keystone."," * "," * ####Example:"," * \t\t"," * \t\tvar homePage = new keystone.content.Page('home');"," * \t\t// ..."," * \t\thomePage.register();"," * \t\t"," * \t\t// later..."," * \t\tvar homePage = keystone.content.page('home');"," * "," * @api public"," */","","Page.prototype.register = function() {","\treturn keystone.content.page(this.key, this);","};","","/**"," * Populates a data structure based on defined fields"," * "," * @api public"," */","","Page.prototype.populate = function(data) {","\t","\tif (!utils.isObject(data)) {","\t\tdata = {};","\t}","\t","\t// TODO: implement schema","\t","\treturn data;","\t","};","","/**"," * Validates a data structure based on defined fields"," * "," * @api public"," */","","Page.prototype.validate = function(data) {","\t","\tif (!_.isObject(data)) {","\t\tdata = {};","\t}","\t","\t// TODO: implement schema","\t","\treturn data;","\t","};","","/**"," * Cleans a data structure so only the defined fields are present"," * "," * @api public"," */","","Page.prototype.clean = function(data) {","\t","\tif (!_.isObject(data)) {","\t\tdata = {};","\t}","\t","\t// TODO: implement schema","\t","\treturn data;","\t","};","","","/*!"," * Export class"," */","","exports = module.exports = Page;",""],"l":{"1":1,"14":1,"16":0,"17":0,"20":0,"24":0,"25":0,"29":1,"31":0,"47":1,"49":0,"50":0,"53":0,"54":0,"71":1,"79":1,"82":0,"83":0,"86":0,"88":0,"89":0,"92":0,"93":0,"96":0,"100":0,"101":0,"113":0,"118":0,"122":0,"141":1,"142":0,"151":1,"153":0,"154":0,"159":0,"169":1,"171":0,"172":0,"177":0,"187":1,"189":0,"190":0,"195":0,"204":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/type.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/type.js","s":{"1":1,"2":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":6,"loc":{"start":{"line":6,"column":11},"end":{"line":6,"column":35}}}},"statementMap":{"1":{"start":{"line":6,"column":0},"end":{"line":8,"column":2}},"2":{"start":{"line":15,"column":0},"end":{"line":15,"column":32}}},"branchMap":{},"code":["/**"," * Type Class"," * @api private"," */","","var Type = function(path, options) { //eslint-disable-line no-unused-vars","\t// TODO","};","","","/*!"," * Export class"," */","","module.exports = exports = Type;",""],"l":{"6":1,"15":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/types/index.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/types/index.js","s":{"1":1,"2":1},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":33}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":33}}},"branchMap":{},"code":["exports.Text = require('./text');","exports.Html = require('./html');",""],"l":{"1":1,"2":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/types/text.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/types/text.js","s":{"1":1,"2":1,"3":0,"4":1,"5":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"text","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":29}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":6,"column":29}},"2":{"start":{"line":14,"column":0},"end":{"line":16,"column":1}},"3":{"start":{"line":15,"column":1},"end":{"line":15,"column":33}},"4":{"start":{"line":22,"column":0},"end":{"line":22,"column":28}},"5":{"start":{"line":29,"column":0},"end":{"line":29,"column":32}}},"branchMap":{},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tsuper_ = require('../type');","","/**"," * Text ContentType Constructor"," * @extends Field"," * @api public"," */","","function text(path, options) {","\ttext.super_.call(path, options);","}","","/*!"," * Inherit from Type"," */","","util.inherits(text, super_);","","","/*!"," * Export class"," */","","module.exports = exports = text;",""],"l":{"5":1,"14":1,"15":0,"22":1,"29":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/types/html.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/content/types/html.js","s":{"1":1,"2":1,"3":0,"4":1,"5":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"html","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":29}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":6,"column":29}},"2":{"start":{"line":14,"column":0},"end":{"line":16,"column":1}},"3":{"start":{"line":15,"column":1},"end":{"line":15,"column":33}},"4":{"start":{"line":22,"column":0},"end":{"line":22,"column":28}},"5":{"start":{"line":29,"column":0},"end":{"line":29,"column":32}}},"branchMap":{},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tsuper_ = require('../type');","","/**"," * HTML ContentType Constructor"," * @extends Field"," * @api public"," */","","function html(path, options) {","\thtml.super_.call(path, options);","}","","/*!"," * Inherit from Type"," */","","util.inherits(html, super_);","","","/*!"," * Export class"," */","","module.exports = exports = html;",""],"l":{"5":1,"14":1,"15":0,"22":1,"29":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/security/csrf.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/security/csrf.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"13":0,"14":1,"15":0,"16":1,"17":0,"18":1,"19":0,"20":1,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":1,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"tokenize","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":32}}},"2":{"name":"(anonymous_2)","line":18,"loc":{"start":{"line":18,"column":23},"end":{"line":18,"column":34}}},"3":{"name":"(anonymous_3)","line":22,"loc":{"start":{"line":22,"column":20},"end":{"line":22,"column":34}}},"4":{"name":"(anonymous_4)","line":26,"loc":{"start":{"line":26,"column":22},"end":{"line":26,"column":36}}},"5":{"name":"(anonymous_5)","line":30,"loc":{"start":{"line":30,"column":19},"end":{"line":30,"column":38}}},"6":{"name":"(anonymous_6)","line":36,"loc":{"start":{"line":36,"column":23},"end":{"line":36,"column":37}}},"7":{"name":"(anonymous_7)","line":49,"loc":{"start":{"line":49,"column":19},"end":{"line":49,"column":40}}},"8":{"name":"(anonymous_8)","line":61,"loc":{"start":{"line":61,"column":7},"end":{"line":61,"column":32}}},"9":{"name":"(anonymous_9)","line":67,"loc":{"start":{"line":67,"column":11},"end":{"line":67,"column":36}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":31}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":27}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"4":{"start":{"line":5,"column":0},"end":{"line":5,"column":28}},"5":{"start":{"line":6,"column":0},"end":{"line":6,"column":37}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":41}},"7":{"start":{"line":8,"column":0},"end":{"line":8,"column":51}},"8":{"start":{"line":9,"column":0},"end":{"line":9,"column":27}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":41}},"10":{"start":{"line":11,"column":0},"end":{"line":11,"column":41}},"11":{"start":{"line":12,"column":0},"end":{"line":12,"column":39}},"12":{"start":{"line":14,"column":0},"end":{"line":16,"column":1}},"13":{"start":{"line":15,"column":1},"end":{"line":15,"column":80}},"14":{"start":{"line":18,"column":0},"end":{"line":20,"column":2}},"15":{"start":{"line":19,"column":1},"end":{"line":19,"column":75}},"16":{"start":{"line":22,"column":0},"end":{"line":24,"column":2}},"17":{"start":{"line":23,"column":1},"end":{"line":23,"column":102}},"18":{"start":{"line":26,"column":0},"end":{"line":28,"column":2}},"19":{"start":{"line":27,"column":1},"end":{"line":27,"column":84}},"20":{"start":{"line":30,"column":0},"end":{"line":34,"column":2}},"21":{"start":{"line":31,"column":1},"end":{"line":31,"column":95}},"22":{"start":{"line":32,"column":1},"end":{"line":32,"column":70}},"23":{"start":{"line":33,"column":1},"end":{"line":33,"column":40}},"24":{"start":{"line":36,"column":0},"end":{"line":47,"column":2}},"25":{"start":{"line":37,"column":1},"end":{"line":45,"column":2}},"26":{"start":{"line":38,"column":2},"end":{"line":38,"column":37}},"27":{"start":{"line":39,"column":8},"end":{"line":45,"column":2}},"28":{"start":{"line":40,"column":2},"end":{"line":40,"column":38}},"29":{"start":{"line":41,"column":8},"end":{"line":45,"column":2}},"30":{"start":{"line":42,"column":2},"end":{"line":42,"column":46}},"31":{"start":{"line":43,"column":8},"end":{"line":45,"column":2}},"32":{"start":{"line":44,"column":2},"end":{"line":44,"column":46}},"33":{"start":{"line":46,"column":1},"end":{"line":46,"column":11}},"34":{"start":{"line":49,"column":0},"end":{"line":57,"column":2}},"35":{"start":{"line":50,"column":1},"end":{"line":52,"column":2}},"36":{"start":{"line":51,"column":2},"end":{"line":51,"column":36}},"37":{"start":{"line":53,"column":1},"end":{"line":55,"column":2}},"38":{"start":{"line":54,"column":2},"end":{"line":54,"column":15}},"39":{"start":{"line":56,"column":1},"end":{"line":56,"column":102}},"40":{"start":{"line":59,"column":0},"end":{"line":84,"column":2}},"41":{"start":{"line":62,"column":2},"end":{"line":62,"column":54}},"42":{"start":{"line":63,"column":2},"end":{"line":63,"column":29}},"43":{"start":{"line":64,"column":2},"end":{"line":64,"column":9}},"44":{"start":{"line":70,"column":2},"end":{"line":72,"column":3}},"45":{"start":{"line":71,"column":3},"end":{"line":71,"column":17}},"46":{"start":{"line":75,"column":2},"end":{"line":80,"column":3}},"47":{"start":{"line":76,"column":3},"end":{"line":76,"column":10}},"48":{"start":{"line":78,"column":3},"end":{"line":78,"column":24}},"49":{"start":{"line":79,"column":3},"end":{"line":79,"column":42}}},"branchMap":{"1":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":8},"end":{"line":23,"column":39}},{"start":{"line":23,"column":44},"end":{"line":23,"column":100}}]},"2":{"line":31,"type":"binary-expr","locations":[{"start":{"line":31,"column":35},"end":{"line":31,"column":66}},{"start":{"line":31,"column":70},"end":{"line":31,"column":94}}]},"3":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},{"start":{"line":37,"column":1},"end":{"line":37,"column":1}}]},"4":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":5},"end":{"line":37,"column":13}},{"start":{"line":37,"column":17},"end":{"line":37,"column":44}}]},"5":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":8},"end":{"line":39,"column":8}},{"start":{"line":39,"column":8},"end":{"line":39,"column":8}}]},"6":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":12},"end":{"line":39,"column":21}},{"start":{"line":39,"column":25},"end":{"line":39,"column":53}}]},"7":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":41,"column":8}},{"start":{"line":41,"column":8},"end":{"line":41,"column":8}}]},"8":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":12},"end":{"line":41,"column":23}},{"start":{"line":41,"column":27},"end":{"line":41,"column":63}}]},"9":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":8},"end":{"line":43,"column":8}},{"start":{"line":43,"column":8},"end":{"line":43,"column":8}}]},"10":{"line":43,"type":"binary-expr","locations":[{"start":{"line":43,"column":12},"end":{"line":43,"column":23}},{"start":{"line":43,"column":27},"end":{"line":43,"column":63}}]},"11":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},{"start":{"line":50,"column":1},"end":{"line":50,"column":1}}]},"12":{"line":53,"type":"if","locations":[{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},{"start":{"line":53,"column":1},"end":{"line":53,"column":1}}]},"13":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":2},"end":{"line":70,"column":2}},{"start":{"line":70,"column":2},"end":{"line":70,"column":2}}]},"14":{"line":70,"type":"binary-expr","locations":[{"start":{"line":70,"column":6},"end":{"line":70,"column":26}},{"start":{"line":70,"column":30},"end":{"line":70,"column":51}},{"start":{"line":70,"column":55},"end":{"line":70,"column":79}}]},"15":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":2},"end":{"line":75,"column":2}},{"start":{"line":75,"column":2},"end":{"line":75,"column":2}}]}},"code":["var crypto = require('crypto');","var scmp = require('scmp');","var utils = require('keystone-utils');","","exports.TOKEN_KEY = '_csrf';","exports.LOCAL_KEY = 'csrf_token_key';","exports.LOCAL_VALUE = 'csrf_token_value';","exports.SECRET_KEY = exports.TOKEN_KEY + '_secret';","exports.SECRET_LENGTH = 10;","exports.CSRF_HEADER_KEY = 'x-csrf-token';","exports.XSRF_HEADER_KEY = 'x-xsrf-token';","exports.XSRF_COOKIE_KEY = 'XSRF-TOKEN';","","function tokenize(salt, secret) {","\treturn salt + crypto.createHash('sha1').update(salt + secret).digest('base64');","}","","exports.createSecret = function() {","\treturn crypto.pseudoRandomBytes(exports.SECRET_LENGTH).toString('base64');","};","","exports.getSecret = function(req) {","\treturn req.session[exports.SECRET_KEY] || (req.session[exports.SECRET_KEY] = exports.createSecret());","};","","exports.createToken = function(req) {","\treturn tokenize(utils.randomString(exports.SECRET_LENGTH), exports.getSecret(req));","};","","exports.getToken = function(req, res) {","\tres.locals[exports.LOCAL_VALUE] = res.locals[exports.LOCAL_VALUE] || exports.createToken(req);","\tres.cookie(exports.XSRF_COOKIE_KEY, res.locals[exports.LOCAL_VALUE]);","\treturn res.locals[exports.LOCAL_VALUE];","};","","exports.requestToken = function(req) {","\tif (req.body && req.body[exports.TOKEN_KEY]) {","\t\treturn req.body[exports.TOKEN_KEY];","\t} else if (req.query && req.query[exports.TOKEN_KEY]) {","\t\treturn req.query[exports.TOKEN_KEY];","\t} else if (req.headers && req.headers[exports.XSRF_HEADER_KEY]) {","\t\treturn req.headers[exports.XSRF_HEADER_KEY];\t","\t} else if (req.headers && req.headers[exports.CSRF_HEADER_KEY]) {","\t\treturn req.headers[exports.CSRF_HEADER_KEY];\t\t","\t}","\treturn '';","};","","exports.validate = function(req, token) {","\tif (arguments.length === 1) {","\t\ttoken = exports.requestToken(req);","\t}","\tif (typeof token !== 'string') {","\t\treturn false;","\t}","\treturn scmp(token, tokenize(token.slice(0, exports.SECRET_LENGTH), req.session[exports.SECRET_KEY]));","};","","exports.middleware = {","\t","\tinit: function(req, res, next) {","\t\tres.locals[exports.LOCAL_KEY] = exports.LOCAL_VALUE;","\t\texports.getToken(req, res);","\t\tnext();","\t},","\t","\tvalidate: function(req, res, next) {","\t\t","\t\t// Bail on safe methods","\t\tif (req.method === 'GET' || req.method === 'HEAD' || req.method === 'OPTIONS') {","\t\t\treturn next();","\t\t}","\t\t","\t\t// Validate token","\t\tif (exports.validate(req)) {","\t\t\tnext();","\t\t} else {","\t\t\tres.statusCode = 403;","\t\t\tnext(new Error('CSRF token mismatch'));","\t\t}","\t","\t}","\t","};",""],"l":{"1":1,"2":1,"3":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":1,"12":1,"14":1,"15":0,"18":1,"19":0,"22":1,"23":0,"26":1,"27":0,"30":1,"31":0,"32":0,"33":0,"36":1,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"46":0,"49":1,"50":0,"51":0,"53":0,"54":0,"56":0,"59":1,"62":0,"63":0,"64":0,"70":0,"71":0,"75":0,"76":0,"78":0,"79":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/session.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/session.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":1,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":1,"56":0,"57":0,"58":0,"59":0,"60":1,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":1,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":1,"90":0,"91":0,"92":0,"93":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0,0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"fnMap":{"1":{"name":"hash","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":19}}},"2":{"name":"signinWithUser","line":32,"loc":{"start":{"line":32,"column":0},"end":{"line":32,"column":51}}},"3":{"name":"(anonymous_3)","line":48,"loc":{"start":{"line":48,"column":24},"end":{"line":48,"column":35}}},"4":{"name":"(anonymous_4)","line":62,"loc":{"start":{"line":62,"column":31},"end":{"line":62,"column":75}}},"5":{"name":"(anonymous_5)","line":63,"loc":{"start":{"line":63,"column":40},"end":{"line":63,"column":54}}},"6":{"name":"(anonymous_6)","line":81,"loc":{"start":{"line":81,"column":15},"end":{"line":81,"column":61}}},"7":{"name":"(anonymous_7)","line":94,"loc":{"start":{"line":94,"column":50},"end":{"line":94,"column":70}}},"8":{"name":"(anonymous_8)","line":96,"loc":{"start":{"line":96,"column":45},"end":{"line":96,"column":68}}},"9":{"name":"(anonymous_9)","line":112,"loc":{"start":{"line":112,"column":35},"end":{"line":112,"column":55}}},"10":{"name":"(anonymous_10)","line":122,"loc":{"start":{"line":122,"column":17},"end":{"line":122,"column":63}}},"11":{"name":"(anonymous_11)","line":123,"loc":{"start":{"line":123,"column":37},"end":{"line":123,"column":51}}},"12":{"name":"(anonymous_12)","line":139,"loc":{"start":{"line":139,"column":18},"end":{"line":139,"column":43}}},"13":{"name":"(anonymous_13)","line":140,"loc":{"start":{"line":140,"column":44},"end":{"line":140,"column":58}}},"14":{"name":"(anonymous_14)","line":146,"loc":{"start":{"line":146,"column":25},"end":{"line":146,"column":39}}},"15":{"name":"(anonymous_15)","line":150,"loc":{"start":{"line":150,"column":41},"end":{"line":150,"column":55}}},"16":{"name":"(anonymous_16)","line":171,"loc":{"start":{"line":171,"column":18},"end":{"line":171,"column":43}}},"17":{"name":"(anonymous_17)","line":178,"loc":{"start":{"line":178,"column":62},"end":{"line":178,"column":73}}},"18":{"name":"(anonymous_18)","line":180,"loc":{"start":{"line":180,"column":5},"end":{"line":180,"column":19}}},"19":{"name":"(anonymous_19)","line":184,"loc":{"start":{"line":184,"column":47},"end":{"line":184,"column":67}}},"20":{"name":"(anonymous_20)","line":213,"loc":{"start":{"line":213,"column":23},"end":{"line":213,"column":48}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":31}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":30}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":10,"column":0},"end":{"line":21,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":16}},"7":{"start":{"line":14,"column":1},"end":{"line":14,"column":49}},"8":{"start":{"line":16,"column":1},"end":{"line":20,"column":23}},"9":{"start":{"line":32,"column":0},"end":{"line":58,"column":1}},"10":{"start":{"line":33,"column":1},"end":{"line":35,"column":2}},"11":{"start":{"line":34,"column":2},"end":{"line":34,"column":116}},"12":{"start":{"line":36,"column":1},"end":{"line":38,"column":2}},"13":{"start":{"line":37,"column":2},"end":{"line":37,"column":84}},"14":{"start":{"line":39,"column":1},"end":{"line":41,"column":2}},"15":{"start":{"line":40,"column":2},"end":{"line":40,"column":83}},"16":{"start":{"line":42,"column":1},"end":{"line":44,"column":2}},"17":{"start":{"line":43,"column":2},"end":{"line":43,"column":83}},"18":{"start":{"line":45,"column":1},"end":{"line":47,"column":2}},"19":{"start":{"line":46,"column":2},"end":{"line":46,"column":90}},"20":{"start":{"line":48,"column":1},"end":{"line":57,"column":4}},"21":{"start":{"line":49,"column":2},"end":{"line":49,"column":18}},"22":{"start":{"line":50,"column":2},"end":{"line":50,"column":31}},"23":{"start":{"line":52,"column":2},"end":{"line":55,"column":3}},"24":{"start":{"line":53,"column":3},"end":{"line":53,"column":55}},"25":{"start":{"line":54,"column":3},"end":{"line":54,"column":75}},"26":{"start":{"line":56,"column":2},"end":{"line":56,"column":18}},"27":{"start":{"line":60,"column":0},"end":{"line":60,"column":40}},"28":{"start":{"line":62,"column":0},"end":{"line":69,"column":2}},"29":{"start":{"line":63,"column":1},"end":{"line":68,"column":4}},"30":{"start":{"line":64,"column":2},"end":{"line":66,"column":3}},"31":{"start":{"line":65,"column":3},"end":{"line":65,"column":22}},"32":{"start":{"line":67,"column":2},"end":{"line":67,"column":60}},"33":{"start":{"line":81,"column":0},"end":{"line":120,"column":2}},"34":{"start":{"line":82,"column":1},"end":{"line":84,"column":2}},"35":{"start":{"line":83,"column":2},"end":{"line":83,"column":96}},"36":{"start":{"line":85,"column":1},"end":{"line":85,"column":54}},"37":{"start":{"line":86,"column":1},"end":{"line":119,"column":2}},"38":{"start":{"line":88,"column":2},"end":{"line":90,"column":3}},"39":{"start":{"line":89,"column":3},"end":{"line":89,"column":59}},"40":{"start":{"line":92,"column":2},"end":{"line":92,"column":82}},"41":{"start":{"line":94,"column":2},"end":{"line":106,"column":5}},"42":{"start":{"line":95,"column":3},"end":{"line":105,"column":4}},"43":{"start":{"line":96,"column":4},"end":{"line":102,"column":7}},"44":{"start":{"line":97,"column":5},"end":{"line":101,"column":6}},"45":{"start":{"line":98,"column":6},"end":{"line":98,"column":66}},"46":{"start":{"line":100,"column":6},"end":{"line":100,"column":18}},"47":{"start":{"line":104,"column":4},"end":{"line":104,"column":16}},"48":{"start":{"line":108,"column":2},"end":{"line":108,"column":23}},"49":{"start":{"line":110,"column":2},"end":{"line":110,"column":90}},"50":{"start":{"line":111,"column":2},"end":{"line":111,"column":97}},"51":{"start":{"line":112,"column":2},"end":{"line":118,"column":5}},"52":{"start":{"line":113,"column":3},"end":{"line":117,"column":4}},"53":{"start":{"line":114,"column":4},"end":{"line":114,"column":64}},"54":{"start":{"line":116,"column":4},"end":{"line":116,"column":16}},"55":{"start":{"line":122,"column":0},"end":{"line":129,"column":2}},"56":{"start":{"line":123,"column":1},"end":{"line":128,"column":4}},"57":{"start":{"line":124,"column":2},"end":{"line":126,"column":3}},"58":{"start":{"line":125,"column":3},"end":{"line":125,"column":22}},"59":{"start":{"line":127,"column":2},"end":{"line":127,"column":48}},"60":{"start":{"line":139,"column":0},"end":{"line":158,"column":2}},"61":{"start":{"line":140,"column":1},"end":{"line":157,"column":4}},"62":{"start":{"line":141,"column":2},"end":{"line":143,"column":3}},"63":{"start":{"line":142,"column":3},"end":{"line":142,"column":69}},"64":{"start":{"line":144,"column":2},"end":{"line":144,"column":34}},"65":{"start":{"line":145,"column":2},"end":{"line":145,"column":18}},"66":{"start":{"line":146,"column":2},"end":{"line":156,"column":5}},"67":{"start":{"line":147,"column":3},"end":{"line":149,"column":4}},"68":{"start":{"line":148,"column":4},"end":{"line":148,"column":21}},"69":{"start":{"line":150,"column":3},"end":{"line":155,"column":6}},"70":{"start":{"line":151,"column":4},"end":{"line":153,"column":5}},"71":{"start":{"line":152,"column":5},"end":{"line":152,"column":72}},"72":{"start":{"line":154,"column":4},"end":{"line":154,"column":11}},"73":{"start":{"line":171,"column":0},"end":{"line":192,"column":2}},"74":{"start":{"line":172,"column":1},"end":{"line":172,"column":54}},"75":{"start":{"line":173,"column":1},"end":{"line":176,"column":2}},"76":{"start":{"line":174,"column":2},"end":{"line":174,"column":151}},"77":{"start":{"line":175,"column":2},"end":{"line":175,"column":18}},"78":{"start":{"line":177,"column":1},"end":{"line":191,"column":2}},"79":{"start":{"line":178,"column":2},"end":{"line":182,"column":5}},"80":{"start":{"line":179,"column":3},"end":{"line":179,"column":10}},"81":{"start":{"line":181,"column":3},"end":{"line":181,"column":13}},"82":{"start":{"line":183,"column":8},"end":{"line":191,"column":2}},"83":{"start":{"line":184,"column":2},"end":{"line":188,"column":5}},"84":{"start":{"line":185,"column":3},"end":{"line":185,"column":29}},"85":{"start":{"line":185,"column":12},"end":{"line":185,"column":29}},"86":{"start":{"line":186,"column":3},"end":{"line":186,"column":19}},"87":{"start":{"line":187,"column":3},"end":{"line":187,"column":10}},"88":{"start":{"line":190,"column":2},"end":{"line":190,"column":9}},"89":{"start":{"line":213,"column":0},"end":{"line":219,"column":2}},"90":{"start":{"line":214,"column":1},"end":{"line":217,"column":2}},"91":{"start":{"line":215,"column":2},"end":{"line":215,"column":88}},"92":{"start":{"line":216,"column":2},"end":{"line":216,"column":57}},"93":{"start":{"line":218,"column":1},"end":{"line":218,"column":8}}},"branchMap":{"1":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},{"start":{"line":33,"column":1},"end":{"line":33,"column":1}}]},"2":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},{"start":{"line":36,"column":1},"end":{"line":36,"column":1}}]},"3":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},{"start":{"line":39,"column":1},"end":{"line":39,"column":1}}]},"4":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},{"start":{"line":42,"column":1},"end":{"line":42,"column":1}}]},"5":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},{"start":{"line":45,"column":1},"end":{"line":45,"column":1}}]},"6":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":2},"end":{"line":52,"column":2}},{"start":{"line":52,"column":2},"end":{"line":52,"column":2}}]},"7":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":6},"end":{"line":52,"column":35}},{"start":{"line":52,"column":39},"end":{"line":52,"column":52}}]},"8":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":2},"end":{"line":64,"column":2}},{"start":{"line":64,"column":2},"end":{"line":64,"column":2}}]},"9":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},{"start":{"line":82,"column":1},"end":{"line":82,"column":1}}]},"10":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},{"start":{"line":86,"column":1},"end":{"line":86,"column":1}}]},"11":{"line":86,"type":"binary-expr","locations":[{"start":{"line":86,"column":5},"end":{"line":86,"column":37}},{"start":{"line":86,"column":41},"end":{"line":86,"column":76}}]},"12":{"line":88,"type":"if","locations":[{"start":{"line":88,"column":2},"end":{"line":88,"column":2}},{"start":{"line":88,"column":2},"end":{"line":88,"column":2}}]},"13":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":3},"end":{"line":95,"column":3}},{"start":{"line":95,"column":3},"end":{"line":95,"column":3}}]},"14":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":5},"end":{"line":97,"column":5}},{"start":{"line":97,"column":5},"end":{"line":97,"column":5}}]},"15":{"line":97,"type":"binary-expr","locations":[{"start":{"line":97,"column":9},"end":{"line":97,"column":13}},{"start":{"line":97,"column":17},"end":{"line":97,"column":24}}]},"16":{"line":110,"type":"cond-expr","locations":[{"start":{"line":110,"column":43},"end":{"line":110,"column":80}},{"start":{"line":110,"column":83},"end":{"line":110,"column":89}}]},"17":{"line":111,"type":"cond-expr","locations":[{"start":{"line":111,"column":50},"end":{"line":111,"column":88}},{"start":{"line":111,"column":91},"end":{"line":111,"column":96}}]},"18":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":3},"end":{"line":113,"column":3}},{"start":{"line":113,"column":3},"end":{"line":113,"column":3}}]},"19":{"line":113,"type":"binary-expr","locations":[{"start":{"line":113,"column":7},"end":{"line":113,"column":11}},{"start":{"line":113,"column":16},"end":{"line":113,"column":30}},{"start":{"line":113,"column":34},"end":{"line":113,"column":74}}]},"20":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":2},"end":{"line":124,"column":2}},{"start":{"line":124,"column":2},"end":{"line":124,"column":2}}]},"21":{"line":141,"type":"if","locations":[{"start":{"line":141,"column":2},"end":{"line":141,"column":2}},{"start":{"line":141,"column":2},"end":{"line":141,"column":2}}]},"22":{"line":147,"type":"if","locations":[{"start":{"line":147,"column":3},"end":{"line":147,"column":3}},{"start":{"line":147,"column":3},"end":{"line":147,"column":3}}]},"23":{"line":151,"type":"if","locations":[{"start":{"line":151,"column":4},"end":{"line":151,"column":4}},{"start":{"line":151,"column":4},"end":{"line":151,"column":4}}]},"24":{"line":173,"type":"if","locations":[{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},{"start":{"line":173,"column":1},"end":{"line":173,"column":1}}]},"25":{"line":177,"type":"if","locations":[{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},{"start":{"line":177,"column":1},"end":{"line":177,"column":1}}]},"26":{"line":177,"type":"binary-expr","locations":[{"start":{"line":177,"column":5},"end":{"line":177,"column":34}},{"start":{"line":177,"column":38},"end":{"line":177,"column":57}},{"start":{"line":177,"column":61},"end":{"line":177,"column":94}},{"start":{"line":177,"column":98},"end":{"line":177,"column":148}}]},"27":{"line":183,"type":"if","locations":[{"start":{"line":183,"column":8},"end":{"line":183,"column":8}},{"start":{"line":183,"column":8},"end":{"line":183,"column":8}}]},"28":{"line":185,"type":"if","locations":[{"start":{"line":185,"column":3},"end":{"line":185,"column":3}},{"start":{"line":185,"column":3},"end":{"line":185,"column":3}}]},"29":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},{"start":{"line":214,"column":1},"end":{"line":214,"column":1}}]},"30":{"line":214,"type":"binary-expr","locations":[{"start":{"line":214,"column":5},"end":{"line":214,"column":14}},{"start":{"line":214,"column":18},"end":{"line":214,"column":45}}]},"31":{"line":215,"type":"cond-expr","locations":[{"start":{"line":215,"column":64},"end":{"line":215,"column":66}},{"start":{"line":215,"column":69},"end":{"line":215,"column":87}}]}},"code":["var crypto = require('crypto');","var keystone = require('../');","var scmp = require('scmp');","var utils = require('keystone-utils');","","/**"," * Creates a hash of str with Keystone's cookie secret."," * Only hashes the first half of the string."," */","function hash(str) {","\t// force type","\tstr = '' + str;","\t// get the first half","\tstr = str.substr(0, Math.round(str.length / 2));","\t// hash using sha256","\treturn crypto","\t\t.createHmac('sha256', keystone.get('cookie secret'))","\t\t.update(str)","\t\t.digest('base64')","\t\t.replace(/\\=+$/, '');","}","","/**"," * Signs in a user using user obejct"," *"," * @param {Object} user - user object"," * @param {Object} req - express request object"," * @param {Object} res - express response object"," * @param {function()} onSuccess callback, is passed the User instance"," */","","function signinWithUser(user, req, res, onSuccess) {","\tif (arguments.length < 4) {","\t\tthrow new Error('keystone.session.signinWithUser requires user, req and res objects, and an onSuccess callback.');","\t}","\tif ('object' !== typeof user) {","\t\tthrow new Error('keystone.session.signinWithUser requires user to be an object.');","\t}","\tif ('object' !== typeof req) {","\t\tthrow new Error('keystone.session.signinWithUser requires req to be an object.');","\t}","\tif ('object' !== typeof res) {","\t\tthrow new Error('keystone.session.signinWithUser requires res to be an object.');","\t}","\tif ('function' !== typeof onSuccess) {","\t\tthrow new Error('keystone.session.signinWithUser requires onSuccess to be a function.');","\t}","\treq.session.regenerate(function() {","\t\treq.user = user;","\t\treq.session.userId = user.id;","\t\t// if the user has a password set, store a persistence cookie to resume sessions","\t\tif (keystone.get('cookie signin') && user.password) {","\t\t\tvar userToken = user.id + ':' + hash(user.password);","\t\t\tres.cookie('keystone.uid', userToken, { signed: true, httpOnly: true });","\t\t}","\t\tonSuccess(user);","\t});","}","","exports.signinWithUser = signinWithUser;","","var postHookedSigninWithUser = function(user, req, res, onSuccess, onFail) {","\tkeystone.callHook(user, 'post:signin', function(err) {","\t\tif (err) {","\t\t\treturn onFail(err);","\t\t}","\t\texports.signinWithUser(user, req, res, onSuccess, onFail);","\t});","};","","/**"," * Signs in a user user matching the lookup filters"," *"," * @param {Object} lookup - must contain email and password"," * @param {Object} req - express request object"," * @param {Object} res - express response object"," * @param {function()} onSuccess callback, is passed the User instance"," * @param {function()} onFail callback"," */","","var doSignin = function(lookup, req, res, onSuccess, onFail) {","\tif (!lookup) {","\t\treturn onFail(new Error('session.signin requires a User ID or Object as the first argument'));","\t}","\tvar User = keystone.list(keystone.get('user model'));","\tif ('string' === typeof lookup.email && 'string' === typeof lookup.password) {","\t\t// ensure that it is an email, we don't want people being able to sign in by just using \"\\.\" and a haphazardly correct password.","\t\tif (!utils.isEmail(lookup.email)) {","\t\t\treturn onFail(new Error('Incorrect email or password'));","\t\t}","\t\t// create regex for email lookup with special characters escaped","\t\tvar emailRegExp = new RegExp('^' + utils.escapeRegExp(lookup.email) + '$', 'i');","\t\t// match email address and password","\t\tUser.model.findOne({ email: emailRegExp }).exec(function(err, user) {","\t\t\tif (user) {","\t\t\t\tuser._.password.compare(lookup.password, function(err, isMatch) {","\t\t\t\t\tif (!err && isMatch) {","\t\t\t\t\t\tpostHookedSigninWithUser(user, req, res, onSuccess, onFail);","\t\t\t\t\t} else {","\t\t\t\t\t\tonFail(err);","\t\t\t\t\t}","\t\t\t\t});","\t\t\t} else {","\t\t\t\tonFail(err);","\t\t\t}","\t\t});","\t} else {","\t\tlookup = '' + lookup;","\t\t// match the userId, with optional password check","\t\tvar userId = (lookup.indexOf(':') > 0) ? lookup.substr(0, lookup.indexOf(':')) : lookup;","\t\tvar passwordCheck = (lookup.indexOf(':') > 0) ? lookup.substr(lookup.indexOf(':') + 1) : false;","\t\tUser.model.findById(userId).exec(function(err, user) {","\t\t\tif (user && (!passwordCheck || scmp(passwordCheck, hash(user.password)))) {","\t\t\t\tpostHookedSigninWithUser(user, req, res, onSuccess, onFail);","\t\t\t} else {","\t\t\t\tonFail(err);","\t\t\t}","\t\t});","\t}","};","","exports.signin = function(lookup, req, res, onSuccess, onFail) {","\tkeystone.callHook({}, 'pre:signin', function(err) {","\t\tif (err) {","\t\t\treturn onFail(err);","\t\t}","\t\tdoSignin(lookup, req, res, onSuccess, onFail);","\t});","};","","/**"," * Signs the current user out and resets the session"," *"," * @param {Object} req - express request object"," * @param {Object} res - express response object"," * @param {function()} next callback"," */","","exports.signout = function(req, res, next) {","\tkeystone.callHook(req.user, 'pre:signout', function(err) {","\t\tif (err) {","\t\t\tconsole.log(\"An error occurred in signout 'pre' middleware\", err);","\t\t}","\t\tres.clearCookie('keystone.uid');","\t\treq.user = null;","\t\treq.session.regenerate(function(err) {","\t\t\tif (err) {","\t\t\t\treturn next(err);","\t\t\t}","\t\t\tkeystone.callHook({}, 'post:signout', function(err) {","\t\t\t\tif (err) {","\t\t\t\t\tconsole.log(\"An error occurred in signout 'post' middleware\", err);","\t\t\t\t}","\t\t\t\tnext();","\t\t\t});","\t\t});","\t});","};","","/**"," * Middleware to ensure session persistence across server restarts"," *"," * Looks for a userId cookie, and if present, and there is no user signed in,"," * automatically signs the user in."," *"," * @param {Object} req - express request object"," * @param {Object} res - express response object"," * @param {function()} next callback"," */","","exports.persist = function(req, res, next) {","\tvar User = keystone.list(keystone.get('user model'));","\tif (!req.session) {","\t\tconsole.error('\\nKeystoneJS Runtime Error:\\n\\napp must have session middleware installed. Try adding \"express-session\" to your express instance.\\n');","\t\tprocess.exit(1);","\t}","\tif (keystone.get('cookie signin') && !req.session.userId && req.signedCookies['keystone.uid'] && req.signedCookies['keystone.uid'].indexOf(':') > 0) {","\t\texports.signin(req.signedCookies['keystone.uid'], req, res, function() {","\t\t\tnext();","\t\t}, function(err) {","\t\t\tnext(err);","\t\t});","\t} else if (req.session.userId) {","\t\tUser.model.findById(req.session.userId).exec(function(err, user) {","\t\t\tif (err) return next(err);","\t\t\treq.user = user;","\t\t\tnext();","\t\t});","\t} else {","\t\tnext();","\t}","};","","/**"," * Middleware to enable access to Keystone"," *"," * Bounces the user to the signin screen if they are not signed in or do not have permission."," *"," * req.user is the user returned by the database. It's type is Keystone.List."," *"," * req.user.canAccessKeystone denotes whether the user has access to the admin panel."," * If you're having issues double check your user model. Setting `canAccessKeystone` to true in"," * the database will not be reflected here if it is virtual."," * See http://mongoosejs.com/docs/guide.html#virtuals"," *"," * @param {Object} req - express request object"," * @param req.user - The user object Keystone.List"," * @param req.user.canAccessKeystone {Boolean|Function}"," * @param {Object} res - express response object"," * @param {function()} next callback"," */","","exports.keystoneAuth = function(req, res, next) {","\tif (!req.user || !req.user.canAccessKeystone) {","\t\tvar from = new RegExp('^\\/keystone\\/?$', 'i').test(req.url) ? '' : '?from=' + req.url;","\t\treturn res.redirect(keystone.get('signin url') + from);","\t}","\tnext();","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"10":1,"12":0,"14":0,"16":0,"32":1,"33":0,"34":0,"36":0,"37":0,"39":0,"40":0,"42":0,"43":0,"45":0,"46":0,"48":0,"49":0,"50":0,"52":0,"53":0,"54":0,"56":0,"60":1,"62":1,"63":0,"64":0,"65":0,"67":0,"81":1,"82":0,"83":0,"85":0,"86":0,"88":0,"89":0,"92":0,"94":0,"95":0,"96":0,"97":0,"98":0,"100":0,"104":0,"108":0,"110":0,"111":0,"112":0,"113":0,"114":0,"116":0,"122":1,"123":0,"124":0,"125":0,"127":0,"139":1,"140":0,"141":0,"142":0,"144":0,"145":0,"146":0,"147":0,"148":0,"150":0,"151":0,"152":0,"154":0,"171":1,"172":0,"173":0,"174":0,"175":0,"177":0,"178":0,"179":0,"181":0,"183":0,"184":0,"185":0,"186":0,"187":0,"190":0,"213":1,"214":0,"215":0,"216":0,"218":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/azurefile/AzureFileType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/azurefile/AzureFileType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":1,"23":1,"24":0,"25":1,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":1,"50":0,"51":1,"52":0,"53":1,"54":0,"55":1,"56":1,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":1,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":1,"97":0,"98":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},"fnMap":{"1":{"name":"azurefile","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":40}}},"2":{"name":"(anonymous_2)","line":51,"loc":{"start":{"line":51,"column":58},"end":{"line":51,"column":83}}},"3":{"name":"(anonymous_3)","line":52,"loc":{"start":{"line":52,"column":60},"end":{"line":52,"column":85}}},"4":{"name":"(anonymous_4)","line":72,"loc":{"start":{"line":72,"column":6},"end":{"line":72,"column":17}}},"5":{"name":"(anonymous_5)","line":84,"loc":{"start":{"line":84,"column":34},"end":{"line":84,"column":45}}},"6":{"name":"(anonymous_6)","line":116,"loc":{"start":{"line":116,"column":14},"end":{"line":116,"column":29}}},"7":{"name":"(anonymous_7)","line":121,"loc":{"start":{"line":121,"column":34},"end":{"line":121,"column":45}}},"8":{"name":"(anonymous_8)","line":125,"loc":{"start":{"line":125,"column":13},"end":{"line":125,"column":28}}},"9":{"name":"(anonymous_9)","line":136,"loc":{"start":{"line":136,"column":10},"end":{"line":136,"column":21}}},"10":{"name":"(anonymous_10)","line":144,"loc":{"start":{"line":144,"column":9},"end":{"line":144,"column":20}}},"11":{"name":"(anonymous_11)","line":146,"loc":{"start":{"line":146,"column":94},"end":{"line":146,"column":105}}},"12":{"name":"(anonymous_12)","line":155,"loc":{"start":{"line":155,"column":10},"end":{"line":155,"column":21}}},"13":{"name":"(anonymous_13)","line":157,"loc":{"start":{"line":157,"column":106},"end":{"line":157,"column":117}}},"14":{"name":"(anonymous_14)","line":163,"loc":{"start":{"line":163,"column":23},"end":{"line":163,"column":41}}},"15":{"name":"(anonymous_15)","line":168,"loc":{"start":{"line":168,"column":14},"end":{"line":168,"column":37}}},"16":{"name":"(anonymous_16)","line":182,"loc":{"start":{"line":182,"column":29},"end":{"line":182,"column":44}}},"17":{"name":"(anonymous_17)","line":193,"loc":{"start":{"line":193,"column":33},"end":{"line":193,"column":48}}},"18":{"name":"(anonymous_18)","line":204,"loc":{"start":{"line":204,"column":36},"end":{"line":204,"column":51}}},"19":{"name":"(anonymous_19)","line":216,"loc":{"start":{"line":216,"column":33},"end":{"line":216,"column":54}}},"20":{"name":"(anonymous_20)","line":227,"loc":{"start":{"line":227,"column":33},"end":{"line":227,"column":72}}},"21":{"name":"(anonymous_21)","line":242,"loc":{"start":{"line":242,"column":16},"end":{"line":242,"column":27}}},"22":{"name":"(anonymous_22)","line":246,"loc":{"start":{"line":246,"column":84},"end":{"line":246,"column":98}}},"23":{"name":"(anonymous_23)","line":250,"loc":{"start":{"line":250,"column":116},"end":{"line":250,"column":141}}},"24":{"name":"(anonymous_24)","line":273,"loc":{"start":{"line":273,"column":41},"end":{"line":273,"column":55}}},"25":{"name":"(anonymous_25)","line":290,"loc":{"start":{"line":290,"column":40},"end":{"line":290,"column":77}}},"26":{"name":"(anonymous_26)","line":301,"loc":{"start":{"line":301,"column":24},"end":{"line":301,"column":35}}},"27":{"name":"(anonymous_27)","line":303,"loc":{"start":{"line":303,"column":8},"end":{"line":303,"column":19}}},"28":{"name":"(anonymous_28)","line":329,"loc":{"start":{"line":329,"column":36},"end":{"line":329,"column":73}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":12,"column":29}},"2":{"start":{"line":21,"column":0},"end":{"line":59,"column":1}},"3":{"start":{"line":22,"column":1},"end":{"line":23,"column":28}},"4":{"start":{"line":25,"column":1},"end":{"line":25,"column":52}},"5":{"start":{"line":26,"column":1},"end":{"line":26,"column":26}},"6":{"start":{"line":29,"column":1},"end":{"line":29,"column":25}},"7":{"start":{"line":32,"column":1},"end":{"line":34,"column":2}},"8":{"start":{"line":33,"column":2},"end":{"line":33,"column":152}},"9":{"start":{"line":36,"column":1},"end":{"line":36,"column":50}},"10":{"start":{"line":39,"column":1},"end":{"line":43,"column":2}},"11":{"start":{"line":40,"column":2},"end":{"line":42,"column":91}},"12":{"start":{"line":45,"column":1},"end":{"line":45,"column":66}},"13":{"start":{"line":46,"column":1},"end":{"line":46,"column":65}},"14":{"start":{"line":48,"column":1},"end":{"line":48,"column":79}},"15":{"start":{"line":50,"column":1},"end":{"line":50,"column":17}},"16":{"start":{"line":51,"column":1},"end":{"line":51,"column":104}},"17":{"start":{"line":51,"column":85},"end":{"line":51,"column":101}},"18":{"start":{"line":52,"column":1},"end":{"line":52,"column":128}},"19":{"start":{"line":52,"column":87},"end":{"line":52,"column":125}},"20":{"start":{"line":55,"column":1},"end":{"line":57,"column":2}},"21":{"start":{"line":56,"column":2},"end":{"line":56,"column":41}},"22":{"start":{"line":65,"column":0},"end":{"line":65,"column":33}},"23":{"start":{"line":71,"column":0},"end":{"line":75,"column":3}},"24":{"start":{"line":73,"column":2},"end":{"line":73,"column":74}},"25":{"start":{"line":84,"column":0},"end":{"line":173,"column":2}},"26":{"start":{"line":86,"column":1},"end":{"line":87,"column":28}},"27":{"start":{"line":89,"column":1},"end":{"line":102,"column":3}},"28":{"start":{"line":104,"column":1},"end":{"line":112,"column":4}},"29":{"start":{"line":114,"column":1},"end":{"line":114,"column":25}},"30":{"start":{"line":116,"column":1},"end":{"line":118,"column":3}},"31":{"start":{"line":117,"column":2},"end":{"line":117,"column":46}},"32":{"start":{"line":121,"column":1},"end":{"line":123,"column":4}},"33":{"start":{"line":122,"column":2},"end":{"line":122,"column":42}},"34":{"start":{"line":125,"column":1},"end":{"line":133,"column":3}},"35":{"start":{"line":126,"column":2},"end":{"line":132,"column":5}},"36":{"start":{"line":135,"column":1},"end":{"line":161,"column":3}},"37":{"start":{"line":137,"column":3},"end":{"line":137,"column":23}},"38":{"start":{"line":145,"column":3},"end":{"line":147,"column":16}},"39":{"start":{"line":146,"column":4},"end":{"line":146,"column":109}},"40":{"start":{"line":148,"column":3},"end":{"line":148,"column":15}},"41":{"start":{"line":156,"column":3},"end":{"line":158,"column":16}},"42":{"start":{"line":157,"column":4},"end":{"line":157,"column":121}},"43":{"start":{"line":159,"column":3},"end":{"line":159,"column":15}},"44":{"start":{"line":163,"column":1},"end":{"line":165,"column":4}},"45":{"start":{"line":164,"column":2},"end":{"line":164,"column":34}},"46":{"start":{"line":168,"column":1},"end":{"line":170,"column":3}},"47":{"start":{"line":169,"column":2},"end":{"line":169,"column":85}},"48":{"start":{"line":172,"column":1},"end":{"line":172,"column":30}},"49":{"start":{"line":182,"column":0},"end":{"line":184,"column":2}},"50":{"start":{"line":183,"column":1},"end":{"line":183,"column":33}},"51":{"start":{"line":193,"column":0},"end":{"line":195,"column":2}},"52":{"start":{"line":194,"column":1},"end":{"line":194,"column":40}},"53":{"start":{"line":204,"column":0},"end":{"line":207,"column":2}},"54":{"start":{"line":206,"column":1},"end":{"line":206,"column":13}},"55":{"start":{"line":216,"column":0},"end":{"line":218,"column":2}},"56":{"start":{"line":227,"column":0},"end":{"line":277,"column":2}},"57":{"start":{"line":229,"column":1},"end":{"line":231,"column":40}},"58":{"start":{"line":233,"column":1},"end":{"line":235,"column":2}},"59":{"start":{"line":234,"column":2},"end":{"line":234,"column":67}},"60":{"start":{"line":237,"column":1},"end":{"line":240,"column":2}},"61":{"start":{"line":238,"column":2},"end":{"line":238,"column":20}},"62":{"start":{"line":239,"column":2},"end":{"line":239,"column":17}},"63":{"start":{"line":242,"column":1},"end":{"line":271,"column":3}},"64":{"start":{"line":243,"column":2},"end":{"line":243,"column":46}},"65":{"start":{"line":244,"column":2},"end":{"line":244,"column":68}},"66":{"start":{"line":246,"column":2},"end":{"line":270,"column":5}},"67":{"start":{"line":248,"column":3},"end":{"line":248,"column":33}},"68":{"start":{"line":248,"column":12},"end":{"line":248,"column":33}},"69":{"start":{"line":250,"column":3},"end":{"line":269,"column":6}},"70":{"start":{"line":252,"column":4},"end":{"line":252,"column":34}},"71":{"start":{"line":252,"column":13},"end":{"line":252,"column":34}},"72":{"start":{"line":254,"column":4},"end":{"line":261,"column":6}},"73":{"start":{"line":263,"column":4},"end":{"line":265,"column":5}},"74":{"start":{"line":264,"column":5},"end":{"line":264,"column":36}},"75":{"start":{"line":267,"column":4},"end":{"line":267,"column":29}},"76":{"start":{"line":273,"column":1},"end":{"line":276,"column":4}},"77":{"start":{"line":274,"column":2},"end":{"line":274,"column":32}},"78":{"start":{"line":274,"column":11},"end":{"line":274,"column":32}},"79":{"start":{"line":275,"column":2},"end":{"line":275,"column":13}},"80":{"start":{"line":290,"column":0},"end":{"line":320,"column":2}},"81":{"start":{"line":292,"column":1},"end":{"line":292,"column":18}},"82":{"start":{"line":294,"column":1},"end":{"line":299,"column":2}},"83":{"start":{"line":295,"column":2},"end":{"line":295,"column":19}},"84":{"start":{"line":296,"column":2},"end":{"line":296,"column":22}},"85":{"start":{"line":297,"column":8},"end":{"line":299,"column":2}},"86":{"start":{"line":298,"column":2},"end":{"line":298,"column":22}},"87":{"start":{"line":301,"column":1},"end":{"line":301,"column":38}},"88":{"start":{"line":303,"column":1},"end":{"line":318,"column":3}},"89":{"start":{"line":304,"column":2},"end":{"line":310,"column":3}},"90":{"start":{"line":305,"column":3},"end":{"line":305,"column":39}},"91":{"start":{"line":307,"column":3},"end":{"line":309,"column":4}},"92":{"start":{"line":308,"column":4},"end":{"line":308,"column":30}},"93":{"start":{"line":312,"column":2},"end":{"line":314,"column":3}},"94":{"start":{"line":313,"column":3},"end":{"line":313,"column":74}},"95":{"start":{"line":316,"column":2},"end":{"line":316,"column":20}},"96":{"start":{"line":329,"column":0},"end":{"line":331,"column":2}},"97":{"start":{"line":330,"column":1},"end":{"line":330,"column":54}},"98":{"start":{"line":338,"column":0},"end":{"line":338,"column":37}}},"branchMap":{"1":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},{"start":{"line":32,"column":1},"end":{"line":32,"column":1}}]},"2":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},{"start":{"line":39,"column":1},"end":{"line":39,"column":1}}]},"3":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":34},"end":{"line":48,"column":64}},{"start":{"line":48,"column":68},"end":{"line":48,"column":78}}]},"4":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":29},"end":{"line":51,"column":54}},{"start":{"line":51,"column":58},"end":{"line":51,"column":103}}]},"5":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":30},"end":{"line":52,"column":56}},{"start":{"line":52,"column":60},"end":{"line":52,"column":127}}]},"6":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},{"start":{"line":55,"column":1},"end":{"line":55,"column":1}}]},"7":{"line":55,"type":"binary-expr","locations":[{"start":{"line":55,"column":5},"end":{"line":55,"column":16}},{"start":{"line":55,"column":20},"end":{"line":55,"column":38}}]},"8":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":9},"end":{"line":73,"column":37}},{"start":{"line":73,"column":41},"end":{"line":73,"column":73}}]},"9":{"line":117,"type":"cond-expr","locations":[{"start":{"line":117,"column":32},"end":{"line":117,"column":36}},{"start":{"line":117,"column":39},"end":{"line":117,"column":44}}]},"10":{"line":230,"type":"cond-expr","locations":[{"start":{"line":230,"column":38},"end":{"line":230,"column":85}},{"start":{"line":230,"column":88},"end":{"line":230,"column":90}}]},"11":{"line":231,"type":"binary-expr","locations":[{"start":{"line":231,"column":13},"end":{"line":231,"column":26}},{"start":{"line":231,"column":30},"end":{"line":231,"column":39}}]},"12":{"line":233,"type":"if","locations":[{"start":{"line":233,"column":1},"end":{"line":233,"column":1}},{"start":{"line":233,"column":1},"end":{"line":233,"column":1}}]},"13":{"line":233,"type":"binary-expr","locations":[{"start":{"line":233,"column":5},"end":{"line":233,"column":31}},{"start":{"line":233,"column":35},"end":{"line":233,"column":84}}]},"14":{"line":237,"type":"if","locations":[{"start":{"line":237,"column":1},"end":{"line":237,"column":1}},{"start":{"line":237,"column":1},"end":{"line":237,"column":1}}]},"15":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":3},"end":{"line":248,"column":3}},{"start":{"line":248,"column":3},"end":{"line":248,"column":3}}]},"16":{"line":252,"type":"if","locations":[{"start":{"line":252,"column":4},"end":{"line":252,"column":4}},{"start":{"line":252,"column":4},"end":{"line":252,"column":4}}]},"17":{"line":263,"type":"if","locations":[{"start":{"line":263,"column":4},"end":{"line":263,"column":4}},{"start":{"line":263,"column":4},"end":{"line":263,"column":4}}]},"18":{"line":274,"type":"if","locations":[{"start":{"line":274,"column":2},"end":{"line":274,"column":2}},{"start":{"line":274,"column":2},"end":{"line":274,"column":2}}]},"19":{"line":294,"type":"if","locations":[{"start":{"line":294,"column":1},"end":{"line":294,"column":1}},{"start":{"line":294,"column":1},"end":{"line":294,"column":1}}]},"20":{"line":297,"type":"if","locations":[{"start":{"line":297,"column":8},"end":{"line":297,"column":8}},{"start":{"line":297,"column":8},"end":{"line":297,"column":8}}]},"21":{"line":301,"type":"binary-expr","locations":[{"start":{"line":301,"column":12},"end":{"line":301,"column":20}},{"start":{"line":301,"column":24},"end":{"line":301,"column":37}}]},"22":{"line":304,"type":"if","locations":[{"start":{"line":304,"column":2},"end":{"line":304,"column":2}},{"start":{"line":304,"column":2},"end":{"line":304,"column":2}}]},"23":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":3},"end":{"line":307,"column":3}},{"start":{"line":307,"column":3},"end":{"line":307,"column":3}}]},"24":{"line":312,"type":"if","locations":[{"start":{"line":312,"column":2},"end":{"line":312,"column":2}},{"start":{"line":312,"column":2},"end":{"line":312,"column":2}}]},"25":{"line":312,"type":"binary-expr","locations":[{"start":{"line":312,"column":6},"end":{"line":312,"column":15}},{"start":{"line":312,"column":19},"end":{"line":312,"column":42}},{"start":{"line":312,"column":46},"end":{"line":312,"column":74}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tmoment = require('moment'),","\tkeystone = require('../../../'),","\tutil = require('util'),","\tazure = require('azure'),","\tutils = require('keystone-utils'),","\tgrappling = require('grappling-hook'),","\tsuper_ = require('../Type');","","","/**"," * AzureFile FieldType Constructor"," * @extends Field"," * @api public"," */","","function azurefile(list, path, options) {","\tgrappling.mixin(this)","\t\t.allowHooks('pre:upload');","","\tthis._underscoreMethods = ['format', 'uploadFile'];","\tthis._fixedSize = 'full';","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","","\t// TODO: implement initial form, usage disabled for now","\tif (options.initial) {","\t\tthrow new Error('Invalid Configuration\\n\\nAzureFile fields (' + list.key + '.' + path + ') do not currently support being used as initial fields.\\n');","\t}","","\tazurefile.super_.call(this, list, path, options);","","\t// validate azurefile config (has to happen after super_.call)","\tif (!this.azurefileconfig) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'AzureFile fields (' + list.key + '.' + path + ') require the \"azurefile config\" option to be set.\\n\\n' +","\t\t\t'See http://keystonejs.com/docs/configuration/#services-azure for more information.\\n');","\t}","","\tprocess.env.AZURE_STORAGE_ACCOUNT = this.azurefileconfig.account;","\tprocess.env.AZURE_STORAGE_ACCESS_KEY = this.azurefileconfig.key;","","\tthis.azurefileconfig.container = this.azurefileconfig.container || 'keystone';","","\tvar self = this;","\toptions.filenameFormatter = options.filenameFormatter || function(item, filename) { return filename; };","\toptions.containerFormatter = options.containerFormatter || function(item, filename) { return self.azurefileconfig.container; };//eslint-disable-line no-unused-vars","","\t// Could be more pre- hooks, just upload for now","\tif (options.pre && options.pre.upload) {","\t\tthis.pre('upload', options.pre.upload);","\t}","","}","","/*!"," * Inherit from Field"," */","","util.inherits(azurefile, super_);","","/**"," * Exposes the custom or keystone s3 config settings"," */","","Object.defineProperty(azurefile.prototype, 'azurefileconfig', {","\tget: function() {","\t\treturn this.options.azurefileconfig || keystone.get('azurefile config');","\t}","});","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","azurefile.prototype.addToSchema = function() {","","\tvar field = this,","\t\tschema = this.list.schema;","","\tvar paths = this.paths = {","\t\t// fields","\t\tfilename:\t\tthis._path.append('.filename'),","\t\tpath:\t\t\tthis._path.append('.path'),","\t\tsize:\t\t\tthis._path.append('.size'),","\t\tfiletype:\t\tthis._path.append('.filetype'),","\t\turl:\t\t\tthis._path.append('.url'),","\t\tetag:\t\t\tthis._path.append('.etag'),","\t\tcontainer:\t\tthis._path.append('.container'),","\t\t// virtuals","\t\texists:\t\t\tthis._path.append('.exists'),","\t\tupload:\t\t\tthis._path.append('_upload'),","\t\taction:\t\t\tthis._path.append('_action')","\t};","","\tvar schemaPaths = this._path.addTo({}, {","\t\tfilename:\t\tString,","\t\tpath:\t\t\tString,","\t\tsize:\t\t\tNumber,","\t\tfiletype:\t\tString,","\t\turl:\t\t\tString,","\t\tetag: \t\t\tString,","\t\tcontainer:\t\tString","\t});","","\tschema.add(schemaPaths);","","\tvar exists = function(item) {","\t\treturn (item.get(paths.url) ? true : false);","\t};","","\t// The .exists virtual indicates whether a file is stored","\tschema.virtual(paths.exists).get(function() {","\t\treturn schemaMethods.exists.apply(this);","\t});","","\tvar reset = function(item) {","\t\titem.set(field.path, {","\t\t\tfilename: '',","\t\t\tpath: '',","\t\t\tsize: 0,","\t\t\tfiletype: '',","\t\t\turl: ''","\t\t});","\t};","","\tvar schemaMethods = {","\t\texists: function() {","\t\t\treturn exists(this);","\t\t},","\t\t/**","\t\t * Resets the value of the field","\t\t *","\t\t * @api public","\t\t */","\t\treset: function() {","\t\t\ttry {","\t\t\t\tazure.createBlobService().deleteBlob(this.get(paths.container), this.get(paths.filename), function() {});","\t\t\t} catch(e) {}//eslint-disable-line no-empty","\t\t\treset(this);","\t\t},","\t\t/**","\t\t * Deletes the file from AzureFile and resets the field","\t\t *","\t\t * @api public","\t\t */","\t\tdelete: function() {","\t\t\ttry {","\t\t\t\tazure.createBlobService().blobService.deleteBlob(this.get(paths.container), this.get(paths.filename), function() {});","\t\t\t} catch(e) {}//eslint-disable-line no-empty","\t\t\treset(this);","\t\t}","\t};","","\t_.each(schemaMethods, function(fn, key) {","\t\tfield.underscoreMethod(key, fn);","\t});","","\t// expose a method on the field to call schema methods","\tthis.apply = function(item, method) {","\t\treturn schemaMethods[method].apply(item, Array.prototype.slice.call(arguments, 2));","\t};","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","azurefile.prototype.format = function(item) {","\treturn item.get(this.paths.url);","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","azurefile.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.url);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","azurefile.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO - how should file field input be validated?","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","azurefile.prototype.updateItem = function(item, data) {//eslint-disable-line no-unused-vars","\t// TODO - direct updating of data (not via upload)","};","","","/**"," * Uploads the file for this field"," *"," * @api public"," */","","azurefile.prototype.uploadFile = function(item, file, update, callback) {","","\tvar field = this,","\t\tprefix = field.options.datePrefix ? moment().format(field.options.datePrefix) + '-' : '',//eslint-disable-line no-unused-vars","\t\tfiletype = file.mimetype || file.type;","","\tif (field.options.allowedTypes && !_.contains(field.options.allowedTypes, filetype)) {","\t\treturn callback(new Error('Unsupported File Type: ' + filetype));","\t}","","\tif ('function' === typeof update) {","\t\tcallback = update;","\t\tupdate = false;","\t}","","\tvar doUpload = function() {","\t\tvar blobService = azure.createBlobService();","\t\tvar container = field.options.containerFormatter(item, file.name);","","\t\tblobService.createContainerIfNotExists(container, { publicAccessLevel : 'blob' }, function(err) {","\t\t\t","\t\t\tif (err) return callback(err);","","\t\t\tblobService.createBlockBlobFromLocalFile(container, field.options.filenameFormatter(item, file.name), file.path, function(err, blob, res) {//eslint-disable-line no-unused-vars","","\t\t\t\tif (err) return callback(err);","\t\t\t","\t\t\t\tvar fileData = {","\t\t\t\t\tfilename: blob.blob,","\t\t\t\t\tsize: file.size,","\t\t\t\t\tfiletype: filetype,","\t\t\t\t\tetag: blob.etag,","\t\t\t\t\tcontainer: container,","\t\t\t\t\turl: 'http://' + field.azurefileconfig.account + '.blob.core.windows.net/' + container + '/' + blob.blob","\t\t\t\t};","","\t\t\t\tif (update) {","\t\t\t\t\titem.set(field.path, fileData);","\t\t\t\t}","","\t\t\t\tcallback(null, fileData);","\t\t\t\t\t","\t\t\t});","\t\t});","\t};","","\tthis.callHook('pre:upload', item, file, function(err) {","\t\tif (err) return callback(err);","\t\tdoUpload();","\t});","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Expected form parts are"," * - `field.paths.action` in `req.body` (`clear` or `delete`)"," * - `field.paths.upload` in `req.files` (uploads the file to s3file)"," *"," * @api public"," */","","azurefile.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","\t\tif (req.body) {","\t\t\tvar action = req.body[paths.action];","","\t\t\tif (/^(delete|reset)$/.test(action)) {","\t\t\t\tfield.apply(item, action);","\t\t\t}","\t\t}","","\t\tif (req.files && req.files[paths.upload] && req.files[paths.upload].size) {","\t\t\treturn field.uploadFile(item, req.files[paths.upload], true, callback);","\t\t}","","\t\treturn callback();","","\t};","","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","azurefile.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/*!"," * Export class"," */","","exports = module.exports = azurefile;",""],"l":{"5":1,"21":1,"22":0,"25":0,"26":0,"29":0,"32":0,"33":0,"36":0,"39":0,"40":0,"45":0,"46":0,"48":0,"50":0,"51":0,"52":0,"55":0,"56":0,"65":1,"71":1,"73":0,"84":1,"86":0,"89":0,"104":0,"114":0,"116":0,"117":0,"121":0,"122":0,"125":0,"126":0,"135":0,"137":0,"145":0,"146":0,"148":0,"156":0,"157":0,"159":0,"163":0,"164":0,"168":0,"169":0,"172":0,"182":1,"183":0,"193":1,"194":0,"204":1,"206":0,"216":1,"227":1,"229":0,"233":0,"234":0,"237":0,"238":0,"239":0,"242":0,"243":0,"244":0,"246":0,"248":0,"250":0,"252":0,"254":0,"263":0,"264":0,"267":0,"273":0,"274":0,"275":0,"290":1,"292":0,"294":0,"295":0,"296":0,"297":0,"298":0,"301":0,"303":0,"304":0,"305":0,"307":0,"308":0,"312":0,"313":0,"316":0,"329":1,"330":0,"338":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/boolean/BooleanType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/boolean/BooleanType.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":0,"18":0,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"boolean","line":9,"loc":{"start":{"line":9,"column":0},"end":{"line":9,"column":38}}},"2":{"name":"(anonymous_2)","line":21,"loc":{"start":{"line":21,"column":37},"end":{"line":21,"column":61}}},"3":{"name":"(anonymous_3)","line":35,"loc":{"start":{"line":35,"column":34},"end":{"line":35,"column":59}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":31},"end":{"line":48,"column":52}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":27}},"3":{"start":{"line":9,"column":0},"end":{"line":15,"column":1}},"4":{"start":{"line":10,"column":1},"end":{"line":10,"column":28}},"5":{"start":{"line":11,"column":1},"end":{"line":11,"column":31}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":26}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":47}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":48}},"9":{"start":{"line":16,"column":0},"end":{"line":16,"column":34}},"10":{"start":{"line":21,"column":0},"end":{"line":29,"column":2}},"11":{"start":{"line":22,"column":1},"end":{"line":22,"column":21}},"12":{"start":{"line":23,"column":1},"end":{"line":27,"column":2}},"13":{"start":{"line":24,"column":2},"end":{"line":24,"column":35}},"14":{"start":{"line":26,"column":2},"end":{"line":26,"column":26}},"15":{"start":{"line":28,"column":1},"end":{"line":28,"column":14}},"16":{"start":{"line":35,"column":0},"end":{"line":41,"column":2}},"17":{"start":{"line":36,"column":1},"end":{"line":40,"column":2}},"18":{"start":{"line":37,"column":2},"end":{"line":37,"column":81}},"19":{"start":{"line":39,"column":2},"end":{"line":39,"column":14}},"20":{"start":{"line":48,"column":0},"end":{"line":57,"column":2}},"21":{"start":{"line":49,"column":1},"end":{"line":49,"column":41}},"22":{"start":{"line":50,"column":1},"end":{"line":56,"column":2}},"23":{"start":{"line":51,"column":2},"end":{"line":53,"column":3}},"24":{"start":{"line":52,"column":3},"end":{"line":52,"column":30}},"25":{"start":{"line":54,"column":8},"end":{"line":56,"column":2}},"26":{"start":{"line":55,"column":2},"end":{"line":55,"column":28}},"27":{"start":{"line":60,"column":0},"end":{"line":60,"column":35}}},"branchMap":{"1":{"line":13,"type":"cond-expr","locations":[{"start":{"line":13,"column":34},"end":{"line":13,"column":38}},{"start":{"line":13,"column":41},"end":{"line":13,"column":46}}]},"2":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":9},"end":{"line":22,"column":14}},{"start":{"line":22,"column":18},"end":{"line":22,"column":20}}]},"3":{"line":23,"type":"if","locations":[{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},{"start":{"line":23,"column":1},"end":{"line":23,"column":1}}]},"4":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":5},"end":{"line":23,"column":18}},{"start":{"line":23,"column":22},"end":{"line":23,"column":46}}]},"5":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},{"start":{"line":36,"column":1},"end":{"line":36,"column":1}}]},"6":{"line":37,"type":"cond-expr","locations":[{"start":{"line":37,"column":68},"end":{"line":37,"column":72}},{"start":{"line":37,"column":75},"end":{"line":37,"column":80}}]},"7":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":10},"end":{"line":37,"column":34}},{"start":{"line":37,"column":38},"end":{"line":37,"column":64}}]},"8":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},{"start":{"line":50,"column":1},"end":{"line":50,"column":1}}]},"9":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":5},"end":{"line":50,"column":11}},{"start":{"line":50,"column":15},"end":{"line":50,"column":32}}]},"10":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":2},"end":{"line":51,"column":2}},{"start":{"line":51,"column":2},"end":{"line":51,"column":2}}]},"11":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":8},"end":{"line":54,"column":8}},{"start":{"line":54,"column":8},"end":{"line":54,"column":8}}]}},"code":["var FieldType = require('../Type');","var util = require('util');","","/**"," * Boolean FieldType Constructor"," * @extends Field"," * @api public"," */","function boolean(list, path, options) {","\tthis._nativeType = Boolean;","\tthis._properties = ['indent'];","\tthis._fixedSize = 'full';","\tthis.indent = (options.indent) ? true : false;","\tboolean.super_.call(this, list, path, options);","}","util.inherits(boolean, FieldType);","","/**"," * Add filters to a query"," */","boolean.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tif (!filter.value || filter.value === 'false') {","\t\tquery[this.path] = { $ne: true };","\t} else {","\t\tquery[this.path] = true;","\t}","\treturn query;","};","","/**"," * Validates that a truthy value for this field has been provided in a data object."," * Useful for checkboxes that are required to be true (e.g. agreed to terms and cond's)"," */","boolean.prototype.validateInput = function(data, required) {","\tif (required) {","\t\treturn (data[this.path] === true || data[this.path] === 'true') ? true : false;","\t} else {","\t\treturn true;","\t}","};","","/**"," * Updates the value for this field in the item from a data object."," * Only updates the value if it has changed."," * Treats a falsy value or the string \"false\" as false, everything else as true."," */","boolean.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\tif (!value || value === 'false') {","\t\tif (item.get(this.path) !== false) {","\t\t\titem.set(this.path, false);","\t\t}","\t} else if (!item.get(this.path)) {","\t\titem.set(this.path, true);","\t}","};","","/* Export Field Type */","exports = module.exports = boolean;",""],"l":{"1":1,"2":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"16":1,"21":1,"22":0,"23":0,"24":0,"26":0,"28":0,"35":1,"36":0,"37":0,"39":0,"48":1,"49":0,"50":0,"51":0,"52":0,"54":0,"55":0,"60":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/cloudinaryimage/CloudinaryImageType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/cloudinaryimage/CloudinaryImageType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":1,"86":0,"87":1,"88":0,"89":1,"90":0,"91":1,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":1,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":1,"152":0,"153":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},"fnMap":{"1":{"name":"cloudinaryimage","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":46}}},"2":{"name":"(anonymous_2)","line":62,"loc":{"start":{"line":62,"column":40},"end":{"line":62,"column":51}}},"3":{"name":"(anonymous_3)","line":101,"loc":{"start":{"line":101,"column":14},"end":{"line":101,"column":29}}},"4":{"name":"(anonymous_4)","line":106,"loc":{"start":{"line":106,"column":34},"end":{"line":106,"column":45}}},"5":{"name":"(anonymous_5)","line":110,"loc":{"start":{"line":110,"column":14},"end":{"line":110,"column":29}}},"6":{"name":"(anonymous_6)","line":128,"loc":{"start":{"line":128,"column":34},"end":{"line":128,"column":45}}},"7":{"name":"(anonymous_7)","line":132,"loc":{"start":{"line":132,"column":11},"end":{"line":132,"column":35}}},"8":{"name":"(anonymous_8)","line":158,"loc":{"start":{"line":158,"column":13},"end":{"line":158,"column":28}}},"9":{"name":"(anonymous_9)","line":172,"loc":{"start":{"line":172,"column":15},"end":{"line":172,"column":55}}},"10":{"name":"(anonymous_10)","line":182,"loc":{"start":{"line":182,"column":10},"end":{"line":182,"column":21}}},"11":{"name":"(anonymous_11)","line":185,"loc":{"start":{"line":185,"column":10},"end":{"line":185,"column":21}}},"12":{"name":"(anonymous_12)","line":188,"loc":{"start":{"line":188,"column":7},"end":{"line":188,"column":25}}},"13":{"name":"(anonymous_13)","line":191,"loc":{"start":{"line":191,"column":7},"end":{"line":191,"column":25}}},"14":{"name":"(anonymous_14)","line":194,"loc":{"start":{"line":194,"column":9},"end":{"line":194,"column":42}}},"15":{"name":"(anonymous_15)","line":197,"loc":{"start":{"line":197,"column":8},"end":{"line":197,"column":41}}},"16":{"name":"(anonymous_16)","line":200,"loc":{"start":{"line":200,"column":9},"end":{"line":200,"column":42}}},"17":{"name":"(anonymous_17)","line":203,"loc":{"start":{"line":203,"column":7},"end":{"line":203,"column":40}}},"18":{"name":"(anonymous_18)","line":206,"loc":{"start":{"line":206,"column":9},"end":{"line":206,"column":42}}},"19":{"name":"(anonymous_19)","line":209,"loc":{"start":{"line":209,"column":7},"end":{"line":209,"column":40}}},"20":{"name":"(anonymous_20)","line":212,"loc":{"start":{"line":212,"column":8},"end":{"line":212,"column":41}}},"21":{"name":"(anonymous_21)","line":215,"loc":{"start":{"line":215,"column":8},"end":{"line":215,"column":41}}},"22":{"name":"(anonymous_22)","line":218,"loc":{"start":{"line":218,"column":13},"end":{"line":218,"column":46}}},"23":{"name":"(anonymous_23)","line":226,"loc":{"start":{"line":226,"column":9},"end":{"line":226,"column":20}}},"24":{"name":"(anonymous_24)","line":234,"loc":{"start":{"line":234,"column":10},"end":{"line":234,"column":21}}},"25":{"name":"(anonymous_25)","line":237,"loc":{"start":{"line":237,"column":58},"end":{"line":237,"column":75}}},"26":{"name":"(anonymous_26)","line":249,"loc":{"start":{"line":249,"column":10},"end":{"line":249,"column":34}}},"27":{"name":"(anonymous_27)","line":252,"loc":{"start":{"line":252,"column":36},"end":{"line":252,"column":53}}},"28":{"name":"(anonymous_28)","line":260,"loc":{"start":{"line":260,"column":23},"end":{"line":260,"column":41}}},"29":{"name":"(anonymous_29)","line":265,"loc":{"start":{"line":265,"column":14},"end":{"line":265,"column":37}}},"30":{"name":"(anonymous_30)","line":279,"loc":{"start":{"line":279,"column":35},"end":{"line":279,"column":50}}},"31":{"name":"(anonymous_31)","line":290,"loc":{"start":{"line":290,"column":39},"end":{"line":290,"column":54}}},"32":{"name":"(anonymous_32)","line":301,"loc":{"start":{"line":301,"column":42},"end":{"line":301,"column":57}}},"33":{"name":"(anonymous_33)","line":313,"loc":{"start":{"line":313,"column":39},"end":{"line":313,"column":60}}},"34":{"name":"(anonymous_34)","line":316,"loc":{"start":{"line":316,"column":16},"end":{"line":316,"column":30}}},"35":{"name":"(anonymous_35)","line":342,"loc":{"start":{"line":342,"column":46},"end":{"line":342,"column":83}}},"36":{"name":"(anonymous_36)","line":353,"loc":{"start":{"line":353,"column":24},"end":{"line":353,"column":35}}},"37":{"name":"(anonymous_37)","line":355,"loc":{"start":{"line":355,"column":8},"end":{"line":355,"column":19}}},"38":{"name":"(anonymous_38)","line":367,"loc":{"start":{"line":367,"column":51},"end":{"line":367,"column":68}}},"39":{"name":"(anonymous_39)","line":416,"loc":{"start":{"line":416,"column":24},"end":{"line":416,"column":41}}},"40":{"name":"(anonymous_40)","line":431,"loc":{"start":{"line":431,"column":26},"end":{"line":431,"column":43}}},"41":{"name":"(anonymous_41)","line":455,"loc":{"start":{"line":455,"column":42},"end":{"line":455,"column":79}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":11,"column":29}},"2":{"start":{"line":19,"column":0},"end":{"line":47,"column":1}},"3":{"start":{"line":21,"column":1},"end":{"line":21,"column":38}},"4":{"start":{"line":22,"column":1},"end":{"line":22,"column":26}},"5":{"start":{"line":23,"column":1},"end":{"line":23,"column":106}},"6":{"start":{"line":26,"column":1},"end":{"line":26,"column":25}},"7":{"start":{"line":29,"column":1},"end":{"line":34,"column":2}},"8":{"start":{"line":30,"column":2},"end":{"line":33,"column":4}},"9":{"start":{"line":36,"column":1},"end":{"line":36,"column":56}},"10":{"start":{"line":39,"column":1},"end":{"line":45,"column":2}},"11":{"start":{"line":40,"column":2},"end":{"line":44,"column":4}},"12":{"start":{"line":53,"column":0},"end":{"line":53,"column":39}},"13":{"start":{"line":62,"column":0},"end":{"line":270,"column":2}},"14":{"start":{"line":64,"column":1},"end":{"line":65,"column":28}},"15":{"start":{"line":67,"column":1},"end":{"line":85,"column":3}},"16":{"start":{"line":87,"column":1},"end":{"line":97,"column":4}},"17":{"start":{"line":99,"column":1},"end":{"line":99,"column":25}},"18":{"start":{"line":101,"column":1},"end":{"line":103,"column":3}},"19":{"start":{"line":102,"column":2},"end":{"line":102,"column":52}},"20":{"start":{"line":106,"column":1},"end":{"line":108,"column":4}},"21":{"start":{"line":107,"column":2},"end":{"line":107,"column":42}},"22":{"start":{"line":110,"column":1},"end":{"line":125,"column":3}},"23":{"start":{"line":111,"column":2},"end":{"line":111,"column":25}},"24":{"start":{"line":113,"column":2},"end":{"line":122,"column":3}},"25":{"start":{"line":114,"column":3},"end":{"line":121,"column":4}},"26":{"start":{"line":115,"column":4},"end":{"line":115,"column":39}},"27":{"start":{"line":117,"column":4},"end":{"line":117,"column":98}},"28":{"start":{"line":118,"column":4},"end":{"line":118,"column":37}},"29":{"start":{"line":119,"column":4},"end":{"line":119,"column":32}},"30":{"start":{"line":120,"column":4},"end":{"line":120,"column":39}},"31":{"start":{"line":124,"column":2},"end":{"line":124,"column":21}},"32":{"start":{"line":128,"column":1},"end":{"line":130,"column":4}},"33":{"start":{"line":129,"column":2},"end":{"line":129,"column":42}},"34":{"start":{"line":132,"column":1},"end":{"line":156,"column":3}},"35":{"start":{"line":134,"column":2},"end":{"line":136,"column":3}},"36":{"start":{"line":135,"column":3},"end":{"line":135,"column":13}},"37":{"start":{"line":138,"column":2},"end":{"line":138,"column":57}},"38":{"start":{"line":140,"column":2},"end":{"line":142,"column":3}},"39":{"start":{"line":141,"column":3},"end":{"line":141,"column":33}},"40":{"start":{"line":144,"column":2},"end":{"line":146,"column":3}},"41":{"start":{"line":145,"column":3},"end":{"line":145,"column":30}},"42":{"start":{"line":148,"column":2},"end":{"line":150,"column":3}},"43":{"start":{"line":149,"column":3},"end":{"line":149,"column":25}},"44":{"start":{"line":152,"column":2},"end":{"line":152,"column":44}},"45":{"start":{"line":154,"column":2},"end":{"line":154,"column":91}},"46":{"start":{"line":158,"column":1},"end":{"line":170,"column":3}},"47":{"start":{"line":159,"column":2},"end":{"line":169,"column":5}},"48":{"start":{"line":172,"column":1},"end":{"line":179,"column":3}},"49":{"start":{"line":173,"column":2},"end":{"line":173,"column":35}},"50":{"start":{"line":173,"column":13},"end":{"line":173,"column":35}},"51":{"start":{"line":174,"column":2},"end":{"line":174,"column":38}},"52":{"start":{"line":174,"column":14},"end":{"line":174,"column":38}},"53":{"start":{"line":175,"column":2},"end":{"line":177,"column":3}},"54":{"start":{"line":176,"column":3},"end":{"line":176,"column":28}},"55":{"start":{"line":178,"column":2},"end":{"line":178,"column":17}},"56":{"start":{"line":181,"column":1},"end":{"line":258,"column":3}},"57":{"start":{"line":183,"column":3},"end":{"line":183,"column":23}},"58":{"start":{"line":186,"column":3},"end":{"line":186,"column":23}},"59":{"start":{"line":189,"column":3},"end":{"line":189,"column":29}},"60":{"start":{"line":192,"column":3},"end":{"line":192,"column":78}},"61":{"start":{"line":195,"column":3},"end":{"line":195,"column":72}},"62":{"start":{"line":198,"column":3},"end":{"line":198,"column":89}},"63":{"start":{"line":201,"column":3},"end":{"line":201,"column":90}},"64":{"start":{"line":204,"column":3},"end":{"line":204,"column":70}},"65":{"start":{"line":207,"column":3},"end":{"line":207,"column":72}},"66":{"start":{"line":210,"column":3},"end":{"line":210,"column":70}},"67":{"start":{"line":213,"column":3},"end":{"line":213,"column":71}},"68":{"start":{"line":216,"column":3},"end":{"line":216,"column":89}},"69":{"start":{"line":219,"column":3},"end":{"line":219,"column":90}},"70":{"start":{"line":227,"column":3},"end":{"line":227,"column":15}},"71":{"start":{"line":235,"column":3},"end":{"line":235,"column":32}},"72":{"start":{"line":237,"column":3},"end":{"line":239,"column":6}},"73":{"start":{"line":238,"column":4},"end":{"line":238,"column":28}},"74":{"start":{"line":240,"column":3},"end":{"line":240,"column":15}},"75":{"start":{"line":242,"column":3},"end":{"line":242,"column":18}},"76":{"start":{"line":250,"column":3},"end":{"line":250,"column":32}},"77":{"start":{"line":252,"column":3},"end":{"line":254,"column":15}},"78":{"start":{"line":253,"column":4},"end":{"line":253,"column":28}},"79":{"start":{"line":256,"column":3},"end":{"line":256,"column":18}},"80":{"start":{"line":260,"column":1},"end":{"line":262,"column":4}},"81":{"start":{"line":261,"column":2},"end":{"line":261,"column":34}},"82":{"start":{"line":265,"column":1},"end":{"line":267,"column":3}},"83":{"start":{"line":266,"column":2},"end":{"line":266,"column":85}},"84":{"start":{"line":269,"column":1},"end":{"line":269,"column":30}},"85":{"start":{"line":279,"column":0},"end":{"line":281,"column":2}},"86":{"start":{"line":280,"column":1},"end":{"line":280,"column":33}},"87":{"start":{"line":290,"column":0},"end":{"line":292,"column":2}},"88":{"start":{"line":291,"column":1},"end":{"line":291,"column":40}},"89":{"start":{"line":301,"column":0},"end":{"line":304,"column":2}},"90":{"start":{"line":303,"column":1},"end":{"line":303,"column":13}},"91":{"start":{"line":313,"column":0},"end":{"line":329,"column":2}},"92":{"start":{"line":314,"column":1},"end":{"line":314,"column":24}},"93":{"start":{"line":316,"column":1},"end":{"line":326,"column":3}},"94":{"start":{"line":317,"column":2},"end":{"line":325,"column":3}},"95":{"start":{"line":318,"column":3},"end":{"line":318,"column":39}},"96":{"start":{"line":319,"column":3},"end":{"line":319,"column":43}},"97":{"start":{"line":322,"column":3},"end":{"line":324,"column":4}},"98":{"start":{"line":323,"column":4},"end":{"line":323,"column":51}},"99":{"start":{"line":328,"column":1},"end":{"line":328,"column":124}},"100":{"start":{"line":342,"column":0},"end":{"line":446,"column":2}},"101":{"start":{"line":344,"column":1},"end":{"line":344,"column":18}},"102":{"start":{"line":346,"column":1},"end":{"line":351,"column":2}},"103":{"start":{"line":347,"column":2},"end":{"line":347,"column":19}},"104":{"start":{"line":348,"column":2},"end":{"line":348,"column":22}},"105":{"start":{"line":349,"column":8},"end":{"line":351,"column":2}},"106":{"start":{"line":350,"column":2},"end":{"line":350,"column":22}},"107":{"start":{"line":353,"column":1},"end":{"line":353,"column":38}},"108":{"start":{"line":355,"column":1},"end":{"line":444,"column":3}},"109":{"start":{"line":357,"column":2},"end":{"line":363,"column":3}},"110":{"start":{"line":358,"column":3},"end":{"line":358,"column":39}},"111":{"start":{"line":360,"column":3},"end":{"line":362,"column":4}},"112":{"start":{"line":361,"column":4},"end":{"line":361,"column":30}},"113":{"start":{"line":365,"column":2},"end":{"line":442,"column":3}},"114":{"start":{"line":367,"column":3},"end":{"line":374,"column":6}},"115":{"start":{"line":368,"column":4},"end":{"line":373,"column":5}},"116":{"start":{"line":369,"column":5},"end":{"line":369,"column":28}},"117":{"start":{"line":371,"column":5},"end":{"line":371,"column":34}},"118":{"start":{"line":372,"column":5},"end":{"line":372,"column":16}},"119":{"start":{"line":376,"column":9},"end":{"line":442,"column":3}},"120":{"start":{"line":378,"column":3},"end":{"line":378,"column":52}},"121":{"start":{"line":379,"column":3},"end":{"line":379,"column":19}},"122":{"start":{"line":381,"column":3},"end":{"line":383,"column":4}},"123":{"start":{"line":382,"column":4},"end":{"line":382,"column":14}},"124":{"start":{"line":385,"column":3},"end":{"line":387,"column":5}},"125":{"start":{"line":389,"column":3},"end":{"line":391,"column":4}},"126":{"start":{"line":390,"column":4},"end":{"line":390,"column":50}},"127":{"start":{"line":393,"column":3},"end":{"line":395,"column":4}},"128":{"start":{"line":394,"column":4},"end":{"line":394,"column":63}},"129":{"start":{"line":397,"column":3},"end":{"line":399,"column":4}},"130":{"start":{"line":398,"column":4},"end":{"line":398,"column":40}},"131":{"start":{"line":401,"column":3},"end":{"line":408,"column":4}},"132":{"start":{"line":402,"column":4},"end":{"line":402,"column":57}},"133":{"start":{"line":403,"column":4},"end":{"line":405,"column":5}},"134":{"start":{"line":404,"column":5},"end":{"line":404,"column":45}},"135":{"start":{"line":406,"column":10},"end":{"line":408,"column":4}},"136":{"start":{"line":407,"column":4},"end":{"line":407,"column":135}},"137":{"start":{"line":410,"column":3},"end":{"line":413,"column":4}},"138":{"start":{"line":412,"column":4},"end":{"line":412,"column":46}},"139":{"start":{"line":416,"column":3},"end":{"line":423,"column":5}},"140":{"start":{"line":417,"column":4},"end":{"line":422,"column":5}},"141":{"start":{"line":418,"column":5},"end":{"line":418,"column":28}},"142":{"start":{"line":420,"column":5},"end":{"line":420,"column":34}},"143":{"start":{"line":421,"column":5},"end":{"line":421,"column":16}},"144":{"start":{"line":426,"column":3},"end":{"line":438,"column":4}},"145":{"start":{"line":427,"column":4},"end":{"line":427,"column":103}},"146":{"start":{"line":431,"column":4},"end":{"line":437,"column":7}},"147":{"start":{"line":432,"column":5},"end":{"line":436,"column":6}},"148":{"start":{"line":433,"column":6},"end":{"line":433,"column":29}},"149":{"start":{"line":435,"column":6},"end":{"line":435,"column":105}},"150":{"start":{"line":441,"column":3},"end":{"line":441,"column":14}},"151":{"start":{"line":455,"column":0},"end":{"line":457,"column":2}},"152":{"start":{"line":456,"column":1},"end":{"line":456,"column":54}},"153":{"start":{"line":464,"column":0},"end":{"line":464,"column":43}}},"branchMap":{"1":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},{"start":{"line":29,"column":1},"end":{"line":29,"column":1}}]},"2":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},{"start":{"line":39,"column":1},"end":{"line":39,"column":1}}]},"3":{"line":102,"type":"cond-expr","locations":[{"start":{"line":102,"column":38},"end":{"line":102,"column":42}},{"start":{"line":102,"column":45},"end":{"line":102,"column":50}}]},"4":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":2},"end":{"line":113,"column":2}},{"start":{"line":113,"column":2},"end":{"line":113,"column":2}}]},"5":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":3},"end":{"line":114,"column":3}},{"start":{"line":114,"column":3},"end":{"line":114,"column":3}}]},"6":{"line":117,"type":"cond-expr","locations":[{"start":{"line":117,"column":57},"end":{"line":117,"column":92}},{"start":{"line":117,"column":95},"end":{"line":117,"column":97}}]},"7":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":2},"end":{"line":134,"column":2}},{"start":{"line":134,"column":2},"end":{"line":134,"column":2}}]},"8":{"line":138,"type":"cond-expr","locations":[{"start":{"line":138,"column":44},"end":{"line":138,"column":51}},{"start":{"line":138,"column":54},"end":{"line":138,"column":56}}]},"9":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":2},"end":{"line":140,"column":2}},{"start":{"line":140,"column":2},"end":{"line":140,"column":2}}]},"10":{"line":140,"type":"binary-expr","locations":[{"start":{"line":140,"column":6},"end":{"line":140,"column":34}},{"start":{"line":140,"column":38},"end":{"line":140,"column":79}}]},"11":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":2},"end":{"line":144,"column":2}},{"start":{"line":144,"column":2},"end":{"line":144,"column":2}}]},"12":{"line":144,"type":"binary-expr","locations":[{"start":{"line":144,"column":6},"end":{"line":144,"column":33}},{"start":{"line":144,"column":37},"end":{"line":144,"column":85}}]},"13":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":2},"end":{"line":148,"column":2}},{"start":{"line":148,"column":2},"end":{"line":148,"column":2}}]},"14":{"line":148,"type":"binary-expr","locations":[{"start":{"line":148,"column":6},"end":{"line":148,"column":28}},{"start":{"line":148,"column":32},"end":{"line":148,"column":65}}]},"15":{"line":173,"type":"if","locations":[{"start":{"line":173,"column":2},"end":{"line":173,"column":2}},{"start":{"line":173,"column":2},"end":{"line":173,"column":2}}]},"16":{"line":174,"type":"if","locations":[{"start":{"line":174,"column":2},"end":{"line":174,"column":2}},{"start":{"line":174,"column":2},"end":{"line":174,"column":2}}]},"17":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":2},"end":{"line":175,"column":2}},{"start":{"line":175,"column":2},"end":{"line":175,"column":2}}]},"18":{"line":192,"type":"cond-expr","locations":[{"start":{"line":192,"column":25},"end":{"line":192,"column":72}},{"start":{"line":192,"column":75},"end":{"line":192,"column":77}}]},"19":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":2},"end":{"line":317,"column":2}},{"start":{"line":317,"column":2},"end":{"line":317,"column":2}}]},"20":{"line":322,"type":"if","locations":[{"start":{"line":322,"column":3},"end":{"line":322,"column":3}},{"start":{"line":322,"column":3},"end":{"line":322,"column":3}}]},"21":{"line":322,"type":"binary-expr","locations":[{"start":{"line":322,"column":7},"end":{"line":322,"column":18}},{"start":{"line":322,"column":22},"end":{"line":322,"column":38}},{"start":{"line":322,"column":42},"end":{"line":322,"column":82}}]},"22":{"line":323,"type":"binary-expr","locations":[{"start":{"line":323,"column":25},"end":{"line":323,"column":41}},{"start":{"line":323,"column":45},"end":{"line":323,"column":49}}]},"23":{"line":346,"type":"if","locations":[{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},{"start":{"line":346,"column":1},"end":{"line":346,"column":1}}]},"24":{"line":349,"type":"if","locations":[{"start":{"line":349,"column":8},"end":{"line":349,"column":8}},{"start":{"line":349,"column":8},"end":{"line":349,"column":8}}]},"25":{"line":353,"type":"binary-expr","locations":[{"start":{"line":353,"column":12},"end":{"line":353,"column":20}},{"start":{"line":353,"column":24},"end":{"line":353,"column":37}}]},"26":{"line":357,"type":"if","locations":[{"start":{"line":357,"column":2},"end":{"line":357,"column":2}},{"start":{"line":357,"column":2},"end":{"line":357,"column":2}}]},"27":{"line":360,"type":"if","locations":[{"start":{"line":360,"column":3},"end":{"line":360,"column":3}},{"start":{"line":360,"column":3},"end":{"line":360,"column":3}}]},"28":{"line":365,"type":"if","locations":[{"start":{"line":365,"column":2},"end":{"line":365,"column":2}},{"start":{"line":365,"column":2},"end":{"line":365,"column":2}}]},"29":{"line":365,"type":"binary-expr","locations":[{"start":{"line":365,"column":6},"end":{"line":365,"column":14}},{"start":{"line":365,"column":18},"end":{"line":365,"column":40}}]},"30":{"line":368,"type":"if","locations":[{"start":{"line":368,"column":4},"end":{"line":368,"column":4}},{"start":{"line":368,"column":4},"end":{"line":368,"column":4}}]},"31":{"line":376,"type":"if","locations":[{"start":{"line":376,"column":9},"end":{"line":376,"column":9}},{"start":{"line":376,"column":9},"end":{"line":376,"column":9}}]},"32":{"line":376,"type":"binary-expr","locations":[{"start":{"line":376,"column":13},"end":{"line":376,"column":22}},{"start":{"line":376,"column":26},"end":{"line":376,"column":49}},{"start":{"line":376,"column":53},"end":{"line":376,"column":81}}]},"33":{"line":378,"type":"binary-expr","locations":[{"start":{"line":378,"column":12},"end":{"line":378,"column":45}},{"start":{"line":378,"column":49},"end":{"line":378,"column":51}}]},"34":{"line":381,"type":"if","locations":[{"start":{"line":381,"column":3},"end":{"line":381,"column":3}},{"start":{"line":381,"column":3},"end":{"line":381,"column":3}}]},"35":{"line":389,"type":"if","locations":[{"start":{"line":389,"column":3},"end":{"line":389,"column":3}},{"start":{"line":389,"column":3},"end":{"line":389,"column":3}}]},"36":{"line":393,"type":"if","locations":[{"start":{"line":393,"column":3},"end":{"line":393,"column":3}},{"start":{"line":393,"column":3},"end":{"line":393,"column":3}}]},"37":{"line":397,"type":"if","locations":[{"start":{"line":397,"column":3},"end":{"line":397,"column":3}},{"start":{"line":397,"column":3},"end":{"line":397,"column":3}}]},"38":{"line":401,"type":"if","locations":[{"start":{"line":401,"column":3},"end":{"line":401,"column":3}},{"start":{"line":401,"column":3},"end":{"line":401,"column":3}}]},"39":{"line":403,"type":"if","locations":[{"start":{"line":403,"column":4},"end":{"line":403,"column":4}},{"start":{"line":403,"column":4},"end":{"line":403,"column":4}}]},"40":{"line":406,"type":"if","locations":[{"start":{"line":406,"column":10},"end":{"line":406,"column":10}},{"start":{"line":406,"column":10},"end":{"line":406,"column":10}}]},"41":{"line":410,"type":"if","locations":[{"start":{"line":410,"column":3},"end":{"line":410,"column":3}},{"start":{"line":410,"column":3},"end":{"line":410,"column":3}}]},"42":{"line":410,"type":"binary-expr","locations":[{"start":{"line":410,"column":7},"end":{"line":410,"column":32}},{"start":{"line":410,"column":36},"end":{"line":410,"column":64}}]},"43":{"line":417,"type":"if","locations":[{"start":{"line":417,"column":4},"end":{"line":417,"column":4}},{"start":{"line":417,"column":4},"end":{"line":417,"column":4}}]},"44":{"line":426,"type":"if","locations":[{"start":{"line":426,"column":3},"end":{"line":426,"column":3}},{"start":{"line":426,"column":3},"end":{"line":426,"column":3}}]},"45":{"line":432,"type":"if","locations":[{"start":{"line":432,"column":5},"end":{"line":432,"column":5}},{"start":{"line":432,"column":5},"end":{"line":432,"column":5}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tkeystone = require('../../../'),","\tutil = require('util'),","\tcloudinary = require('cloudinary'),","\tMPromise = require('mpromise'),","\tutils = require('keystone-utils'),","\tsuper_ = require('../Type');","","/**"," * CloudinaryImage FieldType Constructor"," * @extends Field"," * @api public"," */","","function cloudinaryimage(list, path, options) {","","\tthis._underscoreMethods = ['format'];","\tthis._fixedSize = 'full';","\tthis._properties = ['select', 'selectPrefix', 'autoCleanup', 'publicID', 'folder', 'filenameAsPublicID'];","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","","\t// TODO: implement initial form, usage disabled for now","\tif (options.initial) {","\t\tthrow new Error(","\t\t\t'Invalid Configuration\\n\\n' +","\t\t\t'CloudinaryImage fields (' + list.key + '.' + path + ') do not currently support being used as initial fields.\\n'","\t\t);","\t}","","\tcloudinaryimage.super_.call(this, list, path, options);","","\t// validate cloudinary config","\tif (!keystone.get('cloudinary config')) {","\t\tthrow new Error(","\t\t\t'Invalid Configuration\\n\\n' +","\t\t\t'CloudinaryImage fields (' + list.key + '.' + this.path + ') require the \"cloudinary config\" option to be set.\\n\\n' +","\t\t\t'See http://keystonejs.com/docs/configuration/#services-cloudinary for more information.\\n'","\t\t);","\t}","","}","","/*!"," * Inherit from Field"," */","","util.inherits(cloudinaryimage, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","cloudinaryimage.prototype.addToSchema = function() {","","\tvar field = this,","\t\tschema = this.list.schema;","","\tvar paths = this.paths = {","\t\t// cloudinary fields","\t\tpublic_id: \t\tthis._path.append('.public_id'),","\t\tversion: \t\tthis._path.append('.version'),","\t\tsignature: \t\tthis._path.append('.signature'),","\t\tformat: \t\tthis._path.append('.format'),","\t\tresource_type: \tthis._path.append('.resource_type'),","\t\turl: \t\t\tthis._path.append('.url'),","\t\twidth: \t\t\tthis._path.append('.width'),","\t\theight: \t\tthis._path.append('.height'),","\t\tsecure_url: \tthis._path.append('.secure_url'),","\t\t// virtuals","\t\texists: \t\tthis._path.append('.exists'),","\t\tfolder: \t\tthis._path.append('.folder'),","\t\t// form paths","\t\tupload: \t\tthis._path.append('_upload'),","\t\taction: \t\tthis._path.append('_action'),","\t\tselect: \t\tthis._path.append('_select')","\t};","","\tvar schemaPaths = this._path.addTo({}, {","\t\tpublic_id:\t\tString,","\t\tversion:\t\tNumber,","\t\tsignature:\t\tString,","\t\tformat:\t\t\tString,","\t\tresource_type:\tString,","\t\turl:\t\t\tString,","\t\twidth:\t\t\tNumber,","\t\theight:\t\t\tNumber,","\t\tsecure_url:\t\tString","\t});","","\tschema.add(schemaPaths);","","\tvar exists = function(item) {","\t\treturn (item.get(paths.public_id) ? true : false);","\t};","","\t// The .exists virtual indicates whether an image is stored","\tschema.virtual(paths.exists).get(function() {","\t\treturn schemaMethods.exists.apply(this);","\t});","","\tvar folder = function(item) {//eslint-disable-line no-unused-vars","\t\tvar folderValue = null;","","\t\tif (keystone.get('cloudinary folders')) {","\t\t\tif (field.options.folder) {","\t\t\t\tfolderValue = field.options.folder;","\t\t\t} else {","\t\t\t\tvar folderList = keystone.get('cloudinary prefix') ? [keystone.get('cloudinary prefix')] : [];","\t\t\t\tfolderList.push(field.list.path);","\t\t\t\tfolderList.push(field.path);","\t\t\t\tfolderValue = folderList.join('/');","\t\t\t}","\t\t}","","\t\treturn folderValue;","\t};","","\t// The .folder virtual returns the cloudinary folder used to upload/select images","\tschema.virtual(paths.folder).get(function() {","\t\treturn schemaMethods.folder.apply(this);","\t});","","\tvar src = function(item, options) {","","\t\tif (!exists(item)) {","\t\t\treturn '';","\t\t}","","\t\toptions = ('object' === typeof options) ? options : {};","","\t\tif (!('fetch_format' in options) && keystone.get('cloudinary webp') !== false) {","\t\t\toptions.fetch_format = 'auto';","\t\t}","","\t\tif (!('progressive' in options) && keystone.get('cloudinary progressive') !== false) {","\t\t\toptions.progressive = true;","\t\t}","","\t\tif (!('secure' in options) && keystone.get('cloudinary secure')) {","\t\t\toptions.secure = true;","\t\t}","","\t\toptions.version = item.get(paths.version);","","\t\treturn cloudinary.url(item.get(paths.public_id) + '.' + item.get(paths.format), options);","","\t};","","\tvar reset = function(item) {","\t\titem.set(field.path, {","\t\t\tpublic_id: '',","\t\t\tversion: 0,","\t\t\tsignature: '',","\t\t\tformat: '',","\t\t\tresource_type: '',","\t\t\turl: '',","\t\t\twidth: 0,","\t\t\theight: 0,","\t\t\tsecure_url: ''","\t\t});","\t};","","\tvar addSize = function(options, width, height, other) {","\t\tif (width) options.width = width;","\t\tif (height) options.height = height;","\t\tif ('object' === typeof other) {","\t\t\t_.extend(options, other);","\t\t}","\t\treturn options;","\t};","","\tvar schemaMethods = {","\t\texists: function() {","\t\t\treturn exists(this);","\t\t},","\t\tfolder: function() {","\t\t\treturn folder(this);","\t\t},","\t\tsrc: function(options) {","\t\t\treturn src(this, options);","\t\t},","\t\ttag: function(options) {","\t\t\treturn exists(this) ? cloudinary.image(this.get(field.path), options) : '';","\t\t},","\t\tscale: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'scale' }, width, height, options));","\t\t},","\t\tfill: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'fill', gravity: 'faces' }, width, height, options));","\t\t},","\t\tlfill: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'lfill', gravity: 'faces' }, width, height, options));","\t\t},","\t\tfit: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'fit' }, width, height, options));","\t\t},","\t\tlimit: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'limit' }, width, height, options));","\t\t},","\t\tpad: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'pad' }, width, height, options));","\t\t},","\t\tlpad: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'lpad' }, width, height, options));","\t\t},","\t\tcrop: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'crop', gravity: 'faces' }, width, height, options));","\t\t},","\t\tthumbnail: function(width, height, options) {","\t\t\treturn src(this, addSize({ crop: 'thumb', gravity: 'faces' }, width, height, options));","\t\t},","\t\t/**","\t\t * Resets the value of the field","\t\t *","\t\t * @api public","\t\t */","\t\treset: function() {","\t\t\treset(this);","\t\t},","\t\t/**","\t\t * Deletes the image from Cloudinary and resets the field","\t\t *","\t\t * @api public","\t\t */","\t\tdelete: function() {","\t\t\tvar promise = new MPromise();","","\t\t\tcloudinary.uploader.destroy(this.get(paths.public_id), function(result) {","\t\t\t\tpromise.fulfill(result);","\t\t\t});","\t\t\treset(this);","","\t\t\treturn promise;","\t\t},","\t\t/**","\t\t * Uploads the image to Cloudinary","\t\t *","\t\t * @api public","\t\t */","\t\tupload: function(file, options) {","\t\t\tvar promise = new MPromise();","","\t\t\tcloudinary.uploader.upload(file, function(result) {","\t\t\t\tpromise.fulfill(result);","\t\t\t}, options);","","\t\t\treturn promise;","\t\t}","\t};","","\t_.each(schemaMethods, function(fn, key) {","\t\tfield.underscoreMethod(key, fn);","\t});","","\t// expose a method on the field to call schema methods","\tthis.apply = function(item, method) {","\t\treturn schemaMethods[method].apply(item, Array.prototype.slice.call(arguments, 2));","\t};","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","cloudinaryimage.prototype.format = function(item) {","\treturn item.get(this.paths.url);","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","cloudinaryimage.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.url);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","cloudinaryimage.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO - how should image field input be validated?","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","cloudinaryimage.prototype.updateItem = function(item, data) {","\tvar paths = this.paths;","","\tvar setValue = function(key) {","\t\tif (paths[key]) {","\t\t\tvar index = paths[key].indexOf('.');","\t\t\tvar field = paths[key].substr(0, index);","\t\t\t// Note we allow implicit conversion here so that numbers submitted as strings in the data object","\t\t\t// aren't treated as different values to the stored Number values","\t\t\tif (data[field] && data[field][key] && data[field][key] != item.get(paths[key])) { // eslint-disable-line eqeqeq","\t\t\t\titem.set(paths[key], data[field][key] || null);","\t\t\t}","\t\t}","\t};","","\t_.each(['public_id', 'version', 'signature', 'format', 'resource_type', 'url', 'width', 'height', 'secure_url'], setValue);","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Expected form parts are"," * - `field.paths.action` in `req.body` (`clear` or `delete`)"," * - `field.paths.upload` in `req.files` (uploads the image to cloudinary)"," *"," * @api public"," */","","cloudinaryimage.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","","\t\tif (req.body) {","\t\t\tvar action = req.body[paths.action];","","\t\t\tif (/^(delete|reset)$/.test(action)) {","\t\t\t\tfield.apply(item, action);","\t\t\t}","\t\t}","","\t\tif (req.body && req.body[paths.select]) {","","\t\t\tcloudinary.api.resource(req.body[paths.select], function(result) {","\t\t\t\tif (result.error) {","\t\t\t\t\tcallback(result.error);","\t\t\t\t} else {","\t\t\t\t\titem.set(field.path, result);","\t\t\t\t\tcallback();","\t\t\t\t}","\t\t\t});","","\t\t} else if (req.files && req.files[paths.upload] && req.files[paths.upload].size) {","","\t\t\tvar tp = keystone.get('cloudinary prefix') || '';","\t\t\tvar imageDelete;","","\t\t\tif (tp.length) {","\t\t\t\ttp += '_';","\t\t\t}","","\t\t\tvar uploadOptions = {","\t\t\t\ttags: [tp + field.list.path + '_' + field.path, tp + field.list.path + '_' + field.path + '_' + item.id]","\t\t\t};","","\t\t\tif (keystone.get('cloudinary folders')) {","\t\t\t\tuploadOptions.folder = item.get(paths.folder);","\t\t\t}","","\t\t\tif (keystone.get('cloudinary prefix')) {","\t\t\t\tuploadOptions.tags.push(keystone.get('cloudinary prefix'));","\t\t\t}","","\t\t\tif (keystone.get('env') !== 'production') {","\t\t\t\tuploadOptions.tags.push(tp + 'dev');","\t\t\t}","","\t\t\tif (field.options.publicID) {","\t\t\t\tvar publicIdValue = item.get(field.options.publicID);","\t\t\t\tif (publicIdValue) {","\t\t\t\t\tuploadOptions.public_id = publicIdValue;","\t\t\t\t}","\t\t\t} else if (field.options.filenameAsPublicID) {","\t\t\t\tuploadOptions.public_id = req.files[paths.upload].originalname.substring(0, req.files[paths.upload].originalname.lastIndexOf('.'));","\t\t\t}","","\t\t\tif (field.options.autoCleanup && item.get(field.paths.exists)) {","\t\t\t\t// capture image delete promise","\t\t\t\timageDelete = field.apply(item, 'delete');","\t\t\t}","","\t\t\t// callback to be called upon completion of the 'upload' method","\t\t\tvar uploadComplete = function(result) {","\t\t\t\tif (result.error) {","\t\t\t\t\tcallback(result.error);","\t\t\t\t} else {","\t\t\t\t\titem.set(field.path, result);","\t\t\t\t\tcallback();","\t\t\t\t}","\t\t\t};","","\t\t\t// upload immediately if image is not being delete","\t\t\tif (typeof imageDelete === 'undefined') {","\t\t\t\tfield.apply(item, 'upload', req.files[paths.upload].path, uploadOptions).onFulfill(uploadComplete);","\t\t\t} else {","\t\t\t\t// otherwise wait until image is deleted before uploading","\t\t\t\t// this avoids problems when deleting/uploading images with the same public_id (issue #598)","\t\t\t\timageDelete.onFulfill(function(result) {","\t\t\t\t\tif (result.error) {","\t\t\t\t\t\tcallback(result.error);","\t\t\t\t\t} else {","\t\t\t\t\t\tfield.apply(item, 'upload', req.files[paths.upload].path, uploadOptions).onFulfill(uploadComplete);","\t\t\t\t\t}","\t\t\t\t});","\t\t\t}","","\t\t} else {","\t\t\tcallback();","\t\t}","","\t};","","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","cloudinaryimage.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/*!"," * Export class"," */","","exports = module.exports = cloudinaryimage;",""],"l":{"5":1,"19":1,"21":0,"22":0,"23":0,"26":0,"29":0,"30":0,"36":0,"39":0,"40":0,"53":1,"62":1,"64":0,"67":0,"87":0,"99":0,"101":0,"102":0,"106":0,"107":0,"110":0,"111":0,"113":0,"114":0,"115":0,"117":0,"118":0,"119":0,"120":0,"124":0,"128":0,"129":0,"132":0,"134":0,"135":0,"138":0,"140":0,"141":0,"144":0,"145":0,"148":0,"149":0,"152":0,"154":0,"158":0,"159":0,"172":0,"173":0,"174":0,"175":0,"176":0,"178":0,"181":0,"183":0,"186":0,"189":0,"192":0,"195":0,"198":0,"201":0,"204":0,"207":0,"210":0,"213":0,"216":0,"219":0,"227":0,"235":0,"237":0,"238":0,"240":0,"242":0,"250":0,"252":0,"253":0,"256":0,"260":0,"261":0,"265":0,"266":0,"269":0,"279":1,"280":0,"290":1,"291":0,"301":1,"303":0,"313":1,"314":0,"316":0,"317":0,"318":0,"319":0,"322":0,"323":0,"328":0,"342":1,"344":0,"346":0,"347":0,"348":0,"349":0,"350":0,"353":0,"355":0,"357":0,"358":0,"360":0,"361":0,"365":0,"367":0,"368":0,"369":0,"371":0,"372":0,"376":0,"378":0,"379":0,"381":0,"382":0,"385":0,"389":0,"390":0,"393":0,"394":0,"397":0,"398":0,"401":0,"402":0,"403":0,"404":0,"406":0,"407":0,"410":0,"412":0,"416":0,"417":0,"418":0,"420":0,"421":0,"426":0,"427":0,"431":0,"432":0,"433":0,"435":0,"441":0,"455":1,"456":0,"464":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/cloudinaryimages/CloudinaryImagesType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/cloudinaryimages/CloudinaryImagesType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":1,"83":0,"84":0,"85":1,"86":0,"87":1,"88":0,"89":1,"90":1,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":1,"141":0,"142":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0},"fnMap":{"1":{"name":"cloudinaryimages","line":19,"loc":{"start":{"line":19,"column":0},"end":{"line":19,"column":47}}},"2":{"name":"(anonymous_2)","line":57,"loc":{"start":{"line":57,"column":41},"end":{"line":57,"column":52}}},"3":{"name":"(anonymous_3)","line":87,"loc":{"start":{"line":87,"column":14},"end":{"line":87,"column":29}}},"4":{"name":"(anonymous_4)","line":105,"loc":{"start":{"line":105,"column":40},"end":{"line":105,"column":51}}},"5":{"name":"(anonymous_5)","line":109,"loc":{"start":{"line":109,"column":11},"end":{"line":109,"column":34}}},"6":{"name":"(anonymous_6)","line":117,"loc":{"start":{"line":117,"column":15},"end":{"line":117,"column":48}}},"7":{"name":"(anonymous_7)","line":123,"loc":{"start":{"line":123,"column":27},"end":{"line":123,"column":45}}},"8":{"name":"(anonymous_8)","line":127,"loc":{"start":{"line":127,"column":29},"end":{"line":127,"column":53}}},"9":{"name":"(anonymous_9)","line":131,"loc":{"start":{"line":131,"column":28},"end":{"line":131,"column":52}}},"10":{"name":"(anonymous_10)","line":135,"loc":{"start":{"line":135,"column":29},"end":{"line":135,"column":53}}},"11":{"name":"(anonymous_11)","line":139,"loc":{"start":{"line":139,"column":27},"end":{"line":139,"column":51}}},"12":{"name":"(anonymous_12)","line":143,"loc":{"start":{"line":143,"column":29},"end":{"line":143,"column":53}}},"13":{"name":"(anonymous_13)","line":147,"loc":{"start":{"line":147,"column":27},"end":{"line":147,"column":51}}},"14":{"name":"(anonymous_14)","line":151,"loc":{"start":{"line":151,"column":28},"end":{"line":151,"column":52}}},"15":{"name":"(anonymous_15)","line":155,"loc":{"start":{"line":155,"column":28},"end":{"line":155,"column":52}}},"16":{"name":"(anonymous_16)","line":159,"loc":{"start":{"line":159,"column":33},"end":{"line":159,"column":57}}},"17":{"name":"(anonymous_17)","line":165,"loc":{"start":{"line":165,"column":20},"end":{"line":165,"column":57}}},"18":{"name":"(anonymous_18)","line":178,"loc":{"start":{"line":178,"column":46},"end":{"line":178,"column":57}}},"19":{"name":"(anonymous_19)","line":186,"loc":{"start":{"line":186,"column":33},"end":{"line":186,"column":56}}},"20":{"name":"(anonymous_20)","line":190,"loc":{"start":{"line":190,"column":33},"end":{"line":190,"column":56}}},"21":{"name":"(anonymous_21)","line":204,"loc":{"start":{"line":204,"column":36},"end":{"line":204,"column":51}}},"22":{"name":"(anonymous_22)","line":205,"loc":{"start":{"line":205,"column":35},"end":{"line":205,"column":49}}},"23":{"name":"(anonymous_23)","line":217,"loc":{"start":{"line":217,"column":40},"end":{"line":217,"column":55}}},"24":{"name":"(anonymous_24)","line":229,"loc":{"start":{"line":229,"column":43},"end":{"line":229,"column":58}}},"25":{"name":"(anonymous_25)","line":241,"loc":{"start":{"line":241,"column":40},"end":{"line":241,"column":61}}},"26":{"name":"(anonymous_26)","line":256,"loc":{"start":{"line":256,"column":47},"end":{"line":256,"column":84}}},"27":{"name":"(anonymous_27)","line":267,"loc":{"start":{"line":267,"column":24},"end":{"line":267,"column":35}}},"28":{"name":"(anonymous_28)","line":269,"loc":{"start":{"line":269,"column":8},"end":{"line":269,"column":19}}},"29":{"name":"(anonymous_29)","line":276,"loc":{"start":{"line":276,"column":15},"end":{"line":276,"column":30}}},"30":{"name":"(anonymous_30)","line":285,"loc":{"start":{"line":285,"column":19},"end":{"line":285,"column":36}}},"31":{"name":"(anonymous_31)","line":292,"loc":{"start":{"line":292,"column":27},"end":{"line":292,"column":40}}},"32":{"name":"(anonymous_32)","line":302,"loc":{"start":{"line":302,"column":19},"end":{"line":302,"column":34}}},"33":{"name":"(anonymous_33)","line":334,"loc":{"start":{"line":334,"column":21},"end":{"line":334,"column":42}}},"34":{"name":"(anonymous_34)","line":342,"loc":{"start":{"line":342,"column":42},"end":{"line":342,"column":59}}},"35":{"name":"(anonymous_35)","line":351,"loc":{"start":{"line":351,"column":6},"end":{"line":351,"column":20}}},"36":{"name":"(anonymous_36)","line":367,"loc":{"start":{"line":367,"column":43},"end":{"line":367,"column":80}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":11,"column":26}},"2":{"start":{"line":19,"column":0},"end":{"line":42,"column":1}},"3":{"start":{"line":21,"column":1},"end":{"line":21,"column":38}},"4":{"start":{"line":22,"column":1},"end":{"line":22,"column":26}},"5":{"start":{"line":23,"column":1},"end":{"line":23,"column":106}},"6":{"start":{"line":26,"column":1},"end":{"line":26,"column":25}},"7":{"start":{"line":28,"column":1},"end":{"line":31,"column":2}},"8":{"start":{"line":29,"column":2},"end":{"line":30,"column":119}},"9":{"start":{"line":33,"column":1},"end":{"line":33,"column":57}},"10":{"start":{"line":36,"column":1},"end":{"line":40,"column":2}},"11":{"start":{"line":37,"column":2},"end":{"line":39,"column":96}},"12":{"start":{"line":48,"column":0},"end":{"line":48,"column":40}},"13":{"start":{"line":57,"column":0},"end":{"line":195,"column":2}},"14":{"start":{"line":59,"column":1},"end":{"line":59,"column":34}},"15":{"start":{"line":61,"column":1},"end":{"line":62,"column":28}},"16":{"start":{"line":64,"column":1},"end":{"line":72,"column":3}},"17":{"start":{"line":74,"column":1},"end":{"line":84,"column":4}},"18":{"start":{"line":87,"column":1},"end":{"line":102,"column":3}},"19":{"start":{"line":88,"column":2},"end":{"line":88,"column":23}},"20":{"start":{"line":90,"column":2},"end":{"line":99,"column":3}},"21":{"start":{"line":91,"column":3},"end":{"line":98,"column":4}},"22":{"start":{"line":92,"column":4},"end":{"line":92,"column":39}},"23":{"start":{"line":94,"column":4},"end":{"line":94,"column":98}},"24":{"start":{"line":95,"column":4},"end":{"line":95,"column":37}},"25":{"start":{"line":96,"column":4},"end":{"line":96,"column":32}},"26":{"start":{"line":97,"column":4},"end":{"line":97,"column":39}},"27":{"start":{"line":101,"column":2},"end":{"line":101,"column":21}},"28":{"start":{"line":105,"column":1},"end":{"line":107,"column":4}},"29":{"start":{"line":106,"column":2},"end":{"line":106,"column":22}},"30":{"start":{"line":109,"column":1},"end":{"line":115,"column":3}},"31":{"start":{"line":110,"column":2},"end":{"line":113,"column":3}},"32":{"start":{"line":111,"column":3},"end":{"line":111,"column":27}},"33":{"start":{"line":112,"column":3},"end":{"line":112,"column":25}},"34":{"start":{"line":114,"column":2},"end":{"line":114,"column":88}},"35":{"start":{"line":117,"column":1},"end":{"line":121,"column":3}},"36":{"start":{"line":118,"column":2},"end":{"line":118,"column":35}},"37":{"start":{"line":118,"column":13},"end":{"line":118,"column":35}},"38":{"start":{"line":119,"column":2},"end":{"line":119,"column":38}},"39":{"start":{"line":119,"column":14},"end":{"line":119,"column":38}},"40":{"start":{"line":120,"column":2},"end":{"line":120,"column":17}},"41":{"start":{"line":123,"column":1},"end":{"line":125,"column":4}},"42":{"start":{"line":124,"column":2},"end":{"line":124,"column":28}},"43":{"start":{"line":127,"column":1},"end":{"line":129,"column":4}},"44":{"start":{"line":128,"column":2},"end":{"line":128,"column":62}},"45":{"start":{"line":131,"column":1},"end":{"line":133,"column":4}},"46":{"start":{"line":132,"column":2},"end":{"line":132,"column":79}},"47":{"start":{"line":135,"column":1},"end":{"line":137,"column":4}},"48":{"start":{"line":136,"column":2},"end":{"line":136,"column":80}},"49":{"start":{"line":139,"column":1},"end":{"line":141,"column":4}},"50":{"start":{"line":140,"column":2},"end":{"line":140,"column":60}},"51":{"start":{"line":143,"column":1},"end":{"line":145,"column":4}},"52":{"start":{"line":144,"column":2},"end":{"line":144,"column":62}},"53":{"start":{"line":147,"column":1},"end":{"line":149,"column":4}},"54":{"start":{"line":148,"column":2},"end":{"line":148,"column":60}},"55":{"start":{"line":151,"column":1},"end":{"line":153,"column":4}},"56":{"start":{"line":152,"column":2},"end":{"line":152,"column":61}},"57":{"start":{"line":155,"column":1},"end":{"line":157,"column":4}},"58":{"start":{"line":156,"column":2},"end":{"line":156,"column":79}},"59":{"start":{"line":159,"column":1},"end":{"line":161,"column":4}},"60":{"start":{"line":160,"column":2},"end":{"line":160,"column":80}},"61":{"start":{"line":163,"column":1},"end":{"line":163,"column":49}},"62":{"start":{"line":165,"column":1},"end":{"line":184,"column":3}},"63":{"start":{"line":166,"column":2},"end":{"line":166,"column":36}},"64":{"start":{"line":167,"column":2},"end":{"line":174,"column":3}},"65":{"start":{"line":168,"column":3},"end":{"line":173,"column":4}},"66":{"start":{"line":169,"column":4},"end":{"line":172,"column":5}},"67":{"start":{"line":170,"column":5},"end":{"line":170,"column":12}},"68":{"start":{"line":171,"column":5},"end":{"line":171,"column":11}},"69":{"start":{"line":175,"column":2},"end":{"line":175,"column":23}},"70":{"start":{"line":176,"column":2},"end":{"line":176,"column":19}},"71":{"start":{"line":176,"column":12},"end":{"line":176,"column":19}},"72":{"start":{"line":177,"column":2},"end":{"line":179,"column":3}},"73":{"start":{"line":178,"column":3},"end":{"line":178,"column":61}},"74":{"start":{"line":180,"column":2},"end":{"line":180,"column":23}},"75":{"start":{"line":181,"column":2},"end":{"line":183,"column":3}},"76":{"start":{"line":182,"column":3},"end":{"line":182,"column":70}},"77":{"start":{"line":186,"column":1},"end":{"line":188,"column":4}},"78":{"start":{"line":187,"column":2},"end":{"line":187,"column":50}},"79":{"start":{"line":190,"column":1},"end":{"line":192,"column":4}},"80":{"start":{"line":191,"column":2},"end":{"line":191,"column":50}},"81":{"start":{"line":194,"column":1},"end":{"line":194,"column":30}},"82":{"start":{"line":204,"column":0},"end":{"line":208,"column":2}},"83":{"start":{"line":205,"column":1},"end":{"line":207,"column":15}},"84":{"start":{"line":206,"column":2},"end":{"line":206,"column":19}},"85":{"start":{"line":217,"column":0},"end":{"line":220,"column":2}},"86":{"start":{"line":219,"column":1},"end":{"line":219,"column":13}},"87":{"start":{"line":229,"column":0},"end":{"line":232,"column":2}},"88":{"start":{"line":231,"column":1},"end":{"line":231,"column":13}},"89":{"start":{"line":241,"column":0},"end":{"line":243,"column":2}},"90":{"start":{"line":256,"column":0},"end":{"line":358,"column":2}},"91":{"start":{"line":258,"column":1},"end":{"line":258,"column":18}},"92":{"start":{"line":260,"column":1},"end":{"line":265,"column":2}},"93":{"start":{"line":261,"column":2},"end":{"line":261,"column":19}},"94":{"start":{"line":262,"column":2},"end":{"line":262,"column":22}},"95":{"start":{"line":263,"column":8},"end":{"line":265,"column":2}},"96":{"start":{"line":264,"column":2},"end":{"line":264,"column":22}},"97":{"start":{"line":267,"column":1},"end":{"line":267,"column":38}},"98":{"start":{"line":269,"column":1},"end":{"line":357,"column":3}},"99":{"start":{"line":272,"column":2},"end":{"line":279,"column":3}},"100":{"start":{"line":273,"column":3},"end":{"line":274,"column":48}},"101":{"start":{"line":276,"column":3},"end":{"line":278,"column":6}},"102":{"start":{"line":277,"column":4},"end":{"line":277,"column":84}},"103":{"start":{"line":282,"column":2},"end":{"line":296,"column":3}},"104":{"start":{"line":283,"column":3},"end":{"line":283,"column":51}},"105":{"start":{"line":285,"column":3},"end":{"line":295,"column":6}},"106":{"start":{"line":286,"column":4},"end":{"line":286,"column":31}},"107":{"start":{"line":287,"column":4},"end":{"line":288,"column":21}},"108":{"start":{"line":290,"column":4},"end":{"line":290,"column":59}},"109":{"start":{"line":290,"column":52},"end":{"line":290,"column":59}},"110":{"start":{"line":292,"column":4},"end":{"line":294,"column":7}},"111":{"start":{"line":293,"column":5},"end":{"line":293,"column":41}},"112":{"start":{"line":299,"column":2},"end":{"line":305,"column":3}},"113":{"start":{"line":300,"column":3},"end":{"line":300,"column":53}},"114":{"start":{"line":302,"column":3},"end":{"line":304,"column":6}},"115":{"start":{"line":303,"column":4},"end":{"line":303,"column":36}},"116":{"start":{"line":308,"column":2},"end":{"line":356,"column":3}},"117":{"start":{"line":309,"column":3},"end":{"line":309,"column":50}},"118":{"start":{"line":311,"column":3},"end":{"line":311,"column":52}},"119":{"start":{"line":313,"column":3},"end":{"line":315,"column":4}},"120":{"start":{"line":314,"column":4},"end":{"line":314,"column":14}},"121":{"start":{"line":317,"column":3},"end":{"line":319,"column":5}},"122":{"start":{"line":321,"column":3},"end":{"line":323,"column":4}},"123":{"start":{"line":322,"column":4},"end":{"line":322,"column":50}},"124":{"start":{"line":325,"column":3},"end":{"line":327,"column":4}},"125":{"start":{"line":326,"column":4},"end":{"line":326,"column":63}},"126":{"start":{"line":329,"column":3},"end":{"line":331,"column":4}},"127":{"start":{"line":330,"column":4},"end":{"line":330,"column":40}},"128":{"start":{"line":334,"column":3},"end":{"line":353,"column":6}},"129":{"start":{"line":336,"column":4},"end":{"line":336,"column":34}},"130":{"start":{"line":336,"column":20},"end":{"line":336,"column":34}},"131":{"start":{"line":338,"column":4},"end":{"line":340,"column":5}},"132":{"start":{"line":339,"column":5},"end":{"line":339,"column":98}},"133":{"start":{"line":342,"column":4},"end":{"line":349,"column":22}},"134":{"start":{"line":343,"column":5},"end":{"line":348,"column":6}},"135":{"start":{"line":344,"column":6},"end":{"line":344,"column":32}},"136":{"start":{"line":346,"column":6},"end":{"line":346,"column":40}},"137":{"start":{"line":347,"column":6},"end":{"line":347,"column":20}},"138":{"start":{"line":352,"column":4},"end":{"line":352,"column":25}},"139":{"start":{"line":355,"column":3},"end":{"line":355,"column":21}},"140":{"start":{"line":367,"column":0},"end":{"line":369,"column":2}},"141":{"start":{"line":368,"column":1},"end":{"line":368,"column":54}},"142":{"start":{"line":376,"column":0},"end":{"line":376,"column":44}}},"branchMap":{"1":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},{"start":{"line":28,"column":1},"end":{"line":28,"column":1}}]},"2":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},{"start":{"line":36,"column":1},"end":{"line":36,"column":1}}]},"3":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":2},"end":{"line":90,"column":2}},{"start":{"line":90,"column":2},"end":{"line":90,"column":2}}]},"4":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":3},"end":{"line":91,"column":3}},{"start":{"line":91,"column":3},"end":{"line":91,"column":3}}]},"5":{"line":94,"type":"cond-expr","locations":[{"start":{"line":94,"column":57},"end":{"line":94,"column":92}},{"start":{"line":94,"column":95},"end":{"line":94,"column":97}}]},"6":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":2},"end":{"line":110,"column":2}},{"start":{"line":110,"column":2},"end":{"line":110,"column":2}}]},"7":{"line":111,"type":"binary-expr","locations":[{"start":{"line":111,"column":13},"end":{"line":111,"column":20}},{"start":{"line":111,"column":24},"end":{"line":111,"column":26}}]},"8":{"line":114,"type":"cond-expr","locations":[{"start":{"line":114,"column":25},"end":{"line":114,"column":82}},{"start":{"line":114,"column":85},"end":{"line":114,"column":87}}]},"9":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":2},"end":{"line":118,"column":2}},{"start":{"line":118,"column":2},"end":{"line":118,"column":2}}]},"10":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":2},"end":{"line":119,"column":2}},{"start":{"line":119,"column":2},"end":{"line":119,"column":2}}]},"11":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":2},"end":{"line":167,"column":2}},{"start":{"line":167,"column":2},"end":{"line":167,"column":2}}]},"12":{"line":169,"type":"if","locations":[{"start":{"line":169,"column":4},"end":{"line":169,"column":4}},{"start":{"line":169,"column":4},"end":{"line":169,"column":4}}]},"13":{"line":176,"type":"if","locations":[{"start":{"line":176,"column":2},"end":{"line":176,"column":2}},{"start":{"line":176,"column":2},"end":{"line":176,"column":2}}]},"14":{"line":177,"type":"if","locations":[{"start":{"line":177,"column":2},"end":{"line":177,"column":2}},{"start":{"line":177,"column":2},"end":{"line":177,"column":2}}]},"15":{"line":181,"type":"if","locations":[{"start":{"line":181,"column":2},"end":{"line":181,"column":2}},{"start":{"line":181,"column":2},"end":{"line":181,"column":2}}]},"16":{"line":182,"type":"cond-expr","locations":[{"start":{"line":182,"column":48},"end":{"line":182,"column":56}},{"start":{"line":182,"column":59},"end":{"line":182,"column":68}}]},"17":{"line":260,"type":"if","locations":[{"start":{"line":260,"column":1},"end":{"line":260,"column":1}},{"start":{"line":260,"column":1},"end":{"line":260,"column":1}}]},"18":{"line":263,"type":"if","locations":[{"start":{"line":263,"column":8},"end":{"line":263,"column":8}},{"start":{"line":263,"column":8},"end":{"line":263,"column":8}}]},"19":{"line":267,"type":"binary-expr","locations":[{"start":{"line":267,"column":12},"end":{"line":267,"column":20}},{"start":{"line":267,"column":24},"end":{"line":267,"column":37}}]},"20":{"line":272,"type":"if","locations":[{"start":{"line":272,"column":2},"end":{"line":272,"column":2}},{"start":{"line":272,"column":2},"end":{"line":272,"column":2}}]},"21":{"line":277,"type":"cond-expr","locations":[{"start":{"line":277,"column":77},"end":{"line":277,"column":78}},{"start":{"line":277,"column":81},"end":{"line":277,"column":83}}]},"22":{"line":282,"type":"if","locations":[{"start":{"line":282,"column":2},"end":{"line":282,"column":2}},{"start":{"line":282,"column":2},"end":{"line":282,"column":2}}]},"23":{"line":282,"type":"binary-expr","locations":[{"start":{"line":282,"column":6},"end":{"line":282,"column":14}},{"start":{"line":282,"column":18},"end":{"line":282,"column":40}}]},"24":{"line":290,"type":"if","locations":[{"start":{"line":290,"column":4},"end":{"line":290,"column":4}},{"start":{"line":290,"column":4},"end":{"line":290,"column":4}}]},"25":{"line":290,"type":"binary-expr","locations":[{"start":{"line":290,"column":8},"end":{"line":290,"column":42}},{"start":{"line":290,"column":46},"end":{"line":290,"column":50}}]},"26":{"line":299,"type":"if","locations":[{"start":{"line":299,"column":2},"end":{"line":299,"column":2}},{"start":{"line":299,"column":2},"end":{"line":299,"column":2}}]},"27":{"line":308,"type":"if","locations":[{"start":{"line":308,"column":2},"end":{"line":308,"column":2}},{"start":{"line":308,"column":2},"end":{"line":308,"column":2}}]},"28":{"line":308,"type":"binary-expr","locations":[{"start":{"line":308,"column":6},"end":{"line":308,"column":15}},{"start":{"line":308,"column":19},"end":{"line":308,"column":42}}]},"29":{"line":311,"type":"binary-expr","locations":[{"start":{"line":311,"column":12},"end":{"line":311,"column":45}},{"start":{"line":311,"column":49},"end":{"line":311,"column":51}}]},"30":{"line":313,"type":"if","locations":[{"start":{"line":313,"column":3},"end":{"line":313,"column":3}},{"start":{"line":313,"column":3},"end":{"line":313,"column":3}}]},"31":{"line":321,"type":"if","locations":[{"start":{"line":321,"column":3},"end":{"line":321,"column":3}},{"start":{"line":321,"column":3},"end":{"line":321,"column":3}}]},"32":{"line":325,"type":"if","locations":[{"start":{"line":325,"column":3},"end":{"line":325,"column":3}},{"start":{"line":325,"column":3},"end":{"line":325,"column":3}}]},"33":{"line":329,"type":"if","locations":[{"start":{"line":329,"column":3},"end":{"line":329,"column":3}},{"start":{"line":329,"column":3},"end":{"line":329,"column":3}}]},"34":{"line":336,"type":"if","locations":[{"start":{"line":336,"column":4},"end":{"line":336,"column":4}},{"start":{"line":336,"column":4},"end":{"line":336,"column":4}}]},"35":{"line":338,"type":"if","locations":[{"start":{"line":338,"column":4},"end":{"line":338,"column":4}},{"start":{"line":338,"column":4},"end":{"line":338,"column":4}}]},"36":{"line":343,"type":"if","locations":[{"start":{"line":343,"column":5},"end":{"line":343,"column":5}},{"start":{"line":343,"column":5},"end":{"line":343,"column":5}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tkeystone = require('../../../'),","\tutil = require('util'),","\tcloudinary = require('cloudinary'),","\tutils = require('keystone-utils'),","\tsuper_ = require('../Type'),","\tasync = require('async');","","/**"," * CloudinaryImages FieldType Constructor"," * @extends Field"," * @api public"," */","","function cloudinaryimages(list, path, options) {","","\tthis._underscoreMethods = ['format'];","\tthis._fixedSize = 'full';","\tthis._properties = ['select', 'selectPrefix', 'autoCleanup', 'publicID', 'folder', 'filenameAsPublicID'];","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","\t// TODO: implement initial form, usage disabled for now","\tif (options.initial) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'CloudinaryImages fields (' + list.key + '.' + path + ') do not currently support being used as initial fields.\\n');","\t}","","\tcloudinaryimages.super_.call(this, list, path, options);","","\t// validate cloudinary config","\tif (!keystone.get('cloudinary config')) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'CloudinaryImages fields (' + list.key + '.' + this.path + ') require the \"cloudinary config\" option to be set.\\n\\n' +","\t\t\t'See http://keystonejs.com/docs/configuration/#services-cloudinary for more information.\\n');","\t}","","}","","/*!"," * Inherit from Field"," */","","util.inherits(cloudinaryimages, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","cloudinaryimages.prototype.addToSchema = function() {","","\tvar mongoose = keystone.mongoose;","","\tvar field = this,","\t\tschema = this.list.schema;","","\tthis.paths = {","\t\t// virtuals","\t\tfolder: \t\tthis._path.append('.folder'),","\t\t// form paths","\t\tupload: \t\tthis._path.append('_upload'),","\t\tuploads: \t\tthis._path.append('_uploads'),","\t\taction: \t\tthis._path.append('_action'),","\t\torder: \t\t\tthis._path.append('_order')","\t};","","\tvar ImageSchema = new mongoose.Schema({","\t\tpublic_id:\t\tString,","\t\tversion:\t\tNumber,","\t\tsignature:\t\tString,","\t\tformat:\t\t\tString,","\t\tresource_type:\tString,","\t\turl:\t\t\tString,","\t\twidth:\t\t\tNumber,","\t\theight:\t\t\tNumber,","\t\tsecure_url:\t\tString","\t});","","\t// Generate cloudinary folder used to upload/select images","\tvar folder = function(item) {//eslint-disable-line no-unused-vars","\t\tvar folderValue = '';","","\t\tif (keystone.get('cloudinary folders')) {","\t\t\tif (field.options.folder) {","\t\t\t\tfolderValue = field.options.folder;","\t\t\t} else {","\t\t\t\tvar folderList = keystone.get('cloudinary prefix') ? [keystone.get('cloudinary prefix')] : [];","\t\t\t\tfolderList.push(field.list.path);","\t\t\t\tfolderList.push(field.path);","\t\t\t\tfolderValue = folderList.join('/');","\t\t\t}","\t\t}","","\t\treturn folderValue;","\t};","","\t// The .folder virtual returns the cloudinary folder used to upload/select images","\tschema.virtual(field.paths.folder).get(function() {","\t\treturn folder(this);","\t});","","\tvar src = function(img, options) {","\t\tif (keystone.get('cloudinary secure')) {","\t\t\toptions = options || {};","\t\t\toptions.secure = true;","\t\t}","\t\treturn img.public_id ? cloudinary.url(img.public_id + '.' + img.format, options) : '';","\t};","","\tvar addSize = function(options, width, height) {","\t\tif (width) options.width = width;","\t\tif (height) options.height = height;","\t\treturn options;","\t};","","\tImageSchema.method('src', function(options) {","\t\treturn src(this, options);","\t});","","\tImageSchema.method('scale', function(width, height) {","\t\treturn src(this, addSize({ crop: 'scale' }, width, height));","\t});","","\tImageSchema.method('fill', function(width, height) {","\t\treturn src(this, addSize({ crop: 'fill', gravity: 'faces' }, width, height));","\t});","","\tImageSchema.method('lfill', function(width, height) {","\t\treturn src(this, addSize({ crop: 'lfill', gravity: 'faces' }, width, height));","\t});","","\tImageSchema.method('fit', function(width, height) {","\t\treturn src(this, addSize({ crop: 'fit' }, width, height));","\t});","","\tImageSchema.method('limit', function(width, height) {","\t\treturn src(this, addSize({ crop: 'limit' }, width, height));","\t});","","\tImageSchema.method('pad', function(width, height) {","\t\treturn src(this, addSize({ crop: 'pad' }, width, height));","\t});","","\tImageSchema.method('lpad', function(width, height) {","\t\treturn src(this, addSize({ crop: 'lpad' }, width, height));","\t});","","\tImageSchema.method('crop', function(width, height) {","\t\treturn src(this, addSize({ crop: 'crop', gravity: 'faces' }, width, height));","\t});","","\tImageSchema.method('thumbnail', function(width, height) {","\t\treturn src(this, addSize({ crop: 'thumb', gravity: 'faces' }, width, height));","\t});","","\tschema.add(this._path.addTo({}, [ImageSchema]));","","\tthis.removeImage = function(item, id, method, callback) {","\t\tvar images = item.get(field.path);","\t\tif ('number' !== typeof id) {","\t\t\tfor (var i = 0; i < images.length; i++) {","\t\t\t\tif (images[i].public_id === id) {","\t\t\t\t\tid = i;","\t\t\t\t\tbreak;","\t\t\t\t}","\t\t\t}","\t\t}","\t\tvar img = images[id];","\t\tif (!img) return;","\t\tif (method === 'delete') {","\t\t\tcloudinary.uploader.destroy(img.public_id, function() {});","\t\t}","\t\timages.splice(id, 1);","\t\tif (callback) {","\t\t\titem.save(('function' !== typeof callback) ? callback : undefined);","\t\t}","\t};","","\tthis.underscoreMethod('remove', function(id, callback) {","\t\tfield.removeImage(this, id, 'remove', callback);","\t});","","\tthis.underscoreMethod('delete', function(id, callback) {","\t\tfield.removeImage(this, id, 'delete', callback);","\t});","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","cloudinaryimages.prototype.format = function(item) {","\treturn _.map(item.get(this.path), function(img) {","\t\treturn img.src();","\t}).join(', ');","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","cloudinaryimages.prototype.isModified = function(item) {//eslint-disable-line no-unused-vars","\t// TODO - how should this be detected?","\treturn true;","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","cloudinaryimages.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO - how should image field input be validated?","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","cloudinaryimages.prototype.updateItem = function(item, data) {//eslint-disable-line no-unused-vars","\t// TODO - direct updating of data (not via upload)","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Expected form parts are"," * - `field.paths.action` in `req.body` in syntax `delete:public_id,public_id|remove:public_id,public_id`"," * - `field.paths.upload` in `req.files` (uploads the images to cloudinary)"," *"," * @api public"," */","","cloudinaryimages.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","","\t\t// Order","\t\tif (req.body[paths.order]) {","\t\t\tvar images = item.get(field.path),","\t\t\t\tnewOrder = req.body[paths.order].split(',');","","\t\t\timages.sort(function(a, b) {","\t\t\t\treturn (newOrder.indexOf(a.public_id) > newOrder.indexOf(b.public_id)) ? 1 : -1;","\t\t\t});","\t\t}","","\t\t// Removals & Deletes","\t\tif (req.body && req.body[paths.action]) {","\t\t\tvar actions = req.body[paths.action].split('|');","","\t\t\tactions.forEach(function(action) {","\t\t\t\taction = action.split(':');","\t\t\t\tvar method = action[0],","\t\t\t\t\tids = action[1];","","\t\t\t\tif (!method.match(/^(remove|delete)$/) || !ids) return;","","\t\t\t\tids.split(',').forEach(function(id) {","\t\t\t\t\tfield.removeImage(item, id, method);","\t\t\t\t});","\t\t\t});","\t\t}","","\t\t// Upload References (direct uploading)","\t\tif (req.body[paths.uploads]) {","\t\t\tvar uploads = JSON.parse(req.body[paths.uploads]);","","\t\t\tuploads.forEach(function(file) {","\t\t\t\titem.get(field.path).push(file);","\t\t\t});","\t\t}","","\t\t// Upload Data (form submissions)","\t\tif (req.files && req.files[paths.upload]) {","\t\t\tvar files = [].concat(req.files[paths.upload]);","","\t\t\tvar tp = keystone.get('cloudinary prefix') || '';","","\t\t\tif (tp.length) {","\t\t\t\ttp += '_';","\t\t\t}","","\t\t\tvar uploadOptions = {","\t\t\t\ttags: [tp + field.list.path + '_' + field.path, tp + field.list.path + '_' + field.path + '_' + item.id]","\t\t\t};","","\t\t\tif (keystone.get('cloudinary folders')) {","\t\t\t\tuploadOptions.folder = item.get(paths.folder);","\t\t\t}","","\t\t\tif (keystone.get('cloudinary prefix')) {","\t\t\t\tuploadOptions.tags.push(keystone.get('cloudinary prefix'));","\t\t\t}","","\t\t\tif (keystone.get('env') !== 'production') {","\t\t\t\tuploadOptions.tags.push(tp + 'dev');","\t\t\t}","","","\t\t\tasync.each(files, function(file, next) {","","\t\t\t\tif (!file.size) return next();","","\t\t\t\tif (field.options.filenameAsPublicID) {","\t\t\t\t\tuploadOptions.public_id = file.originalname.substring(0, file.originalname.lastIndexOf('.'));","\t\t\t\t}","","\t\t\t\tcloudinary.uploader.upload(file.path, function(result) {","\t\t\t\t\tif (result.error) {","\t\t\t\t\t\treturn next(result.error);","\t\t\t\t\t} else {","\t\t\t\t\t\titem.get(field.path).push(result);","\t\t\t\t\t\treturn next();","\t\t\t\t\t}","\t\t\t\t}, uploadOptions);","","\t\t\t}, function(err) {","\t\t\t\treturn callback(err);","\t\t\t});","\t\t} else {","\t\t\treturn callback();","\t\t}","\t};","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","cloudinaryimages.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/*!"," * Export class"," */","","exports = module.exports = cloudinaryimages;",""],"l":{"5":1,"19":1,"21":0,"22":0,"23":0,"26":0,"28":0,"29":0,"33":0,"36":0,"37":0,"48":1,"57":1,"59":0,"61":0,"64":0,"74":0,"87":0,"88":0,"90":0,"91":0,"92":0,"94":0,"95":0,"96":0,"97":0,"101":0,"105":0,"106":0,"109":0,"110":0,"111":0,"112":0,"114":0,"117":0,"118":0,"119":0,"120":0,"123":0,"124":0,"127":0,"128":0,"131":0,"132":0,"135":0,"136":0,"139":0,"140":0,"143":0,"144":0,"147":0,"148":0,"151":0,"152":0,"155":0,"156":0,"159":0,"160":0,"163":0,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"175":0,"176":0,"177":0,"178":0,"180":0,"181":0,"182":0,"186":0,"187":0,"190":0,"191":0,"194":0,"204":1,"205":0,"206":0,"217":1,"219":0,"229":1,"231":0,"241":1,"256":1,"258":0,"260":0,"261":0,"262":0,"263":0,"264":0,"267":0,"269":0,"272":0,"273":0,"276":0,"277":0,"282":0,"283":0,"285":0,"286":0,"287":0,"290":0,"292":0,"293":0,"299":0,"300":0,"302":0,"303":0,"308":0,"309":0,"311":0,"313":0,"314":0,"317":0,"321":0,"322":0,"325":0,"326":0,"329":0,"330":0,"334":0,"336":0,"338":0,"339":0,"342":0,"343":0,"344":0,"346":0,"347":0,"352":0,"355":0,"367":1,"368":0,"376":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/code/CodeType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/code/CodeType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":1,"15":1,"16":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"code","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":35}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":11,"column":0},"end":{"line":20,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":27}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":28}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":37}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":46}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":49}},"11":{"start":{"line":17,"column":1},"end":{"line":17,"column":44}},"12":{"start":{"line":18,"column":1},"end":{"line":18,"column":65}},"13":{"start":{"line":19,"column":1},"end":{"line":19,"column":45}},"14":{"start":{"line":21,"column":0},"end":{"line":21,"column":31}},"15":{"start":{"line":24,"column":0},"end":{"line":24,"column":70}},"16":{"start":{"line":27,"column":0},"end":{"line":27,"column":32}}},"branchMap":{"1":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":15},"end":{"line":14,"column":29}},{"start":{"line":14,"column":33},"end":{"line":14,"column":36}}]},"2":{"line":15,"type":"binary-expr","locations":[{"start":{"line":15,"column":13},"end":{"line":15,"column":25}},{"start":{"line":15,"column":29},"end":{"line":15,"column":45}}]},"3":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":19},"end":{"line":17,"column":37}},{"start":{"line":17,"column":41},"end":{"line":17,"column":43}}]}},"code":["var _ = require('underscore');","var FieldType = require('../Type');","var TextType = require('../text/TextType');","var util = require('util');","","/**"," * HTML FieldType Constructor"," * @extends Field"," * @api public"," */","function code(list, path, options) {","\tthis._nativeType = String;","\tthis._defaultSize = 'full';","\tthis.height = options.height || 180;","\tthis.lang = options.lang || options.language;","\tthis._properties = ['editor', 'height', 'lang'];","\tthis.codemirror = options.codemirror || {};","\tthis.editor = _.defaults(this.codemirror, { mode : this.lang });","\tcode.super_.call(this, list, path, options);","}","util.inherits(code, FieldType);","","/* Inherit from TextType prototype */","code.prototype.addFilterToQuery = TextType.prototype.addFilterToQuery;","","/* Export Field Type */","exports = module.exports = code;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"21":1,"24":1,"27":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/text/TextType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/text/TextType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"text","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":35}}},"2":{"name":"(anonymous_2)","line":20,"loc":{"start":{"line":20,"column":34},"end":{"line":20,"column":58}}},"3":{"name":"(anonymous_3)","line":42,"loc":{"start":{"line":42,"column":22},"end":{"line":42,"column":68}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":27}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":38}},"4":{"start":{"line":10,"column":0},"end":{"line":14,"column":1}},"5":{"start":{"line":11,"column":1},"end":{"line":11,"column":27}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":36}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":45}},"8":{"start":{"line":15,"column":0},"end":{"line":15,"column":31}},"9":{"start":{"line":20,"column":0},"end":{"line":37,"column":2}},"10":{"start":{"line":21,"column":1},"end":{"line":21,"column":21}},"11":{"start":{"line":22,"column":1},"end":{"line":25,"column":2}},"12":{"start":{"line":23,"column":2},"end":{"line":23,"column":80}},"13":{"start":{"line":24,"column":2},"end":{"line":24,"column":9}},"14":{"start":{"line":26,"column":1},"end":{"line":26,"column":46}},"15":{"start":{"line":27,"column":1},"end":{"line":33,"column":2}},"16":{"start":{"line":28,"column":2},"end":{"line":28,"column":22}},"17":{"start":{"line":29,"column":8},"end":{"line":33,"column":2}},"18":{"start":{"line":30,"column":2},"end":{"line":30,"column":22}},"19":{"start":{"line":31,"column":8},"end":{"line":33,"column":2}},"20":{"start":{"line":32,"column":2},"end":{"line":32,"column":28}},"21":{"start":{"line":34,"column":1},"end":{"line":34,"column":60}},"22":{"start":{"line":35,"column":1},"end":{"line":35,"column":60}},"23":{"start":{"line":36,"column":1},"end":{"line":36,"column":14}},"24":{"start":{"line":42,"column":0},"end":{"line":44,"column":2}},"25":{"start":{"line":43,"column":1},"end":{"line":43,"column":77}},"26":{"start":{"line":47,"column":0},"end":{"line":47,"column":32}}},"branchMap":{"1":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":9},"end":{"line":21,"column":14}},{"start":{"line":21,"column":18},"end":{"line":21,"column":20}}]},"2":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},{"start":{"line":22,"column":1},"end":{"line":22,"column":1}}]},"3":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":5},"end":{"line":22,"column":28}},{"start":{"line":22,"column":32},"end":{"line":22,"column":45}}]},"4":{"line":23,"type":"cond-expr","locations":[{"start":{"line":23,"column":37},"end":{"line":23,"column":57}},{"start":{"line":23,"column":60},"end":{"line":23,"column":79}}]},"5":{"line":27,"type":"if","locations":[{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},{"start":{"line":27,"column":1},"end":{"line":27,"column":1}}]},"6":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":8},"end":{"line":29,"column":8}},{"start":{"line":29,"column":8},"end":{"line":29,"column":8}}]},"7":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":8},"end":{"line":31,"column":8}},{"start":{"line":31,"column":8},"end":{"line":31,"column":8}}]},"8":{"line":34,"type":"cond-expr","locations":[{"start":{"line":34,"column":50},"end":{"line":34,"column":52}},{"start":{"line":34,"column":55},"end":{"line":34,"column":58}}]},"9":{"line":35,"type":"cond-expr","locations":[{"start":{"line":35,"column":36},"end":{"line":35,"column":51}},{"start":{"line":35,"column":54},"end":{"line":35,"column":59}}]}},"code":["var FieldType = require('../Type');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Text FieldType Constructor"," * @extends Field"," * @api public"," */","function text(list, path, options) {","\tthis._nativeType = String;","\tthis._underscoreMethods = ['crop'];","\ttext.super_.call(this, list, path, options);","}","util.inherits(text, FieldType);","","/**"," * Add filters to a query"," */","text.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tif (filter.mode === 'match' && !filter.value) {","\t\tquery[this.path] = filter.invert ? { $nin: ['', null] } : { $in: ['', null] };","\t\treturn;","\t}","\tvar value = utils.escapeRegExp(filter.value);","\tif (filter.mode === 'startsWith') {","\t\tvalue = '^' + value;","\t} else if (filter.mode === 'endsWith') {","\t\tvalue = value + '$';","\t} else if (filter.mode === 'match') {","\t\tvalue = '^' + value + '$';","\t}","\tvalue = new RegExp(value, filter.caseSensitive ? '' : 'i');","\tquery[this.path] = filter.invert ? { $not: value } : value;","\treturn query;","};","","/**"," * Crops the string to the specifed length."," */","text.prototype.crop = function(item, length, append, preserveWords) {","\treturn utils.cropString(item.get(this.path), length, append, preserveWords);","};","","/* Export Field Type */","exports = module.exports = text;",""],"l":{"1":1,"2":1,"3":1,"10":1,"11":0,"12":0,"13":0,"15":1,"20":1,"21":0,"22":0,"23":0,"24":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"34":0,"35":0,"36":0,"42":1,"43":0,"47":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/color/ColorType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/color/ColorType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":1,"8":1},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"color","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":36}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":6,"column":29}},"2":{"start":{"line":14,"column":0},"end":{"line":22,"column":1}},"3":{"start":{"line":16,"column":1},"end":{"line":16,"column":27}},"4":{"start":{"line":17,"column":1},"end":{"line":17,"column":30}},"5":{"start":{"line":18,"column":1},"end":{"line":18,"column":27}},"6":{"start":{"line":20,"column":1},"end":{"line":20,"column":46}},"7":{"start":{"line":28,"column":0},"end":{"line":28,"column":29}},"8":{"start":{"line":35,"column":0},"end":{"line":35,"column":33}}},"branchMap":{},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tsuper_ = require('../Type');","","/**"," * Color FieldType Constructor"," * @extends Field"," * @api public"," */","","function color(list, path, options) {","\t","\tthis._nativeType = String;","\tthis._underscoreMethods = [];","\tthis._fixedSize = 'small';","\t","\tcolor.super_.call(this, list, path, options);","\t","}","","/*!"," * Inherit from Field"," */","","util.inherits(color, super_);","","","/*!"," * Export class"," */","","exports = module.exports = color;",""],"l":{"5":1,"14":1,"16":0,"17":0,"18":0,"20":0,"28":1,"35":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/date/DateType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/date/DateType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":1,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":1,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":1,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":1,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"date","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":35}}},"2":{"name":"(anonymous_2)","line":31,"loc":{"start":{"line":31,"column":34},"end":{"line":31,"column":58}}},"3":{"name":"(anonymous_3)","line":64,"loc":{"start":{"line":64,"column":24},"end":{"line":64,"column":47}}},"4":{"name":"(anonymous_4)","line":75,"loc":{"start":{"line":75,"column":24},"end":{"line":75,"column":39}}},"5":{"name":"(anonymous_5)","line":84,"loc":{"start":{"line":84,"column":23},"end":{"line":84,"column":38}}},"6":{"name":"(anonymous_6)","line":95,"loc":{"start":{"line":95,"column":31},"end":{"line":95,"column":62}}},"7":{"name":"(anonymous_7)","line":110,"loc":{"start":{"line":110,"column":28},"end":{"line":110,"column":49}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":31}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":11,"column":0},"end":{"line":25,"column":1}},"5":{"start":{"line":12,"column":1},"end":{"line":12,"column":25}},"6":{"start":{"line":13,"column":1},"end":{"line":13,"column":57}},"7":{"start":{"line":14,"column":1},"end":{"line":14,"column":27}},"8":{"start":{"line":15,"column":1},"end":{"line":15,"column":76}},"9":{"start":{"line":16,"column":1},"end":{"line":16,"column":55}},"10":{"start":{"line":17,"column":1},"end":{"line":17,"column":89}},"11":{"start":{"line":18,"column":1},"end":{"line":18,"column":95}},"12":{"start":{"line":19,"column":1},"end":{"line":19,"column":36}},"13":{"start":{"line":20,"column":1},"end":{"line":20,"column":35}},"14":{"start":{"line":21,"column":1},"end":{"line":23,"column":2}},"15":{"start":{"line":22,"column":2},"end":{"line":22,"column":70}},"16":{"start":{"line":24,"column":1},"end":{"line":24,"column":45}},"17":{"start":{"line":26,"column":0},"end":{"line":26,"column":31}},"18":{"start":{"line":31,"column":0},"end":{"line":59,"column":2}},"19":{"start":{"line":32,"column":1},"end":{"line":32,"column":21}},"20":{"start":{"line":33,"column":1},"end":{"line":57,"column":2}},"21":{"start":{"line":34,"column":2},"end":{"line":43,"column":3}},"22":{"start":{"line":35,"column":3},"end":{"line":35,"column":39}},"23":{"start":{"line":36,"column":3},"end":{"line":36,"column":41}},"24":{"start":{"line":37,"column":3},"end":{"line":42,"column":4}},"25":{"start":{"line":38,"column":4},"end":{"line":41,"column":6}},"26":{"start":{"line":44,"column":8},"end":{"line":57,"column":2}},"27":{"start":{"line":45,"column":2},"end":{"line":45,"column":38}},"28":{"start":{"line":46,"column":2},"end":{"line":56,"column":3}},"29":{"start":{"line":47,"column":3},"end":{"line":47,"column":52}},"30":{"start":{"line":48,"column":3},"end":{"line":48,"column":51}},"31":{"start":{"line":49,"column":3},"end":{"line":55,"column":4}},"32":{"start":{"line":50,"column":4},"end":{"line":50,"column":39}},"33":{"start":{"line":51,"column":10},"end":{"line":55,"column":4}},"34":{"start":{"line":52,"column":4},"end":{"line":52,"column":40}},"35":{"start":{"line":54,"column":4},"end":{"line":54,"column":53}},"36":{"start":{"line":58,"column":1},"end":{"line":58,"column":14}},"37":{"start":{"line":64,"column":0},"end":{"line":70,"column":2}},"38":{"start":{"line":65,"column":1},"end":{"line":69,"column":2}},"39":{"start":{"line":66,"column":2},"end":{"line":66,"column":88}},"40":{"start":{"line":68,"column":2},"end":{"line":68,"column":35}},"41":{"start":{"line":75,"column":0},"end":{"line":79,"column":2}},"42":{"start":{"line":76,"column":1},"end":{"line":76,"column":37}},"43":{"start":{"line":77,"column":1},"end":{"line":77,"column":25}},"44":{"start":{"line":77,"column":17},"end":{"line":77,"column":25}},"45":{"start":{"line":78,"column":1},"end":{"line":78,"column":10}},"46":{"start":{"line":84,"column":0},"end":{"line":89,"column":2}},"47":{"start":{"line":85,"column":1},"end":{"line":85,"column":42}},"48":{"start":{"line":86,"column":1},"end":{"line":86,"column":69}},"49":{"start":{"line":87,"column":1},"end":{"line":87,"column":82}},"50":{"start":{"line":88,"column":1},"end":{"line":88,"column":17}},"51":{"start":{"line":95,"column":0},"end":{"line":105,"column":2}},"52":{"start":{"line":96,"column":1},"end":{"line":96,"column":70}},"53":{"start":{"line":96,"column":58},"end":{"line":96,"column":70}},"54":{"start":{"line":97,"column":1},"end":{"line":97,"column":62}},"55":{"start":{"line":98,"column":1},"end":{"line":104,"column":2}},"56":{"start":{"line":99,"column":2},"end":{"line":99,"column":15}},"57":{"start":{"line":100,"column":8},"end":{"line":104,"column":2}},"58":{"start":{"line":101,"column":2},"end":{"line":101,"column":15}},"59":{"start":{"line":103,"column":2},"end":{"line":103,"column":14}},"60":{"start":{"line":110,"column":0},"end":{"line":123,"column":2}},"61":{"start":{"line":111,"column":1},"end":{"line":113,"column":2}},"62":{"start":{"line":112,"column":2},"end":{"line":112,"column":9}},"63":{"start":{"line":114,"column":1},"end":{"line":114,"column":42}},"64":{"start":{"line":115,"column":1},"end":{"line":115,"column":57}},"65":{"start":{"line":116,"column":1},"end":{"line":122,"column":2}},"66":{"start":{"line":117,"column":2},"end":{"line":119,"column":3}},"67":{"start":{"line":118,"column":3},"end":{"line":118,"column":42}},"68":{"start":{"line":120,"column":8},"end":{"line":122,"column":2}},"69":{"start":{"line":121,"column":2},"end":{"line":121,"column":28}},"70":{"start":{"line":126,"column":0},"end":{"line":126,"column":32}}},"branchMap":{"1":{"line":16,"type":"binary-expr","locations":[{"start":{"line":16,"column":24},"end":{"line":16,"column":38}},{"start":{"line":16,"column":42},"end":{"line":16,"column":54}}]},"2":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":48},"end":{"line":17,"column":53}},{"start":{"line":17,"column":57},"end":{"line":17,"column":87}}]},"3":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":57},"end":{"line":17,"column":71}},{"start":{"line":17,"column":75},"end":{"line":17,"column":87}}]},"4":{"line":18,"type":"cond-expr","locations":[{"start":{"line":18,"column":42},"end":{"line":18,"column":89}},{"start":{"line":18,"column":92},"end":{"line":18,"column":94}}]},"5":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":14},"end":{"line":20,"column":25}},{"start":{"line":20,"column":29},"end":{"line":20,"column":34}}]},"6":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},{"start":{"line":21,"column":1},"end":{"line":21,"column":1}}]},"7":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":5},"end":{"line":21,"column":20}},{"start":{"line":21,"column":24},"end":{"line":21,"column":59}}]},"8":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":9},"end":{"line":32,"column":14}},{"start":{"line":32,"column":18},"end":{"line":32,"column":20}}]},"9":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},{"start":{"line":33,"column":1},"end":{"line":33,"column":1}}]},"10":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":2},"end":{"line":34,"column":2}},{"start":{"line":34,"column":2},"end":{"line":34,"column":2}}]},"11":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":6},"end":{"line":34,"column":18}},{"start":{"line":34,"column":22},"end":{"line":34,"column":35}}]},"12":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":3},"end":{"line":37,"column":3}},{"start":{"line":37,"column":3},"end":{"line":37,"column":3}}]},"13":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":7},"end":{"line":37,"column":29}},{"start":{"line":37,"column":33},"end":{"line":37,"column":56}}]},"14":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":8},"end":{"line":44,"column":8}},{"start":{"line":44,"column":8},"end":{"line":44,"column":8}}]},"15":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":2},"end":{"line":46,"column":2}},{"start":{"line":46,"column":2},"end":{"line":46,"column":2}}]},"16":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":3},"end":{"line":49,"column":3}},{"start":{"line":49,"column":3},"end":{"line":49,"column":3}}]},"17":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":10},"end":{"line":51,"column":10}},{"start":{"line":51,"column":10},"end":{"line":51,"column":10}}]},"18":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},{"start":{"line":65,"column":1},"end":{"line":65,"column":1}}]},"19":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":5},"end":{"line":65,"column":11}},{"start":{"line":65,"column":15},"end":{"line":65,"column":30}}]},"20":{"line":66,"type":"cond-expr","locations":[{"start":{"line":66,"column":31},"end":{"line":66,"column":82}},{"start":{"line":66,"column":85},"end":{"line":66,"column":87}}]},"21":{"line":66,"type":"binary-expr","locations":[{"start":{"line":66,"column":56},"end":{"line":66,"column":62}},{"start":{"line":66,"column":66},"end":{"line":66,"column":81}}]},"22":{"line":68,"type":"binary-expr","locations":[{"start":{"line":68,"column":9},"end":{"line":68,"column":28}},{"start":{"line":68,"column":32},"end":{"line":68,"column":34}}]},"23":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},{"start":{"line":77,"column":1},"end":{"line":77,"column":1}}]},"24":{"line":85,"type":"cond-expr","locations":[{"start":{"line":85,"column":22},"end":{"line":85,"column":32}},{"start":{"line":85,"column":35},"end":{"line":85,"column":41}}]},"25":{"line":87,"type":"cond-expr","locations":[{"start":{"line":87,"column":56},"end":{"line":87,"column":73}},{"start":{"line":87,"column":76},"end":{"line":87,"column":80}}]},"26":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":22},"end":{"line":87,"column":30}},{"start":{"line":87,"column":34},"end":{"line":87,"column":52}}]},"27":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":1},"end":{"line":96,"column":1}},{"start":{"line":96,"column":1},"end":{"line":96,"column":1}}]},"28":{"line":96,"type":"binary-expr","locations":[{"start":{"line":96,"column":5},"end":{"line":96,"column":25}},{"start":{"line":96,"column":29},"end":{"line":96,"column":33}},{"start":{"line":96,"column":37},"end":{"line":96,"column":56}}]},"29":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":1},"end":{"line":98,"column":1}},{"start":{"line":98,"column":1},"end":{"line":98,"column":1}}]},"30":{"line":98,"type":"binary-expr","locations":[{"start":{"line":98,"column":5},"end":{"line":98,"column":13}},{"start":{"line":98,"column":18},"end":{"line":98,"column":37}}]},"31":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":8},"end":{"line":100,"column":8}},{"start":{"line":100,"column":8},"end":{"line":100,"column":8}}]},"32":{"line":100,"type":"binary-expr","locations":[{"start":{"line":100,"column":12},"end":{"line":100,"column":27}},{"start":{"line":100,"column":31},"end":{"line":100,"column":39}},{"start":{"line":100,"column":43},"end":{"line":100,"column":62}}]},"33":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":1},"end":{"line":111,"column":1}},{"start":{"line":111,"column":1},"end":{"line":111,"column":1}}]},"34":{"line":114,"type":"cond-expr","locations":[{"start":{"line":114,"column":22},"end":{"line":114,"column":32}},{"start":{"line":114,"column":35},"end":{"line":114,"column":41}}]},"35":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":1},"end":{"line":116,"column":1}},{"start":{"line":116,"column":1},"end":{"line":116,"column":1}}]},"36":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":2},"end":{"line":117,"column":2}},{"start":{"line":117,"column":2},"end":{"line":117,"column":2}}]},"37":{"line":117,"type":"binary-expr","locations":[{"start":{"line":117,"column":6},"end":{"line":117,"column":26}},{"start":{"line":117,"column":30},"end":{"line":117,"column":67}}]},"38":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":8},"end":{"line":120,"column":8}},{"start":{"line":120,"column":8},"end":{"line":120,"column":8}}]}},"code":["var FieldType = require('../Type');","var moment = require('moment');","var util = require('util');","","/**"," * Date FieldType Constructor"," * @extends Field"," * @api public"," */","","function date(list, path, options) {","\tthis._nativeType = Date;","\tthis._underscoreMethods = ['format', 'moment', 'parse'];","\tthis._fixedSize = 'large';","\tthis._properties = ['dateFormat', 'datePlaceholder', 'yearRange', 'isUTC'];","\tthis.parseDateFormat = options.format || 'YYYY-MM-DD';","\tthis.dateFormat = (options.format === false) ? false : (options.format || 'YYYY-MM-DD');","\tthis.datePlaceholder = this.dateFormat ? 'e.g. ' + moment().format(this.parseDateFormat) : '';","\tthis.yearRange = options.yearRange;","\tthis.isUTC = options.utc || false;","\tif (this.dateFormat && 'string' !== typeof this.dateFormat) {","\t\tthrow new Error('FieldType.Date: options.format must be a string.');","\t}","\tdate.super_.call(this, list, path, options);","}","util.inherits(date, FieldType);","","/**"," * Add filters to a query"," */","date.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tif (filter.mode === 'between') {","\t\tif (filter.after && filter.before) {","\t\t\tfilter.after = moment(filter.after);","\t\t\tfilter.before = moment(filter.before);","\t\t\tif (filter.after.isValid() && filter.before.isValid()) {","\t\t\t\tquery[this.path] = {","\t\t\t\t\t$gte: filter.after.startOf('day').toDate(),","\t\t\t\t\t$lte: filter.before.endOf('day').toDate()","\t\t\t\t};","\t\t\t}","\t\t}","\t} else if (filter.value) {","\t\tfilter.value = moment(filter.value);","\t\tif (filter.value.isValid()) {","\t\t\tvar after = filter.value.startOf('day').toDate();","\t\t\tvar before = filter.value.endOf('day').toDate();","\t\t\tif (filter.mode === 'after') {","\t\t\t\tquery[this.path] = { $gte: after };","\t\t\t} else if (filter.mode === 'before') {","\t\t\t\tquery[this.path] = { $lte: before };","\t\t\t} else {","\t\t\t\tquery[this.path] = { $gte: after, $lte: before };","\t\t\t}","\t\t}","\t}","\treturn query;","};","","/**"," * Formats the field value"," */","date.prototype.format = function(item, format) {","\tif (format || this.dateFormat) {","\t\treturn item.get(this.path) ? this.moment(item).format(format || this.dateFormat) : '';","\t} else {","\t\treturn item.get(this.path) || '';","\t}","};","","/**"," * Returns a new `moment` object with the field value"," */","date.prototype.moment = function(item) {","\tvar m = moment(item.get(this.path));","\tif (this.isUTC) m.utc();","\treturn m;","};","","/**"," * Parses input using moment, sets the value, and returns the moment object."," */","date.prototype.parse = function(item) {","\tvar m = this.isUTC ? moment.utc : moment;","\tvar newValue = m.apply(m, Array.prototype.slice.call(arguments, 1));","\titem.set(this.path, (newValue && newValue.isValid()) ? newValue.toDate() : null);","\treturn newValue;","};","","/**"," * Checks that a valid date has been provided in a data object"," * An empty value clears the stored value and is considered valid"," */","date.prototype.validateInput = function(data, required, item) {","\tif (!(this.path in data) && item && item.get(this.path)) return true;","\tvar newValue = moment(data[this.path], this.parseDateFormat);","\tif (required && (!newValue.isValid())) {","\t\treturn false;","\t} else if (data[this.path] && newValue && !newValue.isValid()) {","\t\treturn false;","\t} else {","\t\treturn true;","\t}","};","","/**"," * Updates the value for this field in the item from a data object"," */","date.prototype.updateItem = function(item, data) {","\tif (!(this.path in data)) {","\t\treturn;","\t}","\tvar m = this.isUTC ? moment.utc : moment;","\tvar newValue = m(data[this.path], this.parseDateFormat);","\tif (newValue.isValid()) {","\t\tif (!item.get(this.path) || !newValue.isSame(item.get(this.path))) {","\t\t\titem.set(this.path, newValue.toDate());","\t\t}","\t} else if (item.get(this.path)) {","\t\titem.set(this.path, null);","\t}","};","","/* Export Field Type */","exports = module.exports = date;",""],"l":{"1":1,"2":1,"3":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"24":0,"26":1,"31":1,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"54":0,"58":0,"64":1,"65":0,"66":0,"68":0,"75":1,"76":0,"77":0,"78":0,"84":1,"85":0,"86":0,"87":0,"88":0,"95":1,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"103":0,"110":1,"111":0,"112":0,"114":0,"115":0,"116":0,"117":0,"118":0,"120":0,"121":0,"126":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/datearray/DateArrayType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/datearray/DateArrayType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":0,"15":0,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":1,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0,0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"datearray","line":15,"loc":{"start":{"line":15,"column":0},"end":{"line":15,"column":40}}},"2":{"name":"(anonymous_2)","line":44,"loc":{"start":{"line":44,"column":29},"end":{"line":44,"column":52}}},"3":{"name":"(anonymous_3)","line":60,"loc":{"start":{"line":60,"column":36},"end":{"line":60,"column":67}}},"4":{"name":"(anonymous_4)","line":86,"loc":{"start":{"line":86,"column":23},"end":{"line":86,"column":38}}},"5":{"name":"(anonymous_5)","line":94,"loc":{"start":{"line":94,"column":17},"end":{"line":94,"column":38}}},"6":{"name":"(anonymous_6)","line":110,"loc":{"start":{"line":110,"column":33},"end":{"line":110,"column":54}}},"7":{"name":"(anonymous_7)","line":117,"loc":{"start":{"line":117,"column":24},"end":{"line":117,"column":39}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":7,"column":29}},"2":{"start":{"line":15,"column":0},"end":{"line":30,"column":1}},"3":{"start":{"line":17,"column":1},"end":{"line":17,"column":27}},"4":{"start":{"line":18,"column":1},"end":{"line":18,"column":27}},"5":{"start":{"line":19,"column":1},"end":{"line":19,"column":38}},"6":{"start":{"line":20,"column":1},"end":{"line":20,"column":37}},"7":{"start":{"line":22,"column":1},"end":{"line":22,"column":62}},"8":{"start":{"line":23,"column":1},"end":{"line":23,"column":92}},"9":{"start":{"line":25,"column":1},"end":{"line":27,"column":2}},"10":{"start":{"line":26,"column":2},"end":{"line":26,"column":70}},"11":{"start":{"line":29,"column":1},"end":{"line":29,"column":50}},"12":{"start":{"line":36,"column":0},"end":{"line":36,"column":33}},"13":{"start":{"line":44,"column":0},"end":{"line":50,"column":2}},"14":{"start":{"line":45,"column":1},"end":{"line":49,"column":2}},"15":{"start":{"line":46,"column":2},"end":{"line":46,"column":100}},"16":{"start":{"line":48,"column":2},"end":{"line":48,"column":35}},"17":{"start":{"line":60,"column":0},"end":{"line":101,"column":2}},"18":{"start":{"line":62,"column":1},"end":{"line":62,"column":41}},"19":{"start":{"line":63,"column":1},"end":{"line":63,"column":48}},"20":{"start":{"line":65,"column":1},"end":{"line":70,"column":2}},"21":{"start":{"line":66,"column":2},"end":{"line":68,"column":3}},"22":{"start":{"line":67,"column":3},"end":{"line":67,"column":16}},"23":{"start":{"line":69,"column":2},"end":{"line":69,"column":18}},"24":{"start":{"line":72,"column":1},"end":{"line":82,"column":2}},"25":{"start":{"line":73,"column":2},"end":{"line":75,"column":3}},"26":{"start":{"line":74,"column":3},"end":{"line":74,"column":15}},"27":{"start":{"line":76,"column":2},"end":{"line":78,"column":3}},"28":{"start":{"line":77,"column":3},"end":{"line":77,"column":16}},"29":{"start":{"line":79,"column":2},"end":{"line":81,"column":3}},"30":{"start":{"line":80,"column":3},"end":{"line":80,"column":16}},"31":{"start":{"line":84,"column":1},"end":{"line":97,"column":2}},"32":{"start":{"line":86,"column":2},"end":{"line":88,"column":5}},"33":{"start":{"line":87,"column":3},"end":{"line":87,"column":29}},"34":{"start":{"line":90,"column":2},"end":{"line":92,"column":3}},"35":{"start":{"line":91,"column":3},"end":{"line":91,"column":16}},"36":{"start":{"line":94,"column":2},"end":{"line":96,"column":3}},"37":{"start":{"line":94,"column":40},"end":{"line":94,"column":95}},"38":{"start":{"line":95,"column":3},"end":{"line":95,"column":16}},"39":{"start":{"line":99,"column":1},"end":{"line":99,"column":54}},"40":{"start":{"line":110,"column":0},"end":{"line":133,"column":2}},"41":{"start":{"line":112,"column":1},"end":{"line":112,"column":41}},"42":{"start":{"line":114,"column":1},"end":{"line":132,"column":32}},"43":{"start":{"line":115,"column":2},"end":{"line":120,"column":3}},"44":{"start":{"line":117,"column":3},"end":{"line":119,"column":6}},"45":{"start":{"line":118,"column":4},"end":{"line":118,"column":34}},"46":{"start":{"line":121,"column":2},"end":{"line":123,"column":3}},"47":{"start":{"line":122,"column":3},"end":{"line":122,"column":14}},"48":{"start":{"line":124,"column":2},"end":{"line":128,"column":3}},"49":{"start":{"line":125,"column":3},"end":{"line":127,"column":4}},"50":{"start":{"line":126,"column":4},"end":{"line":126,"column":20}},"51":{"start":{"line":129,"column":2},"end":{"line":131,"column":3}},"52":{"start":{"line":130,"column":3},"end":{"line":130,"column":30}},"53":{"start":{"line":132,"column":8},"end":{"line":132,"column":32}},"54":{"start":{"line":140,"column":0},"end":{"line":140,"column":37}}},"branchMap":{"1":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":26},"end":{"line":22,"column":45}},{"start":{"line":22,"column":49},"end":{"line":22,"column":61}}]},"2":{"line":23,"type":"cond-expr","locations":[{"start":{"line":23,"column":50},"end":{"line":23,"column":55}},{"start":{"line":23,"column":59},"end":{"line":23,"column":90}}]},"3":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":59},"end":{"line":23,"column":73}},{"start":{"line":23,"column":77},"end":{"line":23,"column":90}}]},"4":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},{"start":{"line":25,"column":1},"end":{"line":25,"column":1}}]},"5":{"line":25,"type":"binary-expr","locations":[{"start":{"line":25,"column":5},"end":{"line":25,"column":22}},{"start":{"line":25,"column":26},"end":{"line":25,"column":63}}]},"6":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},{"start":{"line":45,"column":1},"end":{"line":45,"column":1}}]},"7":{"line":45,"type":"binary-expr","locations":[{"start":{"line":45,"column":5},"end":{"line":45,"column":11}},{"start":{"line":45,"column":15},"end":{"line":45,"column":32}}]},"8":{"line":46,"type":"cond-expr","locations":[{"start":{"line":46,"column":31},"end":{"line":46,"column":94}},{"start":{"line":46,"column":97},"end":{"line":46,"column":99}}]},"9":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":66},"end":{"line":46,"column":72}},{"start":{"line":46,"column":76},"end":{"line":46,"column":93}}]},"10":{"line":48,"type":"binary-expr","locations":[{"start":{"line":48,"column":9},"end":{"line":48,"column":28}},{"start":{"line":48,"column":32},"end":{"line":48,"column":34}}]},"11":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},{"start":{"line":65,"column":1},"end":{"line":65,"column":1}}]},"12":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":2},"end":{"line":66,"column":2}},{"start":{"line":66,"column":2},"end":{"line":66,"column":2}}]},"13":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},{"start":{"line":72,"column":1},"end":{"line":72,"column":1}}]},"14":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":2},"end":{"line":73,"column":2}},{"start":{"line":73,"column":2},"end":{"line":73,"column":2}}]},"15":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":6},"end":{"line":73,"column":25}},{"start":{"line":73,"column":29},"end":{"line":73,"column":33}},{"start":{"line":73,"column":37},"end":{"line":73,"column":56}},{"start":{"line":73,"column":60},"end":{"line":73,"column":86}}]},"16":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":2},"end":{"line":76,"column":2}},{"start":{"line":76,"column":2},"end":{"line":76,"column":2}}]},"17":{"line":76,"type":"binary-expr","locations":[{"start":{"line":76,"column":6},"end":{"line":76,"column":25}},{"start":{"line":76,"column":29},"end":{"line":76,"column":50}}]},"18":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":2},"end":{"line":79,"column":2}},{"start":{"line":79,"column":2},"end":{"line":79,"column":2}}]},"19":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":6},"end":{"line":79,"column":26}},{"start":{"line":79,"column":30},"end":{"line":79,"column":43}}]},"20":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},{"start":{"line":84,"column":1},"end":{"line":84,"column":1}}]},"21":{"line":90,"type":"if","locations":[{"start":{"line":90,"column":2},"end":{"line":90,"column":2}},{"start":{"line":90,"column":2},"end":{"line":90,"column":2}}]},"22":{"line":90,"type":"binary-expr","locations":[{"start":{"line":90,"column":6},"end":{"line":90,"column":14}},{"start":{"line":90,"column":18},"end":{"line":90,"column":31}}]},"23":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":2},"end":{"line":94,"column":2}},{"start":{"line":94,"column":2},"end":{"line":94,"column":2}}]},"24":{"line":99,"type":"binary-expr","locations":[{"start":{"line":99,"column":9},"end":{"line":99,"column":28}},{"start":{"line":99,"column":32},"end":{"line":99,"column":52}}]},"25":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":1},"end":{"line":114,"column":1}},{"start":{"line":114,"column":1},"end":{"line":114,"column":1}}]},"26":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":2},"end":{"line":115,"column":2}},{"start":{"line":115,"column":2},"end":{"line":115,"column":2}}]},"27":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":2},"end":{"line":121,"column":2}},{"start":{"line":121,"column":2},"end":{"line":121,"column":2}}]},"28":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":2},"end":{"line":124,"column":2}},{"start":{"line":124,"column":2},"end":{"line":124,"column":2}}]},"29":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":3},"end":{"line":125,"column":3}},{"start":{"line":125,"column":3},"end":{"line":125,"column":3}}]},"30":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":2},"end":{"line":129,"column":2}},{"start":{"line":129,"column":2},"end":{"line":129,"column":2}}]}},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tmoment = require('moment'),","\tsuper_ = require('../Type');","","/**"," * Date FieldType Constructor"," * @extends Field"," * @api public"," */","","function datearray(list, path, options) {","\t","\tthis._nativeType = [Date];","\tthis._fixedSize = 'large';","\tthis._underscoreMethods = ['format'];","\tthis._properties = ['formatString'];","","\tthis.parseFormatString = options.parseFormat || 'YYYY-MM-DD';","\tthis.formatString = (options.format === false) ? false : (options.format || 'Do MMM YYYY');","\t","\tif (this.formatString && 'string' !== typeof this.formatString) {","\t\tthrow new Error('FieldType.Date: options.format must be a string.');","\t}","\t","\tdatearray.super_.call(this, list, path, options);","}","","/*!"," * Inherit from Field"," */","","util.inherits(datearray, super_);","","/**"," * Formats the field value"," *"," * @api public"," */","","datearray.prototype.format = function(item, format) {","\tif (format || this.formatString) {","\t\treturn item.get(this.path) ? moment(item.get(this.path)).format(format || this.formatString) : '';","\t} else {","\t\treturn item.get(this.path) || '';","\t}","};","","/**"," * Checks that a valid array of dates has been provided in a data object"," *"," * An empty value clears the stored value and is considered valid"," *"," * @api public"," */","","datearray.prototype.validateInput = function(data, required, item) {","","\tvar value = this.getValueFromData(data);","\tvar parseFormatString = this.parseFormatString;","","\tif ('string' === typeof value) {","\t\tif (!moment(value, parseFormatString).isValid()) {","\t\t\treturn false;","\t\t}","\t\tvalue = [value];","\t}","\t","\tif (required) {","\t\tif (value === undefined && item && item.get(this.path) && item.get(this.path).length) {","\t\t\treturn true;","\t\t}","\t\tif (value === undefined || !Array.isArray(value)) {","\t\t\treturn false;","\t\t}","\t\tif (Array.isArray(value) && !value.length) {","\t\t\treturn false;","\t\t}","\t}","\t","\tif (Array.isArray(value)) {","\t\t// filter out empty fields","\t\tvalue = value.filter(function(date) {","\t\t\treturn date.trim() !== '';","\t\t});","\t\t// if there are no values left, and requried is true, return false","\t\tif (required && !value.length) {","\t\t\treturn false;","\t\t}","\t\t// if any date in the array is invalid, return false","\t\tif (value.some(function (dateValue) { return !moment(dateValue, parseFormatString).isValid(); })) {","\t\t\treturn false;","\t\t}","\t}","","\treturn (value === undefined || Array.isArray(value));","","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","datearray.prototype.updateItem = function(item, data) {","","\tvar value = this.getValueFromData(data);","\t","\tif (value !== undefined) {","\t\tif (Array.isArray(value)) {","\t\t\t// Only save valid dates","\t\t\tvalue = value.filter(function(date) {","\t\t\t\treturn moment(date).isValid();","\t\t\t});","\t\t}","\t\tif (value === null) {","\t\t\tvalue = [];","\t\t}","\t\tif ('string' === typeof value) {","\t\t\tif (moment(value).isValid()) {","\t\t\t\tvalue = [value];","\t\t\t}","\t\t}","\t\tif (Array.isArray(value)) {","\t\t\titem.set(this.path, value);","\t\t}","\t} else item.set(this.path, []);","};","","","/*!"," * Export class"," */","","exports = module.exports = datearray;",""],"l":{"5":1,"15":1,"17":0,"18":0,"19":0,"20":0,"22":0,"23":0,"25":0,"26":0,"29":0,"36":1,"44":1,"45":0,"46":0,"48":0,"60":1,"62":0,"63":0,"65":0,"66":0,"67":0,"69":0,"72":0,"73":0,"74":0,"76":0,"77":0,"79":0,"80":0,"84":0,"86":0,"87":0,"90":0,"91":0,"94":0,"95":0,"99":0,"110":1,"112":0,"114":0,"115":0,"117":0,"118":0,"121":0,"122":0,"124":0,"125":0,"126":0,"129":0,"130":0,"132":0,"140":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/datetime/DatetimeType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/datetime/DatetimeType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":1,"37":1,"38":1,"39":1,"40":1,"41":1,"42":0,"43":0,"44":0,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0,0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0],"18":[0,0],"19":[0,0,0],"20":[0,0],"21":[0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"datetime","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":39}}},"2":{"name":"(anonymous_2)","line":31,"loc":{"start":{"line":31,"column":22},"end":{"line":31,"column":41}}},"3":{"name":"(anonymous_3)","line":72,"loc":{"start":{"line":72,"column":38},"end":{"line":72,"column":53}}},"4":{"name":"(anonymous_4)","line":84,"loc":{"start":{"line":84,"column":35},"end":{"line":84,"column":66}}},"5":{"name":"(anonymous_5)","line":99,"loc":{"start":{"line":99,"column":32},"end":{"line":99,"column":53}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":31}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":43}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":30}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":114}},"7":{"start":{"line":14,"column":0},"end":{"line":60,"column":1}},"8":{"start":{"line":15,"column":1},"end":{"line":15,"column":25}},"9":{"start":{"line":16,"column":1},"end":{"line":16,"column":57}},"10":{"start":{"line":17,"column":1},"end":{"line":17,"column":27}},"11":{"start":{"line":18,"column":1},"end":{"line":18,"column":112}},"12":{"start":{"line":19,"column":1},"end":{"line":19,"column":40}},"13":{"start":{"line":20,"column":1},"end":{"line":20,"column":62}},"14":{"start":{"line":21,"column":1},"end":{"line":21,"column":101}},"15":{"start":{"line":24,"column":1},"end":{"line":24,"column":45}},"16":{"start":{"line":25,"column":1},"end":{"line":25,"column":20}},"17":{"start":{"line":27,"column":1},"end":{"line":27,"column":17}},"18":{"start":{"line":29,"column":1},"end":{"line":49,"column":2}},"19":{"start":{"line":31,"column":2},"end":{"line":37,"column":5}},"20":{"start":{"line":32,"column":3},"end":{"line":32,"column":55}},"21":{"start":{"line":34,"column":3},"end":{"line":36,"column":4}},"22":{"start":{"line":35,"column":4},"end":{"line":35,"column":26}},"23":{"start":{"line":39,"column":2},"end":{"line":39,"column":65}},"24":{"start":{"line":40,"column":2},"end":{"line":40,"column":62}},"25":{"start":{"line":41,"column":2},"end":{"line":41,"column":68}},"26":{"start":{"line":42,"column":2},"end":{"line":42,"column":68}},"27":{"start":{"line":45,"column":2},"end":{"line":45,"column":23}},"28":{"start":{"line":46,"column":2},"end":{"line":46,"column":23}},"29":{"start":{"line":47,"column":2},"end":{"line":47,"column":28}},"30":{"start":{"line":48,"column":2},"end":{"line":48,"column":28}},"31":{"start":{"line":51,"column":1},"end":{"line":51,"column":35}},"32":{"start":{"line":52,"column":1},"end":{"line":54,"column":2}},"33":{"start":{"line":53,"column":2},"end":{"line":53,"column":74}},"34":{"start":{"line":55,"column":1},"end":{"line":55,"column":49}},"35":{"start":{"line":56,"column":1},"end":{"line":59,"column":3}},"36":{"start":{"line":61,"column":0},"end":{"line":61,"column":35}},"37":{"start":{"line":64,"column":0},"end":{"line":64,"column":74}},"38":{"start":{"line":65,"column":0},"end":{"line":65,"column":54}},"39":{"start":{"line":66,"column":0},"end":{"line":66,"column":54}},"40":{"start":{"line":67,"column":0},"end":{"line":67,"column":52}},"41":{"start":{"line":72,"column":0},"end":{"line":78,"column":2}},"42":{"start":{"line":73,"column":1},"end":{"line":77,"column":2}},"43":{"start":{"line":74,"column":2},"end":{"line":74,"column":70}},"44":{"start":{"line":76,"column":2},"end":{"line":76,"column":25}},"45":{"start":{"line":84,"column":0},"end":{"line":94,"column":2}},"46":{"start":{"line":85,"column":1},"end":{"line":85,"column":127}},"47":{"start":{"line":85,"column":115},"end":{"line":85,"column":127}},"48":{"start":{"line":86,"column":1},"end":{"line":86,"column":66}},"49":{"start":{"line":87,"column":1},"end":{"line":93,"column":2}},"50":{"start":{"line":88,"column":2},"end":{"line":88,"column":15}},"51":{"start":{"line":89,"column":8},"end":{"line":93,"column":2}},"52":{"start":{"line":90,"column":2},"end":{"line":90,"column":15}},"53":{"start":{"line":92,"column":2},"end":{"line":92,"column":14}},"54":{"start":{"line":99,"column":0},"end":{"line":112,"column":2}},"55":{"start":{"line":100,"column":1},"end":{"line":102,"column":2}},"56":{"start":{"line":101,"column":2},"end":{"line":101,"column":9}},"57":{"start":{"line":103,"column":1},"end":{"line":103,"column":42}},"58":{"start":{"line":104,"column":1},"end":{"line":104,"column":66}},"59":{"start":{"line":105,"column":1},"end":{"line":111,"column":2}},"60":{"start":{"line":106,"column":2},"end":{"line":108,"column":3}},"61":{"start":{"line":107,"column":3},"end":{"line":107,"column":42}},"62":{"start":{"line":109,"column":8},"end":{"line":111,"column":2}},"63":{"start":{"line":110,"column":2},"end":{"line":110,"column":28}},"64":{"start":{"line":115,"column":0},"end":{"line":115,"column":36}}},"branchMap":{"1":{"line":20,"type":"binary-expr","locations":[{"start":{"line":20,"column":26},"end":{"line":20,"column":45}},{"start":{"line":20,"column":49},"end":{"line":20,"column":61}}]},"2":{"line":21,"type":"cond-expr","locations":[{"start":{"line":21,"column":50},"end":{"line":21,"column":55}},{"start":{"line":21,"column":59},"end":{"line":21,"column":99}}]},"3":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":59},"end":{"line":21,"column":73}},{"start":{"line":21,"column":77},"end":{"line":21,"column":99}}]},"4":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},{"start":{"line":29,"column":1},"end":{"line":29,"column":1}}]},"5":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":3},"end":{"line":34,"column":3}},{"start":{"line":34,"column":3},"end":{"line":34,"column":3}}]},"6":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":7},"end":{"line":34,"column":23}},{"start":{"line":34,"column":27},"end":{"line":34,"column":48}},{"start":{"line":34,"column":54},"end":{"line":34,"column":70}},{"start":{"line":34,"column":74},"end":{"line":34,"column":90}}]},"7":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":14},"end":{"line":51,"column":25}},{"start":{"line":51,"column":29},"end":{"line":51,"column":34}}]},"8":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},{"start":{"line":52,"column":1},"end":{"line":52,"column":1}}]},"9":{"line":52,"type":"binary-expr","locations":[{"start":{"line":52,"column":5},"end":{"line":52,"column":22}},{"start":{"line":52,"column":26},"end":{"line":52,"column":63}}]},"10":{"line":73,"type":"if","locations":[{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},{"start":{"line":73,"column":1},"end":{"line":73,"column":1}}]},"11":{"line":73,"type":"binary-expr","locations":[{"start":{"line":73,"column":5},"end":{"line":73,"column":28}},{"start":{"line":73,"column":32},"end":{"line":73,"column":55}}]},"12":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},{"start":{"line":85,"column":1},"end":{"line":85,"column":1}}]},"13":{"line":85,"type":"binary-expr","locations":[{"start":{"line":85,"column":5},"end":{"line":85,"column":82}},{"start":{"line":85,"column":86},"end":{"line":85,"column":90}},{"start":{"line":85,"column":94},"end":{"line":85,"column":113}}]},"14":{"line":85,"type":"binary-expr","locations":[{"start":{"line":85,"column":7},"end":{"line":85,"column":24}},{"start":{"line":85,"column":28},"end":{"line":85,"column":81}}]},"15":{"line":85,"type":"binary-expr","locations":[{"start":{"line":85,"column":30},"end":{"line":85,"column":53}},{"start":{"line":85,"column":57},"end":{"line":85,"column":80}}]},"16":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},{"start":{"line":87,"column":1},"end":{"line":87,"column":1}}]},"17":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":5},"end":{"line":87,"column":13}},{"start":{"line":87,"column":18},"end":{"line":87,"column":27}},{"start":{"line":87,"column":31},"end":{"line":87,"column":50}}]},"18":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":8},"end":{"line":89,"column":8}},{"start":{"line":89,"column":8},"end":{"line":89,"column":8}}]},"19":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":12},"end":{"line":89,"column":39}},{"start":{"line":89,"column":43},"end":{"line":89,"column":51}},{"start":{"line":89,"column":55},"end":{"line":89,"column":74}}]},"20":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},{"start":{"line":100,"column":1},"end":{"line":100,"column":1}}]},"21":{"line":100,"type":"binary-expr","locations":[{"start":{"line":100,"column":7},"end":{"line":100,"column":24}},{"start":{"line":100,"column":29},"end":{"line":100,"column":52}},{"start":{"line":100,"column":56},"end":{"line":100,"column":79}}]},"22":{"line":103,"type":"cond-expr","locations":[{"start":{"line":103,"column":22},"end":{"line":103,"column":32}},{"start":{"line":103,"column":35},"end":{"line":103,"column":41}}]},"23":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},{"start":{"line":105,"column":1},"end":{"line":105,"column":1}}]},"24":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":2},"end":{"line":106,"column":2}},{"start":{"line":106,"column":2},"end":{"line":106,"column":2}}]},"25":{"line":106,"type":"binary-expr","locations":[{"start":{"line":106,"column":6},"end":{"line":106,"column":26}},{"start":{"line":106,"column":30},"end":{"line":106,"column":67}}]},"26":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":8},"end":{"line":109,"column":8}},{"start":{"line":109,"column":8},"end":{"line":109,"column":8}}]}},"code":["var moment = require('moment');","var DateType = require('../date/DateType');","var FieldType = require('../Type');","var util = require('util');","var _ = require('underscore');","","var parseFormats = ['YYYY-MM-DD', 'YYYY-MM-DD h:m:s a', 'YYYY-MM-DD h:m a', 'YYYY-MM-DD H:m:s', 'YYYY-MM-DD H:m'];","","/**"," * DateTime FieldType Constructor"," * @extends Field"," * @api public"," */","function datetime(list, path, options) {","\tthis._nativeType = Date;","\tthis._underscoreMethods = ['format', 'moment', 'parse'];","\tthis._fixedSize = 'large';","\tthis._properties = ['formatString', 'dateFormat', 'timeFormat', 'datePlaceholder', 'timePlaceholder', 'isUTC'];","\tthis.typeDescription = 'date and time';","\tthis.parseFormatString = options.parseFormat || parseFormats;","\tthis.formatString = (options.format === false) ? false : (options.format || 'YYYY-MM-DD h:mm:ss a');","","\t// Create an array of moment time format characters to help find where the time portion of the format string beings","\tvar timeOptions = ['h', 'H', 'm', 's', 'S'];","\tvar timeIndex = -1;","","\tvar that = this;","","\tif(this.formatString) {","\t\t// Loop through each moment time format character to determine which begins the time portion of format to segregate date from time","\t\t_.each(timeOptions, function(timeChar) {","\t\t\tvar charIndex = that.formatString.indexOf(timeChar);","","\t\t\tif((charIndex !== -1 && charIndex < timeIndex) || (charIndex !== -1 && timeIndex === -1)) {","\t\t\t\ttimeIndex = charIndex;","\t\t\t}","\t\t});","","\t\tthis.dateFormat = this.formatString.slice(0, timeIndex).trim();","\t\tthis.timeFormat = this.formatString.slice(timeIndex).trim();","\t\tthis.datePlaceholder = 'e.g. ' + moment().format(this.dateFormat);","\t\tthis.timePlaceholder = 'e.g. ' + moment().format(this.timeFormat);","","\t} else {","\t\tthis.dateFormat = '';","\t\tthis.timeFormat = '';","\t\tthis.datePlaceholder = '';","\t\tthis.timePlaceholder = '';","\t}","","\tthis.isUTC = options.utc || false;","\tif (this.formatString && 'string' !== typeof this.formatString) {","\t\tthrow new Error('FieldType.DateTime: options.format must be a string.');","\t}","\tdatetime.super_.call(this, list, path, options);","\tthis.paths = {","\t\tdate: this._path.append('_date'),","\t\ttime: this._path.append('_time')","\t};","}","util.inherits(datetime, FieldType);","","/* Inherit from DateType prototype */","datetime.prototype.addFilterToQuery = DateType.prototype.addFilterToQuery;","datetime.prototype.format = DateType.prototype.format;","datetime.prototype.moment = DateType.prototype.moment;","datetime.prototype.parse = DateType.prototype.parse;","","/**"," * Get the value from a data object; may be simple or a pair of fields"," */","datetime.prototype.getInputFromData = function(data) {","\tif (this.paths.date in data && this.paths.time in data) {","\t\treturn (data[this.paths.date] + ' ' + data[this.paths.time]).trim();","\t} else {","\t\treturn data[this.path];","\t}","};","","/**"," * Checks that a valid date has been provided in a data object"," * An empty value clears the stored value and is considered valid"," */","datetime.prototype.validateInput = function(data, required, item) {","\tif (!(this.path in data && !(this.paths.date in data && this.paths.time in data)) && item && item.get(this.path)) return true;","\tvar newValue = moment(this.getInputFromData(data), parseFormats);","\tif (required && (!newValue || !newValue.isValid())) {","\t\treturn false;","\t} else if (this.getInputFromData(data) && newValue && !newValue.isValid()) {","\t\treturn false;","\t} else {","\t\treturn true;","\t}","};","","/**"," * Updates the value for this field in the item from a data object"," */","datetime.prototype.updateItem = function(item, data) {","\tif (!(this.path in data || (this.paths.date in data && this.paths.time in data))) {","\t\treturn;","\t}","\tvar m = this.isUTC ? moment.utc : moment;","\tvar newValue = m(this.getInputFromData(data), this.formatString);","\tif (newValue.isValid()) {","\t\tif (!item.get(this.path) || !newValue.isSame(item.get(this.path))) {","\t\t\titem.set(this.path, newValue.toDate());","\t\t}","\t} else if (item.get(this.path)) {","\t\titem.set(this.path, null);","\t}","};","","/* Export Field Type */","exports = module.exports = datetime;",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"7":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"24":0,"25":0,"27":0,"29":0,"31":0,"32":0,"34":0,"35":0,"39":0,"40":0,"41":0,"42":0,"45":0,"46":0,"47":0,"48":0,"51":0,"52":0,"53":0,"55":0,"56":0,"61":1,"64":1,"65":1,"66":1,"67":1,"72":1,"73":0,"74":0,"76":0,"84":1,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"92":0,"99":1,"100":0,"101":0,"103":0,"104":0,"105":0,"106":0,"107":0,"109":0,"110":0,"115":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/email/EmailType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/email/EmailType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":1,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":1,"20":0,"21":0,"22":0,"23":0,"24":1,"25":0,"26":0,"27":0,"28":0,"29":0,"30":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"email","line":12,"loc":{"start":{"line":12,"column":0},"end":{"line":12,"column":36}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":30},"end":{"line":27,"column":73}}},"3":{"name":"(anonymous_3)","line":49,"loc":{"start":{"line":49,"column":32},"end":{"line":49,"column":63}}},"4":{"name":"(anonymous_4)","line":62,"loc":{"start":{"line":62,"column":29},"end":{"line":62,"column":50}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":31}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":43}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":38}},"6":{"start":{"line":12,"column":0},"end":{"line":18,"column":1}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":27}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":43}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":27}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":40}},"11":{"start":{"line":17,"column":1},"end":{"line":17,"column":46}},"12":{"start":{"line":19,"column":0},"end":{"line":19,"column":32}},"13":{"start":{"line":22,"column":0},"end":{"line":22,"column":71}},"14":{"start":{"line":27,"column":0},"end":{"line":44,"column":2}},"15":{"start":{"line":28,"column":1},"end":{"line":28,"column":33}},"16":{"start":{"line":29,"column":1},"end":{"line":31,"column":2}},"17":{"start":{"line":30,"column":2},"end":{"line":30,"column":12}},"18":{"start":{"line":32,"column":1},"end":{"line":43,"column":12}},"19":{"start":{"line":49,"column":0},"end":{"line":56,"column":2}},"20":{"start":{"line":50,"column":1},"end":{"line":50,"column":41}},"21":{"start":{"line":51,"column":1},"end":{"line":55,"column":2}},"22":{"start":{"line":52,"column":2},"end":{"line":52,"column":30}},"23":{"start":{"line":54,"column":2},"end":{"line":54,"column":92}},"24":{"start":{"line":62,"column":0},"end":{"line":70,"column":2}},"25":{"start":{"line":63,"column":1},"end":{"line":63,"column":44}},"26":{"start":{"line":64,"column":1},"end":{"line":66,"column":2}},"27":{"start":{"line":65,"column":2},"end":{"line":65,"column":36}},"28":{"start":{"line":67,"column":1},"end":{"line":69,"column":2}},"29":{"start":{"line":68,"column":2},"end":{"line":68,"column":32}},"30":{"start":{"line":73,"column":0},"end":{"line":73,"column":33}}},"branchMap":{"1":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},{"start":{"line":29,"column":1},"end":{"line":29,"column":1}}]},"2":{"line":38,"type":"cond-expr","locations":[{"start":{"line":38,"column":80},"end":{"line":38,"column":84}},{"start":{"line":38,"column":87},"end":{"line":38,"column":89}}]},"3":{"line":40,"type":"cond-expr","locations":[{"start":{"line":40,"column":26},"end":{"line":40,"column":58}},{"start":{"line":40,"column":61},"end":{"line":40,"column":72}}]},"4":{"line":42,"type":"cond-expr","locations":[{"start":{"line":42,"column":44},"end":{"line":42,"column":64}},{"start":{"line":42,"column":67},"end":{"line":42,"column":70}}]},"5":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},{"start":{"line":51,"column":1},"end":{"line":51,"column":1}}]},"6":{"line":54,"type":"cond-expr","locations":[{"start":{"line":54,"column":79},"end":{"line":54,"column":83}},{"start":{"line":54,"column":86},"end":{"line":54,"column":91}}]},"7":{"line":54,"type":"binary-expr","locations":[{"start":{"line":54,"column":10},"end":{"line":54,"column":19}},{"start":{"line":54,"column":24},"end":{"line":54,"column":43}},{"start":{"line":54,"column":47},"end":{"line":54,"column":51}},{"start":{"line":54,"column":55},"end":{"line":54,"column":74}}]},"8":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},{"start":{"line":64,"column":1},"end":{"line":64,"column":1}}]},"9":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},{"start":{"line":67,"column":1},"end":{"line":67,"column":1}}]},"10":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":5},"end":{"line":67,"column":27}},{"start":{"line":67,"column":31},"end":{"line":67,"column":63}}]}},"code":["var crypto = require('crypto');","var FieldType = require('../Type');","var TextType = require('../text/TextType');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Email FieldType Constructor"," * @extends Field"," * @api public"," */","function email(list, path, options) {","\tthis._nativeType = String;","\tthis._underscoreMethods = ['gravatarUrl'];","\tthis._fixedSize = 'large';","\tthis.typeDescription = 'email address';","\temail.super_.call(this, list, path, options);","}","util.inherits(email, FieldType);","","/* Inherit from TextType prototype */","email.prototype.addFilterToQuery = TextType.prototype.addFilterToQuery;","","/**"," * Generate a gravatar image request url"," */","email.prototype.gravatarUrl = function(item, size, defaultImage, rating) {","\tvar value = item.get(this.path);","\tif ('string' !== typeof value) {","\t\treturn '';","\t}","\treturn [","\t\t// base url protocol-less for both http/https","\t\t'//www.gravatar.com/avatar/',","\t\t// md5 hash the trimmed lowercase email","\t\tcrypto.createHash('md5').update(value.toLowerCase().trim()).digest('hex'),","\t\t// size of images ranging from 1 to 2048 pixels, square","\t\t'?s=' + (/^(?:[1-9][0-9]{0,2}|1[0-9]{3}|20[0-3][0-9]|204[0-8])$/.test(size) ? size : 80),","\t\t// default image url encoded href or one of the built in options: 404, mm, identicon, monsterid, wavatar, retro, blank","\t\t'&d=' + (defaultImage ? encodeURIComponent(defaultImage) : 'identicon'),","\t\t// rating, g, pg, r or x","\t\t'&r=' + (/^(?:g|pg|r|x)$/i.test(rating) ? rating.toLowerCase() : 'g')","\t].join('');","};","","/**"," * Validates that a valid email has been provided in a data object"," */","email.prototype.validateInput = function(data, required, item) {","\tvar value = this.getValueFromData(data);","\tif (value) {","\t\treturn utils.isEmail(value);","\t} else {","\t\treturn (!required || (value !== undefined && item && item.get(this.path))) ? true : false;","\t}","};","","/**"," * Updates the value for this field in the item from a data object"," * Ensures that the email address is lowercase"," */","email.prototype.updateItem = function(item, data) {","\tvar newValue = this.getValueFromData(data);","\tif ('string' === typeof newValue) {","\t\tnewValue = newValue.toLowerCase();","\t}","\tif (newValue !== undefined && newValue !== item.get(this.path)) {","\t\titem.set(this.path, newValue);","\t}","};","","/* Export Field Type */","exports = module.exports = email;",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"12":1,"13":0,"14":0,"15":0,"16":0,"17":0,"19":1,"22":1,"27":1,"28":0,"29":0,"30":0,"32":0,"49":1,"50":0,"51":0,"52":0,"54":0,"62":1,"63":0,"64":0,"65":0,"67":0,"68":0,"73":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/embedly/EmbedlyType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/embedly/EmbedlyType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":1,"48":0,"49":1,"50":0,"51":1,"52":0,"53":1,"54":0,"55":1,"56":0,"57":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"embedly","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":38}}},"2":{"name":"(anonymous_2)","line":69,"loc":{"start":{"line":69,"column":32},"end":{"line":69,"column":43}}},"3":{"name":"(anonymous_3)","line":115,"loc":{"start":{"line":115,"column":20},"end":{"line":115,"column":35}}},"4":{"name":"(anonymous_4)","line":130,"loc":{"start":{"line":130,"column":59},"end":{"line":130,"column":78}}},"5":{"name":"(anonymous_5)","line":141,"loc":{"start":{"line":141,"column":20},"end":{"line":141,"column":40}}},"6":{"name":"(anonymous_6)","line":191,"loc":{"start":{"line":191,"column":26},"end":{"line":191,"column":41}}},"7":{"name":"(anonymous_7)","line":219,"loc":{"start":{"line":219,"column":27},"end":{"line":219,"column":42}}},"8":{"name":"(anonymous_8)","line":230,"loc":{"start":{"line":230,"column":31},"end":{"line":230,"column":46}}},"9":{"name":"(anonymous_9)","line":242,"loc":{"start":{"line":242,"column":34},"end":{"line":242,"column":49}}},"10":{"name":"(anonymous_10)","line":254,"loc":{"start":{"line":254,"column":31},"end":{"line":254,"column":52}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":9,"column":29}},"2":{"start":{"line":21,"column":0},"end":{"line":54,"column":1}},"3":{"start":{"line":23,"column":1},"end":{"line":23,"column":37}},"4":{"start":{"line":24,"column":1},"end":{"line":24,"column":26}},"5":{"start":{"line":26,"column":1},"end":{"line":26,"column":30}},"6":{"start":{"line":27,"column":1},"end":{"line":27,"column":45}},"7":{"start":{"line":30,"column":1},"end":{"line":30,"column":25}},"8":{"start":{"line":33,"column":1},"end":{"line":37,"column":2}},"9":{"start":{"line":34,"column":2},"end":{"line":36,"column":93}},"10":{"start":{"line":40,"column":1},"end":{"line":44,"column":2}},"11":{"start":{"line":41,"column":2},"end":{"line":43,"column":90}},"12":{"start":{"line":47,"column":1},"end":{"line":50,"column":2}},"13":{"start":{"line":48,"column":2},"end":{"line":49,"column":88}},"14":{"start":{"line":52,"column":1},"end":{"line":52,"column":48}},"15":{"start":{"line":60,"column":0},"end":{"line":60,"column":31}},"16":{"start":{"line":69,"column":0},"end":{"line":182,"column":2}},"17":{"start":{"line":71,"column":1},"end":{"line":72,"column":28}},"18":{"start":{"line":74,"column":1},"end":{"line":91,"column":3}},"19":{"start":{"line":93,"column":1},"end":{"line":93,"column":33}},"20":{"start":{"line":94,"column":1},"end":{"line":111,"column":21}},"21":{"start":{"line":115,"column":1},"end":{"line":178,"column":4}},"22":{"start":{"line":117,"column":2},"end":{"line":119,"column":3}},"23":{"start":{"line":118,"column":3},"end":{"line":118,"column":17}},"24":{"start":{"line":121,"column":2},"end":{"line":121,"column":43}},"25":{"start":{"line":123,"column":2},"end":{"line":126,"column":3}},"26":{"start":{"line":124,"column":3},"end":{"line":124,"column":21}},"27":{"start":{"line":125,"column":3},"end":{"line":125,"column":17}},"28":{"start":{"line":128,"column":2},"end":{"line":128,"column":18}},"29":{"start":{"line":130,"column":2},"end":{"line":176,"column":5}},"30":{"start":{"line":132,"column":3},"end":{"line":137,"column":4}},"31":{"start":{"line":133,"column":4},"end":{"line":133,"column":49}},"32":{"start":{"line":134,"column":4},"end":{"line":134,"column":28}},"33":{"start":{"line":135,"column":4},"end":{"line":135,"column":22}},"34":{"start":{"line":136,"column":4},"end":{"line":136,"column":18}},"35":{"start":{"line":139,"column":3},"end":{"line":139,"column":67}},"36":{"start":{"line":141,"column":3},"end":{"line":175,"column":6}},"37":{"start":{"line":143,"column":4},"end":{"line":172,"column":5}},"38":{"start":{"line":144,"column":5},"end":{"line":144,"column":41}},"39":{"start":{"line":145,"column":5},"end":{"line":145,"column":30}},"40":{"start":{"line":146,"column":5},"end":{"line":146,"column":23}},"41":{"start":{"line":148,"column":5},"end":{"line":148,"column":24}},"42":{"start":{"line":149,"column":5},"end":{"line":171,"column":6}},"43":{"start":{"line":150,"column":6},"end":{"line":167,"column":9}},"44":{"start":{"line":170,"column":6},"end":{"line":170,"column":24}},"45":{"start":{"line":173,"column":4},"end":{"line":173,"column":18}},"46":{"start":{"line":180,"column":1},"end":{"line":180,"column":30}},"47":{"start":{"line":191,"column":0},"end":{"line":210,"column":2}},"48":{"start":{"line":192,"column":1},"end":{"line":209,"column":5}},"49":{"start":{"line":219,"column":0},"end":{"line":221,"column":2}},"50":{"start":{"line":220,"column":1},"end":{"line":220,"column":34}},"51":{"start":{"line":230,"column":0},"end":{"line":233,"column":2}},"52":{"start":{"line":232,"column":1},"end":{"line":232,"column":40}},"53":{"start":{"line":242,"column":0},"end":{"line":245,"column":2}},"54":{"start":{"line":244,"column":1},"end":{"line":244,"column":13}},"55":{"start":{"line":254,"column":0},"end":{"line":275,"column":2}},"56":{"start":{"line":257,"column":1},"end":{"line":274,"column":5}},"57":{"start":{"line":282,"column":0},"end":{"line":282,"column":35}}},"branchMap":{"1":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":23},"end":{"line":27,"column":38}},{"start":{"line":27,"column":42},"end":{"line":27,"column":44}}]},"2":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},{"start":{"line":33,"column":1},"end":{"line":33,"column":1}}]},"3":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},{"start":{"line":40,"column":1},"end":{"line":40,"column":1}}]},"4":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},{"start":{"line":47,"column":1},"end":{"line":47,"column":1}}]},"5":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":2},"end":{"line":117,"column":2}},{"start":{"line":117,"column":2},"end":{"line":117,"column":2}}]},"6":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":2},"end":{"line":123,"column":2}},{"start":{"line":123,"column":2},"end":{"line":123,"column":2}}]},"7":{"line":132,"type":"if","locations":[{"start":{"line":132,"column":3},"end":{"line":132,"column":3}},{"start":{"line":132,"column":3},"end":{"line":132,"column":3}}]},"8":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":4},"end":{"line":143,"column":4}},{"start":{"line":143,"column":4},"end":{"line":143,"column":4}}]},"9":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":5},"end":{"line":149,"column":5}},{"start":{"line":149,"column":5},"end":{"line":149,"column":5}}]},"10":{"line":149,"type":"binary-expr","locations":[{"start":{"line":149,"column":9},"end":{"line":149,"column":13}},{"start":{"line":149,"column":17},"end":{"line":149,"column":38}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tkeystone = require('../../../'),","\tutil = require('util'),","\tEmbedlyAPI = require('embedly'),","\tsuper_ = require('../Type');","","/**"," * Embedly FieldType Constructor"," *"," * Reqires the option `from` to refer to another path in the schema"," * that provides the url to expand"," *"," * @extends Field"," * @api public"," */","","function embedly(list, path, options) {","","\tthis._underscoreMethods = ['reset'];","\tthis._fixedSize = 'full';","\t","\tthis.fromPath = options.from;","\tthis.embedlyOptions = options.options || {};","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","","\t// check and api key has been set, or bail.","\tif (!keystone.get('embedly api key')) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'Embedly fields (' + list.key + '.' + path + ') require the \"embedly api key\" option to be set.\\n\\n' +","\t\t\t'See http://keystonejs.com/docs/configuration/#services-embedly for more information.\\n');","\t}","","\t// ensure a fromPath has been defined","\tif (!options.from) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'Embedly fields (' + list.key + '.' + path + ') require a fromPath option to be set.\\n' +","\t\t\t'See http://keystonejs.com/docs/database/#fieldtypes-embedly for more information.\\n');","\t}","","\t// embedly fields cannot be set as initial fields","\tif (options.initial) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'Embedly fields (' + list.key + '.' + path + ') cannot be set as initial fields.\\n');","\t}","","\tembedly.super_.call(this, list, path, options);","","}","","/*!"," * Inherit from Field"," */","","util.inherits(embedly, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","embedly.prototype.addToSchema = function() {","","\tvar field = this,","\t\tschema = this.list.schema;","","\tthis.paths = {","\t\texists: \t\t\t\tthis._path.append('.exists'),","\t\ttype: \t\t\t\t\tthis._path.append('.type'),","\t\ttitle: \t\t\t\t\tthis._path.append('.title'),","\t\turl: \t\t\t\t\tthis._path.append('.url'),","\t\twidth: \t\t\t\t\tthis._path.append('.width'),","\t\theight: \t\t\t\tthis._path.append('.height'),","\t\tversion: \t\t\t\tthis._path.append('.version'),","\t\tdescription: \t\t\tthis._path.append('.description'),","\t\thtml: \t\t\t\t\tthis._path.append('.html'),","\t\tauthorName: \t\t\tthis._path.append('.authorName'),","\t\tauthorUrl: \t\t\t\tthis._path.append('.authorUrl'),","\t\tproviderName: \t\t\tthis._path.append('.providerName'),","\t\tproviderUrl: \t\t\tthis._path.append('.providerUrl'),","\t\tthumbnailUrl: \t\t\tthis._path.append('.thumbnailUrl'),","\t\tthumbnailWidth: \t\tthis._path.append('.thumbnailWidth'),","\t\tthumbnailHeight: \t\tthis._path.append('.thumbnailHeight')","\t};","","\tschema.nested[this.path] = true;","\tschema.add({","\t\texists: \t\t\t\tBoolean,","\t\ttype: \t\t\t\t\tString,","\t\ttitle: \t\t\t\t\tString,","\t\turl: \t\t\t\t\tString,","\t\twidth: \t\t\t\t\tNumber,","\t\theight: \t\t\t\tNumber,","\t\tversion: \t\t\t\tString,","\t\tdescription: \t\t\tString,","\t\thtml: \t\t\t\t\tString,","\t\tauthorName: \t\t\tString,","\t\tauthorUrl: \t\t\t\tString,","\t\tproviderName: \t\t\tString,","\t\tproviderUrl: \t\t\tString,","\t\tthumbnailUrl: \t\t\tString,","\t\tthumbnailWidth: \t\tNumber,","\t\tthumbnailHeight: \t\tNumber","\t}, this.path + '.');","","\t// Bind the pre-save hook to hit the embedly api if the source path has changed","","\tschema.pre('save', function(next) {","","\t\tif (!this.isModified(field.fromPath)) {","\t\t\treturn next();","\t\t}","","\t\tvar fromValue = this.get(field.fromPath);","","\t\tif (!fromValue) {","\t\t\tfield.reset(this);","\t\t\treturn next();","\t\t}","","\t\tvar post = this;","","\t\tnew EmbedlyAPI({ key: keystone.get('embedly api key') }, function(err, api) {//eslint-disable-line no-new","","\t\t\tif (err) {","\t\t\t\tconsole.error('Error creating Embedly api:');","\t\t\t\tconsole.error(err, api);","\t\t\t\tfield.reset(this);","\t\t\t\treturn next();","\t\t\t}","","\t\t\tvar opts = _.defaults({ url: fromValue }, field.embedlyOptions);","","\t\t\tapi.oembed(opts, function(err, objs) {","","\t\t\t\tif (err) {","\t\t\t\t\tconsole.error('Embedly API Error:');","\t\t\t\t\tconsole.error(err, objs);","\t\t\t\t\tfield.reset(post);","\t\t\t\t} else {","\t\t\t\t\tvar data = objs[0];","\t\t\t\t\tif (data && data.type !== 'error') {","\t\t\t\t\t\tpost.set(field.path, {","\t\t\t\t\t\t\texists: \t\t\ttrue,","\t\t\t\t\t\t\ttype: \t\t\t\tdata.type,","\t\t\t\t\t\t\ttitle: \t\t\t\tdata.title,","\t\t\t\t\t\t\turl: \t\t\t\tdata.url,","\t\t\t\t\t\t\twidth: \t\t\t\tdata.width,","\t\t\t\t\t\t\theight: \t\t\tdata.height,","\t\t\t\t\t\t\tversion: \t\t\tdata.version,","\t\t\t\t\t\t\tdescription: \t\tdata.description,","\t\t\t\t\t\t\thtml: \t\t\t\tdata.html,","\t\t\t\t\t\t\tauthorName: \t\tdata.author_name,","\t\t\t\t\t\t\tauthorUrl: \t\t\tdata.author_url,","\t\t\t\t\t\t\tproviderName: \t\tdata.provider_name,","\t\t\t\t\t\t\tproviderUrl: \t\tdata.provider_url,","\t\t\t\t\t\t\tthumbnailUrl: \t\tdata.thumbnail_url,","\t\t\t\t\t\t\tthumbnailWidth: \tdata.thumbnail_width,","\t\t\t\t\t\t\tthumbnailHeight: \tdata.thumbnail_height","\t\t\t\t\t\t});","","\t\t\t\t\t} else {","\t\t\t\t\t\tfield.reset(post);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn next();","","\t\t\t});","\t\t});","","\t});","","\tthis.bindUnderscoreMethods();","","};","","","/**"," * Resets the value of the field"," *"," * @api public"," */","","embedly.prototype.reset = function(item) {","\treturn item.set(item.set(this.path, {","\t\texists: \t\t\tfalse,","\t\ttype: \t\t\t\tnull,","\t\ttitle: \t\t\t\tnull,","\t\turl: \t\t\t\tnull,","\t\twidth: \t\t\t\tnull,","\t\theight: \t\t\tnull,","\t\tversion: \t\t\tnull,","\t\tdescription: \t\tnull,","\t\thtml: \t\t\t\tnull,","\t\tauthorName: \t\tnull,","\t\tauthorUrl: \t\t\tnull,","\t\tproviderName: \t\tnull,","\t\tproviderUrl: \t\tnull,","\t\tthumbnailUrl: \t\tnull,","\t\tthumbnailWidth: \tnull,","\t\tthumbnailHeight: \tnull","\t}));","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","embedly.prototype.format = function(item) {","\treturn item.get(this.paths.html);","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","embedly.prototype.isModified = function(item) {","\t// Assume that it has changed if the url is different","\treturn item.isModified(this.paths.url);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","embedly.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO: I don't think embedly fields need to be validated...","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","embedly.prototype.updateItem = function(item, data) {","\t// TODO: This could be more granular and check for actual changes to values,","\t// see the Location field for an example","\treturn item.set(item.set(this.path, {","\t\texists: \t\t\tdata[this.paths.exists],","\t\ttype: \t\t\t\tdata[this.paths.type],","\t\ttitle: \t\t\t\tdata[this.paths.title],","\t\turl: \t\t\t\tdata[this.paths.url],","\t\twidth: \t\t\t\tdata[this.paths.width],","\t\theight: \t\t\tdata[this.paths.height],","\t\tversion: \t\t\tdata[this.paths.version],","\t\tdescription: \t\tdata[this.paths.description],","\t\thtml: \t\t\t\tdata[this.paths.html],","\t\tauthorName: \t\tdata[this.paths.authorName],","\t\tauthorUrl: \t\t\tdata[this.paths.authorUrl],","\t\tproviderName: \t\tdata[this.paths.providerName],","\t\tproviderUrl: \t\tdata[this.paths.providerUrl],","\t\tthumbnailUrl: \t\tdata[this.paths.thumbnailUrl],","\t\tthumbnailWidth: \tdata[this.paths.thumbnailWidth],","\t\tthumbnailHeight: \tdata[this.paths.thumbnailHeight]","\t}));","};","","","/*!"," * Export class"," */","","exports = module.exports = embedly;",""],"l":{"5":1,"21":1,"23":0,"24":0,"26":0,"27":0,"30":0,"33":0,"34":0,"40":0,"41":0,"47":0,"48":0,"52":0,"60":1,"69":1,"71":0,"74":0,"93":0,"94":0,"115":0,"117":0,"118":0,"121":0,"123":0,"124":0,"125":0,"128":0,"130":0,"132":0,"133":0,"134":0,"135":0,"136":0,"139":0,"141":0,"143":0,"144":0,"145":0,"146":0,"148":0,"149":0,"150":0,"170":0,"173":0,"180":0,"191":1,"192":0,"219":1,"220":0,"230":1,"232":0,"242":1,"244":0,"254":1,"257":0,"282":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/geopoint/GeoPointType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/geopoint/GeoPointType.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":1,"8":1,"9":0,"10":0,"11":1,"12":0,"13":0,"14":1,"15":0,"16":0,"17":0,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"geopoint","line":17,"loc":{"start":{"line":17,"column":0},"end":{"line":17,"column":39}}},"2":{"name":"(anonymous_2)","line":42,"loc":{"start":{"line":42,"column":33},"end":{"line":42,"column":44}}},"3":{"name":"(anonymous_3)","line":52,"loc":{"start":{"line":52,"column":29},"end":{"line":52,"column":44}}},"4":{"name":"(anonymous_4)","line":64,"loc":{"start":{"line":64,"column":28},"end":{"line":64,"column":43}}},"5":{"name":"(anonymous_5)","line":78,"loc":{"start":{"line":78,"column":35},"end":{"line":78,"column":66}}},"6":{"name":"(anonymous_6)","line":102,"loc":{"start":{"line":102,"column":32},"end":{"line":102,"column":53}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":7,"column":29}},"2":{"start":{"line":9,"column":0},"end":{"line":9,"column":75}},"3":{"start":{"line":17,"column":0},"end":{"line":25,"column":1}},"4":{"start":{"line":19,"column":1},"end":{"line":19,"column":28}},"5":{"start":{"line":22,"column":1},"end":{"line":22,"column":25}},"6":{"start":{"line":23,"column":1},"end":{"line":23,"column":49}},"7":{"start":{"line":31,"column":0},"end":{"line":31,"column":32}},"8":{"start":{"line":42,"column":0},"end":{"line":45,"column":2}},"9":{"start":{"line":43,"column":1},"end":{"line":43,"column":99}},"10":{"start":{"line":44,"column":1},"end":{"line":44,"column":30}},"11":{"start":{"line":52,"column":0},"end":{"line":55,"column":2}},"12":{"start":{"line":53,"column":1},"end":{"line":53,"column":34}},"13":{"start":{"line":54,"column":1},"end":{"line":54,"column":54}},"14":{"start":{"line":64,"column":0},"end":{"line":69,"column":2}},"15":{"start":{"line":65,"column":1},"end":{"line":67,"column":2}},"16":{"start":{"line":66,"column":2},"end":{"line":66,"column":50}},"17":{"start":{"line":68,"column":1},"end":{"line":68,"column":13}},"18":{"start":{"line":78,"column":0},"end":{"line":93,"column":2}},"19":{"start":{"line":80,"column":1},"end":{"line":80,"column":42}},"20":{"start":{"line":83,"column":1},"end":{"line":83,"column":52}},"21":{"start":{"line":83,"column":40},"end":{"line":83,"column":52}},"22":{"start":{"line":85,"column":1},"end":{"line":87,"column":2}},"23":{"start":{"line":86,"column":2},"end":{"line":86,"column":39}},"24":{"start":{"line":89,"column":1},"end":{"line":89,"column":45}},"25":{"start":{"line":89,"column":33},"end":{"line":89,"column":45}},"26":{"start":{"line":91,"column":1},"end":{"line":91,"column":35}},"27":{"start":{"line":102,"column":0},"end":{"line":130,"column":2}},"28":{"start":{"line":104,"column":1},"end":{"line":104,"column":31}},"29":{"start":{"line":104,"column":24},"end":{"line":104,"column":31}},"30":{"start":{"line":106,"column":1},"end":{"line":106,"column":41}},"31":{"start":{"line":107,"column":1},"end":{"line":107,"column":33}},"32":{"start":{"line":107,"column":26},"end":{"line":107,"column":33}},"33":{"start":{"line":109,"column":1},"end":{"line":128,"column":2}},"34":{"start":{"line":112,"column":2},"end":{"line":112,"column":41}},"35":{"start":{"line":114,"column":2},"end":{"line":118,"column":3}},"36":{"start":{"line":115,"column":3},"end":{"line":115,"column":47}},"37":{"start":{"line":117,"column":3},"end":{"line":117,"column":34}},"38":{"start":{"line":120,"column":8},"end":{"line":128,"column":2}},"39":{"start":{"line":122,"column":2},"end":{"line":126,"column":3}},"40":{"start":{"line":123,"column":3},"end":{"line":123,"column":30}},"41":{"start":{"line":125,"column":3},"end":{"line":125,"column":34}},"42":{"start":{"line":137,"column":0},"end":{"line":137,"column":36}}},"branchMap":{"1":{"line":54,"type":"cond-expr","locations":[{"start":{"line":54,"column":42},"end":{"line":54,"column":48}},{"start":{"line":54,"column":51},"end":{"line":54,"column":53}}]},"2":{"line":54,"type":"binary-expr","locations":[{"start":{"line":54,"column":9},"end":{"line":54,"column":15}},{"start":{"line":54,"column":19},"end":{"line":54,"column":38}}]},"3":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},{"start":{"line":65,"column":1},"end":{"line":65,"column":1}}]},"4":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":1},"end":{"line":83,"column":1}},{"start":{"line":83,"column":1},"end":{"line":83,"column":1}}]},"5":{"line":83,"type":"binary-expr","locations":[{"start":{"line":83,"column":5},"end":{"line":83,"column":25}},{"start":{"line":83,"column":29},"end":{"line":83,"column":38}}]},"6":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},{"start":{"line":85,"column":1},"end":{"line":85,"column":1}}]},"7":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},{"start":{"line":89,"column":1},"end":{"line":89,"column":1}}]},"8":{"line":89,"type":"binary-expr","locations":[{"start":{"line":89,"column":5},"end":{"line":89,"column":18}},{"start":{"line":89,"column":22},"end":{"line":89,"column":31}}]},"9":{"line":104,"type":"if","locations":[{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},{"start":{"line":104,"column":1},"end":{"line":104,"column":1}}]},"10":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},{"start":{"line":107,"column":1},"end":{"line":107,"column":1}}]},"11":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":1},"end":{"line":109,"column":1}},{"start":{"line":109,"column":1},"end":{"line":109,"column":1}}]},"12":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":2},"end":{"line":114,"column":2}},{"start":{"line":114,"column":2},"end":{"line":114,"column":2}}]},"13":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":8},"end":{"line":120,"column":8}},{"start":{"line":120,"column":8},"end":{"line":120,"column":8}}]},"14":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":2},"end":{"line":122,"column":2}},{"start":{"line":122,"column":2},"end":{"line":122,"column":2}}]},"15":{"line":122,"type":"binary-expr","locations":[{"start":{"line":122,"column":6},"end":{"line":122,"column":24}},{"start":{"line":122,"column":28},"end":{"line":122,"column":74}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tutil = require('util'),","\tsuper_ = require('../Type');","\t","var REGEXP_LNGLAT = /^\\s*(\\-?\\d+(?:\\.\\d+)?)\\s*\\,\\s*(\\-?\\d+(?:\\.\\d+)?)\\s*$/;","","/**"," * Geo FieldType Constructor"," * @extends Field"," * @api public"," */","","function geopoint(list, path, options) {","\t","\tthis._fixedSize = 'medium';","\t","\t// TODO: implement filtering, hard-coded as disabled for now","\toptions.nofilter = true;","\tgeopoint.super_.call(this, list, path, options);","\t","}","","/*!"," * Inherit from Field"," */","","util.inherits(geopoint, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * Adds a 2dsphere indexed lat/lng pair"," *"," * @api public"," */","","geopoint.prototype.addToSchema = function() {","\tthis.list.schema.path(this.path, _.defaults({ type: [Number], index: '2dsphere' }, this.options));","\tthis.bindUnderscoreMethods();","};","","","/**"," * Gets the field's data from an Item, as used by the React components"," */","","geopoint.prototype.getData = function(item) {","\tvar points = item.get(this.path);","\treturn (points && points.length === 2) ? points : [];","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","geopoint.prototype.format = function(item) {","\tif (item.get(this.path)) {","\t\treturn item.get(this.path).reverse().join(', ');\t","\t}","\treturn null;","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","geopoint.prototype.validateInput = function(data, required, item) {//eslint-disable-line no-unused-vars","\t","\tvar values = this.getValueFromData(data);","","\t// Input is valid if the field is not required, and not present","\tif (values === undefined && !required) return true;","\t","\tif (_.isArray(values)) {","\t\tvalues = _.compact(values).join(',');","\t}","\t","\tif (values === '' && !required) return true;","\t","\treturn REGEXP_LNGLAT.test(values);","","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","geopoint.prototype.updateItem = function(item, data) {","\t","\tif (!_.isObject(data)) return;","\t","\tvar value = this.getValueFromData(data);","\tif (value === undefined) return;","","\tif (_.isString(value)) {","\t\t","\t\t// Value should be formatted lng,lat","\t\tvar values = REGEXP_LNGLAT.exec(value);","\t\t","\t\tif (values) {","\t\t\titem.set(this.path, [values[1], values[2]]);","\t\t} else {","\t\t\titem.set(this.path, undefined);","\t\t}","\t\t","\t} else if (_.isArray(value)) {","\t\t","\t\tif (value.length === 2 && REGEXP_LNGLAT.test(_.compact(value).join(','))) {","\t\t\titem.set(this.path, value);","\t\t} else {","\t\t\titem.set(this.path, undefined);","\t\t}","\t\t","\t}","","};","","","/*!"," * Export class"," */","","exports = module.exports = geopoint;",""],"l":{"5":1,"9":1,"17":1,"19":0,"22":0,"23":0,"31":1,"42":1,"43":0,"44":0,"52":1,"53":0,"54":0,"64":1,"65":0,"66":0,"68":0,"78":1,"80":0,"83":0,"85":0,"86":0,"89":0,"91":0,"102":1,"104":0,"106":0,"107":0,"109":0,"112":0,"114":0,"115":0,"117":0,"120":0,"122":0,"123":0,"125":0,"137":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/html/HtmlType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/html/HtmlType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":1,"13":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"html","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":35}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":43}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":10,"column":0},"end":{"line":17,"column":1}},"5":{"start":{"line":11,"column":1},"end":{"line":11,"column":27}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":28}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":41}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":37}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":42}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":45}},"11":{"start":{"line":18,"column":0},"end":{"line":18,"column":31}},"12":{"start":{"line":21,"column":0},"end":{"line":21,"column":70}},"13":{"start":{"line":24,"column":0},"end":{"line":24,"column":32}}},"branchMap":{"1":{"line":13,"type":"binary-expr","locations":[{"start":{"line":13,"column":16},"end":{"line":13,"column":31}},{"start":{"line":13,"column":35},"end":{"line":13,"column":40}}]},"2":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":15},"end":{"line":14,"column":29}},{"start":{"line":14,"column":33},"end":{"line":14,"column":36}}]}},"code":["var FieldType = require('../Type');","var TextType = require('../text/TextType');","var util = require('util');","","/**"," * HTML FieldType Constructor"," * @extends Field"," * @api public"," */","function html(list, path, options) {","\tthis._nativeType = String;","\tthis._defaultSize = 'full';","\tthis.wysiwyg = options.wysiwyg || false;","\tthis.height = options.height || 180;","\tthis._properties = ['wysiwyg', 'height'];","\thtml.super_.call(this, list, path, options);","}","util.inherits(html, FieldType);","","/* Inherit from TextType prototype */","html.prototype.addFilterToQuery = TextType.prototype.addFilterToQuery;","","/* Export Field Type */","exports = module.exports = html;",""],"l":{"1":1,"2":1,"3":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"18":1,"21":1,"24":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/key/KeyType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/key/KeyType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":1,"11":1,"12":1,"13":0,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"key","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":34}}},"2":{"name":"(anonymous_2)","line":25,"loc":{"start":{"line":25,"column":28},"end":{"line":25,"column":42}}},"3":{"name":"(anonymous_3)","line":32,"loc":{"start":{"line":32,"column":30},"end":{"line":32,"column":61}}},"4":{"name":"(anonymous_4)","line":44,"loc":{"start":{"line":44,"column":27},"end":{"line":44,"column":48}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":43}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":11,"column":0},"end":{"line":16,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":27}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":30}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":43}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":44}},"10":{"start":{"line":17,"column":0},"end":{"line":17,"column":30}},"11":{"start":{"line":20,"column":0},"end":{"line":20,"column":69}},"12":{"start":{"line":25,"column":0},"end":{"line":27,"column":2}},"13":{"start":{"line":26,"column":1},"end":{"line":26,"column":48}},"14":{"start":{"line":32,"column":0},"end":{"line":39,"column":2}},"15":{"start":{"line":33,"column":1},"end":{"line":33,"column":41}},"16":{"start":{"line":34,"column":1},"end":{"line":36,"column":2}},"17":{"start":{"line":35,"column":2},"end":{"line":35,"column":14}},"18":{"start":{"line":37,"column":1},"end":{"line":37,"column":33}},"19":{"start":{"line":38,"column":1},"end":{"line":38,"column":44}},"20":{"start":{"line":44,"column":0},"end":{"line":53,"column":2}},"21":{"start":{"line":45,"column":1},"end":{"line":45,"column":41}},"22":{"start":{"line":46,"column":1},"end":{"line":48,"column":2}},"23":{"start":{"line":47,"column":2},"end":{"line":47,"column":9}},"24":{"start":{"line":49,"column":1},"end":{"line":49,"column":33}},"25":{"start":{"line":50,"column":1},"end":{"line":52,"column":2}},"26":{"start":{"line":51,"column":2},"end":{"line":51,"column":29}},"27":{"start":{"line":56,"column":0},"end":{"line":56,"column":31}}},"branchMap":{"1":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":18},"end":{"line":14,"column":35}},{"start":{"line":14,"column":39},"end":{"line":14,"column":42}}]},"2":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},{"start":{"line":34,"column":1},"end":{"line":34,"column":1}}]},"3":{"line":34,"type":"binary-expr","locations":[{"start":{"line":34,"column":5},"end":{"line":34,"column":24}},{"start":{"line":34,"column":28},"end":{"line":34,"column":32}},{"start":{"line":34,"column":36},"end":{"line":34,"column":55}}]},"4":{"line":38,"type":"cond-expr","locations":[{"start":{"line":38,"column":31},"end":{"line":38,"column":35}},{"start":{"line":38,"column":38},"end":{"line":38,"column":43}}]},"5":{"line":38,"type":"binary-expr","locations":[{"start":{"line":38,"column":9},"end":{"line":38,"column":14}},{"start":{"line":38,"column":18},"end":{"line":38,"column":27}}]},"6":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},{"start":{"line":46,"column":1},"end":{"line":46,"column":1}}]},"7":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},{"start":{"line":50,"column":1},"end":{"line":50,"column":1}}]}},"code":["var FieldType = require('../Type');","var TextType = require('../text/TextType');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Key FieldType Constructor"," * @extends Field"," * @api public"," */","function key(list, path, options) {","\tthis._nativeType = String;","\tthis._defaultSize = 'medium';","\tthis.separator = options.separator || '-';","\tkey.super_.call(this, list, path, options);","}","util.inherits(key, FieldType);","","/* Inherit from TextType prototype */","key.prototype.addFilterToQuery = TextType.prototype.addFilterToQuery;","","/**"," * Generates a valid key from a string"," */","key.prototype.generateKey = function(str) {","\treturn utils.slug(String(str), this.separator);","};","","/**"," * Checks that a valid key has been provided in a data object"," */","key.prototype.validateInput = function(data, required, item) {","\tvar value = this.getValueFromData(data);","\tif (value === undefined && item && item.get(this.path)) {","\t\treturn true;","\t}","\tvalue = this.generateKey(value);","\treturn (value || !required) ? true : false;","};","","/**"," * Updates the value for this field in the item from a data object"," */","key.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\tif (value === undefined) {","\t\treturn;","\t}","\tvalue = this.generateKey(value);","\tif (item.get(this.path) !== value) {","\t\titem.set(this.path, value);","\t}","};","","/* Export Field Type */","exports = module.exports = key;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"15":0,"17":1,"20":1,"25":1,"26":0,"32":1,"33":0,"34":0,"35":0,"37":0,"38":0,"44":1,"45":0,"46":0,"47":0,"49":0,"50":0,"51":0,"56":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/localfile/LocalFileType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/localfile/LocalFileType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1,"55":0,"56":1,"57":0,"58":0,"59":0,"60":0,"61":1,"62":0,"63":1,"64":0,"65":1,"66":1,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":1,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":1,"110":0,"111":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},"fnMap":{"1":{"name":"localfile","line":20,"loc":{"start":{"line":20,"column":0},"end":{"line":20,"column":40}}},"2":{"name":"(anonymous_2)","line":71,"loc":{"start":{"line":71,"column":34},"end":{"line":71,"column":45}}},"3":{"name":"(anonymous_3)","line":101,"loc":{"start":{"line":101,"column":14},"end":{"line":101,"column":29}}},"4":{"name":"(anonymous_4)","line":113,"loc":{"start":{"line":113,"column":34},"end":{"line":113,"column":45}}},"5":{"name":"(anonymous_5)","line":118,"loc":{"start":{"line":118,"column":32},"end":{"line":118,"column":43}}},"6":{"name":"(anonymous_6)","line":123,"loc":{"start":{"line":123,"column":13},"end":{"line":123,"column":28}}},"7":{"name":"(anonymous_7)","line":133,"loc":{"start":{"line":133,"column":10},"end":{"line":133,"column":21}}},"8":{"name":"(anonymous_8)","line":141,"loc":{"start":{"line":141,"column":9},"end":{"line":141,"column":20}}},"9":{"name":"(anonymous_9)","line":149,"loc":{"start":{"line":149,"column":10},"end":{"line":149,"column":21}}},"10":{"name":"(anonymous_10)","line":157,"loc":{"start":{"line":157,"column":23},"end":{"line":157,"column":41}}},"11":{"name":"(anonymous_11)","line":162,"loc":{"start":{"line":162,"column":14},"end":{"line":162,"column":37}}},"12":{"name":"(anonymous_12)","line":177,"loc":{"start":{"line":177,"column":29},"end":{"line":177,"column":44}}},"13":{"name":"(anonymous_13)","line":194,"loc":{"start":{"line":194,"column":35},"end":{"line":194,"column":46}}},"14":{"name":"(anonymous_14)","line":205,"loc":{"start":{"line":205,"column":27},"end":{"line":205,"column":42}}},"15":{"name":"(anonymous_15)","line":218,"loc":{"start":{"line":218,"column":33},"end":{"line":218,"column":48}}},"16":{"name":"(anonymous_16)","line":229,"loc":{"start":{"line":229,"column":36},"end":{"line":229,"column":51}}},"17":{"name":"(anonymous_17)","line":241,"loc":{"start":{"line":241,"column":33},"end":{"line":241,"column":54}}},"18":{"name":"(anonymous_18)","line":252,"loc":{"start":{"line":252,"column":33},"end":{"line":252,"column":72}}},"19":{"name":"(anonymous_19)","line":267,"loc":{"start":{"line":267,"column":14},"end":{"line":267,"column":33}}},"20":{"name":"(anonymous_20)","line":273,"loc":{"start":{"line":273,"column":100},"end":{"line":273,"column":114}}},"21":{"name":"(anonymous_21)","line":294,"loc":{"start":{"line":294,"column":40},"end":{"line":294,"column":54}}},"22":{"name":"(anonymous_22)","line":296,"loc":{"start":{"line":296,"column":9},"end":{"line":296,"column":33}}},"23":{"name":"(anonymous_23)","line":298,"loc":{"start":{"line":298,"column":55},"end":{"line":298,"column":69}}},"24":{"name":"(anonymous_24)","line":317,"loc":{"start":{"line":317,"column":40},"end":{"line":317,"column":77}}},"25":{"name":"(anonymous_25)","line":328,"loc":{"start":{"line":328,"column":24},"end":{"line":328,"column":35}}},"26":{"name":"(anonymous_26)","line":330,"loc":{"start":{"line":330,"column":8},"end":{"line":330,"column":19}}},"27":{"name":"(anonymous_27)","line":357,"loc":{"start":{"line":357,"column":36},"end":{"line":357,"column":73}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":12,"column":29}},"2":{"start":{"line":20,"column":0},"end":{"line":55,"column":1}},"3":{"start":{"line":21,"column":1},"end":{"line":22,"column":22}},"4":{"start":{"line":23,"column":1},"end":{"line":23,"column":52}},"5":{"start":{"line":24,"column":1},"end":{"line":24,"column":26}},"6":{"start":{"line":27,"column":1},"end":{"line":27,"column":25}},"7":{"start":{"line":30,"column":1},"end":{"line":33,"column":2}},"8":{"start":{"line":31,"column":2},"end":{"line":32,"column":112}},"9":{"start":{"line":35,"column":1},"end":{"line":37,"column":2}},"10":{"start":{"line":36,"column":2},"end":{"line":36,"column":27}},"11":{"start":{"line":39,"column":1},"end":{"line":39,"column":50}},"12":{"start":{"line":42,"column":1},"end":{"line":45,"column":2}},"13":{"start":{"line":43,"column":2},"end":{"line":44,"column":92}},"14":{"start":{"line":47,"column":1},"end":{"line":49,"column":2}},"15":{"start":{"line":48,"column":2},"end":{"line":48,"column":37}},"16":{"start":{"line":51,"column":1},"end":{"line":53,"column":2}},"17":{"start":{"line":52,"column":2},"end":{"line":52,"column":39}},"18":{"start":{"line":61,"column":0},"end":{"line":61,"column":33}},"19":{"start":{"line":71,"column":0},"end":{"line":167,"column":2}},"20":{"start":{"line":73,"column":1},"end":{"line":74,"column":28}},"21":{"start":{"line":76,"column":1},"end":{"line":88,"column":3}},"22":{"start":{"line":90,"column":1},"end":{"line":96,"column":4}},"23":{"start":{"line":98,"column":1},"end":{"line":98,"column":25}},"24":{"start":{"line":101,"column":1},"end":{"line":110,"column":3}},"25":{"start":{"line":102,"column":2},"end":{"line":103,"column":39}},"26":{"start":{"line":105,"column":2},"end":{"line":107,"column":3}},"27":{"start":{"line":106,"column":3},"end":{"line":106,"column":16}},"28":{"start":{"line":109,"column":2},"end":{"line":109,"column":54}},"29":{"start":{"line":113,"column":1},"end":{"line":115,"column":4}},"30":{"start":{"line":114,"column":2},"end":{"line":114,"column":42}},"31":{"start":{"line":118,"column":1},"end":{"line":120,"column":4}},"32":{"start":{"line":119,"column":2},"end":{"line":119,"column":38}},"33":{"start":{"line":123,"column":1},"end":{"line":130,"column":3}},"34":{"start":{"line":124,"column":2},"end":{"line":129,"column":5}},"35":{"start":{"line":132,"column":1},"end":{"line":155,"column":3}},"36":{"start":{"line":134,"column":3},"end":{"line":134,"column":23}},"37":{"start":{"line":142,"column":3},"end":{"line":142,"column":15}},"38":{"start":{"line":150,"column":3},"end":{"line":152,"column":4}},"39":{"start":{"line":151,"column":4},"end":{"line":151,"column":77}},"40":{"start":{"line":153,"column":3},"end":{"line":153,"column":15}},"41":{"start":{"line":157,"column":1},"end":{"line":159,"column":4}},"42":{"start":{"line":158,"column":2},"end":{"line":158,"column":34}},"43":{"start":{"line":162,"column":1},"end":{"line":164,"column":3}},"44":{"start":{"line":163,"column":2},"end":{"line":163,"column":85}},"45":{"start":{"line":166,"column":1},"end":{"line":166,"column":30}},"46":{"start":{"line":177,"column":0},"end":{"line":185,"column":2}},"47":{"start":{"line":178,"column":1},"end":{"line":178,"column":47}},"48":{"start":{"line":178,"column":37},"end":{"line":178,"column":47}},"49":{"start":{"line":179,"column":1},"end":{"line":183,"column":2}},"50":{"start":{"line":180,"column":2},"end":{"line":180,"column":33}},"51":{"start":{"line":181,"column":2},"end":{"line":181,"column":30}},"52":{"start":{"line":182,"column":2},"end":{"line":182,"column":52}},"53":{"start":{"line":184,"column":1},"end":{"line":184,"column":24}},"54":{"start":{"line":194,"column":0},"end":{"line":196,"column":2}},"55":{"start":{"line":195,"column":1},"end":{"line":195,"column":50}},"56":{"start":{"line":205,"column":0},"end":{"line":209,"column":2}},"57":{"start":{"line":206,"column":1},"end":{"line":206,"column":47}},"58":{"start":{"line":206,"column":37},"end":{"line":206,"column":47}},"59":{"start":{"line":207,"column":1},"end":{"line":207,"column":84}},"60":{"start":{"line":208,"column":1},"end":{"line":208,"column":53}},"61":{"start":{"line":218,"column":0},"end":{"line":220,"column":2}},"62":{"start":{"line":219,"column":1},"end":{"line":219,"column":41}},"63":{"start":{"line":229,"column":0},"end":{"line":232,"column":2}},"64":{"start":{"line":231,"column":1},"end":{"line":231,"column":13}},"65":{"start":{"line":241,"column":0},"end":{"line":243,"column":2}},"66":{"start":{"line":252,"column":0},"end":{"line":304,"column":2}},"67":{"start":{"line":253,"column":1},"end":{"line":256,"column":40}},"68":{"start":{"line":258,"column":1},"end":{"line":260,"column":2}},"69":{"start":{"line":259,"column":2},"end":{"line":259,"column":67}},"70":{"start":{"line":262,"column":1},"end":{"line":265,"column":2}},"71":{"start":{"line":263,"column":2},"end":{"line":263,"column":20}},"72":{"start":{"line":264,"column":2},"end":{"line":264,"column":17}},"73":{"start":{"line":267,"column":1},"end":{"line":292,"column":3}},"74":{"start":{"line":269,"column":2},"end":{"line":271,"column":3}},"75":{"start":{"line":270,"column":3},"end":{"line":270,"column":49}},"76":{"start":{"line":273,"column":2},"end":{"line":291,"column":5}},"77":{"start":{"line":275,"column":3},"end":{"line":275,"column":33}},"78":{"start":{"line":275,"column":12},"end":{"line":275,"column":33}},"79":{"start":{"line":277,"column":3},"end":{"line":283,"column":5}},"80":{"start":{"line":285,"column":3},"end":{"line":287,"column":4}},"81":{"start":{"line":286,"column":4},"end":{"line":286,"column":35}},"82":{"start":{"line":289,"column":3},"end":{"line":289,"column":28}},"83":{"start":{"line":294,"column":1},"end":{"line":303,"column":4}},"84":{"start":{"line":295,"column":2},"end":{"line":295,"column":32}},"85":{"start":{"line":295,"column":11},"end":{"line":295,"column":32}},"86":{"start":{"line":296,"column":2},"end":{"line":302,"column":5}},"87":{"start":{"line":297,"column":3},"end":{"line":297,"column":33}},"88":{"start":{"line":297,"column":12},"end":{"line":297,"column":33}},"89":{"start":{"line":298,"column":3},"end":{"line":301,"column":6}},"90":{"start":{"line":299,"column":4},"end":{"line":299,"column":34}},"91":{"start":{"line":299,"column":13},"end":{"line":299,"column":34}},"92":{"start":{"line":300,"column":4},"end":{"line":300,"column":29}},"93":{"start":{"line":317,"column":0},"end":{"line":348,"column":2}},"94":{"start":{"line":319,"column":1},"end":{"line":319,"column":18}},"95":{"start":{"line":321,"column":1},"end":{"line":326,"column":2}},"96":{"start":{"line":322,"column":2},"end":{"line":322,"column":19}},"97":{"start":{"line":323,"column":2},"end":{"line":323,"column":22}},"98":{"start":{"line":324,"column":8},"end":{"line":326,"column":2}},"99":{"start":{"line":325,"column":2},"end":{"line":325,"column":22}},"100":{"start":{"line":328,"column":1},"end":{"line":328,"column":38}},"101":{"start":{"line":330,"column":1},"end":{"line":346,"column":3}},"102":{"start":{"line":332,"column":2},"end":{"line":338,"column":3}},"103":{"start":{"line":333,"column":3},"end":{"line":333,"column":39}},"104":{"start":{"line":335,"column":3},"end":{"line":337,"column":4}},"105":{"start":{"line":336,"column":4},"end":{"line":336,"column":30}},"106":{"start":{"line":340,"column":2},"end":{"line":342,"column":3}},"107":{"start":{"line":341,"column":3},"end":{"line":341,"column":74}},"108":{"start":{"line":344,"column":2},"end":{"line":344,"column":20}},"109":{"start":{"line":357,"column":0},"end":{"line":359,"column":2}},"110":{"start":{"line":358,"column":1},"end":{"line":358,"column":54}},"111":{"start":{"line":366,"column":0},"end":{"line":366,"column":37}}},"branchMap":{"1":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},{"start":{"line":30,"column":1},"end":{"line":30,"column":1}}]},"2":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},{"start":{"line":35,"column":1},"end":{"line":35,"column":1}}]},"3":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},{"start":{"line":42,"column":1},"end":{"line":42,"column":1}}]},"4":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},{"start":{"line":47,"column":1},"end":{"line":47,"column":1}}]},"5":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":5},"end":{"line":47,"column":16}},{"start":{"line":47,"column":20},"end":{"line":47,"column":36}}]},"6":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},{"start":{"line":51,"column":1},"end":{"line":51,"column":1}}]},"7":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":5},"end":{"line":51,"column":17}},{"start":{"line":51,"column":21},"end":{"line":51,"column":38}}]},"8":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":2},"end":{"line":105,"column":2}},{"start":{"line":105,"column":2},"end":{"line":105,"column":2}}]},"9":{"line":105,"type":"binary-expr","locations":[{"start":{"line":105,"column":6},"end":{"line":105,"column":15}},{"start":{"line":105,"column":19},"end":{"line":105,"column":28}}]},"10":{"line":150,"type":"if","locations":[{"start":{"line":150,"column":3},"end":{"line":150,"column":3}},{"start":{"line":150,"column":3},"end":{"line":150,"column":3}}]},"11":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":1},"end":{"line":178,"column":1}},{"start":{"line":178,"column":1},"end":{"line":178,"column":1}}]},"12":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":1},"end":{"line":179,"column":1}},{"start":{"line":179,"column":1},"end":{"line":179,"column":1}}]},"13":{"line":206,"type":"if","locations":[{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},{"start":{"line":206,"column":1},"end":{"line":206,"column":1}}]},"14":{"line":207,"type":"cond-expr","locations":[{"start":{"line":207,"column":36},"end":{"line":207,"column":55}},{"start":{"line":207,"column":58},"end":{"line":207,"column":83}}]},"15":{"line":254,"type":"cond-expr","locations":[{"start":{"line":254,"column":38},"end":{"line":254,"column":85}},{"start":{"line":254,"column":88},"end":{"line":254,"column":90}}]},"16":{"line":256,"type":"binary-expr","locations":[{"start":{"line":256,"column":13},"end":{"line":256,"column":26}},{"start":{"line":256,"column":30},"end":{"line":256,"column":39}}]},"17":{"line":258,"type":"if","locations":[{"start":{"line":258,"column":1},"end":{"line":258,"column":1}},{"start":{"line":258,"column":1},"end":{"line":258,"column":1}}]},"18":{"line":258,"type":"binary-expr","locations":[{"start":{"line":258,"column":5},"end":{"line":258,"column":31}},{"start":{"line":258,"column":35},"end":{"line":258,"column":84}}]},"19":{"line":262,"type":"if","locations":[{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},{"start":{"line":262,"column":1},"end":{"line":262,"column":1}}]},"20":{"line":269,"type":"if","locations":[{"start":{"line":269,"column":2},"end":{"line":269,"column":2}},{"start":{"line":269,"column":2},"end":{"line":269,"column":2}}]},"21":{"line":275,"type":"if","locations":[{"start":{"line":275,"column":3},"end":{"line":275,"column":3}},{"start":{"line":275,"column":3},"end":{"line":275,"column":3}}]},"22":{"line":285,"type":"if","locations":[{"start":{"line":285,"column":3},"end":{"line":285,"column":3}},{"start":{"line":285,"column":3},"end":{"line":285,"column":3}}]},"23":{"line":295,"type":"if","locations":[{"start":{"line":295,"column":2},"end":{"line":295,"column":2}},{"start":{"line":295,"column":2},"end":{"line":295,"column":2}}]},"24":{"line":297,"type":"if","locations":[{"start":{"line":297,"column":3},"end":{"line":297,"column":3}},{"start":{"line":297,"column":3},"end":{"line":297,"column":3}}]},"25":{"line":299,"type":"if","locations":[{"start":{"line":299,"column":4},"end":{"line":299,"column":4}},{"start":{"line":299,"column":4},"end":{"line":299,"column":4}}]},"26":{"line":321,"type":"if","locations":[{"start":{"line":321,"column":1},"end":{"line":321,"column":1}},{"start":{"line":321,"column":1},"end":{"line":321,"column":1}}]},"27":{"line":324,"type":"if","locations":[{"start":{"line":324,"column":8},"end":{"line":324,"column":8}},{"start":{"line":324,"column":8},"end":{"line":324,"column":8}}]},"28":{"line":328,"type":"binary-expr","locations":[{"start":{"line":328,"column":12},"end":{"line":328,"column":20}},{"start":{"line":328,"column":24},"end":{"line":328,"column":37}}]},"29":{"line":332,"type":"if","locations":[{"start":{"line":332,"column":2},"end":{"line":332,"column":2}},{"start":{"line":332,"column":2},"end":{"line":332,"column":2}}]},"30":{"line":335,"type":"if","locations":[{"start":{"line":335,"column":3},"end":{"line":335,"column":3}},{"start":{"line":335,"column":3},"end":{"line":335,"column":3}}]},"31":{"line":340,"type":"if","locations":[{"start":{"line":340,"column":2},"end":{"line":340,"column":2}},{"start":{"line":340,"column":2},"end":{"line":340,"column":2}}]},"32":{"line":340,"type":"binary-expr","locations":[{"start":{"line":340,"column":6},"end":{"line":340,"column":15}},{"start":{"line":340,"column":19},"end":{"line":340,"column":42}},{"start":{"line":340,"column":46},"end":{"line":340,"column":74}}]}},"code":["/*!"," * Module dependencies."," */","","var fs = require('fs-extra'),","\tpath = require('path'),","\t_ = require('underscore'),","\tmoment = require('moment'),","\tgrappling = require('grappling-hook'),","\tutil = require('util'),","\tutils = require('keystone-utils'),","\tsuper_ = require('../Type');","","/**"," * localfile FieldType Constructor"," * @extends Field"," * @api public"," */","","function localfile(list, path, options) {","\tgrappling.mixin(this)","\t\t.allowHooks('move');","\tthis._underscoreMethods = ['format', 'uploadFile'];","\tthis._fixedSize = 'full';","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","\t","\t// TODO: implement initial form, usage disabled for now","\tif (options.initial) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'localfile fields (' + list.key + '.' + path + ') do not currently support being used as initial fields.\\n');","\t}","\t","\tif (options.overwrite !== false) {","\t\toptions.overwrite = true;","\t}","\t","\tlocalfile.super_.call(this, list, path, options);","\t","\t// validate destination dir","\tif (!options.dest) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'localfile fields (' + list.key + '.' + path + ') require the \"dest\" option to be set.');","\t}","\t// Allow hook into before and after","\tif (options.pre && options.pre.move) {","\t\tthis.pre('move', options.pre.move);","\t}","\t","\tif (options.post && options.post.move) {","\t\tthis.post('move', options.post.move);","\t}","\t","}","","/*!"," * Inherit from Field"," */","","util.inherits(localfile, super_);","","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","localfile.prototype.addToSchema = function() {","\t","\tvar field = this,","\t\tschema = this.list.schema;","\t","\tvar paths = this.paths = {","\t\t// fields","\t\tfilename:\t\tthis._path.append('.filename'),","\t\toriginalname:\t\tthis._path.append('.originalname'),","\t\tpath:\t\t\tthis._path.append('.path'),","\t\tsize:\t\t\tthis._path.append('.size'),","\t\tfiletype:\t\tthis._path.append('.filetype'),","\t\t// virtuals","\t\texists:\t\t\tthis._path.append('.exists'),","\t\thref:\t\t\tthis._path.append('.href'),","\t\tupload:\t\t\tthis._path.append('_upload'),","\t\taction:\t\t\tthis._path.append('_action')","\t};","\t","\tvar schemaPaths = this._path.addTo({}, {","\t\tfilename:\t\tString,","\t\toriginalname:   String,","\t\tpath:\t\t\tString,","\t\tsize:\t\t\tNumber,","\t\tfiletype:\t\tString","\t});","\t","\tschema.add(schemaPaths);","\t","\t// exists checks for a matching file at run-time","\tvar exists = function(item) {","\t\tvar filepath = item.get(paths.path),","\t\t\tfilename = item.get(paths.filename);","","\t\tif (!filepath || !filename) {","\t\t\treturn false;","\t\t}","","\t\treturn fs.existsSync(path.join(filepath, filename));","\t};","\t","\t// The .exists virtual indicates whether a file is stored","\tschema.virtual(paths.exists).get(function() {","\t\treturn schemaMethods.exists.apply(this);","\t});","\t","\t// The .href virtual returns the public path of the file","\tschema.virtual(paths.href).get(function() {","\t\treturn field.href.call(field, this);","\t});","\t","\t// reset clears the value of the field","\tvar reset = function(item) {","\t\titem.set(field.path, {","\t\t\tfilename: '',","\t\t\tpath: '',","\t\t\tsize: 0,","\t\t\tfiletype: ''","\t\t});","\t};","","\tvar schemaMethods = {","\t\texists: function() {","\t\t\treturn exists(this);","\t\t},","\t\t/**","\t\t * Resets the value of the field","\t\t *","\t\t * @api public","\t\t */","\t\treset: function() {","\t\t\treset(this);","\t\t},","\t\t/**","\t\t * Deletes the file from localfile and resets the field","\t\t *","\t\t * @api public","\t\t */","\t\tdelete: function() {","\t\t\tif (exists(this)) {","\t\t\t\tfs.unlinkSync(path.join(this.get(paths.path), this.get(paths.filename)));","\t\t\t}","\t\t\treset(this);","\t\t}","\t};","","\t_.each(schemaMethods, function(fn, key) {","\t\tfield.underscoreMethod(key, fn);","\t});","","\t// expose a method on the field to call schema methods","\tthis.apply = function(item, method) {","\t\treturn schemaMethods[method].apply(item, Array.prototype.slice.call(arguments, 2));","\t};","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * Delegates to the options.format function if it exists."," * @api public"," */","","localfile.prototype.format = function(item) {","\tif (!item.get(this.paths.filename)) return '';","\tif (this.hasFormatter()) {","\t\tvar file = item.get(this.path);","\t\tfile.href = this.href(item);","\t\treturn this.options.format.call(this, item, file);","\t}","\treturn this.href(item);","};","","","/**"," * Detects whether the field has formatter function"," *"," * @api public"," */","","localfile.prototype.hasFormatter = function() {","\treturn 'function' === typeof this.options.format;","};","","","/**"," * Return the public href for the stored file"," *"," * @api public"," */","","localfile.prototype.href = function(item) {","\tif (!item.get(this.paths.filename)) return '';","\tvar prefix = this.options.prefix ? this.options.prefix : item.get(this.paths.path);","\treturn prefix + '/' + item.get(this.paths.filename);","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","localfile.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.path);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","localfile.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO - how should file field input be validated?","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","localfile.prototype.updateItem = function(item, data) {//eslint-disable-line no-unused-vars","\t// TODO - direct updating of data (not via upload)","};","","","/**"," * Uploads the file for this field"," *"," * @api public"," */","","localfile.prototype.uploadFile = function(item, file, update, callback) {","\tvar field = this,","\t\tprefix = field.options.datePrefix ? moment().format(field.options.datePrefix) + '-' : '',","\t\tfilename = prefix + file.name,","\t\tfiletype = file.mimetype || file.type;","","\tif (field.options.allowedTypes && !_.contains(field.options.allowedTypes, filetype)) {","\t\treturn callback(new Error('Unsupported File Type: ' + filetype));","\t}","","\tif ('function' === typeof update) {","\t\tcallback = update;","\t\tupdate = false;","\t}","","\tvar doMove = function(callback) {","\t\t","\t\tif ('function' === typeof field.options.filename) {","\t\t\tfilename = field.options.filename(item, file);","\t\t}","","\t\tfs.move(file.path, path.join(field.options.dest, filename), { clobber: field.options.overwrite }, function(err) {","\t\t\t","\t\t\tif (err) return callback(err);","","\t\t\tvar fileData = {","\t\t\t\tfilename: filename,","\t\t\t\toriginalname: file.originalname,","\t\t\t\tpath: field.options.dest,","\t\t\t\tsize: file.size,","\t\t\t\tfiletype: filetype","\t\t\t};","","\t\t\tif (update) {","\t\t\t\titem.set(field.path, fileData);","\t\t\t}","","\t\t\tcallback(null, fileData);","\t\t\t","\t\t});","\t};","","\tfield.callHook('pre:move', item, file, function(err) {","\t\tif (err) return callback(err);","\t\tdoMove(function(err, fileData) {","\t\t\tif (err) return callback(err);","\t\t\tfield.callHook('post:move', [item, file, fileData], function(err) {","\t\t\t\tif (err) return callback(err);","\t\t\t\tcallback(null, fileData);","\t\t\t});","\t\t});","\t});","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Expected form parts are"," * - `field.paths.action` in `req.body` (`clear` or `delete`)"," * - `field.paths.upload` in `req.files` (uploads the file to localfile)"," *"," * @api public"," */","","localfile.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","","\t\tif (req.body) {","\t\t\tvar action = req.body[paths.action];","","\t\t\tif (/^(delete|reset)$/.test(action)) {","\t\t\t\tfield.apply(item, action);","\t\t\t}","\t\t}","","\t\tif (req.files && req.files[paths.upload] && req.files[paths.upload].size) {","\t\t\treturn field.uploadFile(item, req.files[paths.upload], true, callback);","\t\t}","","\t\treturn callback();","","\t};","","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","localfile.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/*!"," * Export class"," */","","exports = module.exports = localfile;",""],"l":{"5":1,"20":1,"21":0,"23":0,"24":0,"27":0,"30":0,"31":0,"35":0,"36":0,"39":0,"42":0,"43":0,"47":0,"48":0,"51":0,"52":0,"61":1,"71":1,"73":0,"76":0,"90":0,"98":0,"101":0,"102":0,"105":0,"106":0,"109":0,"113":0,"114":0,"118":0,"119":0,"123":0,"124":0,"132":0,"134":0,"142":0,"150":0,"151":0,"153":0,"157":0,"158":0,"162":0,"163":0,"166":0,"177":1,"178":0,"179":0,"180":0,"181":0,"182":0,"184":0,"194":1,"195":0,"205":1,"206":0,"207":0,"208":0,"218":1,"219":0,"229":1,"231":0,"241":1,"252":1,"253":0,"258":0,"259":0,"262":0,"263":0,"264":0,"267":0,"269":0,"270":0,"273":0,"275":0,"277":0,"285":0,"286":0,"289":0,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"317":1,"319":0,"321":0,"322":0,"323":0,"324":0,"325":0,"328":0,"330":0,"332":0,"333":0,"335":0,"336":0,"340":0,"341":0,"344":0,"357":1,"358":0,"366":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/localfiles/LocalFilesType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/localfiles/LocalFilesType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":1,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":1,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":1,"76":0,"77":1,"78":0,"79":0,"80":0,"81":0,"82":1,"83":0,"84":1,"85":0,"86":1,"87":1,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":1,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":1,"150":0,"151":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0},"fnMap":{"1":{"name":"localfiles","line":22,"loc":{"start":{"line":22,"column":0},"end":{"line":22,"column":41}}},"2":{"name":"(anonymous_2)","line":73,"loc":{"start":{"line":73,"column":35},"end":{"line":73,"column":46}}},"3":{"name":"(anonymous_3)","line":102,"loc":{"start":{"line":102,"column":33},"end":{"line":102,"column":44}}},"4":{"name":"(anonymous_4)","line":108,"loc":{"start":{"line":108,"column":14},"end":{"line":108,"column":41}}},"5":{"name":"(anonymous_5)","line":138,"loc":{"start":{"line":138,"column":34},"end":{"line":138,"column":45}}},"6":{"name":"(anonymous_6)","line":142,"loc":{"start":{"line":142,"column":13},"end":{"line":142,"column":40}}},"7":{"name":"(anonymous_7)","line":155,"loc":{"start":{"line":155,"column":10},"end":{"line":155,"column":21}}},"8":{"name":"(anonymous_8)","line":163,"loc":{"start":{"line":163,"column":9},"end":{"line":163,"column":20}}},"9":{"name":"(anonymous_9)","line":171,"loc":{"start":{"line":171,"column":10},"end":{"line":171,"column":31}}},"10":{"name":"(anonymous_10)","line":183,"loc":{"start":{"line":183,"column":23},"end":{"line":183,"column":41}}},"11":{"name":"(anonymous_11)","line":188,"loc":{"start":{"line":188,"column":14},"end":{"line":188,"column":37}}},"12":{"name":"(anonymous_12)","line":202,"loc":{"start":{"line":202,"column":30},"end":{"line":202,"column":48}}},"13":{"name":"(anonymous_13)","line":223,"loc":{"start":{"line":223,"column":36},"end":{"line":223,"column":47}}},"14":{"name":"(anonymous_14)","line":234,"loc":{"start":{"line":234,"column":28},"end":{"line":234,"column":43}}},"15":{"name":"(anonymous_15)","line":247,"loc":{"start":{"line":247,"column":34},"end":{"line":247,"column":49}}},"16":{"name":"(anonymous_16)","line":258,"loc":{"start":{"line":258,"column":37},"end":{"line":258,"column":52}}},"17":{"name":"(anonymous_17)","line":270,"loc":{"start":{"line":270,"column":34},"end":{"line":270,"column":55}}},"18":{"name":"(anonymous_18)","line":281,"loc":{"start":{"line":281,"column":35},"end":{"line":281,"column":75}}},"19":{"name":"(anonymous_19)","line":290,"loc":{"start":{"line":290,"column":18},"end":{"line":290,"column":48}}},"20":{"name":"(anonymous_20)","line":300,"loc":{"start":{"line":300,"column":15},"end":{"line":300,"column":34}}},"21":{"name":"(anonymous_21)","line":306,"loc":{"start":{"line":306,"column":101},"end":{"line":306,"column":115}}},"22":{"name":"(anonymous_22)","line":326,"loc":{"start":{"line":326,"column":41},"end":{"line":326,"column":55}}},"23":{"name":"(anonymous_23)","line":329,"loc":{"start":{"line":329,"column":10},"end":{"line":329,"column":34}}},"24":{"name":"(anonymous_24)","line":331,"loc":{"start":{"line":331,"column":54},"end":{"line":331,"column":68}}},"25":{"name":"(anonymous_25)","line":352,"loc":{"start":{"line":352,"column":41},"end":{"line":352,"column":78}}},"26":{"name":"(anonymous_26)","line":363,"loc":{"start":{"line":363,"column":24},"end":{"line":363,"column":35}}},"27":{"name":"(anonymous_27)","line":365,"loc":{"start":{"line":365,"column":8},"end":{"line":365,"column":19}}},"28":{"name":"(anonymous_28)","line":372,"loc":{"start":{"line":372,"column":14},"end":{"line":372,"column":29}}},"29":{"name":"(anonymous_29)","line":381,"loc":{"start":{"line":381,"column":19},"end":{"line":381,"column":36}}},"30":{"name":"(anonymous_30)","line":390,"loc":{"start":{"line":390,"column":27},"end":{"line":390,"column":40}}},"31":{"name":"(anonymous_31)","line":407,"loc":{"start":{"line":407,"column":33},"end":{"line":407,"column":45}}},"32":{"name":"(anonymous_32)","line":430,"loc":{"start":{"line":430,"column":37},"end":{"line":430,"column":74}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":14,"column":39}},"2":{"start":{"line":22,"column":0},"end":{"line":58,"column":1}},"3":{"start":{"line":23,"column":1},"end":{"line":24,"column":22}},"4":{"start":{"line":25,"column":1},"end":{"line":25,"column":53}},"5":{"start":{"line":26,"column":1},"end":{"line":26,"column":26}},"6":{"start":{"line":29,"column":1},"end":{"line":29,"column":25}},"7":{"start":{"line":32,"column":1},"end":{"line":35,"column":2}},"8":{"start":{"line":33,"column":2},"end":{"line":34,"column":113}},"9":{"start":{"line":37,"column":1},"end":{"line":39,"column":2}},"10":{"start":{"line":38,"column":2},"end":{"line":38,"column":27}},"11":{"start":{"line":41,"column":1},"end":{"line":41,"column":51}},"12":{"start":{"line":44,"column":1},"end":{"line":47,"column":2}},"13":{"start":{"line":45,"column":2},"end":{"line":46,"column":93}},"14":{"start":{"line":50,"column":1},"end":{"line":52,"column":2}},"15":{"start":{"line":51,"column":2},"end":{"line":51,"column":37}},"16":{"start":{"line":54,"column":1},"end":{"line":56,"column":2}},"17":{"start":{"line":55,"column":2},"end":{"line":55,"column":39}},"18":{"start":{"line":64,"column":0},"end":{"line":64,"column":34}},"19":{"start":{"line":73,"column":0},"end":{"line":193,"column":2}},"20":{"start":{"line":75,"column":1},"end":{"line":76,"column":28}},"21":{"start":{"line":77,"column":1},"end":{"line":77,"column":34}},"22":{"start":{"line":79,"column":1},"end":{"line":91,"column":3}},"23":{"start":{"line":93,"column":1},"end":{"line":99,"column":4}},"24":{"start":{"line":102,"column":1},"end":{"line":104,"column":4}},"25":{"start":{"line":103,"column":2},"end":{"line":103,"column":38}},"26":{"start":{"line":106,"column":1},"end":{"line":106,"column":49}},"27":{"start":{"line":108,"column":1},"end":{"line":135,"column":3}},"28":{"start":{"line":109,"column":2},"end":{"line":109,"column":36}},"29":{"start":{"line":110,"column":2},"end":{"line":110,"column":12}},"30":{"start":{"line":112,"column":2},"end":{"line":114,"column":3}},"31":{"start":{"line":113,"column":3},"end":{"line":113,"column":16}},"32":{"start":{"line":117,"column":2},"end":{"line":121,"column":3}},"33":{"start":{"line":118,"column":3},"end":{"line":118,"column":21}},"34":{"start":{"line":120,"column":3},"end":{"line":120,"column":53}},"35":{"start":{"line":123,"column":2},"end":{"line":125,"column":3}},"36":{"start":{"line":124,"column":3},"end":{"line":124,"column":16}},"37":{"start":{"line":127,"column":2},"end":{"line":128,"column":29}},"38":{"start":{"line":130,"column":2},"end":{"line":132,"column":3}},"39":{"start":{"line":131,"column":3},"end":{"line":131,"column":16}},"40":{"start":{"line":134,"column":2},"end":{"line":134,"column":55}},"41":{"start":{"line":138,"column":1},"end":{"line":140,"column":4}},"42":{"start":{"line":139,"column":2},"end":{"line":139,"column":42}},"43":{"start":{"line":142,"column":1},"end":{"line":152,"column":3}},"44":{"start":{"line":143,"column":2},"end":{"line":151,"column":3}},"45":{"start":{"line":144,"column":3},"end":{"line":144,"column":28}},"46":{"start":{"line":146,"column":3},"end":{"line":146,"column":37}},"47":{"start":{"line":147,"column":3},"end":{"line":147,"column":57}},"48":{"start":{"line":148,"column":3},"end":{"line":150,"column":4}},"49":{"start":{"line":149,"column":4},"end":{"line":149,"column":44}},"50":{"start":{"line":154,"column":1},"end":{"line":181,"column":3}},"51":{"start":{"line":156,"column":3},"end":{"line":156,"column":23}},"52":{"start":{"line":164,"column":3},"end":{"line":164,"column":15}},"53":{"start":{"line":172,"column":3},"end":{"line":178,"column":4}},"54":{"start":{"line":173,"column":4},"end":{"line":173,"column":38}},"55":{"start":{"line":174,"column":4},"end":{"line":174,"column":58}},"56":{"start":{"line":175,"column":4},"end":{"line":177,"column":5}},"57":{"start":{"line":176,"column":5},"end":{"line":176,"column":58}},"58":{"start":{"line":179,"column":3},"end":{"line":179,"column":27}},"59":{"start":{"line":183,"column":1},"end":{"line":185,"column":4}},"60":{"start":{"line":184,"column":2},"end":{"line":184,"column":34}},"61":{"start":{"line":188,"column":1},"end":{"line":190,"column":3}},"62":{"start":{"line":189,"column":2},"end":{"line":189,"column":85}},"63":{"start":{"line":192,"column":1},"end":{"line":192,"column":30}},"64":{"start":{"line":202,"column":0},"end":{"line":214,"column":2}},"65":{"start":{"line":203,"column":1},"end":{"line":203,"column":33}},"66":{"start":{"line":204,"column":1},"end":{"line":206,"column":2}},"67":{"start":{"line":205,"column":2},"end":{"line":205,"column":46}},"68":{"start":{"line":207,"column":1},"end":{"line":207,"column":21}},"69":{"start":{"line":208,"column":1},"end":{"line":208,"column":22}},"70":{"start":{"line":208,"column":12},"end":{"line":208,"column":22}},"71":{"start":{"line":209,"column":1},"end":{"line":212,"column":2}},"72":{"start":{"line":210,"column":2},"end":{"line":210,"column":30}},"73":{"start":{"line":211,"column":2},"end":{"line":211,"column":52}},"74":{"start":{"line":213,"column":1},"end":{"line":213,"column":22}},"75":{"start":{"line":223,"column":0},"end":{"line":225,"column":2}},"76":{"start":{"line":224,"column":1},"end":{"line":224,"column":50}},"77":{"start":{"line":234,"column":0},"end":{"line":238,"column":2}},"78":{"start":{"line":235,"column":1},"end":{"line":235,"column":31}},"79":{"start":{"line":235,"column":21},"end":{"line":235,"column":31}},"80":{"start":{"line":236,"column":1},"end":{"line":236,"column":68}},"81":{"start":{"line":237,"column":1},"end":{"line":237,"column":37}},"82":{"start":{"line":247,"column":0},"end":{"line":249,"column":2}},"83":{"start":{"line":248,"column":1},"end":{"line":248,"column":41}},"84":{"start":{"line":258,"column":0},"end":{"line":261,"column":2}},"85":{"start":{"line":260,"column":1},"end":{"line":260,"column":13}},"86":{"start":{"line":270,"column":0},"end":{"line":272,"column":2}},"87":{"start":{"line":281,"column":0},"end":{"line":339,"column":2}},"88":{"start":{"line":283,"column":1},"end":{"line":283,"column":18}},"89":{"start":{"line":285,"column":1},"end":{"line":288,"column":2}},"90":{"start":{"line":286,"column":2},"end":{"line":286,"column":20}},"91":{"start":{"line":287,"column":2},"end":{"line":287,"column":17}},"92":{"start":{"line":290,"column":1},"end":{"line":337,"column":14}},"93":{"start":{"line":292,"column":2},"end":{"line":294,"column":41}},"94":{"start":{"line":296,"column":2},"end":{"line":298,"column":3}},"95":{"start":{"line":297,"column":3},"end":{"line":297,"column":73}},"96":{"start":{"line":300,"column":2},"end":{"line":324,"column":4}},"97":{"start":{"line":302,"column":3},"end":{"line":304,"column":4}},"98":{"start":{"line":303,"column":4},"end":{"line":303,"column":50}},"99":{"start":{"line":306,"column":3},"end":{"line":322,"column":6}},"100":{"start":{"line":307,"column":4},"end":{"line":307,"column":34}},"101":{"start":{"line":307,"column":13},"end":{"line":307,"column":34}},"102":{"start":{"line":309,"column":4},"end":{"line":315,"column":6}},"103":{"start":{"line":317,"column":4},"end":{"line":319,"column":5}},"104":{"start":{"line":318,"column":5},"end":{"line":318,"column":41}},"105":{"start":{"line":321,"column":4},"end":{"line":321,"column":29}},"106":{"start":{"line":326,"column":2},"end":{"line":335,"column":5}},"107":{"start":{"line":327,"column":3},"end":{"line":327,"column":38}},"108":{"start":{"line":327,"column":12},"end":{"line":327,"column":38}},"109":{"start":{"line":329,"column":3},"end":{"line":334,"column":6}},"110":{"start":{"line":330,"column":4},"end":{"line":330,"column":39}},"111":{"start":{"line":330,"column":13},"end":{"line":330,"column":39}},"112":{"start":{"line":331,"column":4},"end":{"line":333,"column":7}},"113":{"start":{"line":332,"column":5},"end":{"line":332,"column":41}},"114":{"start":{"line":352,"column":0},"end":{"line":421,"column":2}},"115":{"start":{"line":354,"column":1},"end":{"line":354,"column":18}},"116":{"start":{"line":356,"column":1},"end":{"line":361,"column":2}},"117":{"start":{"line":357,"column":2},"end":{"line":357,"column":19}},"118":{"start":{"line":358,"column":2},"end":{"line":358,"column":22}},"119":{"start":{"line":359,"column":8},"end":{"line":361,"column":2}},"120":{"start":{"line":360,"column":2},"end":{"line":360,"column":22}},"121":{"start":{"line":363,"column":1},"end":{"line":363,"column":38}},"122":{"start":{"line":365,"column":1},"end":{"line":419,"column":3}},"123":{"start":{"line":368,"column":2},"end":{"line":375,"column":3}},"124":{"start":{"line":369,"column":3},"end":{"line":370,"column":48}},"125":{"start":{"line":372,"column":3},"end":{"line":374,"column":6}},"126":{"start":{"line":373,"column":4},"end":{"line":373,"column":94}},"127":{"start":{"line":378,"column":2},"end":{"line":395,"column":3}},"128":{"start":{"line":379,"column":3},"end":{"line":379,"column":51}},"129":{"start":{"line":381,"column":3},"end":{"line":394,"column":6}},"130":{"start":{"line":383,"column":4},"end":{"line":383,"column":31}},"131":{"start":{"line":385,"column":4},"end":{"line":386,"column":21}},"132":{"start":{"line":388,"column":4},"end":{"line":388,"column":59}},"133":{"start":{"line":388,"column":52},"end":{"line":388,"column":59}},"134":{"start":{"line":390,"column":4},"end":{"line":392,"column":7}},"135":{"start":{"line":391,"column":5},"end":{"line":391,"column":35}},"136":{"start":{"line":398,"column":2},"end":{"line":416,"column":3}},"137":{"start":{"line":400,"column":3},"end":{"line":400,"column":41}},"138":{"start":{"line":401,"column":3},"end":{"line":415,"column":4}},"139":{"start":{"line":402,"column":4},"end":{"line":404,"column":5}},"140":{"start":{"line":403,"column":5},"end":{"line":403,"column":25}},"141":{"start":{"line":406,"column":4},"end":{"line":414,"column":5}},"142":{"start":{"line":407,"column":5},"end":{"line":407,"column":109}},"143":{"start":{"line":407,"column":47},"end":{"line":407,"column":105}},"144":{"start":{"line":409,"column":5},"end":{"line":413,"column":6}},"145":{"start":{"line":410,"column":6},"end":{"line":410,"column":38}},"146":{"start":{"line":411,"column":6},"end":{"line":411,"column":27}},"147":{"start":{"line":412,"column":6},"end":{"line":412,"column":62}},"148":{"start":{"line":418,"column":2},"end":{"line":418,"column":20}},"149":{"start":{"line":430,"column":0},"end":{"line":432,"column":2}},"150":{"start":{"line":431,"column":1},"end":{"line":431,"column":54}},"151":{"start":{"line":439,"column":0},"end":{"line":439,"column":38}}},"branchMap":{"1":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},{"start":{"line":32,"column":1},"end":{"line":32,"column":1}}]},"2":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},{"start":{"line":37,"column":1},"end":{"line":37,"column":1}}]},"3":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},{"start":{"line":44,"column":1},"end":{"line":44,"column":1}}]},"4":{"line":50,"type":"if","locations":[{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},{"start":{"line":50,"column":1},"end":{"line":50,"column":1}}]},"5":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":5},"end":{"line":50,"column":16}},{"start":{"line":50,"column":20},"end":{"line":50,"column":36}}]},"6":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},{"start":{"line":54,"column":1},"end":{"line":54,"column":1}}]},"7":{"line":54,"type":"binary-expr","locations":[{"start":{"line":54,"column":5},"end":{"line":54,"column":17}},{"start":{"line":54,"column":21},"end":{"line":54,"column":38}}]},"8":{"line":112,"type":"if","locations":[{"start":{"line":112,"column":2},"end":{"line":112,"column":2}},{"start":{"line":112,"column":2},"end":{"line":112,"column":2}}]},"9":{"line":112,"type":"binary-expr","locations":[{"start":{"line":112,"column":6},"end":{"line":112,"column":35}},{"start":{"line":112,"column":39},"end":{"line":112,"column":58}}]},"10":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":2},"end":{"line":117,"column":2}},{"start":{"line":117,"column":2},"end":{"line":117,"column":2}}]},"11":{"line":123,"type":"if","locations":[{"start":{"line":123,"column":2},"end":{"line":123,"column":2}},{"start":{"line":123,"column":2},"end":{"line":123,"column":2}}]},"12":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":2},"end":{"line":130,"column":2}},{"start":{"line":130,"column":2},"end":{"line":130,"column":2}}]},"13":{"line":130,"type":"binary-expr","locations":[{"start":{"line":130,"column":6},"end":{"line":130,"column":16}},{"start":{"line":130,"column":20},"end":{"line":130,"column":29}}]},"14":{"line":143,"type":"if","locations":[{"start":{"line":143,"column":2},"end":{"line":143,"column":2}},{"start":{"line":143,"column":2},"end":{"line":143,"column":2}}]},"15":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":3},"end":{"line":148,"column":3}},{"start":{"line":148,"column":3},"end":{"line":148,"column":3}}]},"16":{"line":172,"type":"if","locations":[{"start":{"line":172,"column":3},"end":{"line":172,"column":3}},{"start":{"line":172,"column":3},"end":{"line":172,"column":3}}]},"17":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":4},"end":{"line":175,"column":4}},{"start":{"line":175,"column":4},"end":{"line":175,"column":4}}]},"18":{"line":204,"type":"if","locations":[{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},{"start":{"line":204,"column":1},"end":{"line":204,"column":1}}]},"19":{"line":208,"type":"if","locations":[{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},{"start":{"line":208,"column":1},"end":{"line":208,"column":1}}]},"20":{"line":209,"type":"if","locations":[{"start":{"line":209,"column":1},"end":{"line":209,"column":1}},{"start":{"line":209,"column":1},"end":{"line":209,"column":1}}]},"21":{"line":235,"type":"if","locations":[{"start":{"line":235,"column":1},"end":{"line":235,"column":1}},{"start":{"line":235,"column":1},"end":{"line":235,"column":1}}]},"22":{"line":236,"type":"cond-expr","locations":[{"start":{"line":236,"column":36},"end":{"line":236,"column":55}},{"start":{"line":236,"column":58},"end":{"line":236,"column":67}}]},"23":{"line":285,"type":"if","locations":[{"start":{"line":285,"column":1},"end":{"line":285,"column":1}},{"start":{"line":285,"column":1},"end":{"line":285,"column":1}}]},"24":{"line":292,"type":"cond-expr","locations":[{"start":{"line":292,"column":42},"end":{"line":292,"column":89}},{"start":{"line":292,"column":92},"end":{"line":292,"column":94}}]},"25":{"line":294,"type":"binary-expr","locations":[{"start":{"line":294,"column":14},"end":{"line":294,"column":27}},{"start":{"line":294,"column":31},"end":{"line":294,"column":40}}]},"26":{"line":296,"type":"if","locations":[{"start":{"line":296,"column":2},"end":{"line":296,"column":2}},{"start":{"line":296,"column":2},"end":{"line":296,"column":2}}]},"27":{"line":296,"type":"binary-expr","locations":[{"start":{"line":296,"column":6},"end":{"line":296,"column":32}},{"start":{"line":296,"column":36},"end":{"line":296,"column":85}}]},"28":{"line":302,"type":"if","locations":[{"start":{"line":302,"column":3},"end":{"line":302,"column":3}},{"start":{"line":302,"column":3},"end":{"line":302,"column":3}}]},"29":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":4},"end":{"line":307,"column":4}},{"start":{"line":307,"column":4},"end":{"line":307,"column":4}}]},"30":{"line":317,"type":"if","locations":[{"start":{"line":317,"column":4},"end":{"line":317,"column":4}},{"start":{"line":317,"column":4},"end":{"line":317,"column":4}}]},"31":{"line":327,"type":"if","locations":[{"start":{"line":327,"column":3},"end":{"line":327,"column":3}},{"start":{"line":327,"column":3},"end":{"line":327,"column":3}}]},"32":{"line":330,"type":"if","locations":[{"start":{"line":330,"column":4},"end":{"line":330,"column":4}},{"start":{"line":330,"column":4},"end":{"line":330,"column":4}}]},"33":{"line":356,"type":"if","locations":[{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},{"start":{"line":356,"column":1},"end":{"line":356,"column":1}}]},"34":{"line":359,"type":"if","locations":[{"start":{"line":359,"column":8},"end":{"line":359,"column":8}},{"start":{"line":359,"column":8},"end":{"line":359,"column":8}}]},"35":{"line":363,"type":"binary-expr","locations":[{"start":{"line":363,"column":12},"end":{"line":363,"column":20}},{"start":{"line":363,"column":24},"end":{"line":363,"column":37}}]},"36":{"line":368,"type":"if","locations":[{"start":{"line":368,"column":2},"end":{"line":368,"column":2}},{"start":{"line":368,"column":2},"end":{"line":368,"column":2}}]},"37":{"line":373,"type":"cond-expr","locations":[{"start":{"line":373,"column":87},"end":{"line":373,"column":88}},{"start":{"line":373,"column":91},"end":{"line":373,"column":93}}]},"38":{"line":378,"type":"if","locations":[{"start":{"line":378,"column":2},"end":{"line":378,"column":2}},{"start":{"line":378,"column":2},"end":{"line":378,"column":2}}]},"39":{"line":378,"type":"binary-expr","locations":[{"start":{"line":378,"column":6},"end":{"line":378,"column":14}},{"start":{"line":378,"column":18},"end":{"line":378,"column":40}}]},"40":{"line":388,"type":"if","locations":[{"start":{"line":388,"column":4},"end":{"line":388,"column":4}},{"start":{"line":388,"column":4},"end":{"line":388,"column":4}}]},"41":{"line":388,"type":"binary-expr","locations":[{"start":{"line":388,"column":8},"end":{"line":388,"column":42}},{"start":{"line":388,"column":46},"end":{"line":388,"column":50}}]},"42":{"line":398,"type":"if","locations":[{"start":{"line":398,"column":2},"end":{"line":398,"column":2}},{"start":{"line":398,"column":2},"end":{"line":398,"column":2}}]},"43":{"line":401,"type":"if","locations":[{"start":{"line":401,"column":3},"end":{"line":401,"column":3}},{"start":{"line":401,"column":3},"end":{"line":401,"column":3}}]},"44":{"line":402,"type":"if","locations":[{"start":{"line":402,"column":4},"end":{"line":402,"column":4}},{"start":{"line":402,"column":4},"end":{"line":402,"column":4}}]},"45":{"line":406,"type":"if","locations":[{"start":{"line":406,"column":4},"end":{"line":406,"column":4}},{"start":{"line":406,"column":4},"end":{"line":406,"column":4}}]},"46":{"line":407,"type":"binary-expr","locations":[{"start":{"line":407,"column":54},"end":{"line":407,"column":83}},{"start":{"line":407,"column":87},"end":{"line":407,"column":104}}]},"47":{"line":409,"type":"if","locations":[{"start":{"line":409,"column":5},"end":{"line":409,"column":5}},{"start":{"line":409,"column":5},"end":{"line":409,"column":5}}]}},"code":["/*!"," * Module dependencies."," */","","var fs = require('fs-extra'),","\tpath = require('path'),","\t_ = require('underscore'),","\tmoment = require('moment'),","\tkeystone = require('../../../'),","\tutil = require('util'),","\tutils = require('keystone-utils'),","\tsuper_ = require('../Type'),","\tasync = require('async'),","\tgrappling = require('grappling-hook');","","/**"," * localfiles FieldType Constructor"," * @extends Field"," * @api public"," */","","function localfiles(list, path, options) {","\tgrappling.mixin(this)","\t\t.allowHooks('move');","\tthis._underscoreMethods = ['format', 'uploadFiles'];","\tthis._fixedSize = 'full';","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","","\t// TODO: implement initial form, usage disabled for now","\tif (options.initial) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'localfiles fields (' + list.key + '.' + path + ') do not currently support being used as initial fields.\\n');","\t}","","\tif (options.overwrite !== false) {","\t\toptions.overwrite = true;","\t}","","\tlocalfiles.super_.call(this, list, path, options);","","\t// validate destination dir","\tif (!options.dest) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'localfiles fields (' + list.key + '.' + path + ') require the \"dest\" option to be set.');","\t}","","\t// Allow hook into before and after","\tif (options.pre && options.pre.move) {","\t\tthis.pre('move', options.pre.move);","\t}","","\tif (options.post && options.post.move) {","\t\tthis.post('move', options.post.move);","\t}","","}","","/*!"," * Inherit from Field"," */","","util.inherits(localfiles, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","localfiles.prototype.addToSchema = function() {","","\tvar field = this,","\t\tschema = this.list.schema;","\tvar mongoose = keystone.mongoose;","","\tvar paths = this.paths = {","\t\t// fields","\t\tfilename:\t\tthis._path.append('.filename'),","\t\tpath:\t\t\tthis._path.append('.path'),","\t\toriginalname:\tthis._path.append('.originalname'),","\t\tsize:\t\t\tthis._path.append('.size'),","\t\tfiletype:\t\tthis._path.append('.filetype'),","\t\t// virtuals","\t\texists:\t\t\tthis._path.append('.exists'),","\t\tupload:\t\t\tthis._path.append('_upload'),","\t\taction:\t\t\tthis._path.append('_action'),","\t\torder: \t\t\tthis._path.append('_order')","\t};","","\tvar schemaPaths = new mongoose.Schema({","\t\tfilename:\t\tString,","\t\toriginalname:\tString,","\t\tpath:\t\t\tString,","\t\tsize:\t\t\tNumber,","\t\tfiletype:\t\tString","\t});","","\t// The .href virtual returns the public path of the file","\tschemaPaths.virtual('href').get(function() {","\t\treturn field.href.call(field, this);","\t});","","\tschema.add(this._path.addTo({}, [schemaPaths]));","","\tvar exists = function(item, element_id) {","\t\tvar values = item.get(field.path);","\t\tvar value;","","\t\tif (typeof values === 'undefined' || values.length === 0) {","\t\t\treturn false;","\t\t}","","\t\t// if current Field contains any file, it means it exists","\t\tif (typeof element_id === 'undefined') {","\t\t\tvalue = values[0];","\t\t} else {","\t\t\tvalue = _.findWhere(values, { 'id': element_id });","\t\t}","","\t\tif (typeof value === 'undefined') {","\t\t\treturn false;","\t\t}","","\t\tvar filepaths = value.path,","\t\t\tfilename = value.filename;","","\t\tif (!filepaths || !filename) {","\t\t\treturn false;","\t\t}","","\t\treturn fs.existsSync(path.join(filepaths, filename));","\t};","","\t// The .exists virtual indicates whether a file is stored","\tschema.virtual(paths.exists).get(function() {","\t\treturn schemaMethods.exists.apply(this);","\t});","","\tvar reset = function(item, element_id) {","\t\tif (typeof element_id === 'undefined') {","\t\t\titem.set(field.path, []);","\t\t} else {","\t\t\tvar values = item.get(field.path);","\t\t\tvar value = _.findWhere(values, { 'id': element_id });","\t\t\tif (typeof value !== 'undefined') {","\t\t\t\tvalues.splice(values.indexOf(value), 1);","\t\t\t}","\t\t}","\t};","","\tvar schemaMethods = {","\t\texists: function() {","\t\t\treturn exists(this);","\t\t},","\t\t/**","\t\t * Resets the value of the field","\t\t *","\t\t * @api public","\t\t */","\t\treset: function() {","\t\t\treset(this);","\t\t},","\t\t/**","\t\t * Deletes the file from localfiles and resets the field","\t\t *","\t\t * @api public","\t\t */","\t\tdelete: function(element_id) {","\t\t\tif (exists(this, element_id)) {","\t\t\t\tvar values = this.get(field.path);","\t\t\t\tvar value = _.findWhere(values, { 'id': element_id });","\t\t\t\tif (typeof value !== 'undefined') {","\t\t\t\t\tfs.unlinkSync(path.join(value.path, value.filename));","\t\t\t\t}","\t\t\t}","\t\t\treset(this, element_id);","\t\t}","\t};","","\t_.each(schemaMethods, function(fn, key) {","\t\tfield.underscoreMethod(key, fn);","\t});","","\t// expose a method on the field to call schema methods","\tthis.apply = function(item, method) {","\t\treturn schemaMethods[method].apply(item, Array.prototype.slice.call(arguments, 2));","\t};","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","localfiles.prototype.format = function(item, i) {","\tvar files = item.get(this.path);","\tif (typeof i === 'undefined') {","\t\treturn utils.plural(files.length, '* File');","\t}","\tvar file = files[i];","\tif (!file) return '';","\tif (this.hasFormatter()) {","\t\tfile.href = this.href(file);","\t\treturn this.options.format.call(this, item, file);","\t}","\treturn file.filename;","};","","","/**"," * Detects whether the field has a formatter function"," *"," * @api public"," */","","localfiles.prototype.hasFormatter = function() {","\treturn 'function' === typeof this.options.format;","};","","","/**"," * Return the public href for a single stored file"," *"," * @api public"," */","","localfiles.prototype.href = function(file) {","\tif (!file.filename) return '';","\tvar prefix = this.options.prefix ? this.options.prefix : file.path;","\treturn prefix + '/' + file.filename;","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","localfiles.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.path);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","localfiles.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO - how should file field input be validated?","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","localfiles.prototype.updateItem = function(item, data) {//eslint-disable-line no-unused-vars","\t// TODO - direct updating of data (not via upload)","};","","","/**"," * Uploads the file for this field"," *"," * @api public"," */","","localfiles.prototype.uploadFiles = function(item, files, update, callback) {","","\tvar field = this;","","\tif ('function' === typeof update) {","\t\tcallback = update;","\t\tupdate = false;","\t}","","\tasync.map(files, function(file, processedFile) {","","\t\tvar prefix = field.options.datePrefix ? moment().format(field.options.datePrefix) + '-' : '',","\t\t\tfilename = prefix + file.name,","\t\t\tfiletype = file.mimetype || file.type;","","\t\tif (field.options.allowedTypes && !_.contains(field.options.allowedTypes, filetype)) {","\t\t\treturn processedFile(new Error('Unsupported File Type: ' + filetype));","\t\t}","","\t\tvar doMove = function(doneMove) {","","\t\t\tif ('function' === typeof field.options.filename) {","\t\t\t\tfilename = field.options.filename(item, file);","\t\t\t}","","\t\t\tfs.move(file.path, path.join(field.options.dest, filename), { clobber: field.options.overwrite }, function(err) {","\t\t\t\tif (err) return doneMove(err);","","\t\t\t\tvar fileData = {","\t\t\t\t\tfilename: filename,","\t\t\t\t\toriginalname: file.originalname,","\t\t\t\t\tpath: field.options.dest,","\t\t\t\t\tsize: file.size,","\t\t\t\t\tfiletype: filetype","\t\t\t\t};","","\t\t\t\tif (update) {","\t\t\t\t\titem.get(field.path).push(fileData);","\t\t\t\t}","","\t\t\t\tdoneMove(null, fileData);","\t\t\t});","","\t\t};","","\t\tfield.callHook('pre:move', item, file, function(err) {","\t\t\tif (err) return processedFile(err);","","\t\t\tdoMove(function(err, fileData) {","\t\t\t\tif (err) return processedFile(err);","\t\t\t\tfield.callHook('post:move', item, file, fileData, function(err) {","\t\t\t\t\treturn processedFile(err, fileData);","\t\t\t\t});","\t\t\t});","\t\t});","","\t}, callback);","","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Expected form parts are"," * - `field.paths.action` in `req.body` (`clear` or `delete`)"," * - `field.paths.upload` in `req.files` (uploads the file to localfiles)"," *"," * @api public"," */","","localfiles.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","","\t\t// Order","\t\tif (req.body[paths.order]) {","\t\t\tvar files = item.get(field.path),","\t\t\t\tnewOrder = req.body[paths.order].split(',');","","\t\t\tfiles.sort(function(a, b) {","\t\t\t\treturn (newOrder.indexOf(a._id.toString()) > newOrder.indexOf(b._id.toString())) ? 1 : -1;","\t\t\t});","\t\t}","","\t\t// Removals","\t\tif (req.body && req.body[paths.action]) {","\t\t\tvar actions = req.body[paths.action].split('|');","","\t\t\tactions.forEach(function(action) {","","\t\t\t\taction = action.split(':');","","\t\t\t\tvar method = action[0],","\t\t\t\t\tids = action[1];","","\t\t\t\tif (!(/^(delete|reset)$/.test(method)) || !ids) return;","","\t\t\t\tids.split(',').forEach(function(id) {","\t\t\t\t\tfield.apply(item, method, id);","\t\t\t\t});","","\t\t\t});","\t\t}","","\t\t// Upload new files","\t\tif (req.files) {","","\t\t\tvar upFiles = req.files[paths.upload];","\t\t\tif (upFiles) {","\t\t\t\tif (!Array.isArray(upFiles)) {","\t\t\t\t\tupFiles = [upFiles];","\t\t\t\t}","","\t\t\t\tif (upFiles.length > 0) {","\t\t\t\t\tupFiles = _.filter(upFiles, function(f) { return typeof f.name !== 'undefined' && f.name.length > 0; });","","\t\t\t\t\tif (upFiles.length > 0) {","\t\t\t\t\t\tconsole.log('uploading files:');","\t\t\t\t\t\tconsole.log(upFiles);","\t\t\t\t\t\treturn field.uploadFiles(item, upFiles, true, callback);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","\t\t}","","\t\treturn callback();","\t};","","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","localfiles.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/*!"," * Export class"," */","","exports = module.exports = localfiles;",""],"l":{"5":1,"22":1,"23":0,"25":0,"26":0,"29":0,"32":0,"33":0,"37":0,"38":0,"41":0,"44":0,"45":0,"50":0,"51":0,"54":0,"55":0,"64":1,"73":1,"75":0,"77":0,"79":0,"93":0,"102":0,"103":0,"106":0,"108":0,"109":0,"110":0,"112":0,"113":0,"117":0,"118":0,"120":0,"123":0,"124":0,"127":0,"130":0,"131":0,"134":0,"138":0,"139":0,"142":0,"143":0,"144":0,"146":0,"147":0,"148":0,"149":0,"154":0,"156":0,"164":0,"172":0,"173":0,"174":0,"175":0,"176":0,"179":0,"183":0,"184":0,"188":0,"189":0,"192":0,"202":1,"203":0,"204":0,"205":0,"207":0,"208":0,"209":0,"210":0,"211":0,"213":0,"223":1,"224":0,"234":1,"235":0,"236":0,"237":0,"247":1,"248":0,"258":1,"260":0,"270":1,"281":1,"283":0,"285":0,"286":0,"287":0,"290":0,"292":0,"296":0,"297":0,"300":0,"302":0,"303":0,"306":0,"307":0,"309":0,"317":0,"318":0,"321":0,"326":0,"327":0,"329":0,"330":0,"331":0,"332":0,"352":1,"354":0,"356":0,"357":0,"358":0,"359":0,"360":0,"363":0,"365":0,"368":0,"369":0,"372":0,"373":0,"378":0,"379":0,"381":0,"383":0,"385":0,"388":0,"390":0,"391":0,"398":0,"400":0,"401":0,"402":0,"403":0,"406":0,"407":0,"409":0,"410":0,"411":0,"412":0,"418":0,"430":1,"431":0,"439":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/location/LocationType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/location/LocationType.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":1,"20":1,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":1,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":1,"46":0,"47":1,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":1,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":1,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":1,"101":0,"102":1,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":1,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":1,"165":0,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":1,"173":0,"174":1,"175":0,"176":1},"b":{"1":[0,0],"2":[0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0,0,0],"11":[0,0],"12":[0,0],"13":[0,0,0,0,0,0,0,0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0,0],"19":[0,0],"20":[0,0],"21":[0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0],"48":[0,0],"49":[0,0],"50":[0,0],"51":[0,0],"52":[0,0],"53":[0,0],"54":[0,0],"55":[0,0],"56":[0,0],"57":[0,0],"58":[0,0],"59":[0,0],"60":[0,0],"61":[0,0],"62":[0,0],"63":[0,0],"64":[0,0],"65":[0,0],"66":[0,0],"67":[0,0],"68":[0,0],"69":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0},"fnMap":{"1":{"name":"location","line":22,"loc":{"start":{"line":22,"column":0},"end":{"line":22,"column":39}}},"2":{"name":"(anonymous_2)","line":68,"loc":{"start":{"line":68,"column":33},"end":{"line":68,"column":44}}},"3":{"name":"(anonymous_3)","line":91,"loc":{"start":{"line":91,"column":19},"end":{"line":91,"column":39}}},"4":{"name":"(anonymous_4)","line":113,"loc":{"start":{"line":113,"column":38},"end":{"line":113,"column":49}}},"5":{"name":"(anonymous_5)","line":128,"loc":{"start":{"line":128,"column":20},"end":{"line":128,"column":35}}},"6":{"name":"(anonymous_6)","line":152,"loc":{"start":{"line":152,"column":28},"end":{"line":152,"column":62}}},"7":{"name":"(anonymous_7)","line":160,"loc":{"start":{"line":160,"column":32},"end":{"line":160,"column":44}}},"8":{"name":"(anonymous_8)","line":175,"loc":{"start":{"line":175,"column":32},"end":{"line":175,"column":47}}},"9":{"name":"(anonymous_9)","line":197,"loc":{"start":{"line":197,"column":35},"end":{"line":197,"column":66}}},"10":{"name":"(anonymous_10)","line":208,"loc":{"start":{"line":208,"column":28},"end":{"line":208,"column":43}}},"11":{"name":"(anonymous_11)","line":239,"loc":{"start":{"line":239,"column":32},"end":{"line":239,"column":53}}},"12":{"name":"(anonymous_12)","line":250,"loc":{"start":{"line":250,"column":29},"end":{"line":250,"column":41}}},"13":{"name":"(anonymous_13)","line":259,"loc":{"start":{"line":259,"column":16},"end":{"line":259,"column":30}}},"14":{"name":"(anonymous_14)","line":306,"loc":{"start":{"line":306,"column":39},"end":{"line":306,"column":76}}},"15":{"name":"(anonymous_15)","line":317,"loc":{"start":{"line":317,"column":24},"end":{"line":317,"column":35}}},"16":{"name":"(anonymous_16)","line":319,"loc":{"start":{"line":319,"column":8},"end":{"line":319,"column":19}}},"17":{"name":"(anonymous_17)","line":324,"loc":{"start":{"line":324,"column":43},"end":{"line":324,"column":54}}},"18":{"name":"(anonymous_18)","line":342,"loc":{"start":{"line":342,"column":35},"end":{"line":342,"column":72}}},"19":{"name":"doGoogleGeocodeRequest","line":353,"loc":{"start":{"line":353,"column":0},"end":{"line":353,"column":59}}},"20":{"name":"(anonymous_20)","line":381,"loc":{"start":{"line":381,"column":21},"end":{"line":381,"column":35}}},"21":{"name":"(anonymous_21)","line":383,"loc":{"start":{"line":383,"column":17},"end":{"line":383,"column":33}}},"22":{"name":"(anonymous_22)","line":386,"loc":{"start":{"line":386,"column":14},"end":{"line":386,"column":25}}},"23":{"name":"(anonymous_23)","line":398,"loc":{"start":{"line":398,"column":14},"end":{"line":398,"column":28}}},"24":{"name":"(anonymous_24)","line":416,"loc":{"start":{"line":416,"column":34},"end":{"line":416,"column":75}}},"25":{"name":"(anonymous_25)","line":431,"loc":{"start":{"line":431,"column":75},"end":{"line":431,"column":97}}},"26":{"name":"(anonymous_26)","line":445,"loc":{"start":{"line":445,"column":36},"end":{"line":445,"column":49}}},"27":{"name":"(anonymous_27)","line":486,"loc":{"start":{"line":486,"column":20},"end":{"line":486,"column":41}}},"28":{"name":"calculateDistance","line":513,"loc":{"start":{"line":513,"column":0},"end":{"line":513,"column":43}}},"29":{"name":"(anonymous_29)","line":535,"loc":{"start":{"line":535,"column":28},"end":{"line":535,"column":50}}},"30":{"name":"(anonymous_30)","line":546,"loc":{"start":{"line":546,"column":31},"end":{"line":546,"column":53}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":11,"column":29}},"2":{"start":{"line":13,"column":0},"end":{"line":14,"column":21}},"3":{"start":{"line":22,"column":0},"end":{"line":53,"column":1}},"4":{"start":{"line":24,"column":1},"end":{"line":24,"column":77}},"5":{"start":{"line":25,"column":1},"end":{"line":25,"column":26}},"6":{"start":{"line":27,"column":1},"end":{"line":27,"column":146}},"7":{"start":{"line":29,"column":1},"end":{"line":29,"column":38}},"8":{"start":{"line":31,"column":1},"end":{"line":33,"column":2}},"9":{"start":{"line":32,"column":2},"end":{"line":32,"column":24}},"10":{"start":{"line":35,"column":1},"end":{"line":45,"column":2}},"11":{"start":{"line":36,"column":2},"end":{"line":42,"column":3}},"12":{"start":{"line":38,"column":3},"end":{"line":38,"column":41}},"13":{"start":{"line":39,"column":9},"end":{"line":42,"column":3}},"14":{"start":{"line":41,"column":3},"end":{"line":41,"column":73}},"15":{"start":{"line":44,"column":2},"end":{"line":44,"column":26}},"16":{"start":{"line":47,"column":1},"end":{"line":49,"column":2}},"17":{"start":{"line":48,"column":2},"end":{"line":48,"column":45}},"18":{"start":{"line":51,"column":1},"end":{"line":51,"column":49}},"19":{"start":{"line":59,"column":0},"end":{"line":59,"column":32}},"20":{"start":{"line":68,"column":0},"end":{"line":138,"column":2}},"21":{"start":{"line":70,"column":1},"end":{"line":72,"column":25}},"22":{"start":{"line":74,"column":1},"end":{"line":89,"column":3}},"23":{"start":{"line":91,"column":1},"end":{"line":97,"column":3}},"24":{"start":{"line":92,"column":2},"end":{"line":92,"column":27}},"25":{"start":{"line":93,"column":2},"end":{"line":95,"column":3}},"26":{"start":{"line":94,"column":3},"end":{"line":94,"column":39}},"27":{"start":{"line":96,"column":2},"end":{"line":96,"column":13}},"28":{"start":{"line":99,"column":1},"end":{"line":99,"column":33}},"29":{"start":{"line":100,"column":1},"end":{"line":111,"column":21}},"30":{"start":{"line":113,"column":1},"end":{"line":124,"column":4}},"31":{"start":{"line":114,"column":2},"end":{"line":123,"column":16}},"32":{"start":{"line":128,"column":1},"end":{"line":134,"column":4}},"33":{"start":{"line":129,"column":2},"end":{"line":129,"column":34}},"34":{"start":{"line":130,"column":2},"end":{"line":132,"column":3}},"35":{"start":{"line":131,"column":3},"end":{"line":131,"column":23}},"36":{"start":{"line":133,"column":2},"end":{"line":133,"column":9}},"37":{"start":{"line":136,"column":1},"end":{"line":136,"column":30}},"38":{"start":{"line":152,"column":0},"end":{"line":166,"column":2}},"39":{"start":{"line":154,"column":1},"end":{"line":156,"column":2}},"40":{"start":{"line":155,"column":2},"end":{"line":155,"column":41}},"41":{"start":{"line":158,"column":1},"end":{"line":158,"column":24}},"42":{"start":{"line":160,"column":1},"end":{"line":162,"column":4}},"43":{"start":{"line":161,"column":2},"end":{"line":161,"column":28}},"44":{"start":{"line":164,"column":1},"end":{"line":164,"column":50}},"45":{"start":{"line":175,"column":0},"end":{"line":185,"column":2}},"46":{"start":{"line":176,"column":1},"end":{"line":184,"column":34}},"47":{"start":{"line":197,"column":0},"end":{"line":230,"column":2}},"48":{"start":{"line":199,"column":1},"end":{"line":201,"column":2}},"49":{"start":{"line":200,"column":2},"end":{"line":200,"column":14}},"50":{"start":{"line":203,"column":1},"end":{"line":206,"column":15}},"51":{"start":{"line":208,"column":1},"end":{"line":226,"column":4}},"52":{"start":{"line":210,"column":2},"end":{"line":224,"column":3}},"53":{"start":{"line":211,"column":3},"end":{"line":213,"column":4}},"54":{"start":{"line":212,"column":4},"end":{"line":212,"column":11}},"55":{"start":{"line":214,"column":3},"end":{"line":216,"column":4}},"56":{"start":{"line":215,"column":4},"end":{"line":215,"column":18}},"57":{"start":{"line":218,"column":3},"end":{"line":220,"column":4}},"58":{"start":{"line":219,"column":4},"end":{"line":219,"column":11}},"59":{"start":{"line":221,"column":3},"end":{"line":223,"column":4}},"60":{"start":{"line":222,"column":4},"end":{"line":222,"column":18}},"61":{"start":{"line":228,"column":1},"end":{"line":228,"column":14}},"62":{"start":{"line":239,"column":0},"end":{"line":293,"column":2}},"63":{"start":{"line":241,"column":1},"end":{"line":246,"column":32}},"64":{"start":{"line":248,"column":1},"end":{"line":254,"column":2}},"65":{"start":{"line":250,"column":2},"end":{"line":252,"column":5}},"66":{"start":{"line":251,"column":3},"end":{"line":251,"column":19}},"67":{"start":{"line":253,"column":2},"end":{"line":253,"column":36}},"68":{"start":{"line":257,"column":1},"end":{"line":257,"column":46}},"69":{"start":{"line":259,"column":1},"end":{"line":263,"column":3}},"70":{"start":{"line":260,"column":2},"end":{"line":262,"column":3}},"71":{"start":{"line":261,"column":3},"end":{"line":261,"column":57}},"72":{"start":{"line":265,"column":1},"end":{"line":265,"column":29}},"73":{"start":{"line":267,"column":1},"end":{"line":291,"column":2}},"74":{"start":{"line":269,"column":2},"end":{"line":269,"column":41}},"75":{"start":{"line":270,"column":2},"end":{"line":273,"column":3}},"76":{"start":{"line":271,"column":3},"end":{"line":271,"column":38}},"77":{"start":{"line":272,"column":3},"end":{"line":272,"column":38}},"78":{"start":{"line":274,"column":2},"end":{"line":274,"column":38}},"79":{"start":{"line":276,"column":2},"end":{"line":278,"column":3}},"80":{"start":{"line":277,"column":3},"end":{"line":277,"column":15}},"81":{"start":{"line":280,"column":2},"end":{"line":282,"column":3}},"82":{"start":{"line":281,"column":3},"end":{"line":281,"column":31}},"83":{"start":{"line":284,"column":8},"end":{"line":291,"column":2}},"84":{"start":{"line":286,"column":2},"end":{"line":287,"column":50}},"85":{"start":{"line":289,"column":2},"end":{"line":289,"column":61}},"86":{"start":{"line":306,"column":0},"end":{"line":333,"column":2}},"87":{"start":{"line":308,"column":1},"end":{"line":308,"column":18}},"88":{"start":{"line":310,"column":1},"end":{"line":315,"column":2}},"89":{"start":{"line":311,"column":2},"end":{"line":311,"column":19}},"90":{"start":{"line":312,"column":2},"end":{"line":312,"column":22}},"91":{"start":{"line":313,"column":8},"end":{"line":315,"column":2}},"92":{"start":{"line":314,"column":2},"end":{"line":314,"column":22}},"93":{"start":{"line":317,"column":1},"end":{"line":317,"column":38}},"94":{"start":{"line":319,"column":1},"end":{"line":331,"column":3}},"95":{"start":{"line":321,"column":2},"end":{"line":321,"column":62}},"96":{"start":{"line":323,"column":2},"end":{"line":329,"column":3}},"97":{"start":{"line":324,"column":3},"end":{"line":326,"column":6}},"98":{"start":{"line":325,"column":4},"end":{"line":325,"column":15}},"99":{"start":{"line":328,"column":3},"end":{"line":328,"column":14}},"100":{"start":{"line":342,"column":0},"end":{"line":344,"column":2}},"101":{"start":{"line":343,"column":1},"end":{"line":343,"column":54}},"102":{"start":{"line":353,"column":0},"end":{"line":401,"column":1}},"103":{"start":{"line":360,"column":1},"end":{"line":364,"column":3}},"104":{"start":{"line":366,"column":1},"end":{"line":369,"column":2}},"105":{"start":{"line":367,"column":2},"end":{"line":367,"column":20}},"106":{"start":{"line":368,"column":2},"end":{"line":368,"column":16}},"107":{"start":{"line":371,"column":1},"end":{"line":373,"column":2}},"108":{"start":{"line":372,"column":2},"end":{"line":372,"column":26}},"109":{"start":{"line":375,"column":1},"end":{"line":377,"column":2}},"110":{"start":{"line":376,"column":2},"end":{"line":376,"column":54}},"111":{"start":{"line":379,"column":1},"end":{"line":379,"column":102}},"112":{"start":{"line":381,"column":1},"end":{"line":400,"column":4}},"113":{"start":{"line":382,"column":2},"end":{"line":382,"column":16}},"114":{"start":{"line":383,"column":2},"end":{"line":396,"column":6}},"115":{"start":{"line":384,"column":4},"end":{"line":384,"column":21}},"116":{"start":{"line":387,"column":4},"end":{"line":387,"column":40}},"117":{"start":{"line":388,"column":4},"end":{"line":388,"column":15}},"118":{"start":{"line":389,"column":4},"end":{"line":394,"column":5}},"119":{"start":{"line":390,"column":5},"end":{"line":390,"column":35}},"120":{"start":{"line":393,"column":5},"end":{"line":393,"column":100}},"121":{"start":{"line":395,"column":4},"end":{"line":395,"column":27}},"122":{"start":{"line":399,"column":2},"end":{"line":399,"column":16}},"123":{"start":{"line":416,"column":0},"end":{"line":502,"column":2}},"124":{"start":{"line":418,"column":1},"end":{"line":421,"column":2}},"125":{"start":{"line":419,"column":2},"end":{"line":419,"column":20}},"126":{"start":{"line":420,"column":2},"end":{"line":420,"column":17}},"127":{"start":{"line":423,"column":1},"end":{"line":425,"column":44}},"128":{"start":{"line":427,"column":1},"end":{"line":429,"column":2}},"129":{"start":{"line":428,"column":2},"end":{"line":428,"column":106}},"130":{"start":{"line":431,"column":1},"end":{"line":501,"column":4}},"131":{"start":{"line":433,"column":2},"end":{"line":435,"column":3}},"132":{"start":{"line":434,"column":3},"end":{"line":434,"column":84}},"133":{"start":{"line":439,"column":2},"end":{"line":439,"column":34}},"134":{"start":{"line":443,"column":2},"end":{"line":443,"column":20}},"135":{"start":{"line":445,"column":2},"end":{"line":467,"column":5}},"136":{"start":{"line":446,"column":3},"end":{"line":449,"column":4}},"137":{"start":{"line":447,"column":4},"end":{"line":447,"column":46}},"138":{"start":{"line":448,"column":4},"end":{"line":448,"column":41}},"139":{"start":{"line":450,"column":3},"end":{"line":453,"column":4}},"140":{"start":{"line":451,"column":4},"end":{"line":451,"column":46}},"141":{"start":{"line":452,"column":4},"end":{"line":452,"column":42}},"142":{"start":{"line":455,"column":3},"end":{"line":457,"column":4}},"143":{"start":{"line":456,"column":4},"end":{"line":456,"column":36}},"144":{"start":{"line":458,"column":3},"end":{"line":460,"column":4}},"145":{"start":{"line":459,"column":4},"end":{"line":459,"column":36}},"146":{"start":{"line":461,"column":3},"end":{"line":463,"column":4}},"147":{"start":{"line":462,"column":4},"end":{"line":462,"column":37}},"148":{"start":{"line":464,"column":3},"end":{"line":466,"column":4}},"149":{"start":{"line":465,"column":4},"end":{"line":465,"column":39}},"150":{"start":{"line":469,"column":2},"end":{"line":471,"column":3}},"151":{"start":{"line":470,"column":3},"end":{"line":470,"column":49}},"152":{"start":{"line":473,"column":2},"end":{"line":476,"column":4}},"153":{"start":{"line":483,"column":2},"end":{"line":497,"column":3}},"154":{"start":{"line":484,"column":3},"end":{"line":484,"column":34}},"155":{"start":{"line":485,"column":9},"end":{"line":497,"column":3}},"156":{"start":{"line":486,"column":3},"end":{"line":493,"column":6}},"157":{"start":{"line":487,"column":4},"end":{"line":489,"column":5}},"158":{"start":{"line":488,"column":5},"end":{"line":488,"column":12}},"159":{"start":{"line":490,"column":4},"end":{"line":492,"column":5}},"160":{"start":{"line":491,"column":5},"end":{"line":491,"column":39}},"161":{"start":{"line":494,"column":3},"end":{"line":496,"column":4}},"162":{"start":{"line":495,"column":4},"end":{"line":495,"column":44}},"163":{"start":{"line":499,"column":2},"end":{"line":499,"column":35}},"164":{"start":{"line":513,"column":0},"end":{"line":526,"column":1}},"165":{"start":{"line":515,"column":1},"end":{"line":515,"column":52}},"166":{"start":{"line":516,"column":1},"end":{"line":516,"column":52}},"167":{"start":{"line":517,"column":1},"end":{"line":517,"column":40}},"168":{"start":{"line":518,"column":1},"end":{"line":518,"column":40}},"169":{"start":{"line":521,"column":1},"end":{"line":521,"column":117}},"170":{"start":{"line":522,"column":1},"end":{"line":522,"column":54}},"171":{"start":{"line":524,"column":1},"end":{"line":524,"column":10}},"172":{"start":{"line":535,"column":0},"end":{"line":537,"column":2}},"173":{"start":{"line":536,"column":1},"end":{"line":536,"column":71}},"174":{"start":{"line":546,"column":0},"end":{"line":548,"column":2}},"175":{"start":{"line":547,"column":1},"end":{"line":547,"column":74}},"176":{"start":{"line":555,"column":0},"end":{"line":555,"column":36}}},"branchMap":{"1":{"line":27,"type":"cond-expr","locations":[{"start":{"line":27,"column":133},"end":{"line":27,"column":137}},{"start":{"line":27,"column":140},"end":{"line":27,"column":145}}]},"2":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":23},"end":{"line":27,"column":51}},{"start":{"line":27,"column":56},"end":{"line":27,"column":87}},{"start":{"line":27,"column":91},"end":{"line":27,"column":128}}]},"3":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},{"start":{"line":31,"column":1},"end":{"line":31,"column":1}}]},"4":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},{"start":{"line":35,"column":1},"end":{"line":35,"column":1}}]},"5":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"6":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":9},"end":{"line":39,"column":9}},{"start":{"line":39,"column":9},"end":{"line":39,"column":9}}]},"7":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},{"start":{"line":47,"column":1},"end":{"line":47,"column":1}}]},"8":{"line":93,"type":"if","locations":[{"start":{"line":93,"column":2},"end":{"line":93,"column":2}},{"start":{"line":93,"column":2},"end":{"line":93,"column":2}}]},"9":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":2},"end":{"line":130,"column":2}},{"start":{"line":130,"column":2},"end":{"line":130,"column":2}}]},"10":{"line":130,"type":"binary-expr","locations":[{"start":{"line":130,"column":6},"end":{"line":130,"column":28}},{"start":{"line":130,"column":33},"end":{"line":130,"column":53}},{"start":{"line":130,"column":58},"end":{"line":130,"column":77}},{"start":{"line":130,"column":81},"end":{"line":130,"column":100}}]},"11":{"line":154,"type":"if","locations":[{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},{"start":{"line":154,"column":1},"end":{"line":154,"column":1}}]},"12":{"line":164,"type":"binary-expr","locations":[{"start":{"line":164,"column":31},"end":{"line":164,"column":40}},{"start":{"line":164,"column":44},"end":{"line":164,"column":48}}]},"13":{"line":176,"type":"binary-expr","locations":[{"start":{"line":176,"column":8},"end":{"line":176,"column":42}},{"start":{"line":177,"column":2},"end":{"line":177,"column":34}},{"start":{"line":178,"column":2},"end":{"line":178,"column":37}},{"start":{"line":179,"column":2},"end":{"line":179,"column":37}},{"start":{"line":180,"column":2},"end":{"line":180,"column":36}},{"start":{"line":181,"column":2},"end":{"line":181,"column":35}},{"start":{"line":182,"column":2},"end":{"line":182,"column":38}},{"start":{"line":183,"column":2},"end":{"line":183,"column":37}},{"start":{"line":184,"column":2},"end":{"line":184,"column":33}}]},"14":{"line":199,"type":"if","locations":[{"start":{"line":199,"column":1},"end":{"line":199,"column":1}},{"start":{"line":199,"column":1},"end":{"line":199,"column":1}}]},"15":{"line":205,"type":"binary-expr","locations":[{"start":{"line":205,"column":11},"end":{"line":205,"column":17}},{"start":{"line":205,"column":21},"end":{"line":205,"column":25}}]},"16":{"line":210,"type":"if","locations":[{"start":{"line":210,"column":2},"end":{"line":210,"column":2}},{"start":{"line":210,"column":2},"end":{"line":210,"column":2}}]},"17":{"line":211,"type":"if","locations":[{"start":{"line":211,"column":3},"end":{"line":211,"column":3}},{"start":{"line":211,"column":3},"end":{"line":211,"column":3}}]},"18":{"line":211,"type":"binary-expr","locations":[{"start":{"line":211,"column":7},"end":{"line":211,"column":24}},{"start":{"line":211,"column":28},"end":{"line":211,"column":32}},{"start":{"line":211,"column":36},"end":{"line":211,"column":57}}]},"19":{"line":214,"type":"if","locations":[{"start":{"line":214,"column":3},"end":{"line":214,"column":3}},{"start":{"line":214,"column":3},"end":{"line":214,"column":3}}]},"20":{"line":218,"type":"if","locations":[{"start":{"line":218,"column":3},"end":{"line":218,"column":3}},{"start":{"line":218,"column":3},"end":{"line":218,"column":3}}]},"21":{"line":218,"type":"binary-expr","locations":[{"start":{"line":218,"column":7},"end":{"line":218,"column":31}},{"start":{"line":218,"column":35},"end":{"line":218,"column":39}},{"start":{"line":218,"column":43},"end":{"line":218,"column":64}}]},"22":{"line":221,"type":"if","locations":[{"start":{"line":221,"column":3},"end":{"line":221,"column":3}},{"start":{"line":221,"column":3},"end":{"line":221,"column":3}}]},"23":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":1},"end":{"line":248,"column":1}},{"start":{"line":248,"column":1},"end":{"line":248,"column":1}}]},"24":{"line":260,"type":"if","locations":[{"start":{"line":260,"column":2},"end":{"line":260,"column":2}},{"start":{"line":260,"column":2},"end":{"line":260,"column":2}}]},"25":{"line":260,"type":"binary-expr","locations":[{"start":{"line":260,"column":6},"end":{"line":260,"column":31}},{"start":{"line":260,"column":35},"end":{"line":260,"column":83}}]},"26":{"line":261,"type":"binary-expr","locations":[{"start":{"line":261,"column":24},"end":{"line":261,"column":47}},{"start":{"line":261,"column":51},"end":{"line":261,"column":55}}]},"27":{"line":267,"type":"if","locations":[{"start":{"line":267,"column":1},"end":{"line":267,"column":1}},{"start":{"line":267,"column":1},"end":{"line":267,"column":1}}]},"28":{"line":269,"type":"binary-expr","locations":[{"start":{"line":269,"column":15},"end":{"line":269,"column":34}},{"start":{"line":269,"column":38},"end":{"line":269,"column":40}}]},"29":{"line":270,"type":"if","locations":[{"start":{"line":270,"column":2},"end":{"line":270,"column":2}},{"start":{"line":270,"column":2},"end":{"line":270,"column":2}}]},"30":{"line":276,"type":"if","locations":[{"start":{"line":276,"column":2},"end":{"line":276,"column":2}},{"start":{"line":276,"column":2},"end":{"line":276,"column":2}}]},"31":{"line":276,"type":"binary-expr","locations":[{"start":{"line":276,"column":6},"end":{"line":276,"column":28}},{"start":{"line":276,"column":32},"end":{"line":276,"column":51}}]},"32":{"line":280,"type":"if","locations":[{"start":{"line":280,"column":2},"end":{"line":280,"column":2}},{"start":{"line":280,"column":2},"end":{"line":280,"column":2}}]},"33":{"line":280,"type":"binary-expr","locations":[{"start":{"line":280,"column":6},"end":{"line":280,"column":29}},{"start":{"line":280,"column":33},"end":{"line":280,"column":56}}]},"34":{"line":284,"type":"if","locations":[{"start":{"line":284,"column":8},"end":{"line":284,"column":8}},{"start":{"line":284,"column":8},"end":{"line":284,"column":8}}]},"35":{"line":284,"type":"binary-expr","locations":[{"start":{"line":284,"column":12},"end":{"line":284,"column":40}},{"start":{"line":284,"column":44},"end":{"line":284,"column":72}}]},"36":{"line":289,"type":"cond-expr","locations":[{"start":{"line":289,"column":37},"end":{"line":289,"column":47}},{"start":{"line":289,"column":50},"end":{"line":289,"column":59}}]},"37":{"line":289,"type":"binary-expr","locations":[{"start":{"line":289,"column":23},"end":{"line":289,"column":26}},{"start":{"line":289,"column":30},"end":{"line":289,"column":33}}]},"38":{"line":310,"type":"if","locations":[{"start":{"line":310,"column":1},"end":{"line":310,"column":1}},{"start":{"line":310,"column":1},"end":{"line":310,"column":1}}]},"39":{"line":313,"type":"if","locations":[{"start":{"line":313,"column":8},"end":{"line":313,"column":8}},{"start":{"line":313,"column":8},"end":{"line":313,"column":8}}]},"40":{"line":317,"type":"binary-expr","locations":[{"start":{"line":317,"column":12},"end":{"line":317,"column":20}},{"start":{"line":317,"column":24},"end":{"line":317,"column":37}}]},"41":{"line":321,"type":"cond-expr","locations":[{"start":{"line":321,"column":43},"end":{"line":321,"column":54}},{"start":{"line":321,"column":57},"end":{"line":321,"column":61}}]},"42":{"line":323,"type":"if","locations":[{"start":{"line":323,"column":2},"end":{"line":323,"column":2}},{"start":{"line":323,"column":2},"end":{"line":323,"column":2}}]},"43":{"line":323,"type":"binary-expr","locations":[{"start":{"line":323,"column":6},"end":{"line":323,"column":14}},{"start":{"line":323,"column":18},"end":{"line":323,"column":41}}]},"44":{"line":366,"type":"if","locations":[{"start":{"line":366,"column":1},"end":{"line":366,"column":1}},{"start":{"line":366,"column":1},"end":{"line":366,"column":1}}]},"45":{"line":366,"type":"binary-expr","locations":[{"start":{"line":366,"column":5},"end":{"line":366,"column":27}},{"start":{"line":366,"column":31},"end":{"line":366,"column":51}}]},"46":{"line":371,"type":"if","locations":[{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},{"start":{"line":371,"column":1},"end":{"line":371,"column":1}}]},"47":{"line":375,"type":"if","locations":[{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},{"start":{"line":375,"column":1},"end":{"line":375,"column":1}}]},"48":{"line":418,"type":"if","locations":[{"start":{"line":418,"column":1},"end":{"line":418,"column":1}},{"start":{"line":418,"column":1},"end":{"line":418,"column":1}}]},"49":{"line":427,"type":"if","locations":[{"start":{"line":427,"column":1},"end":{"line":427,"column":1}},{"start":{"line":427,"column":1},"end":{"line":427,"column":1}}]},"50":{"line":431,"type":"binary-expr","locations":[{"start":{"line":431,"column":33},"end":{"line":431,"column":39}},{"start":{"line":431,"column":43},"end":{"line":431,"column":73}}]},"51":{"line":433,"type":"if","locations":[{"start":{"line":433,"column":2},"end":{"line":433,"column":2}},{"start":{"line":433,"column":2},"end":{"line":433,"column":2}}]},"52":{"line":433,"type":"binary-expr","locations":[{"start":{"line":433,"column":6},"end":{"line":433,"column":9}},{"start":{"line":433,"column":13},"end":{"line":433,"column":36}}]},"53":{"line":434,"type":"binary-expr","locations":[{"start":{"line":434,"column":19},"end":{"line":434,"column":22}},{"start":{"line":434,"column":26},"end":{"line":434,"column":82}}]},"54":{"line":446,"type":"if","locations":[{"start":{"line":446,"column":3},"end":{"line":446,"column":3}},{"start":{"line":446,"column":3},"end":{"line":446,"column":3}}]},"55":{"line":447,"type":"binary-expr","locations":[{"start":{"line":447,"column":23},"end":{"line":447,"column":39}},{"start":{"line":447,"column":43},"end":{"line":447,"column":45}}]},"56":{"line":450,"type":"if","locations":[{"start":{"line":450,"column":3},"end":{"line":450,"column":3}},{"start":{"line":450,"column":3},"end":{"line":450,"column":3}}]},"57":{"line":451,"type":"binary-expr","locations":[{"start":{"line":451,"column":23},"end":{"line":451,"column":39}},{"start":{"line":451,"column":43},"end":{"line":451,"column":45}}]},"58":{"line":455,"type":"if","locations":[{"start":{"line":455,"column":3},"end":{"line":455,"column":3}},{"start":{"line":455,"column":3},"end":{"line":455,"column":3}}]},"59":{"line":455,"type":"binary-expr","locations":[{"start":{"line":455,"column":8},"end":{"line":455,"column":45}},{"start":{"line":455,"column":49},"end":{"line":455,"column":65}}]},"60":{"line":458,"type":"if","locations":[{"start":{"line":458,"column":3},"end":{"line":458,"column":3}},{"start":{"line":458,"column":3},"end":{"line":458,"column":3}}]},"61":{"line":461,"type":"if","locations":[{"start":{"line":461,"column":3},"end":{"line":461,"column":3}},{"start":{"line":461,"column":3},"end":{"line":461,"column":3}}]},"62":{"line":464,"type":"if","locations":[{"start":{"line":464,"column":3},"end":{"line":464,"column":3}},{"start":{"line":464,"column":3},"end":{"line":464,"column":3}}]},"63":{"line":469,"type":"if","locations":[{"start":{"line":469,"column":2},"end":{"line":469,"column":2}},{"start":{"line":469,"column":2},"end":{"line":469,"column":2}}]},"64":{"line":483,"type":"if","locations":[{"start":{"line":483,"column":2},"end":{"line":483,"column":2}},{"start":{"line":483,"column":2},"end":{"line":483,"column":2}}]},"65":{"line":485,"type":"if","locations":[{"start":{"line":485,"column":9},"end":{"line":485,"column":9}},{"start":{"line":485,"column":9},"end":{"line":485,"column":9}}]},"66":{"line":487,"type":"if","locations":[{"start":{"line":487,"column":4},"end":{"line":487,"column":4}},{"start":{"line":487,"column":4},"end":{"line":487,"column":4}}]},"67":{"line":490,"type":"if","locations":[{"start":{"line":490,"column":4},"end":{"line":490,"column":4}},{"start":{"line":490,"column":4},"end":{"line":490,"column":4}}]},"68":{"line":494,"type":"if","locations":[{"start":{"line":494,"column":3},"end":{"line":494,"column":3}},{"start":{"line":494,"column":3},"end":{"line":494,"column":3}}]},"69":{"line":494,"type":"binary-expr","locations":[{"start":{"line":494,"column":7},"end":{"line":494,"column":33}},{"start":{"line":494,"column":37},"end":{"line":494,"column":51}},{"start":{"line":494,"column":55},"end":{"line":494,"column":69}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tkeystone = require('../../../'),","\tquerystring = require('querystring'),","\thttps = require('https'),","\tutil = require('util'),","\tutils = require('keystone-utils'),","\tsuper_ = require('../Type');","","var RADIUS_KM = 6371,","\tRADIUS_MILES = 3959;","","/**"," * Location FieldType Constructor"," * @extends Field"," * @api public"," */","","function location(list, path, options) {","","\tthis._underscoreMethods = ['format', 'googleLookup', 'kmFrom', 'milesFrom'];","\tthis._fixedSize = 'full';","","\tthis.enableMapsAPI = (options.geocodeGoogle===true || (options.geocodeGoogle !== false && keystone.get('google server api key'))) ? true : false;","","\tthis._properties = ['enableMapsAPI'];","","\tif (!options.defaults) {","\t\toptions.defaults = {};","\t}","","\tif (options.required) {","\t\tif (Array.isArray(options.required)) {","\t\t\t// required can be specified as an array of paths","\t\t\tthis.requiredPaths = options.required;","\t\t} else if ('string' === typeof options.required) {","\t\t\t// or it can be specified as a comma-delimited list","\t\t\tthis.requiredPaths = options.required.replace(/,/g, ' ').split(/\\s+/);","\t\t}","\t\t// options.required should always be simplified to a boolean","\t\toptions.required = true;","\t}","\t// default this.requiredPaths","\tif (!this.requiredPaths) {","\t\tthis.requiredPaths = ['street1', 'suburb'];","\t}","","\tlocation.super_.call(this, list, path, options);","","}","","/*!"," * Inherit from Field"," */","","util.inherits(location, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","location.prototype.addToSchema = function() {","","\tvar field = this,","\t\tschema = this.list.schema,","\t\toptions = this.options;","","\tvar paths = this.paths = {","\t\tnumber: this._path.append('.number'),","\t\tname: this._path.append('.name'),","\t\tstreet1: this._path.append('.street1'),","\t\tstreet2: this._path.append('.street2'),","\t\tsuburb: this._path.append('.suburb'),","\t\tstate: this._path.append('.state'),","\t\tpostcode: this._path.append('.postcode'),","\t\tcountry: this._path.append('.country'),","\t\tgeo: this._path.append('.geo'),","\t\tgeo_lat: this._path.append('.geo_lat'),","\t\tgeo_lng: this._path.append('.geo_lng'),","\t\tserialised: this._path.append('.serialised'),","\t\timprove: this._path.append('_improve'),","\t\toverwrite: this._path.append('_improve_overwrite')","\t};","","\tvar getFieldDef = function(type, key) {","\t\tvar def = { type: type };","\t\tif (options.defaults[key]) {","\t\t\tdef.default = options.defaults[key];","\t\t}","\t\treturn def;","\t};","","\tschema.nested[this.path] = true;","\tschema.add({","\t\tnumber: getFieldDef(String, 'number'),","\t\tname: getFieldDef(String, 'name'),","\t\tstreet1: getFieldDef(String, 'street1'),","\t\tstreet2: getFieldDef(String, 'street2'),","\t\tstreet3: getFieldDef(String, 'street3'),","\t\tsuburb: getFieldDef(String, 'suburb'),","\t\tstate: getFieldDef(String, 'state'),","\t\tpostcode: getFieldDef(String, 'postcode'),","\t\tcountry: getFieldDef(String, 'country'),","\t\tgeo: { type: [Number], index: '2dsphere' }","\t}, this.path + '.');","","\tschema.virtual(paths.serialised).get(function() {","\t\treturn _.compact([","\t\t\tthis.get(paths.number),","\t\t\tthis.get(paths.name),","\t\t\tthis.get(paths.street1),","\t\t\tthis.get(paths.street2),","\t\t\tthis.get(paths.suburb),","\t\t\tthis.get(paths.state),","\t\t\tthis.get(paths.postcode),","\t\t\tthis.get(paths.country)","\t\t]).join(', ');","\t});","","\t// pre-save hook to fix blank geo fields","\t// see http://stackoverflow.com/questions/16388836/does-applying-a-2dsphere-index-on-a-mongoose-schema-force-the-location-field-to","\tschema.pre('save', function(next) {","\t\tvar obj = field._path.get(this);","\t\tif (Array.isArray(obj.geo) && (obj.geo.length !== 2 || (obj.geo[0] === null && obj.geo[1] === null))) {","\t\t\tobj.geo = undefined;","\t\t}","\t\tnext();","\t});","","\tthis.bindUnderscoreMethods();","","};","","","/**"," * Formats a list of the values stored by the field. Only paths that"," * have values will be included."," *"," * Optionally provide a space-separated list of values to include."," *"," * Delimiter defaults to `', '`."," *"," * @api public"," */","","location.prototype.format = function(item, values, delimiter) {","","\tif (!values) {","\t\treturn item.get(this.paths.serialised);","\t}","","\tvar paths = this.paths;","","\tvalues = values.split(' ').map(function(i) {","\t\treturn item.get(paths[i]);","\t});","","\treturn _.compact(values).join(delimiter || ', ');","","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","location.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.number) ||","\t\titem.isModified(this.paths.name) ||","\t\titem.isModified(this.paths.street1) ||","\t\titem.isModified(this.paths.street2) ||","\t\titem.isModified(this.paths.suburb) ||","\t\titem.isModified(this.paths.state) ||","\t\titem.isModified(this.paths.postcode) ||","\t\titem.isModified(this.paths.country) ||","\t\titem.isModified(this.paths.geo);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * options.required specifies an array or space-delimited list of paths that"," * are required (defaults to street1, suburb)"," *"," * @api public"," */","","location.prototype.validateInput = function(data, required, item) {","","\tif (!required) {","\t\treturn true;","\t}","","\tvar paths = this.paths,","\t\tnested = this._path.get(data),","\t\tvalues = nested || data,","\t\tvalid = true;","","\tthis.requiredPaths.forEach(function(path) {","","\t\tif (nested) {","\t\t\tif (!(path in values) && item && item.get(paths[path])) {","\t\t\t\treturn;","\t\t\t}","\t\t\tif (!values[path]) {","\t\t\t\tvalid = false;","\t\t\t}","\t\t} else {","\t\t\tif (!(paths[path] in values) && item && item.get(paths[path])) {","\t\t\t\treturn;","\t\t\t}","\t\t\tif (!values[paths[path]]) {","\t\t\t\tvalid = false;","\t\t\t}","\t\t}","","\t});","","\treturn valid;","","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","location.prototype.updateItem = function(item, data) {","","\tvar paths = this.paths,","\t\tfieldKeys = ['number', 'name', 'street1', 'street2', 'suburb', 'state', 'postcode', 'country'],","\t\tgeoKeys = ['geo', 'geo_lat', 'geo_lng'],","\t\tvalueKeys = fieldKeys.concat(geoKeys),","\t\tvaluePaths = valueKeys,","\t\tvalues = this._path.get(data);","","\tif (!values) {","\t\t// Handle flattened values","\t\tvaluePaths = valueKeys.map(function(i) {","\t\t\treturn paths[i];","\t\t});","\t\tvalues = _.pick(data, valuePaths);","\t}","","\t// convert valuePaths to a map for easier usage","\tvaluePaths = _.object(valueKeys, valuePaths);","","\tvar setValue = function(key) {","\t\tif (valuePaths[key] in values && values[valuePaths[key]] !== item.get(paths[key])) {","\t\t\titem.set(paths[key], values[valuePaths[key]] || null);","\t\t}","\t};","","\t_.each(fieldKeys, setValue);","","\tif (valuePaths.geo in values) {","","\t\tvar oldGeo = item.get(paths.geo) || [];","\t\tif (oldGeo.length > 1) {","\t\t\toldGeo[0] = item.get(paths.geo)[1];","\t\t\toldGeo[1] = item.get(paths.geo)[0];","\t\t}","\t\tvar newGeo = values[valuePaths.geo];","","\t\tif (!Array.isArray(newGeo) || newGeo.length !== 2) {","\t\t\tnewGeo = [];","\t\t}","","\t\tif (newGeo[0] !== oldGeo[0] || newGeo[1] !== oldGeo[1]) {","\t\t\titem.set(paths.geo, newGeo);","\t\t}","","\t} else if (valuePaths.geo_lat in values && valuePaths.geo_lng in values) {","","\t\tvar lat = utils.number(values[valuePaths.geo_lat]),","\t\t\tlng = utils.number(values[valuePaths.geo_lng]);","","\t\titem.set(paths.geo, (lat && lng) ? [lng, lat] : undefined);","","\t}","","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Handles:"," * - `field.paths.improve` in `req.body` - improves data via `.googleLookup()`"," * - `field.paths.overwrite` in `req.body` - in conjunction with `improve`, overwrites existing data"," *"," * @api public"," */","","location.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","","\t\tvar update = req.body[paths.overwrite] ? 'overwrite' : true;","","\t\tif (req.body && req.body[paths.improve]) {","\t\t\tfield.googleLookup(item, false, update, function() {","\t\t\t\tcallback();","\t\t\t});","\t\t} else {","\t\t\tcallback();","\t\t}","","\t};","","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","location.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/**"," * Internal Google geocode request method"," *"," * @api private"," */","","function doGoogleGeocodeRequest(address, region, callback) {","","\t// https://developers.google.com/maps/documentation/geocoding/","\t// Use of the Google Geocoding API is subject to a query limit of 2,500 geolocation requests per day, except with an enterprise license.","\t// Note: the Geocoding API may only be used in conjunction with a Google map; geocoding results without displaying them on a map is prohibited.","\t// Please make sure your Keystone app complies with the Google Maps API License.","","\tvar options = {","\t\tsensor: false,","\t\tlanguage: 'en',","\t\taddress: address","\t};","","\tif (arguments.length === 2 && _.isFunction(region)) {","\t\tcallback = region;","\t\tregion = null;","\t}","","\tif (region) {","\t\toptions.region = region;","\t}","","\tif (keystone.get('google server api key')){","\t\toptions.key = keystone.get('google server api key');","\t}","","\tvar endpoint = 'https://maps.googleapis.com/maps/api/geocode/json?' + querystring.stringify(options);","","\thttps.get(endpoint, function(res) {","\t\tvar data = [];","\t\tres.on('data', function(chunk) {","\t\t\t\tdata.push(chunk);","\t\t\t})","\t\t\t.on('end', function() {","\t\t\t\tvar dataBuff = data.join('').trim();","\t\t\t\tvar result;","\t\t\t\ttry {","\t\t\t\t\tresult = JSON.parse(dataBuff);","\t\t\t\t}","\t\t\t\tcatch (exp) {","\t\t\t\t\tresult = { 'status_code': 500, 'status_text': 'JSON Parse Failed', 'status': 'UNKNOWN_ERROR' };","\t\t\t\t}","\t\t\t\tcallback(null, result);","\t\t\t});","\t})","\t.on('error', function(err) {","\t\tcallback(err);","\t});","}","","","/**"," * Autodetect the full address and lat, lng from the stored value."," *"," * Uses Google's Maps API and may only be used in conjunction with a Google map."," * Geocoding results without displaying them on a map is prohibited."," * Please make sure your Keystone app complies with the Google Maps API License."," *"," * Internal status codes mimic the Google API status codes."," *"," * @api private"," */","","location.prototype.googleLookup = function(item, region, update, callback) {","","\tif (_.isFunction(update)) {","\t\tcallback = update;","\t\tupdate = false;","\t}","","\tvar field = this,","\t\tstored = item.get(this.path),","\t\taddress = item.get(this.paths.serialised);","","\tif (address.length === 0) {","\t\treturn callback({ 'status_code': 500, 'status_text': 'No address to geocode', 'status': 'NO_ADDRESS' });","\t}","","\tdoGoogleGeocodeRequest(address, region || keystone.get('default region'), function(err, geocode){","","\t\tif (err || geocode.status !== 'OK') {","\t\t\treturn callback(err || new Error(geocode.status + ': ' + geocode.error_message));","\t\t}","","\t\t// use the first result","\t\t// if there were no results in the array, status would be ZERO_RESULTS","\t\tvar result = geocode.results[0];","","\t\t// parse the address components into a location object","","\t\tvar location = {};","","\t\t_.each(result.address_components, function(val){","\t\t\tif ( _.indexOf(val.types, 'street_number') >= 0 ) {","\t\t\t\tlocation.street1 = location.street1 || [];","\t\t\t\tlocation.street1.push(val.long_name);","\t\t\t}","\t\t\tif ( _.indexOf(val.types, 'route') >= 0 ) {","\t\t\t\tlocation.street1 = location.street1 || [];","\t\t\t\tlocation.street1.push(val.short_name);","\t\t\t}","\t\t\t// in some cases, you get suburb, city as locality - so only use the first","\t\t\tif ( _.indexOf(val.types, 'locality') >= 0 && !location.suburb) {","\t\t\t\tlocation.suburb = val.long_name;","\t\t\t}","\t\t\tif ( _.indexOf(val.types, 'administrative_area_level_1') >= 0 ) {","\t\t\t\tlocation.state = val.short_name;","\t\t\t}","\t\t\tif ( _.indexOf(val.types, 'country') >= 0 ) {","\t\t\t\tlocation.country = val.long_name;","\t\t\t}","\t\t\tif ( _.indexOf(val.types, 'postal_code') >= 0 ) {","\t\t\t\tlocation.postcode = val.short_name;","\t\t\t}","\t\t});","","\t\tif (Array.isArray(location.street1)) {","\t\t\tlocation.street1 = location.street1.join(' ');","\t\t}","","\t\tlocation.geo = [","\t\t\tresult.geometry.location.lng,","\t\t\tresult.geometry.location.lat","\t\t];","","\t\t//console.log('------ Google Geocode Results ------');","\t\t//console.log(address);","\t\t//console.log(result);","\t\t//console.log(location);","","\t\tif (update === 'overwrite') {","\t\t\titem.set(field.path, location);","\t\t} else if (update) {","\t\t\t_.each(location, function(value, key) {","\t\t\t\tif (key === 'geo') {","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\tif (!stored[key]) {","\t\t\t\t\titem.set(field.paths[key], value);","\t\t\t\t}","\t\t\t});","\t\t\tif (!Array.isArray(stored.geo) || !stored.geo[0] || !stored.geo[1]) {","\t\t\t\titem.set(field.paths.geo, location.geo);","\t\t\t}","\t\t}","","\t\tcallback(null, location, result);","","\t});","};","","","/**"," * Internal Distance calculation function"," *"," * See http://en.wikipedia.org/wiki/Haversine_formula"," *"," * @api private"," */","","function calculateDistance(point1, point2) {","","\tvar dLng = (point2[0] - point1[0]) * Math.PI / 180;","\tvar dLat = (point2[1] - point1[1]) * Math.PI / 180;","\tvar lat1 = (point1[1]) * Math.PI / 180;","\tvar lat2 = (point2[1]) * Math.PI / 180;","","\t/* eslint-disable space-infix-ops */","\tvar a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.sin(dLng/2) * Math.sin(dLng/2) * Math.cos(lat1) * Math.cos(lat2);","\tvar c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));","\t/* eslint-enable space-infix-ops */","\treturn c;","","}","","","/**"," * Returns the distance from a [lat, lng] point in kilometres"," *"," * @api public"," */","","location.prototype.kmFrom = function(item, point) {","\treturn calculateDistance(this.get(this.paths.geo), point) * RADIUS_KM;","};","","","/**"," * Returns the distance from a [lat, lng] point in miles"," *"," * @api public"," */","","location.prototype.milesFrom = function(item, point) {","\treturn calculateDistance(this.get(this.paths.geo), point) * RADIUS_MILES;","};","","","/*!"," * Export class"," */","","exports = module.exports = location;",""],"l":{"5":1,"13":1,"22":1,"24":0,"25":0,"27":0,"29":0,"31":0,"32":0,"35":0,"36":0,"38":0,"39":0,"41":0,"44":0,"47":0,"48":0,"51":0,"59":1,"68":1,"70":0,"74":0,"91":0,"92":0,"93":0,"94":0,"96":0,"99":0,"100":0,"113":0,"114":0,"128":0,"129":0,"130":0,"131":0,"133":0,"136":0,"152":1,"154":0,"155":0,"158":0,"160":0,"161":0,"164":0,"175":1,"176":0,"197":1,"199":0,"200":0,"203":0,"208":0,"210":0,"211":0,"212":0,"214":0,"215":0,"218":0,"219":0,"221":0,"222":0,"228":0,"239":1,"241":0,"248":0,"250":0,"251":0,"253":0,"257":0,"259":0,"260":0,"261":0,"265":0,"267":0,"269":0,"270":0,"271":0,"272":0,"274":0,"276":0,"277":0,"280":0,"281":0,"284":0,"286":0,"289":0,"306":1,"308":0,"310":0,"311":0,"312":0,"313":0,"314":0,"317":0,"319":0,"321":0,"323":0,"324":0,"325":0,"328":0,"342":1,"343":0,"353":1,"360":0,"366":0,"367":0,"368":0,"371":0,"372":0,"375":0,"376":0,"379":0,"381":0,"382":0,"383":0,"384":0,"387":0,"388":0,"389":0,"390":0,"393":0,"395":0,"399":0,"416":1,"418":0,"419":0,"420":0,"423":0,"427":0,"428":0,"431":0,"433":0,"434":0,"439":0,"443":0,"445":0,"446":0,"447":0,"448":0,"450":0,"451":0,"452":0,"455":0,"456":0,"458":0,"459":0,"461":0,"462":0,"464":0,"465":0,"469":0,"470":0,"473":0,"483":0,"484":0,"485":0,"486":0,"487":0,"488":0,"490":0,"491":0,"494":0,"495":0,"499":0,"513":1,"515":0,"516":0,"517":0,"518":0,"521":0,"522":0,"524":0,"535":1,"536":0,"546":1,"547":0,"555":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/markdown/MarkdownType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/markdown/MarkdownType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":1,"28":0,"29":0,"30":0,"31":1,"32":0,"33":1,"34":0,"35":0,"36":0,"37":0,"38":0,"39":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0,0],"11":[0,0],"12":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"markdown","line":15,"loc":{"start":{"line":15,"column":0},"end":{"line":15,"column":39}}},"2":{"name":"(anonymous_2)","line":50,"loc":{"start":{"line":50,"column":33},"end":{"line":50,"column":44}}},"3":{"name":"(anonymous_3)","line":59,"loc":{"start":{"line":59,"column":19},"end":{"line":59,"column":35}}},"4":{"name":"(anonymous_4)","line":91,"loc":{"start":{"line":91,"column":28},"end":{"line":91,"column":43}}},"5":{"name":"(anonymous_5)","line":104,"loc":{"start":{"line":104,"column":35},"end":{"line":104,"column":66}}},"6":{"name":"(anonymous_6)","line":118,"loc":{"start":{"line":118,"column":32},"end":{"line":118,"column":47}}},"7":{"name":"(anonymous_7)","line":131,"loc":{"start":{"line":131,"column":32},"end":{"line":131,"column":53}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":7,"column":29}},"2":{"start":{"line":15,"column":0},"end":{"line":32,"column":1}},"3":{"start":{"line":17,"column":1},"end":{"line":17,"column":28}},"4":{"start":{"line":20,"column":1},"end":{"line":20,"column":25}},"5":{"start":{"line":22,"column":1},"end":{"line":22,"column":52}},"6":{"start":{"line":23,"column":1},"end":{"line":23,"column":36}},"7":{"start":{"line":26,"column":1},"end":{"line":26,"column":64}},"8":{"start":{"line":28,"column":1},"end":{"line":28,"column":60}},"9":{"start":{"line":30,"column":1},"end":{"line":30,"column":49}},"10":{"start":{"line":38,"column":0},"end":{"line":38,"column":32}},"11":{"start":{"line":50,"column":0},"end":{"line":82,"column":2}},"12":{"start":{"line":52,"column":1},"end":{"line":52,"column":31}},"13":{"start":{"line":54,"column":1},"end":{"line":57,"column":3}},"14":{"start":{"line":59,"column":1},"end":{"line":73,"column":3}},"15":{"start":{"line":61,"column":2},"end":{"line":63,"column":3}},"16":{"start":{"line":62,"column":3},"end":{"line":62,"column":16}},"17":{"start":{"line":65,"column":2},"end":{"line":71,"column":3}},"18":{"start":{"line":66,"column":3},"end":{"line":66,"column":39}},"19":{"start":{"line":67,"column":3},"end":{"line":67,"column":16}},"20":{"start":{"line":69,"column":3},"end":{"line":69,"column":35}},"21":{"start":{"line":70,"column":3},"end":{"line":70,"column":20}},"22":{"start":{"line":75,"column":1},"end":{"line":75,"column":33}},"23":{"start":{"line":76,"column":1},"end":{"line":79,"column":21}},"24":{"start":{"line":81,"column":1},"end":{"line":81,"column":30}},"25":{"start":{"line":91,"column":0},"end":{"line":93,"column":2}},"26":{"start":{"line":92,"column":1},"end":{"line":92,"column":34}},"27":{"start":{"line":104,"column":0},"end":{"line":109,"column":2}},"28":{"start":{"line":105,"column":1},"end":{"line":107,"column":2}},"29":{"start":{"line":106,"column":2},"end":{"line":106,"column":14}},"30":{"start":{"line":108,"column":1},"end":{"line":108,"column":77}},"31":{"start":{"line":118,"column":0},"end":{"line":120,"column":2}},"32":{"start":{"line":119,"column":1},"end":{"line":119,"column":39}},"33":{"start":{"line":131,"column":0},"end":{"line":138,"column":2}},"34":{"start":{"line":132,"column":1},"end":{"line":132,"column":41}},"35":{"start":{"line":133,"column":1},"end":{"line":137,"column":2}},"36":{"start":{"line":134,"column":2},"end":{"line":134,"column":33}},"37":{"start":{"line":135,"column":8},"end":{"line":137,"column":2}},"38":{"start":{"line":136,"column":2},"end":{"line":136,"column":47}},"39":{"start":{"line":145,"column":0},"end":{"line":145,"column":36}}},"branchMap":{"1":{"line":22,"type":"binary-expr","locations":[{"start":{"line":22,"column":23},"end":{"line":22,"column":45}},{"start":{"line":22,"column":49},"end":{"line":22,"column":51}}]},"2":{"line":23,"type":"binary-expr","locations":[{"start":{"line":23,"column":15},"end":{"line":23,"column":29}},{"start":{"line":23,"column":33},"end":{"line":23,"column":35}}]},"3":{"line":26,"type":"cond-expr","locations":[{"start":{"line":26,"column":41},"end":{"line":26,"column":56}},{"start":{"line":26,"column":59},"end":{"line":26,"column":63}}]},"4":{"line":61,"type":"if","locations":[{"start":{"line":61,"column":2},"end":{"line":61,"column":2}},{"start":{"line":61,"column":2},"end":{"line":61,"column":2}}]},"5":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":65,"column":2}},{"start":{"line":65,"column":2},"end":{"line":65,"column":2}}]},"6":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},{"start":{"line":105,"column":1},"end":{"line":105,"column":1}}]},"7":{"line":105,"type":"binary-expr","locations":[{"start":{"line":105,"column":5},"end":{"line":105,"column":50}},{"start":{"line":105,"column":54},"end":{"line":105,"column":58}},{"start":{"line":105,"column":62},"end":{"line":105,"column":85}}]},"8":{"line":105,"type":"binary-expr","locations":[{"start":{"line":105,"column":7},"end":{"line":105,"column":24}},{"start":{"line":105,"column":28},"end":{"line":105,"column":49}}]},"9":{"line":108,"type":"cond-expr","locations":[{"start":{"line":108,"column":64},"end":{"line":108,"column":68}},{"start":{"line":108,"column":71},"end":{"line":108,"column":76}}]},"10":{"line":108,"type":"binary-expr","locations":[{"start":{"line":108,"column":9},"end":{"line":108,"column":18}},{"start":{"line":108,"column":22},"end":{"line":108,"column":37}},{"start":{"line":108,"column":41},"end":{"line":108,"column":60}}]},"11":{"line":133,"type":"if","locations":[{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},{"start":{"line":133,"column":1},"end":{"line":133,"column":1}}]},"12":{"line":135,"type":"if","locations":[{"start":{"line":135,"column":8},"end":{"line":135,"column":8}},{"start":{"line":135,"column":8},"end":{"line":135,"column":8}}]}},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tmarked = require('marked'),","\tsuper_ = require('../Type');","","/**"," * Markdown FieldType Constructor"," * @extends Field"," * @api public"," */","","function markdown(list, path, options) {","\t","\tthis._defaultSize = 'full';","\t","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","","\tthis.toolbarOptions = options.toolbarOptions || {};","\tthis.height = options.height || 90;","","\t// since wysiwyg option can be falsey this needs to use `in` instead of ||","\tthis.wysiwyg = ('wysiwyg' in options) ? options.wysiwyg : true;","","\tthis._properties = ['wysiwyg', 'height', 'toolbarOptions'];","","\tmarkdown.super_.call(this, list, path, options);","","}","","/*!"," * Inherit from Field"," */","","util.inherits(markdown, super_);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * Adds String properties for .markdown and .html markdown, and a setter"," * for .markdown that generates html when it is updated."," *"," * @api public"," */","","markdown.prototype.addToSchema = function() {","","\tvar schema = this.list.schema;","","\tvar paths = this.paths = {","\t\tmd: this._path.append('.md'),","\t\thtml: this._path.append('.html')","\t};","","\tvar setMarkdown = function(value) {","","\t\tif (value === this.get(paths.md)) {","\t\t\treturn value;","\t\t}","","\t\tif (typeof value === 'string') {","\t\t\tthis.set(paths.html, marked(value));","\t\t\treturn value;","\t\t} else {","\t\t\tthis.set(paths.html, undefined);","\t\t\treturn undefined;","\t\t}","","\t};","","\tschema.nested[this.path] = true;","\tschema.add({","\t\thtml: { type: String },","\t\tmd: { type: String, set: setMarkdown }","\t}, this.path + '.');","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","markdown.prototype.format = function(item) {","\treturn item.get(this.paths.html);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * Will accept either the field path, or paths.md"," *"," * @api public"," */","","markdown.prototype.validateInput = function(data, required, item) {","\tif (!(this.path in data || this.paths.md in data) && item && item.get(this.paths.md)) {","\t\treturn true;","\t}","\treturn (!required || data[this.path] || data[this.paths.md]) ? true : false;","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","markdown.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.md);","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * Will accept either the field path, or paths.md"," *"," * @api public"," */","","markdown.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\tif (value !== undefined) {","\t\titem.set(this.paths.md, value);","\t} else if (this.paths.md in data) {","\t\titem.set(this.paths.md, data[this.paths.md]);","\t}","};","","","/*!"," * Export class"," */","","exports = module.exports = markdown;",""],"l":{"5":1,"15":1,"17":0,"20":0,"22":0,"23":0,"26":0,"28":0,"30":0,"38":1,"50":1,"52":0,"54":0,"59":0,"61":0,"62":0,"65":0,"66":0,"67":0,"69":0,"70":0,"75":0,"76":0,"81":0,"91":1,"92":0,"104":1,"105":0,"106":0,"108":0,"118":1,"119":0,"131":1,"132":0,"133":0,"134":0,"135":0,"136":0,"145":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/money/MoneyType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/money/MoneyType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":1,"16":1,"17":1,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"money","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":36}}},"2":{"name":"(anonymous_2)","line":32,"loc":{"start":{"line":32,"column":25},"end":{"line":32,"column":48}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":49}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":11,"column":0},"end":{"line":22,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":34}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":27}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":38}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":33}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":27}},"11":{"start":{"line":17,"column":1},"end":{"line":17,"column":89}},"12":{"start":{"line":18,"column":1},"end":{"line":20,"column":2}},"13":{"start":{"line":19,"column":2},"end":{"line":19,"column":71}},"14":{"start":{"line":21,"column":1},"end":{"line":21,"column":46}},"15":{"start":{"line":23,"column":0},"end":{"line":23,"column":32}},"16":{"start":{"line":26,"column":0},"end":{"line":26,"column":61}},"17":{"start":{"line":27,"column":0},"end":{"line":27,"column":67}},"18":{"start":{"line":32,"column":0},"end":{"line":46,"column":2}},"19":{"start":{"line":33,"column":1},"end":{"line":40,"column":2}},"20":{"start":{"line":34,"column":2},"end":{"line":39,"column":3}},"21":{"start":{"line":35,"column":3},"end":{"line":35,"column":82}},"22":{"start":{"line":36,"column":3},"end":{"line":36,"column":35}},"23":{"start":{"line":38,"column":3},"end":{"line":38,"column":72}},"24":{"start":{"line":41,"column":1},"end":{"line":45,"column":2}},"25":{"start":{"line":42,"column":2},"end":{"line":42,"column":124}},"26":{"start":{"line":44,"column":2},"end":{"line":44,"column":35}},"27":{"start":{"line":49,"column":0},"end":{"line":49,"column":33}}},"branchMap":{"1":{"line":17,"type":"cond-expr","locations":[{"start":{"line":17,"column":51},"end":{"line":17,"column":56}},{"start":{"line":17,"column":60},"end":{"line":17,"column":87}}]},"2":{"line":17,"type":"binary-expr","locations":[{"start":{"line":17,"column":60},"end":{"line":17,"column":74}},{"start":{"line":17,"column":78},"end":{"line":17,"column":87}}]},"3":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},{"start":{"line":18,"column":1},"end":{"line":18,"column":1}}]},"4":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":5},"end":{"line":18,"column":23}},{"start":{"line":18,"column":27},"end":{"line":18,"column":65}}]},"5":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},{"start":{"line":33,"column":1},"end":{"line":33,"column":1}}]},"6":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},{"start":{"line":41,"column":1},"end":{"line":41,"column":1}}]},"7":{"line":41,"type":"binary-expr","locations":[{"start":{"line":41,"column":5},"end":{"line":41,"column":11}},{"start":{"line":41,"column":15},"end":{"line":41,"column":33}}]},"8":{"line":42,"type":"cond-expr","locations":[{"start":{"line":42,"column":53},"end":{"line":42,"column":118}},{"start":{"line":42,"column":121},"end":{"line":42,"column":123}}]},"9":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":89},"end":{"line":42,"column":95}},{"start":{"line":42,"column":99},"end":{"line":42,"column":117}}]},"10":{"line":44,"type":"binary-expr","locations":[{"start":{"line":44,"column":9},"end":{"line":44,"column":28}},{"start":{"line":44,"column":32},"end":{"line":44,"column":34}}]}},"code":["var FieldType = require('../Type');","var NumberType = require('../number/NumberType');","var numeral = require('numeral');","var util = require('util');","","/**"," * Money FieldType Constructor"," * @extends Field"," * @api public"," */","function money(list, path, options) {","\tthis.currency = options.currency;","\tthis._nativeType = Number;","\tthis._underscoreMethods = ['format'];","\tthis._properties = ['currency'];","\tthis._fixedSize = 'small';","\tthis._formatString = (options.format === false) ? false : (options.format || '$0,0.00');","\tif (this._formatString && 'string' !== typeof this._formatString) {","\t\tthrow new Error('FieldType.Money: options.format must be a string.');","\t}","\tmoney.super_.call(this, list, path, options);","}","util.inherits(money, FieldType);","","/* Inherit from NumberType prototype */","money.prototype.updateItem = NumberType.prototype.updateItem;","money.prototype.validateInput = NumberType.prototype.validateInput;","","/**"," * Formats the field value"," */","money.prototype.format = function(item, format) {","\tif (this.currency) {","\t\ttry {","\t\t\tnumeral.language(this.currency, require('numeral/languages/' + this.currency));","\t\t\tnumeral.language(this.currency);","\t\t} catch (err) {","\t\t\tthrow new Error('FieldType.Money: options.currency failed to load.');","\t\t}","\t}","\tif (format || this._formatString) {","\t\treturn ('number' === typeof item.get(this.path)) ? numeral(item.get(this.path)).format(format || this._formatString) : '';","\t} else {","\t\treturn item.get(this.path) || '';","\t}","};","","/* Export Field Type */","exports = module.exports = money;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"21":0,"23":1,"26":1,"27":1,"32":1,"33":0,"34":0,"35":0,"36":0,"38":0,"41":0,"42":0,"44":0,"49":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/number/NumberType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/number/NumberType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":1,"34":0,"35":0,"36":0,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":1,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0},"fnMap":{"1":{"name":"number","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":37}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":36},"end":{"line":26,"column":60}}},"3":{"name":"(anonymous_3)","line":61,"loc":{"start":{"line":61,"column":26},"end":{"line":61,"column":49}}},"4":{"name":"(anonymous_4)","line":73,"loc":{"start":{"line":73,"column":33},"end":{"line":73,"column":64}}},"5":{"name":"(anonymous_5)","line":89,"loc":{"start":{"line":89,"column":30},"end":{"line":89,"column":51}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":33}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":11,"column":0},"end":{"line":20,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":27}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":27}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":38}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":102}},"10":{"start":{"line":16,"column":1},"end":{"line":18,"column":2}},"11":{"start":{"line":17,"column":2},"end":{"line":17,"column":72}},"12":{"start":{"line":19,"column":1},"end":{"line":19,"column":47}},"13":{"start":{"line":21,"column":0},"end":{"line":21,"column":33}},"14":{"start":{"line":26,"column":0},"end":{"line":56,"column":2}},"15":{"start":{"line":27,"column":1},"end":{"line":27,"column":21}},"16":{"start":{"line":28,"column":1},"end":{"line":31,"column":2}},"17":{"start":{"line":29,"column":2},"end":{"line":29,"column":86}},"18":{"start":{"line":30,"column":2},"end":{"line":30,"column":9}},"19":{"start":{"line":32,"column":1},"end":{"line":42,"column":2}},"20":{"start":{"line":33,"column":2},"end":{"line":33,"column":36}},"21":{"start":{"line":34,"column":2},"end":{"line":34,"column":36}},"22":{"start":{"line":35,"column":2},"end":{"line":40,"column":3}},"23":{"start":{"line":36,"column":3},"end":{"line":39,"column":5}},"24":{"start":{"line":41,"column":2},"end":{"line":41,"column":9}},"25":{"start":{"line":43,"column":1},"end":{"line":43,"column":40}},"26":{"start":{"line":44,"column":1},"end":{"line":54,"column":2}},"27":{"start":{"line":45,"column":2},"end":{"line":53,"column":3}},"28":{"start":{"line":46,"column":3},"end":{"line":46,"column":37}},"29":{"start":{"line":48,"column":7},"end":{"line":53,"column":3}},"30":{"start":{"line":49,"column":3},"end":{"line":49,"column":37}},"31":{"start":{"line":52,"column":3},"end":{"line":52,"column":28}},"32":{"start":{"line":55,"column":1},"end":{"line":55,"column":14}},"33":{"start":{"line":61,"column":0},"end":{"line":67,"column":2}},"34":{"start":{"line":62,"column":1},"end":{"line":66,"column":2}},"35":{"start":{"line":63,"column":2},"end":{"line":63,"column":124}},"36":{"start":{"line":65,"column":2},"end":{"line":65,"column":35}},"37":{"start":{"line":73,"column":0},"end":{"line":84,"column":2}},"38":{"start":{"line":74,"column":1},"end":{"line":74,"column":41}},"39":{"start":{"line":75,"column":1},"end":{"line":77,"column":2}},"40":{"start":{"line":76,"column":2},"end":{"line":76,"column":14}},"41":{"start":{"line":78,"column":1},"end":{"line":83,"column":2}},"42":{"start":{"line":79,"column":2},"end":{"line":79,"column":37}},"43":{"start":{"line":80,"column":2},"end":{"line":80,"column":28}},"44":{"start":{"line":82,"column":2},"end":{"line":82,"column":35}},"45":{"start":{"line":89,"column":0},"end":{"line":102,"column":2}},"46":{"start":{"line":90,"column":1},"end":{"line":90,"column":41}},"47":{"start":{"line":91,"column":1},"end":{"line":93,"column":2}},"48":{"start":{"line":92,"column":2},"end":{"line":92,"column":9}},"49":{"start":{"line":94,"column":1},"end":{"line":94,"column":36}},"50":{"start":{"line":95,"column":1},"end":{"line":101,"column":2}},"51":{"start":{"line":96,"column":2},"end":{"line":98,"column":3}},"52":{"start":{"line":97,"column":3},"end":{"line":97,"column":33}},"53":{"start":{"line":99,"column":8},"end":{"line":101,"column":2}},"54":{"start":{"line":100,"column":2},"end":{"line":100,"column":28}},"55":{"start":{"line":105,"column":0},"end":{"line":105,"column":34}}},"branchMap":{"1":{"line":15,"type":"cond-expr","locations":[{"start":{"line":15,"column":51},"end":{"line":15,"column":56}},{"start":{"line":15,"column":60},"end":{"line":15,"column":100}}]},"2":{"line":15,"type":"binary-expr","locations":[{"start":{"line":15,"column":60},"end":{"line":15,"column":74}},{"start":{"line":15,"column":78},"end":{"line":15,"column":100}}]},"3":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},{"start":{"line":16,"column":1},"end":{"line":16,"column":1}}]},"4":{"line":16,"type":"binary-expr","locations":[{"start":{"line":16,"column":5},"end":{"line":16,"column":23}},{"start":{"line":16,"column":27},"end":{"line":16,"column":65}}]},"5":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":9},"end":{"line":27,"column":14}},{"start":{"line":27,"column":18},"end":{"line":27,"column":20}}]},"6":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},{"start":{"line":28,"column":1},"end":{"line":28,"column":1}}]},"7":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":5},"end":{"line":28,"column":29}},{"start":{"line":28,"column":33},"end":{"line":28,"column":46}}]},"8":{"line":29,"type":"cond-expr","locations":[{"start":{"line":29,"column":37},"end":{"line":29,"column":60}},{"start":{"line":29,"column":63},"end":{"line":29,"column":85}}]},"9":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},{"start":{"line":32,"column":1},"end":{"line":32,"column":1}}]},"10":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":2},"end":{"line":35,"column":2}},{"start":{"line":35,"column":2},"end":{"line":35,"column":2}}]},"11":{"line":35,"type":"binary-expr","locations":[{"start":{"line":35,"column":6},"end":{"line":35,"column":17}},{"start":{"line":35,"column":21},"end":{"line":35,"column":32}}]},"12":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},{"start":{"line":44,"column":1},"end":{"line":44,"column":1}}]},"13":{"line":45,"type":"if","locations":[{"start":{"line":45,"column":2},"end":{"line":45,"column":2}},{"start":{"line":45,"column":2},"end":{"line":45,"column":2}}]},"14":{"line":48,"type":"if","locations":[{"start":{"line":48,"column":7},"end":{"line":48,"column":7}},{"start":{"line":48,"column":7},"end":{"line":48,"column":7}}]},"15":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},{"start":{"line":62,"column":1},"end":{"line":62,"column":1}}]},"16":{"line":62,"type":"binary-expr","locations":[{"start":{"line":62,"column":5},"end":{"line":62,"column":11}},{"start":{"line":62,"column":15},"end":{"line":62,"column":33}}]},"17":{"line":63,"type":"cond-expr","locations":[{"start":{"line":63,"column":53},"end":{"line":63,"column":118}},{"start":{"line":63,"column":121},"end":{"line":63,"column":123}}]},"18":{"line":63,"type":"binary-expr","locations":[{"start":{"line":63,"column":89},"end":{"line":63,"column":95}},{"start":{"line":63,"column":99},"end":{"line":63,"column":117}}]},"19":{"line":65,"type":"binary-expr","locations":[{"start":{"line":65,"column":9},"end":{"line":65,"column":28}},{"start":{"line":65,"column":32},"end":{"line":65,"column":34}}]},"20":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},{"start":{"line":75,"column":1},"end":{"line":75,"column":1}}]},"21":{"line":75,"type":"binary-expr","locations":[{"start":{"line":75,"column":5},"end":{"line":75,"column":24}},{"start":{"line":75,"column":28},"end":{"line":75,"column":32}},{"start":{"line":75,"column":37},"end":{"line":75,"column":56}},{"start":{"line":75,"column":60},"end":{"line":75,"column":85}}]},"22":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},{"start":{"line":78,"column":1},"end":{"line":78,"column":1}}]},"23":{"line":78,"type":"binary-expr","locations":[{"start":{"line":78,"column":5},"end":{"line":78,"column":24}},{"start":{"line":78,"column":28},"end":{"line":78,"column":40}}]},"24":{"line":82,"type":"cond-expr","locations":[{"start":{"line":82,"column":22},"end":{"line":82,"column":27}},{"start":{"line":82,"column":30},"end":{"line":82,"column":34}}]},"25":{"line":91,"type":"if","locations":[{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},{"start":{"line":91,"column":1},"end":{"line":91,"column":1}}]},"26":{"line":95,"type":"if","locations":[{"start":{"line":95,"column":1},"end":{"line":95,"column":1}},{"start":{"line":95,"column":1},"end":{"line":95,"column":1}}]},"27":{"line":96,"type":"if","locations":[{"start":{"line":96,"column":2},"end":{"line":96,"column":2}},{"start":{"line":96,"column":2},"end":{"line":96,"column":2}}]},"28":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":8},"end":{"line":99,"column":8}},{"start":{"line":99,"column":8},"end":{"line":99,"column":8}}]}},"code":["var FieldType = require('../Type');","var numeral = require('numeral');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Number FieldType Constructor"," * @extends Field"," * @api public"," */","function number(list, path, options) {","\tthis._nativeType = Number;","\tthis._fixedSize = 'small';","\tthis._underscoreMethods = ['format'];","\tthis._formatString = (options.format === false) ? false : (options.format || '0,0[.][000000000000]');","\tif (this._formatString && 'string' !== typeof this._formatString) {","\t\tthrow new Error('FieldType.Number: options.format must be a string.');","\t}","\tnumber.super_.call(this, list, path, options);","}","util.inherits(number, FieldType);","","/**"," * Add filters to a query"," */","number.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tif (filter.mode === 'equals' && !filter.value) {","\t\tquery[this.path] = filter.invert ? { $nin: ['', 0, null] } : { $in: ['', 0, null] };","\t\treturn;","\t}","\tif (filter.mode === 'between') {","\t\tvar min = utils.number(value.min);","\t\tvar max = utils.number(value.max);","\t\tif (!isNaN(min) && !isNaN(max)) {","\t\t\tquery[this.path] = {","\t\t\t\t$gte: min,","\t\t\t\t$lte: max","\t\t\t};","\t\t}","\t\treturn;","\t}","\tvar value = utils.number(filter.value);","\tif (!isNaN(value)) {","\t\tif (filter.mode === 'gt') {","\t\t\tquery[this.path] = { $gt: value };","\t\t}","\t\telse if (filter.mode === 'lt') {","\t\t\tquery[this.path] = { $lt: value };","\t\t}","\t\telse {","\t\t\tquery[this.path] = value;","\t\t}","\t}","\treturn query;","};","","/**"," * Formats the field value"," */","number.prototype.format = function(item, format) {","\tif (format || this._formatString) {","\t\treturn ('number' === typeof item.get(this.path)) ? numeral(item.get(this.path)).format(format || this._formatString) : '';","\t} else {","\t\treturn item.get(this.path) || '';","\t}","};","","/**"," * Checks that a valid number has been provided in a data object"," * An empty value clears the stored value and is considered valid"," */","number.prototype.validateInput = function(data, required, item) {","\tvar value = this.getValueFromData(data);","\tif (value === undefined && item && (item.get(this.path) || item.get(this.path) === 0)) {","\t\treturn true;","\t}","\tif (value !== undefined && value !== '') {","\t\tvar newValue = utils.number(value);","\t\treturn (!isNaN(newValue));","\t} else {","\t\treturn (required) ? false : true;","\t}","};","","/**"," * Updates the value for this field in the item from a data object"," */","number.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\tif (value === undefined) {","\t\treturn;","\t}","\tvar newValue = utils.number(value);","\tif (!isNaN(newValue)) {","\t\tif (newValue !== item.get(this.path)) {","\t\t\titem.set(this.path, newValue);","\t\t}","\t} else if ('number' === typeof item.get(this.path)) {","\t\titem.set(this.path, null);","\t}","};","","/* Export Field Type */","exports = module.exports = number;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"19":0,"21":1,"26":1,"27":0,"28":0,"29":0,"30":0,"32":0,"33":0,"34":0,"35":0,"36":0,"41":0,"43":0,"44":0,"45":0,"46":0,"48":0,"49":0,"52":0,"55":0,"61":1,"62":0,"63":0,"65":0,"73":1,"74":0,"75":0,"76":0,"78":0,"79":0,"80":0,"82":0,"89":1,"90":0,"91":0,"92":0,"94":0,"95":0,"96":0,"97":0,"99":0,"100":0,"105":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/name/NameType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/name/NameType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":1,"9":1,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":1,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":1,"36":0,"37":1,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0,0],"5":[0,0,0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0],"11":[0,0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},"fnMap":{"1":{"name":"name","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":35}}},"2":{"name":"(anonymous_2)","line":27,"loc":{"start":{"line":27,"column":29},"end":{"line":27,"column":40}}},"3":{"name":"(anonymous_3)","line":41,"loc":{"start":{"line":41,"column":32},"end":{"line":41,"column":44}}},"4":{"name":"(anonymous_4)","line":45,"loc":{"start":{"line":45,"column":32},"end":{"line":45,"column":48}}},"5":{"name":"(anonymous_5)","line":63,"loc":{"start":{"line":63,"column":24},"end":{"line":63,"column":39}}},"6":{"name":"(anonymous_6)","line":70,"loc":{"start":{"line":70,"column":31},"end":{"line":70,"column":62}}},"7":{"name":"(anonymous_7)","line":89,"loc":{"start":{"line":89,"column":28},"end":{"line":89,"column":43}}},"8":{"name":"(anonymous_8)","line":98,"loc":{"start":{"line":98,"column":28},"end":{"line":98,"column":49}}},"9":{"name":"(anonymous_9)","line":108,"loc":{"start":{"line":108,"column":13},"end":{"line":108,"column":27}}},"10":{"name":"(anonymous_10)","line":115,"loc":{"start":{"line":115,"column":13},"end":{"line":115,"column":27}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":10,"column":0},"end":{"line":14,"column":1}},"5":{"start":{"line":11,"column":1},"end":{"line":11,"column":27}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":25}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":45}},"8":{"start":{"line":15,"column":0},"end":{"line":15,"column":31}},"9":{"start":{"line":27,"column":0},"end":{"line":57,"column":2}},"10":{"start":{"line":28,"column":1},"end":{"line":28,"column":31}},"11":{"start":{"line":29,"column":1},"end":{"line":33,"column":3}},"12":{"start":{"line":35,"column":1},"end":{"line":35,"column":33}},"13":{"start":{"line":36,"column":1},"end":{"line":39,"column":21}},"14":{"start":{"line":41,"column":1},"end":{"line":43,"column":4}},"15":{"start":{"line":42,"column":2},"end":{"line":42,"column":76}},"16":{"start":{"line":45,"column":1},"end":{"line":54,"column":4}},"17":{"start":{"line":46,"column":2},"end":{"line":50,"column":3}},"18":{"start":{"line":47,"column":3},"end":{"line":47,"column":36}},"19":{"start":{"line":48,"column":3},"end":{"line":48,"column":35}},"20":{"start":{"line":49,"column":3},"end":{"line":49,"column":10}},"21":{"start":{"line":51,"column":2},"end":{"line":51,"column":31}},"22":{"start":{"line":52,"column":2},"end":{"line":52,"column":39}},"23":{"start":{"line":53,"column":2},"end":{"line":53,"column":53}},"24":{"start":{"line":56,"column":1},"end":{"line":56,"column":30}},"25":{"start":{"line":63,"column":0},"end":{"line":65,"column":2}},"26":{"start":{"line":64,"column":1},"end":{"line":64,"column":34}},"27":{"start":{"line":70,"column":0},"end":{"line":82,"column":2}},"28":{"start":{"line":72,"column":1},"end":{"line":72,"column":158}},"29":{"start":{"line":72,"column":146},"end":{"line":72,"column":158}},"30":{"start":{"line":74,"column":1},"end":{"line":74,"column":28}},"31":{"start":{"line":74,"column":16},"end":{"line":74,"column":28}},"32":{"start":{"line":77,"column":1},"end":{"line":81,"column":2}},"33":{"start":{"line":78,"column":2},"end":{"line":78,"column":96}},"34":{"start":{"line":80,"column":2},"end":{"line":80,"column":99}},"35":{"start":{"line":89,"column":0},"end":{"line":91,"column":2}},"36":{"start":{"line":90,"column":1},"end":{"line":90,"column":78}},"37":{"start":{"line":98,"column":0},"end":{"line":124,"column":2}},"38":{"start":{"line":99,"column":1},"end":{"line":99,"column":31}},"39":{"start":{"line":99,"column":24},"end":{"line":99,"column":31}},"40":{"start":{"line":100,"column":1},"end":{"line":100,"column":24}},"41":{"start":{"line":101,"column":1},"end":{"line":101,"column":14}},"42":{"start":{"line":102,"column":1},"end":{"line":120,"column":2}},"43":{"start":{"line":104,"column":2},"end":{"line":104,"column":40}},"44":{"start":{"line":105,"column":8},"end":{"line":120,"column":2}},"45":{"start":{"line":107,"column":2},"end":{"line":107,"column":33}},"46":{"start":{"line":108,"column":2},"end":{"line":112,"column":4}},"47":{"start":{"line":109,"column":3},"end":{"line":111,"column":4}},"48":{"start":{"line":110,"column":4},"end":{"line":110,"column":40}},"49":{"start":{"line":115,"column":2},"end":{"line":119,"column":4}},"50":{"start":{"line":116,"column":3},"end":{"line":118,"column":4}},"51":{"start":{"line":117,"column":4},"end":{"line":117,"column":43}},"52":{"start":{"line":121,"column":1},"end":{"line":123,"column":2}},"53":{"start":{"line":122,"column":2},"end":{"line":122,"column":46}},"54":{"start":{"line":128,"column":0},"end":{"line":128,"column":32}}},"branchMap":{"1":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":2},"end":{"line":46,"column":2}},{"start":{"line":46,"column":2},"end":{"line":46,"column":2}}]},"2":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":23},"end":{"line":53,"column":38}},{"start":{"line":53,"column":42},"end":{"line":53,"column":51}}]},"3":{"line":72,"type":"if","locations":[{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},{"start":{"line":72,"column":1},"end":{"line":72,"column":1}}]},"4":{"line":72,"type":"binary-expr","locations":[{"start":{"line":72,"column":5},"end":{"line":72,"column":107}},{"start":{"line":72,"column":111},"end":{"line":72,"column":115}},{"start":{"line":72,"column":119},"end":{"line":72,"column":144}}]},"5":{"line":72,"type":"binary-expr","locations":[{"start":{"line":72,"column":7},"end":{"line":72,"column":24}},{"start":{"line":72,"column":28},"end":{"line":72,"column":52}},{"start":{"line":72,"column":56},"end":{"line":72,"column":79}},{"start":{"line":72,"column":83},"end":{"line":72,"column":106}}]},"6":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},{"start":{"line":74,"column":1},"end":{"line":74,"column":1}}]},"7":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},{"start":{"line":77,"column":1},"end":{"line":77,"column":1}}]},"8":{"line":78,"type":"cond-expr","locations":[{"start":{"line":78,"column":83},"end":{"line":78,"column":87}},{"start":{"line":78,"column":90},"end":{"line":78,"column":95}}]},"9":{"line":78,"type":"binary-expr","locations":[{"start":{"line":78,"column":10},"end":{"line":78,"column":30}},{"start":{"line":78,"column":34},"end":{"line":78,"column":55}},{"start":{"line":78,"column":59},"end":{"line":78,"column":79}}]},"10":{"line":80,"type":"cond-expr","locations":[{"start":{"line":80,"column":86},"end":{"line":80,"column":90}},{"start":{"line":80,"column":93},"end":{"line":80,"column":98}}]},"11":{"line":80,"type":"binary-expr","locations":[{"start":{"line":80,"column":10},"end":{"line":80,"column":31}},{"start":{"line":80,"column":35},"end":{"line":80,"column":57}},{"start":{"line":80,"column":61},"end":{"line":80,"column":82}}]},"12":{"line":90,"type":"binary-expr","locations":[{"start":{"line":90,"column":8},"end":{"line":90,"column":41}},{"start":{"line":90,"column":45},"end":{"line":90,"column":77}}]},"13":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":1},"end":{"line":99,"column":1}},{"start":{"line":99,"column":1},"end":{"line":99,"column":1}}]},"14":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},{"start":{"line":102,"column":1},"end":{"line":102,"column":1}}]},"15":{"line":102,"type":"binary-expr","locations":[{"start":{"line":102,"column":5},"end":{"line":102,"column":22}},{"start":{"line":102,"column":26},"end":{"line":102,"column":53}}]},"16":{"line":105,"type":"if","locations":[{"start":{"line":105,"column":8},"end":{"line":105,"column":8}},{"start":{"line":105,"column":8},"end":{"line":105,"column":8}}]},"17":{"line":105,"type":"binary-expr","locations":[{"start":{"line":105,"column":12},"end":{"line":105,"column":29}},{"start":{"line":105,"column":33},"end":{"line":105,"column":60}}]},"18":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":3},"end":{"line":109,"column":3}},{"start":{"line":109,"column":3},"end":{"line":109,"column":3}}]},"19":{"line":109,"type":"binary-expr","locations":[{"start":{"line":109,"column":7},"end":{"line":109,"column":22}},{"start":{"line":109,"column":26},"end":{"line":109,"column":64}}]},"20":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":3},"end":{"line":116,"column":3}},{"start":{"line":116,"column":3},"end":{"line":116,"column":3}}]},"21":{"line":116,"type":"binary-expr","locations":[{"start":{"line":116,"column":7},"end":{"line":116,"column":25}},{"start":{"line":116,"column":29},"end":{"line":116,"column":70}}]},"22":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},{"start":{"line":121,"column":1},"end":{"line":121,"column":1}}]}},"code":["var _ = require('underscore');","var FieldType = require('../Type');","var util = require('util');","","/**"," * Name FieldType Constructor"," * @extends Field"," * @api public"," */","function name(list, path, options) {","\tthis._fixedSize = 'large';","\toptions.nofilter = true; // TODO: remove this when 0.4 is merged","\tname.super_.call(this, list, path, options);","}","util.inherits(name, FieldType);","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * Adds String properties for .first and .last name, and a virtual"," * with get() and set() methods for .full"," *"," * @api public"," */","","name.prototype.addToSchema = function() {","\tvar schema = this.list.schema;","\tvar paths = this.paths = {","\t\tfirst: this._path.append('.first'),","\t\tlast: this._path.append('.last'),","\t\tfull: this._path.append('.full')","\t};","","\tschema.nested[this.path] = true;","\tschema.add({","\t\tfirst: String,","\t\tlast: String","\t}, this.path + '.');","","\tschema.virtual(paths.full).get(function () {","\t\treturn _.compact([this.get(paths.first), this.get(paths.last)]).join(' ');","\t});","","\tschema.virtual(paths.full).set(function(value) {","\t\tif (typeof value !== 'string') {","\t\t\tthis.set(paths.first, undefined);","\t\t\tthis.set(paths.last, undefined);","\t\t\treturn;","\t\t}","\t\tvar split = value.split(' ');","\t\tthis.set(paths.first, split.shift());","\t\tthis.set(paths.last, split.join(' ') || undefined);","\t});","","\tthis.bindUnderscoreMethods();","};","","/**"," * Formats the field value"," */","","name.prototype.format = function(item) {","\treturn item.get(this.paths.full);","};","","/**"," * Validates that a value for this field has been provided in a data object"," */","name.prototype.validateInput = function(data, required, item) {","\t// Input is valid if none was provided, but the item has data","\tif (!(this.path in data || this.paths.first in data || this.paths.last in data || this.paths.full in data) && item && item.get(this.paths.full)) return true;","\t// Input is valid if the field is not required","\tif (!required) return true;","\t// Otherwise check for valid strings in the provided data,","\t// which may be nested or use flattened paths.","\tif (_.isObject(data[this.path])) {","\t\treturn (data[this.path].full || data[this.path].first || data[this.path].last) ? true : false;","\t} else {","\t\treturn (data[this.paths.full] || data[this.paths.first] || data[this.paths.last]) ? true : false;","\t}","};","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","name.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.first) || item.isModified(this.paths.last);","};","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","name.prototype.updateItem = function(item, data) {","\tif (!_.isObject(data)) return;","\tvar paths = this.paths;","\tvar setValue;","\tif (this.path in data && _.isString(data[this.path])) {","\t\t// Allow the root path as an alias to {path}.full","\t\titem.set(paths.full, data[this.path]);","\t} else if (this.path in data && _.isObject(data[this.path])) {","\t\t// Allow a nested object like { path: { first: 'Jed' } }","\t\tvar valueObj = data[this.path];","\t\tsetValue = function(key) {","\t\t\tif (key in valueObj && valueObj[key] !== item.get(paths[key])) {","\t\t\t\titem.set(paths[key], valueObj[key]);","\t\t\t}","\t\t};","\t} else {","\t\t// Default to flattened paths like { 'path.first': 'Jed' }","\t\tsetValue = function(key) {","\t\t\tif (paths[key] in data && data[paths[key]] !== item.get(paths[key])) {","\t\t\t\titem.set(paths[key], data[paths[key]]);","\t\t\t}","\t\t};","\t}","\tif (setValue) {","\t\t_.each(['full', 'first', 'last'], setValue);","\t}","};","","","/* Export Field Type */","exports = module.exports = name;",""],"l":{"1":1,"2":1,"3":1,"10":1,"11":0,"12":0,"13":0,"15":1,"27":1,"28":0,"29":0,"35":0,"36":0,"41":0,"42":0,"45":0,"46":0,"47":0,"48":0,"49":0,"51":0,"52":0,"53":0,"56":0,"63":1,"64":0,"70":1,"72":0,"74":0,"77":0,"78":0,"80":0,"89":1,"90":0,"98":1,"99":0,"100":0,"101":0,"102":0,"104":0,"105":0,"107":0,"108":0,"109":0,"110":0,"115":0,"116":0,"117":0,"121":0,"122":0,"128":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/numberarray/NumberArrayType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/numberarray/NumberArrayType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":1,"11":1,"12":0,"13":0,"14":0,"15":1,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":1,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0,0,0],"13":[0,0],"14":[0,0,0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0,0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"numberarray","line":16,"loc":{"start":{"line":16,"column":0},"end":{"line":16,"column":42}}},"2":{"name":"(anonymous_2)","line":45,"loc":{"start":{"line":45,"column":31},"end":{"line":45,"column":54}}},"3":{"name":"isValidNumber","line":59,"loc":{"start":{"line":59,"column":0},"end":{"line":59,"column":30}}},"4":{"name":"(anonymous_4)","line":71,"loc":{"start":{"line":71,"column":38},"end":{"line":71,"column":69}}},"5":{"name":"(anonymous_5)","line":110,"loc":{"start":{"line":110,"column":35},"end":{"line":110,"column":56}}},"6":{"name":"(anonymous_6)","line":115,"loc":{"start":{"line":115,"column":27},"end":{"line":115,"column":42}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":8,"column":29}},"2":{"start":{"line":16,"column":0},"end":{"line":30,"column":1}},"3":{"start":{"line":18,"column":1},"end":{"line":18,"column":29}},"4":{"start":{"line":20,"column":1},"end":{"line":20,"column":38}},"5":{"start":{"line":21,"column":1},"end":{"line":21,"column":102}},"6":{"start":{"line":22,"column":1},"end":{"line":22,"column":27}},"7":{"start":{"line":24,"column":1},"end":{"line":26,"column":2}},"8":{"start":{"line":25,"column":2},"end":{"line":25,"column":72}},"9":{"start":{"line":28,"column":1},"end":{"line":28,"column":52}},"10":{"start":{"line":36,"column":0},"end":{"line":36,"column":35}},"11":{"start":{"line":45,"column":0},"end":{"line":51,"column":2}},"12":{"start":{"line":46,"column":1},"end":{"line":50,"column":2}},"13":{"start":{"line":47,"column":2},"end":{"line":47,"column":124}},"14":{"start":{"line":49,"column":2},"end":{"line":49,"column":35}},"15":{"start":{"line":59,"column":0},"end":{"line":61,"column":1}},"16":{"start":{"line":60,"column":1},"end":{"line":60,"column":36}},"17":{"start":{"line":71,"column":0},"end":{"line":101,"column":2}},"18":{"start":{"line":72,"column":1},"end":{"line":72,"column":41}},"19":{"start":{"line":74,"column":1},"end":{"line":84,"column":2}},"20":{"start":{"line":75,"column":2},"end":{"line":77,"column":3}},"21":{"start":{"line":76,"column":3},"end":{"line":76,"column":15}},"22":{"start":{"line":78,"column":2},"end":{"line":80,"column":3}},"23":{"start":{"line":79,"column":3},"end":{"line":79,"column":16}},"24":{"start":{"line":81,"column":2},"end":{"line":83,"column":3}},"25":{"start":{"line":82,"column":3},"end":{"line":82,"column":16}},"26":{"start":{"line":86,"column":1},"end":{"line":90,"column":2}},"27":{"start":{"line":87,"column":2},"end":{"line":89,"column":3}},"28":{"start":{"line":88,"column":3},"end":{"line":88,"column":16}},"29":{"start":{"line":92,"column":1},"end":{"line":98,"column":2}},"30":{"start":{"line":93,"column":2},"end":{"line":97,"column":3}},"31":{"start":{"line":94,"column":3},"end":{"line":96,"column":4}},"32":{"start":{"line":95,"column":4},"end":{"line":95,"column":17}},"33":{"start":{"line":100,"column":1},"end":{"line":100,"column":116}},"34":{"start":{"line":110,"column":0},"end":{"line":138,"column":2}},"35":{"start":{"line":111,"column":1},"end":{"line":111,"column":41}},"36":{"start":{"line":113,"column":1},"end":{"line":136,"column":2}},"37":{"start":{"line":114,"column":2},"end":{"line":121,"column":3}},"38":{"start":{"line":115,"column":3},"end":{"line":119,"column":6}},"39":{"start":{"line":116,"column":4},"end":{"line":118,"column":5}},"40":{"start":{"line":117,"column":5},"end":{"line":117,"column":31}},"41":{"start":{"line":120,"column":3},"end":{"line":120,"column":16}},"42":{"start":{"line":122,"column":2},"end":{"line":124,"column":3}},"43":{"start":{"line":123,"column":3},"end":{"line":123,"column":14}},"44":{"start":{"line":125,"column":2},"end":{"line":129,"column":3}},"45":{"start":{"line":126,"column":3},"end":{"line":128,"column":4}},"46":{"start":{"line":127,"column":4},"end":{"line":127,"column":34}},"47":{"start":{"line":130,"column":2},"end":{"line":132,"column":3}},"48":{"start":{"line":131,"column":3},"end":{"line":131,"column":19}},"49":{"start":{"line":133,"column":2},"end":{"line":135,"column":3}},"50":{"start":{"line":134,"column":3},"end":{"line":134,"column":30}},"51":{"start":{"line":145,"column":0},"end":{"line":145,"column":39}}},"branchMap":{"1":{"line":21,"type":"cond-expr","locations":[{"start":{"line":21,"column":51},"end":{"line":21,"column":56}},{"start":{"line":21,"column":60},"end":{"line":21,"column":100}}]},"2":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":60},"end":{"line":21,"column":74}},{"start":{"line":21,"column":78},"end":{"line":21,"column":100}}]},"3":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},{"start":{"line":24,"column":1},"end":{"line":24,"column":1}}]},"4":{"line":24,"type":"binary-expr","locations":[{"start":{"line":24,"column":5},"end":{"line":24,"column":23}},{"start":{"line":24,"column":27},"end":{"line":24,"column":65}}]},"5":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},{"start":{"line":46,"column":1},"end":{"line":46,"column":1}}]},"6":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":5},"end":{"line":46,"column":11}},{"start":{"line":46,"column":15},"end":{"line":46,"column":33}}]},"7":{"line":47,"type":"cond-expr","locations":[{"start":{"line":47,"column":53},"end":{"line":47,"column":118}},{"start":{"line":47,"column":121},"end":{"line":47,"column":123}}]},"8":{"line":47,"type":"binary-expr","locations":[{"start":{"line":47,"column":89},"end":{"line":47,"column":95}},{"start":{"line":47,"column":99},"end":{"line":47,"column":117}}]},"9":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":9},"end":{"line":49,"column":28}},{"start":{"line":49,"column":32},"end":{"line":49,"column":34}}]},"10":{"line":74,"type":"if","locations":[{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},{"start":{"line":74,"column":1},"end":{"line":74,"column":1}}]},"11":{"line":75,"type":"if","locations":[{"start":{"line":75,"column":2},"end":{"line":75,"column":2}},{"start":{"line":75,"column":2},"end":{"line":75,"column":2}}]},"12":{"line":75,"type":"binary-expr","locations":[{"start":{"line":75,"column":6},"end":{"line":75,"column":25}},{"start":{"line":75,"column":29},"end":{"line":75,"column":33}},{"start":{"line":75,"column":37},"end":{"line":75,"column":56}},{"start":{"line":75,"column":60},"end":{"line":75,"column":86}}]},"13":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":2},"end":{"line":78,"column":2}},{"start":{"line":78,"column":2},"end":{"line":78,"column":2}}]},"14":{"line":78,"type":"binary-expr","locations":[{"start":{"line":78,"column":6},"end":{"line":78,"column":25}},{"start":{"line":78,"column":29},"end":{"line":78,"column":50}},{"start":{"line":78,"column":55},"end":{"line":78,"column":80}},{"start":{"line":78,"column":86},"end":{"line":78,"column":111}}]},"15":{"line":81,"type":"if","locations":[{"start":{"line":81,"column":2},"end":{"line":81,"column":2}},{"start":{"line":81,"column":2},"end":{"line":81,"column":2}}]},"16":{"line":81,"type":"binary-expr","locations":[{"start":{"line":81,"column":6},"end":{"line":81,"column":26}},{"start":{"line":81,"column":30},"end":{"line":81,"column":43}}]},"17":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},{"start":{"line":86,"column":1},"end":{"line":86,"column":1}}]},"18":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":2},"end":{"line":87,"column":2}},{"start":{"line":87,"column":2},"end":{"line":87,"column":2}}]},"19":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":1},"end":{"line":92,"column":1}},{"start":{"line":92,"column":1},"end":{"line":92,"column":1}}]},"20":{"line":94,"type":"if","locations":[{"start":{"line":94,"column":3},"end":{"line":94,"column":3}},{"start":{"line":94,"column":3},"end":{"line":94,"column":3}}]},"21":{"line":100,"type":"binary-expr","locations":[{"start":{"line":100,"column":9},"end":{"line":100,"column":28}},{"start":{"line":100,"column":32},"end":{"line":100,"column":52}},{"start":{"line":100,"column":57},"end":{"line":100,"column":82}},{"start":{"line":100,"column":88},"end":{"line":100,"column":113}}]},"22":{"line":113,"type":"if","locations":[{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},{"start":{"line":113,"column":1},"end":{"line":113,"column":1}}]},"23":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":2},"end":{"line":114,"column":2}},{"start":{"line":114,"column":2},"end":{"line":114,"column":2}}]},"24":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":4},"end":{"line":116,"column":4}},{"start":{"line":116,"column":4},"end":{"line":116,"column":4}}]},"25":{"line":122,"type":"if","locations":[{"start":{"line":122,"column":2},"end":{"line":122,"column":2}},{"start":{"line":122,"column":2},"end":{"line":122,"column":2}}]},"26":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":2},"end":{"line":125,"column":2}},{"start":{"line":125,"column":2},"end":{"line":125,"column":2}}]},"27":{"line":126,"type":"if","locations":[{"start":{"line":126,"column":3},"end":{"line":126,"column":3}},{"start":{"line":126,"column":3},"end":{"line":126,"column":3}}]},"28":{"line":130,"type":"if","locations":[{"start":{"line":130,"column":2},"end":{"line":130,"column":2}},{"start":{"line":130,"column":2},"end":{"line":130,"column":2}}]},"29":{"line":133,"type":"if","locations":[{"start":{"line":133,"column":2},"end":{"line":133,"column":2}},{"start":{"line":133,"column":2},"end":{"line":133,"column":2}}]}},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tnumeral = require('numeral'),","\tutils = require('keystone-utils'),","\tsuper_ = require('../Type');","","/**"," * Number FieldType Constructor"," * @extends Field"," * @api public"," */","","function numberarray(list, path, options) {","\t","\tthis._nativeType = [Number];","","\tthis._underscoreMethods = ['format'];","\tthis._formatString = (options.format === false) ? false : (options.format || '0,0[.][000000000000]');","\tthis._fixedSize = 'small';","\t","\tif (this._formatString && 'string' !== typeof this._formatString) {","\t\tthrow new Error('FieldType.Number: options.format must be a string.');","\t}","\t","\tnumberarray.super_.call(this, list, path, options);","\t","}","","/*!"," * Inherit from Field"," */","","util.inherits(numberarray, super_);","","","/**"," * Formats the field value"," *"," * @api public"," */","","numberarray.prototype.format = function(item, format) {","\tif (format || this._formatString) {","\t\treturn ('number' === typeof item.get(this.path)) ? numeral(item.get(this.path)).format(format || this._formatString) : '';","\t} else {","\t\treturn item.get(this.path) || '';","\t}","};","","/**"," * Checks if a value is a valid number"," *"," * @api private"," */","","function isValidNumber(value) {","\treturn !isNaN(utils.number(value));","}","","/**"," * Checks that a valid array of number has been provided in a data object"," *"," * An empty value clears the stored value and is considered valid"," *"," * @api public"," */","","numberarray.prototype.validateInput = function(data, required, item) {","\tvar value = this.getValueFromData(data);","","\tif (required) {","\t\tif (value === undefined && item && item.get(this.path) && item.get(this.path).length) {","\t\t\treturn true;","\t\t}","\t\tif (value === undefined || !Array.isArray(value) || ('string' !== typeof value) || ('number' !== typeof value)) {","\t\t\treturn false;","\t\t}","\t\tif (Array.isArray(value) && !value.length) {","\t\t\treturn false;","\t\t}","\t}","","\tif ('string' === typeof value) {","\t\tif (!isValidNumber(value)) {","\t\t\treturn false;","\t\t}","\t}","","\tif (Array.isArray(value)) {","\t\tfor (var index = 0; index < value.length; index++) {","\t\t\tif (!isValidNumber(value[index])) {","\t\t\t\treturn false;","\t\t\t}","\t\t}","\t}","","\treturn (value === undefined || Array.isArray(value) || ('string' === typeof value) || ('number' === typeof value));","};","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","","numberarray.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\t","\tif ('undefined' !== typeof value) {","\t\tif (Array.isArray(value)) {","\t\t\tvar temp = value.filter(function(temp) {","\t\t\t\tif (isValidNumber(temp)) {","\t\t\t\t\treturn utils.number(temp);","\t\t\t\t}","\t\t\t});","\t\t\tvalue = temp;","\t\t}","\t\tif (value === null) {","\t\t\tvalue = [];","\t\t}","\t\tif ('string' === typeof value) {","\t\t\tif (isValidNumber(value)) {","\t\t\t\tvalue = [utils.number(value)];","\t\t\t}","\t\t}","\t\tif ('number' === typeof value) {","\t\t\tvalue = [value];","\t\t}","\t\tif (Array.isArray(value)) {","\t\t\titem.set(this.path, value);","\t\t}","\t}","","};","","","/*!"," * Export class"," */","","exports = module.exports = numberarray;",""],"l":{"5":1,"16":1,"18":0,"20":0,"21":0,"22":0,"24":0,"25":0,"28":0,"36":1,"45":1,"46":0,"47":0,"49":0,"59":1,"60":0,"71":1,"72":0,"74":0,"75":0,"76":0,"78":0,"79":0,"81":0,"82":0,"86":0,"87":0,"88":0,"92":0,"93":0,"94":0,"95":0,"100":0,"110":1,"111":0,"113":0,"114":0,"115":0,"116":0,"117":0,"120":0,"122":0,"123":0,"125":0,"126":0,"127":0,"130":0,"131":0,"133":0,"134":0,"145":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/password/PasswordType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/password/PasswordType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":1,"14":1,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":1,"43":0,"44":0,"45":0,"46":1,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":1,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":1,"62":0,"63":0,"64":0,"65":0,"66":0,"67":1,"68":0,"69":0,"70":0,"71":0,"72":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0,0,0],"19":[0,0],"20":[0,0],"21":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"password","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":39}}},"2":{"name":"(anonymous_2)","line":30,"loc":{"start":{"line":30,"column":33},"end":{"line":30,"column":44}}},"3":{"name":"(anonymous_3)","line":42,"loc":{"start":{"line":42,"column":7},"end":{"line":42,"column":26}}},"4":{"name":"(anonymous_4)","line":48,"loc":{"start":{"line":48,"column":37},"end":{"line":48,"column":56}}},"5":{"name":"(anonymous_5)","line":53,"loc":{"start":{"line":53,"column":20},"end":{"line":53,"column":35}}},"6":{"name":"(anonymous_6)","line":62,"loc":{"start":{"line":62,"column":41},"end":{"line":62,"column":61}}},"7":{"name":"(anonymous_7)","line":66,"loc":{"start":{"line":66,"column":52},"end":{"line":66,"column":64}}},"8":{"name":"(anonymous_8)","line":66,"loc":{"start":{"line":66,"column":68},"end":{"line":66,"column":88}}},"9":{"name":"(anonymous_9)","line":86,"loc":{"start":{"line":86,"column":38},"end":{"line":86,"column":62}}},"10":{"name":"(anonymous_10)","line":101,"loc":{"start":{"line":101,"column":28},"end":{"line":101,"column":43}}},"11":{"name":"(anonymous_11)","line":114,"loc":{"start":{"line":114,"column":29},"end":{"line":114,"column":65}}},"12":{"name":"(anonymous_12)","line":130,"loc":{"start":{"line":130,"column":35},"end":{"line":130,"column":66}}},"13":{"name":"(anonymous_13)","line":145,"loc":{"start":{"line":145,"column":32},"end":{"line":145,"column":53}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":38}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":35}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":11,"column":0},"end":{"line":20,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":27}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":49}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":27}},"9":{"start":{"line":16,"column":1},"end":{"line":16,"column":23}},"10":{"start":{"line":17,"column":1},"end":{"line":17,"column":25}},"11":{"start":{"line":18,"column":1},"end":{"line":18,"column":44}},"12":{"start":{"line":19,"column":1},"end":{"line":19,"column":49}},"13":{"start":{"line":21,"column":0},"end":{"line":21,"column":35}},"14":{"start":{"line":30,"column":0},"end":{"line":81,"column":2}},"15":{"start":{"line":31,"column":1},"end":{"line":31,"column":18}},"16":{"start":{"line":32,"column":1},"end":{"line":32,"column":31}},"17":{"start":{"line":33,"column":1},"end":{"line":33,"column":58}},"18":{"start":{"line":35,"column":1},"end":{"line":38,"column":3}},"19":{"start":{"line":40,"column":1},"end":{"line":46,"column":19}},"20":{"start":{"line":43,"column":3},"end":{"line":43,"column":30}},"21":{"start":{"line":44,"column":3},"end":{"line":44,"column":19}},"22":{"start":{"line":48,"column":1},"end":{"line":51,"column":4}},"23":{"start":{"line":49,"column":2},"end":{"line":49,"column":33}},"24":{"start":{"line":50,"column":2},"end":{"line":50,"column":30}},"25":{"start":{"line":53,"column":1},"end":{"line":79,"column":4}},"26":{"start":{"line":54,"column":2},"end":{"line":56,"column":3}},"27":{"start":{"line":55,"column":3},"end":{"line":55,"column":17}},"28":{"start":{"line":57,"column":2},"end":{"line":60,"column":3}},"29":{"start":{"line":58,"column":3},"end":{"line":58,"column":35}},"30":{"start":{"line":59,"column":3},"end":{"line":59,"column":17}},"31":{"start":{"line":61,"column":2},"end":{"line":61,"column":18}},"32":{"start":{"line":62,"column":8},"end":{"line":78,"column":11}},"33":{"start":{"line":63,"column":12},"end":{"line":65,"column":13}},"34":{"start":{"line":64,"column":16},"end":{"line":64,"column":33}},"35":{"start":{"line":66,"column":12},"end":{"line":77,"column":15}},"36":{"start":{"line":67,"column":16},"end":{"line":69,"column":17}},"37":{"start":{"line":68,"column":20},"end":{"line":68,"column":37}},"38":{"start":{"line":71,"column":16},"end":{"line":71,"column":43}},"39":{"start":{"line":74,"column":4},"end":{"line":74,"column":32}},"40":{"start":{"line":76,"column":16},"end":{"line":76,"column":23}},"41":{"start":{"line":80,"column":1},"end":{"line":80,"column":30}},"42":{"start":{"line":86,"column":0},"end":{"line":90,"column":2}},"43":{"start":{"line":87,"column":1},"end":{"line":87,"column":21}},"44":{"start":{"line":88,"column":1},"end":{"line":88,"column":59}},"45":{"start":{"line":89,"column":1},"end":{"line":89,"column":14}},"46":{"start":{"line":101,"column":0},"end":{"line":107,"column":2}},"47":{"start":{"line":102,"column":1},"end":{"line":102,"column":37}},"48":{"start":{"line":102,"column":27},"end":{"line":102,"column":37}},"49":{"start":{"line":103,"column":1},"end":{"line":103,"column":45}},"50":{"start":{"line":104,"column":1},"end":{"line":104,"column":16}},"51":{"start":{"line":105,"column":1},"end":{"line":105,"column":44}},"52":{"start":{"line":105,"column":31},"end":{"line":105,"column":44}},"53":{"start":{"line":106,"column":1},"end":{"line":106,"column":14}},"54":{"start":{"line":114,"column":0},"end":{"line":119,"column":2}},"55":{"start":{"line":115,"column":1},"end":{"line":115,"column":105}},"56":{"start":{"line":115,"column":37},"end":{"line":115,"column":105}},"57":{"start":{"line":116,"column":1},"end":{"line":116,"column":33}},"58":{"start":{"line":117,"column":1},"end":{"line":117,"column":42}},"59":{"start":{"line":117,"column":13},"end":{"line":117,"column":42}},"60":{"start":{"line":118,"column":1},"end":{"line":118,"column":58}},"61":{"start":{"line":130,"column":0},"end":{"line":136,"column":2}},"62":{"start":{"line":131,"column":1},"end":{"line":133,"column":2}},"63":{"start":{"line":132,"column":2},"end":{"line":132,"column":69}},"64":{"start":{"line":134,"column":1},"end":{"line":134,"column":92}},"65":{"start":{"line":134,"column":80},"end":{"line":134,"column":92}},"66":{"start":{"line":135,"column":1},"end":{"line":135,"column":32}},"67":{"start":{"line":145,"column":0},"end":{"line":151,"column":2}},"68":{"start":{"line":146,"column":1},"end":{"line":150,"column":2}},"69":{"start":{"line":147,"column":2},"end":{"line":147,"column":39}},"70":{"start":{"line":148,"column":8},"end":{"line":150,"column":2}},"71":{"start":{"line":149,"column":2},"end":{"line":149,"column":51}},"72":{"start":{"line":154,"column":0},"end":{"line":154,"column":36}}},"branchMap":{"1":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":19},"end":{"line":18,"column":37}},{"start":{"line":18,"column":41},"end":{"line":18,"column":43}}]},"2":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":8},"end":{"line":36,"column":29}},{"start":{"line":36,"column":33},"end":{"line":36,"column":59}}]},"3":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":11},"end":{"line":37,"column":35}},{"start":{"line":37,"column":39},"end":{"line":37,"column":68}}]},"4":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":2},"end":{"line":54,"column":2}},{"start":{"line":54,"column":2},"end":{"line":54,"column":2}}]},"5":{"line":54,"type":"binary-expr","locations":[{"start":{"line":54,"column":6},"end":{"line":54,"column":34}},{"start":{"line":54,"column":38},"end":{"line":54,"column":58}}]},"6":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":2},"end":{"line":57,"column":2}},{"start":{"line":57,"column":2},"end":{"line":57,"column":2}}]},"7":{"line":63,"type":"if","locations":[{"start":{"line":63,"column":12},"end":{"line":63,"column":12}},{"start":{"line":63,"column":12},"end":{"line":63,"column":12}}]},"8":{"line":67,"type":"if","locations":[{"start":{"line":67,"column":16},"end":{"line":67,"column":16}},{"start":{"line":67,"column":16},"end":{"line":67,"column":16}}]},"9":{"line":87,"type":"binary-expr","locations":[{"start":{"line":87,"column":9},"end":{"line":87,"column":14}},{"start":{"line":87,"column":18},"end":{"line":87,"column":20}}]},"10":{"line":88,"type":"cond-expr","locations":[{"start":{"line":88,"column":38},"end":{"line":88,"column":51}},{"start":{"line":88,"column":54},"end":{"line":88,"column":58}}]},"11":{"line":102,"type":"if","locations":[{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},{"start":{"line":102,"column":1},"end":{"line":102,"column":1}}]},"12":{"line":115,"type":"if","locations":[{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},{"start":{"line":115,"column":1},"end":{"line":115,"column":1}}]},"13":{"line":117,"type":"if","locations":[{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},{"start":{"line":117,"column":1},"end":{"line":117,"column":1}}]},"14":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":1},"end":{"line":131,"column":1}},{"start":{"line":131,"column":1},"end":{"line":131,"column":1}}]},"15":{"line":131,"type":"binary-expr","locations":[{"start":{"line":131,"column":5},"end":{"line":131,"column":20}},{"start":{"line":131,"column":24},"end":{"line":131,"column":50}}]},"16":{"line":132,"type":"cond-expr","locations":[{"start":{"line":132,"column":56},"end":{"line":132,"column":60}},{"start":{"line":132,"column":63},"end":{"line":132,"column":68}}]},"17":{"line":134,"type":"if","locations":[{"start":{"line":134,"column":1},"end":{"line":134,"column":1}},{"start":{"line":134,"column":1},"end":{"line":134,"column":1}}]},"18":{"line":134,"type":"binary-expr","locations":[{"start":{"line":134,"column":5},"end":{"line":134,"column":20}},{"start":{"line":134,"column":24},"end":{"line":134,"column":45}},{"start":{"line":134,"column":50},"end":{"line":134,"column":54}},{"start":{"line":134,"column":58},"end":{"line":134,"column":77}}]},"19":{"line":135,"type":"cond-expr","locations":[{"start":{"line":135,"column":19},"end":{"line":135,"column":24}},{"start":{"line":135,"column":27},"end":{"line":135,"column":31}}]},"20":{"line":146,"type":"if","locations":[{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},{"start":{"line":146,"column":1},"end":{"line":146,"column":1}}]},"21":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":8},"end":{"line":148,"column":8}},{"start":{"line":148,"column":8},"end":{"line":148,"column":8}}]}},"code":["var _ = require('underscore');","var bcrypt = require('bcrypt-nodejs');","var FieldType = require('../Type');","var util = require('util');","","/**"," * password FieldType Constructor"," * @extends Field"," * @api public"," */","function password(list, path, options) {","\tthis._nativeType = String;","\tthis._underscoreMethods = ['format', 'compare'];","\tthis._fixedSize = 'large';","\t// You can't sort on password fields","\toptions.nosort = true;","\toptions.nofilter = true; // TODO: remove this when 0.4 is merged","\tthis.workFactor = options.workFactor || 10;","\tpassword.super_.call(this, list, path, options);","}","util.inherits(password, FieldType);","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * Adds ..."," *"," * @api public"," */","password.prototype.addToSchema = function() {","\tvar field = this;","\tvar schema = this.list.schema;","\tvar needs_hashing = '__' + field.path + '_needs_hashing';","","\tthis.paths = {","\t\thash: this.options.hashPath || this._path.append('_hash'),","\t\tconfirm: this.options.confirmPath || this._path.append('_confirm')","\t};","","\tschema.path(this.path, _.defaults({","\t\ttype: String,","\t\tset: function(newValue) {","\t\t\tthis[needs_hashing] = true;","\t\t\treturn newValue;","\t\t}","\t}, this.options));","","\tschema.virtual(this.paths.hash).set(function(newValue) {","\t\tthis.set(field.path, newValue);","\t\tthis[needs_hashing] = false;","\t});","","\tschema.pre('save', function(next) {","\t\tif (!this.isModified(field.path) || !this[needs_hashing]) {","\t\t\treturn next();","\t\t}","\t\tif (!this.get(field.path)) {","\t\t\tthis.set(field.path, undefined);","\t\t\treturn next();","\t\t}","\t\tvar item = this;","        bcrypt.genSalt(field.workFactor, function(err, salt) {","            if (err) {","                return next(err);","            }","            bcrypt.hash(item.get(field.path), salt, function () {}, function(err, hash) {","                if (err) {","                    return next(err);","                }","                // override the cleartext password with the hashed one","                item.set(field.path, hash);","                // reset the [needs_hashing] flag so that new values can't be hashed more than once","\t\t\t\t// (inherited models double up on pre save handlers for password fields)","\t\t\t\titem[needs_hashing] = false;","","                next();","            });","        });","\t});","\tthis.bindUnderscoreMethods();","};","","/**"," * Add filters to a query"," */","password.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tquery[this.path] = (filter.exists) ? { $ne: null } : null;","\treturn query;","};","","/**"," * Formats the field value"," *"," * Password fields are always formatted as a random no. of asterisks,"," * because the saved hash should never be displayed nor the length"," * of the actual password hinted at."," *"," * @api public"," */","password.prototype.format = function(item) {","\tif (!item.get(this.path)) return '';","\tvar len = Math.round(Math.random() * 4) + 6;","\tvar stars = '';","\tfor (var i = 0; i < len; i++) stars += '*';","\treturn stars;","};","","/**"," * Compares"," *"," * @api public"," */","password.prototype.compare = function(item, candidate, callback) {","\tif ('function' !== typeof callback) throw new Error('Password.compare() requires a callback function.');","\tvar value = item.get(this.path);","\tif (!value) return callback(null, false);","\tbcrypt.compare(candidate, item.get(this.path), callback);","};","","/**"," * If password fields are required, check that either a value has been"," * provided or already exists in the field."," *"," * Otherwise, input is always considered valid, as providing an empty"," * value will not change the password."," *"," * @api public"," */","password.prototype.validateInput = function(data, required, item) {","\tif (data[this.path] && this.paths.confirm in data) {","\t\treturn data[this.path] === data[this.paths.confirm] ? true : false;","\t}","\tif (data[this.path] || data[this.paths.hash] || (item && item.get(this.path))) return true;","\treturn required ? false : true;","};","","/**"," * Updates the value for this field in the item from a data object"," *"," * Will accept either the field path, or paths.hash to bypass bcrypt"," *"," * @api public"," */","password.prototype.updateItem = function(item, data) {","\tif (this.path in data) {","\t\titem.set(this.path, data[this.path]);","\t} else if (this.paths.hash in data) {","\t\titem.set(this.paths.hash, data[this.paths.hash]);","\t}","};","","/* Export Field Type */","exports = module.exports = password;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"16":0,"17":0,"18":0,"19":0,"21":1,"30":1,"31":0,"32":0,"33":0,"35":0,"40":0,"43":0,"44":0,"48":0,"49":0,"50":0,"53":0,"54":0,"55":0,"57":0,"58":0,"59":0,"61":0,"62":0,"63":0,"64":0,"66":0,"67":0,"68":0,"71":0,"74":0,"76":0,"80":0,"86":1,"87":0,"88":0,"89":0,"101":1,"102":0,"103":0,"104":0,"105":0,"106":0,"114":1,"115":0,"116":0,"117":0,"118":0,"130":1,"131":0,"132":0,"134":0,"135":0,"145":1,"146":0,"147":0,"148":0,"149":0,"154":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/relationship/RelationshipType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/relationship/RelationshipType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":1,"15":1,"16":0,"17":0,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":1,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":1,"46":0,"47":0,"48":1,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":1,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":1,"77":0,"78":1,"79":0,"80":1,"81":0,"82":1,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0,0,0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},"fnMap":{"1":{"name":"relationship","line":12,"loc":{"start":{"line":12,"column":0},"end":{"line":12,"column":43}}},"2":{"name":"(anonymous_2)","line":26,"loc":{"start":{"line":26,"column":39},"end":{"line":26,"column":51}}},"3":{"name":"(anonymous_3)","line":40,"loc":{"start":{"line":40,"column":37},"end":{"line":40,"column":48}}},"4":{"name":"(anonymous_4)","line":54,"loc":{"start":{"line":54,"column":40},"end":{"line":54,"column":52}}},"5":{"name":"(anonymous_5)","line":58,"loc":{"start":{"line":58,"column":36},"end":{"line":58,"column":51}}},"6":{"name":"(anonymous_6)","line":63,"loc":{"start":{"line":63,"column":30},"end":{"line":63,"column":46}}},"7":{"name":"(anonymous_7)","line":75,"loc":{"start":{"line":75,"column":42},"end":{"line":75,"column":66}}},"8":{"name":"(anonymous_8)","line":96,"loc":{"start":{"line":96,"column":32},"end":{"line":96,"column":47}}},"9":{"name":"(anonymous_9)","line":105,"loc":{"start":{"line":105,"column":39},"end":{"line":105,"column":70}}},"10":{"name":"(anonymous_10)","line":120,"loc":{"start":{"line":120,"column":36},"end":{"line":120,"column":57}}},"11":{"name":"(anonymous_11)","line":129,"loc":{"start":{"line":129,"column":21},"end":{"line":129,"column":33}}},"12":{"name":"(anonymous_12)","line":154,"loc":{"start":{"line":154,"column":6},"end":{"line":154,"column":17}}},"13":{"name":"(anonymous_13)","line":163,"loc":{"start":{"line":163,"column":6},"end":{"line":163,"column":17}}},"14":{"name":"(anonymous_14)","line":172,"loc":{"start":{"line":172,"column":6},"end":{"line":172,"column":17}}},"15":{"name":"(anonymous_15)","line":181,"loc":{"start":{"line":181,"column":36},"end":{"line":181,"column":58}}},"16":{"name":"(anonymous_16)","line":182,"loc":{"start":{"line":182,"column":22},"end":{"line":182,"column":46}}},"17":{"name":"(anonymous_17)","line":187,"loc":{"start":{"line":187,"column":18},"end":{"line":187,"column":42}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":36}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":38}},"6":{"start":{"line":12,"column":0},"end":{"line":20,"column":1}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":43}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":32}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":50}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":60}},"11":{"start":{"line":17,"column":1},"end":{"line":17,"column":38}},"12":{"start":{"line":18,"column":1},"end":{"line":18,"column":51}},"13":{"start":{"line":19,"column":1},"end":{"line":19,"column":53}},"14":{"start":{"line":21,"column":0},"end":{"line":21,"column":39}},"15":{"start":{"line":26,"column":0},"end":{"line":35,"column":2}},"16":{"start":{"line":27,"column":1},"end":{"line":27,"column":28}},"17":{"start":{"line":28,"column":1},"end":{"line":34,"column":3}},"18":{"start":{"line":40,"column":0},"end":{"line":70,"column":2}},"19":{"start":{"line":41,"column":1},"end":{"line":41,"column":18}},"20":{"start":{"line":42,"column":1},"end":{"line":42,"column":31}},"21":{"start":{"line":43,"column":1},"end":{"line":49,"column":3}},"22":{"start":{"line":50,"column":1},"end":{"line":52,"column":3}},"23":{"start":{"line":53,"column":1},"end":{"line":53,"column":49}},"24":{"start":{"line":54,"column":1},"end":{"line":56,"column":4}},"25":{"start":{"line":55,"column":2},"end":{"line":55,"column":42}},"26":{"start":{"line":57,"column":1},"end":{"line":68,"column":2}},"27":{"start":{"line":58,"column":2},"end":{"line":67,"column":5}},"28":{"start":{"line":59,"column":3},"end":{"line":59,"column":66}},"29":{"start":{"line":60,"column":3},"end":{"line":62,"column":4}},"30":{"start":{"line":61,"column":4},"end":{"line":61,"column":19}},"31":{"start":{"line":63,"column":3},"end":{"line":65,"column":6}},"32":{"start":{"line":64,"column":4},"end":{"line":64,"column":33}},"33":{"start":{"line":66,"column":3},"end":{"line":66,"column":17}},"34":{"start":{"line":69,"column":1},"end":{"line":69,"column":30}},"35":{"start":{"line":75,"column":0},"end":{"line":91,"column":2}},"36":{"start":{"line":76,"column":1},"end":{"line":76,"column":21}},"37":{"start":{"line":77,"column":1},"end":{"line":89,"column":2}},"38":{"start":{"line":78,"column":2},"end":{"line":82,"column":3}},"39":{"start":{"line":79,"column":3},"end":{"line":79,"column":92}},"40":{"start":{"line":81,"column":3},"end":{"line":81,"column":79}},"41":{"start":{"line":84,"column":2},"end":{"line":88,"column":3}},"42":{"start":{"line":85,"column":3},"end":{"line":85,"column":78}},"43":{"start":{"line":87,"column":3},"end":{"line":87,"column":62}},"44":{"start":{"line":90,"column":1},"end":{"line":90,"column":14}},"45":{"start":{"line":96,"column":0},"end":{"line":100,"column":2}},"46":{"start":{"line":97,"column":1},"end":{"line":97,"column":33}},"47":{"start":{"line":99,"column":1},"end":{"line":99,"column":58}},"48":{"start":{"line":105,"column":0},"end":{"line":113,"column":2}},"49":{"start":{"line":106,"column":1},"end":{"line":106,"column":28}},"50":{"start":{"line":106,"column":16},"end":{"line":106,"column":28}},"51":{"start":{"line":107,"column":1},"end":{"line":107,"column":117}},"52":{"start":{"line":107,"column":105},"end":{"line":107,"column":117}},"53":{"start":{"line":108,"column":1},"end":{"line":112,"column":2}},"54":{"start":{"line":109,"column":2},"end":{"line":109,"column":49}},"55":{"start":{"line":111,"column":2},"end":{"line":111,"column":42}},"56":{"start":{"line":120,"column":0},"end":{"line":148,"column":2}},"57":{"start":{"line":121,"column":1},"end":{"line":123,"column":2}},"58":{"start":{"line":122,"column":2},"end":{"line":122,"column":9}},"59":{"start":{"line":124,"column":1},"end":{"line":126,"column":2}},"60":{"start":{"line":125,"column":2},"end":{"line":125,"column":109}},"61":{"start":{"line":127,"column":1},"end":{"line":147,"column":2}},"62":{"start":{"line":128,"column":2},"end":{"line":128,"column":32}},"63":{"start":{"line":129,"column":2},"end":{"line":129,"column":56}},"64":{"start":{"line":129,"column":35},"end":{"line":129,"column":52}},"65":{"start":{"line":130,"column":2},"end":{"line":130,"column":29}},"66":{"start":{"line":131,"column":2},"end":{"line":133,"column":3}},"67":{"start":{"line":132,"column":3},"end":{"line":132,"column":40}},"68":{"start":{"line":134,"column":2},"end":{"line":134,"column":25}},"69":{"start":{"line":136,"column":2},"end":{"line":138,"column":3}},"70":{"start":{"line":137,"column":3},"end":{"line":137,"column":29}},"71":{"start":{"line":140,"column":2},"end":{"line":146,"column":3}},"72":{"start":{"line":141,"column":3},"end":{"line":143,"column":4}},"73":{"start":{"line":142,"column":4},"end":{"line":142,"column":41}},"74":{"start":{"line":144,"column":9},"end":{"line":146,"column":3}},"75":{"start":{"line":145,"column":3},"end":{"line":145,"column":29}},"76":{"start":{"line":153,"column":0},"end":{"line":157,"column":3}},"77":{"start":{"line":155,"column":2},"end":{"line":155,"column":56}},"78":{"start":{"line":162,"column":0},"end":{"line":166,"column":3}},"79":{"start":{"line":164,"column":2},"end":{"line":164,"column":41}},"80":{"start":{"line":171,"column":0},"end":{"line":175,"column":3}},"81":{"start":{"line":173,"column":2},"end":{"line":173,"column":55}},"82":{"start":{"line":181,"column":0},"end":{"line":197,"column":2}},"83":{"start":{"line":182,"column":1},"end":{"line":196,"column":4}},"84":{"start":{"line":183,"column":2},"end":{"line":185,"column":3}},"85":{"start":{"line":184,"column":3},"end":{"line":184,"column":33}},"86":{"start":{"line":186,"column":2},"end":{"line":186,"column":20}},"87":{"start":{"line":187,"column":2},"end":{"line":195,"column":5}},"88":{"start":{"line":188,"column":3},"end":{"line":193,"column":4}},"89":{"start":{"line":189,"column":4},"end":{"line":191,"column":5}},"90":{"start":{"line":190,"column":5},"end":{"line":190,"column":12}},"91":{"start":{"line":192,"column":4},"end":{"line":192,"column":38}},"92":{"start":{"line":194,"column":3},"end":{"line":194,"column":24}},"93":{"start":{"line":200,"column":0},"end":{"line":200,"column":40}}},"branchMap":{"1":{"line":13,"type":"cond-expr","locations":[{"start":{"line":13,"column":30},"end":{"line":13,"column":34}},{"start":{"line":13,"column":37},"end":{"line":13,"column":42}}]},"2":{"line":15,"type":"cond-expr","locations":[{"start":{"line":15,"column":33},"end":{"line":15,"column":39}},{"start":{"line":15,"column":42},"end":{"line":15,"column":49}}]},"3":{"line":46,"type":"cond-expr","locations":[{"start":{"line":46,"column":31},"end":{"line":46,"column":35}},{"start":{"line":46,"column":38},"end":{"line":46,"column":43}}]},"4":{"line":47,"type":"cond-expr","locations":[{"start":{"line":47,"column":37},"end":{"line":47,"column":41}},{"start":{"line":47,"column":44},"end":{"line":47,"column":49}}]},"5":{"line":48,"type":"cond-expr","locations":[{"start":{"line":48,"column":33},"end":{"line":48,"column":37}},{"start":{"line":48,"column":40},"end":{"line":48,"column":45}}]},"6":{"line":51,"type":"binary-expr","locations":[{"start":{"line":51,"column":11},"end":{"line":51,"column":35}},{"start":{"line":51,"column":39},"end":{"line":51,"column":67}}]},"7":{"line":53,"type":"cond-expr","locations":[{"start":{"line":53,"column":36},"end":{"line":53,"column":41}},{"start":{"line":53,"column":44},"end":{"line":53,"column":47}}]},"8":{"line":57,"type":"if","locations":[{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},{"start":{"line":57,"column":1},"end":{"line":57,"column":1}}]},"9":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":15},"end":{"line":59,"column":41}},{"start":{"line":59,"column":45},"end":{"line":59,"column":65}}]},"10":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":3},"end":{"line":60,"column":3}},{"start":{"line":60,"column":3},"end":{"line":60,"column":3}}]},"11":{"line":76,"type":"binary-expr","locations":[{"start":{"line":76,"column":9},"end":{"line":76,"column":14}},{"start":{"line":76,"column":18},"end":{"line":76,"column":20}}]},"12":{"line":77,"type":"if","locations":[{"start":{"line":77,"column":1},"end":{"line":77,"column":1}},{"start":{"line":77,"column":1},"end":{"line":77,"column":1}}]},"13":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":2},"end":{"line":78,"column":2}},{"start":{"line":78,"column":2},"end":{"line":78,"column":2}}]},"14":{"line":79,"type":"cond-expr","locations":[{"start":{"line":79,"column":41},"end":{"line":79,"column":65}},{"start":{"line":79,"column":68},"end":{"line":79,"column":91}}]},"15":{"line":81,"type":"cond-expr","locations":[{"start":{"line":81,"column":41},"end":{"line":81,"column":63}},{"start":{"line":81,"column":66},"end":{"line":81,"column":78}}]},"16":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":2},"end":{"line":84,"column":2}},{"start":{"line":84,"column":2},"end":{"line":84,"column":2}}]},"17":{"line":85,"type":"cond-expr","locations":[{"start":{"line":85,"column":41},"end":{"line":85,"column":62}},{"start":{"line":85,"column":65},"end":{"line":85,"column":77}}]},"18":{"line":87,"type":"cond-expr","locations":[{"start":{"line":87,"column":41},"end":{"line":87,"column":54}},{"start":{"line":87,"column":57},"end":{"line":87,"column":61}}]},"19":{"line":99,"type":"cond-expr","locations":[{"start":{"line":99,"column":20},"end":{"line":99,"column":36}},{"start":{"line":99,"column":39},"end":{"line":99,"column":57}}]},"20":{"line":99,"type":"binary-expr","locations":[{"start":{"line":99,"column":40},"end":{"line":99,"column":45}},{"start":{"line":99,"column":49},"end":{"line":99,"column":51}}]},"21":{"line":106,"type":"if","locations":[{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},{"start":{"line":106,"column":1},"end":{"line":106,"column":1}}]},"22":{"line":107,"type":"if","locations":[{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},{"start":{"line":107,"column":1},"end":{"line":107,"column":1}}]},"23":{"line":107,"type":"binary-expr","locations":[{"start":{"line":107,"column":5},"end":{"line":107,"column":25}},{"start":{"line":107,"column":29},"end":{"line":107,"column":33}},{"start":{"line":107,"column":39},"end":{"line":107,"column":48}},{"start":{"line":107,"column":52},"end":{"line":107,"column":78}},{"start":{"line":107,"column":83},"end":{"line":107,"column":102}}]},"24":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},{"start":{"line":108,"column":1},"end":{"line":108,"column":1}}]},"25":{"line":109,"type":"cond-expr","locations":[{"start":{"line":109,"column":36},"end":{"line":109,"column":40}},{"start":{"line":109,"column":43},"end":{"line":109,"column":48}}]},"26":{"line":111,"type":"cond-expr","locations":[{"start":{"line":111,"column":29},"end":{"line":111,"column":33}},{"start":{"line":111,"column":36},"end":{"line":111,"column":41}}]},"27":{"line":121,"type":"if","locations":[{"start":{"line":121,"column":1},"end":{"line":121,"column":1}},{"start":{"line":121,"column":1},"end":{"line":121,"column":1}}]},"28":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},{"start":{"line":124,"column":1},"end":{"line":124,"column":1}}]},"29":{"line":127,"type":"if","locations":[{"start":{"line":127,"column":1},"end":{"line":127,"column":1}},{"start":{"line":127,"column":1},"end":{"line":127,"column":1}}]},"30":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":2},"end":{"line":131,"column":2}},{"start":{"line":131,"column":2},"end":{"line":131,"column":2}}]},"31":{"line":132,"type":"binary-expr","locations":[{"start":{"line":132,"column":17},"end":{"line":132,"column":21}},{"start":{"line":132,"column":25},"end":{"line":132,"column":27}}]},"32":{"line":136,"type":"if","locations":[{"start":{"line":136,"column":2},"end":{"line":136,"column":2}},{"start":{"line":136,"column":2},"end":{"line":136,"column":2}}]},"33":{"line":140,"type":"if","locations":[{"start":{"line":140,"column":2},"end":{"line":140,"column":2}},{"start":{"line":140,"column":2},"end":{"line":140,"column":2}}]},"34":{"line":141,"type":"if","locations":[{"start":{"line":141,"column":3},"end":{"line":141,"column":3}},{"start":{"line":141,"column":3},"end":{"line":141,"column":3}}]},"35":{"line":144,"type":"if","locations":[{"start":{"line":144,"column":9},"end":{"line":144,"column":9}},{"start":{"line":144,"column":9},"end":{"line":144,"column":9}}]},"36":{"line":155,"type":"cond-expr","locations":[{"start":{"line":155,"column":43},"end":{"line":155,"column":47}},{"start":{"line":155,"column":50},"end":{"line":155,"column":55}}]},"37":{"line":173,"type":"binary-expr","locations":[{"start":{"line":173,"column":10},"end":{"line":173,"column":22}},{"start":{"line":173,"column":26},"end":{"line":173,"column":53}}]},"38":{"line":183,"type":"if","locations":[{"start":{"line":183,"column":2},"end":{"line":183,"column":2}},{"start":{"line":183,"column":2},"end":{"line":183,"column":2}}]},"39":{"line":188,"type":"if","locations":[{"start":{"line":188,"column":3},"end":{"line":188,"column":3}},{"start":{"line":188,"column":3},"end":{"line":188,"column":3}}]},"40":{"line":188,"type":"binary-expr","locations":[{"start":{"line":188,"column":7},"end":{"line":188,"column":32}},{"start":{"line":188,"column":36},"end":{"line":188,"column":62}}]},"41":{"line":189,"type":"if","locations":[{"start":{"line":189,"column":4},"end":{"line":189,"column":4}},{"start":{"line":189,"column":4},"end":{"line":189,"column":4}}]}},"code":["var _ = require('underscore');","var FieldType = require('../Type');","var keystone = require('../../../');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Relationship FieldType Constructor"," * @extends Field"," * @api public"," */","function relationship(list, path, options) {","\tthis.many = (options.many) ? true : false;","\tthis.filters = options.filters;","\tthis._defaultSize = this.many ? 'full' : 'large';","\tthis._nativeType = keystone.mongoose.Schema.Types.ObjectId;","\tthis._underscoreMethods = ['format'];","\tthis._properties = ['isValid', 'many', 'filters'];","\trelationship.super_.call(this, list, path, options);","}","util.inherits(relationship, FieldType);","","/**"," * Get client-side properties to pass to react field."," */","relationship.prototype.getProperties = function () {","\tvar refList = this.refList;","\treturn {","\t\trefList: {","\t\t\tsingular: refList.singular,","\t\t\tplural:   refList.plural,","\t\t\tpath:     refList.path","\t\t}","\t};","};","","/**"," * Registers the field on the List's Mongoose Schema."," */","relationship.prototype.addToSchema = function() {","\tvar field = this;","\tvar schema = this.list.schema;","\tvar def = {","\t\ttype: this._nativeType,","\t\tref: this.options.ref,","\t\tindex: (this.options.index ? true : false),","\t\trequired: (this.options.required ? true : false),","\t\tunique: (this.options.unique ? true : false)","\t};","\tthis.paths = {","\t\trefList: this.options.refListPath || this._path.append('RefList')","\t};","\tschema.path(this.path, this.many ? [def] : def);","\tschema.virtual(this.paths.refList).get(function () {","\t\treturn keystone.list(field.options.ref);","\t});","\tif (this.many) {","\t\tthis.underscoreMethod('contains', function(find) {","\t\t\tvar value = this.populated(field.path) || this.get(field.path);","\t\t\tif ('object' === typeof find) {","\t\t\t\tfind = find.id;","\t\t\t}","\t\t\tvar result = _.some(value, function(value) {","\t\t\t\treturn (value + '' === find);","\t\t\t});","\t\t\treturn result;","\t\t});","\t}","\tthis.bindUnderscoreMethods();","};","","/**"," * Add filters to a query"," */","relationship.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tif (this.many) {","\t\tif (filter.value) {","\t\t\tquery[this.path] = (filter.inverse) ? { $nin: [filter.value] } : { $in: [filter.value] };","\t\t} else {","\t\t\tquery[this.path] = (filter.inverse) ? { $not: { $size: 0 } } : { $size: 0 };","\t\t}","\t} else {","\t\tif (filter.value) {","\t\t\tquery[this.path] = (filter.inverse) ? { $ne: filter.value } : filter.value;","\t\t} else {","\t\t\tquery[this.path] = (filter.inverse) ? { $ne: null } : null;","\t\t}","\t}","\treturn query;","};","","/**"," * Formats the field value"," */","relationship.prototype.format = function(item) {","\tvar value = item.get(this.path);","\t// force the formatted value to be a string - unexpected things happen with ObjectIds.","\treturn this.many ? value.join(', ') : (value || '') + '';","};","","/**"," * Validates that a value for this field has been provided in a data object"," */","relationship.prototype.validateInput = function(data, required, item) {","\tif (!required) return true;","\tif (!(this.path in data) && item && ((this.many && item.get(this.path).length) || item.get(this.path))) return true;","\tif ('string' === typeof data[this.path]) {","\t\treturn (data[this.path].trim()) ? true : false;","\t} else {","\t\treturn (data[this.path]) ? true : false;","\t}","};","","/**"," * Updates the value for this field in the item from a data object."," * Only updates the value if it has changed."," * Treats an empty string as a null value."," */","relationship.prototype.updateItem = function(item, data) {","\tif (!(this.path in data)) {","\t\treturn;","\t}","\tif (item.populated(this.path)) {","\t\tthrow new Error('fieldTypes.relationship.updateItem() Error - You cannot update populated relationships.');","\t}","\tif (this.many) {","\t\tvar arr = item.get(this.path);","\t\tvar _old = arr.map(function(i) { return String(i); });","\t\tvar _new = data[this.path];","\t\tif (!utils.isArray(_new)) {","\t\t\t_new = String(_new || '').split(',');","\t\t}","\t\t_new = _.compact(_new);","\t\t// Only update if the lists aren't the same","\t\tif (!_.isEqual(_old, _new)) {","\t\t\titem.set(this.path, _new);","\t\t}","\t} else {","\t\tif (data[this.path]) {","\t\t\tif (data[this.path] !== item.get(this.path)) {","\t\t\t\titem.set(this.path, data[this.path]);","\t\t\t}","\t\t} else if (item.get(this.path)) {","\t\t\titem.set(this.path, null);","\t\t}","\t}","};","","/**"," * Returns true if the relationship configuration is valid"," */","Object.defineProperty(relationship.prototype, 'isValid', {","\tget: function() {","\t\treturn keystone.list(this.options.ref) ? true : false;","\t}","});","","/**"," * Returns the Related List"," */","Object.defineProperty(relationship.prototype, 'refList', {","\tget: function() {","\t\treturn keystone.list(this.options.ref);","\t}","});","","/**"," * Whether the field has any filters defined"," */","Object.defineProperty(relationship.prototype, 'hasFilters', {","\tget: function() {","\t\treturn (this.filters && _.keys(this.filters).length);","\t}","});","","/**"," * Adds relationship filters to a query"," */","// TODO: Deprecate this? Not sure it's used anywhere - JW","relationship.prototype.addFilters = function(query, item) {","\t_.each(this.filters, function(filters, path) {","\t\tif (!utils.isObject(filters)) {","\t\t\tfilters = { equals: filters };","\t\t}","\t\tquery.where(path);","\t\t_.each(filters, function(value, method) {","\t\t\tif ('string' === typeof value && value.substr(0, 1) === ':') {","\t\t\t\tif (!item) {","\t\t\t\t\treturn;","\t\t\t\t}","\t\t\t\tvalue = item.get(value.substr(1));","\t\t\t}","\t\t\tquery[method](value);","\t\t});","\t});","};","","/* Export Field Type */","exports = module.exports = relationship;",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"12":1,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"21":1,"26":1,"27":0,"28":0,"40":1,"41":0,"42":0,"43":0,"50":0,"53":0,"54":0,"55":0,"57":0,"58":0,"59":0,"60":0,"61":0,"63":0,"64":0,"66":0,"69":0,"75":1,"76":0,"77":0,"78":0,"79":0,"81":0,"84":0,"85":0,"87":0,"90":0,"96":1,"97":0,"99":0,"105":1,"106":0,"107":0,"108":0,"109":0,"111":0,"120":1,"121":0,"122":0,"124":0,"125":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"134":0,"136":0,"137":0,"140":0,"141":0,"142":0,"144":0,"145":0,"153":1,"155":0,"162":1,"164":0,"171":1,"173":0,"181":1,"182":0,"183":0,"184":0,"186":0,"187":0,"188":0,"189":0,"190":0,"192":0,"194":0,"200":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/s3file/S3FileType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/s3file/S3FileType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":1,"15":1,"16":0,"17":1,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":1,"42":0,"43":0,"44":0,"45":1,"46":0,"47":1,"48":0,"49":1,"50":0,"51":1,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":1,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":1,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":1,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":1,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"153":0,"154":1,"155":0,"156":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0],"45":[0,0],"46":[0,0],"47":[0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0},"fnMap":{"1":{"name":"s3file","line":21,"loc":{"start":{"line":21,"column":0},"end":{"line":21,"column":37}}},"2":{"name":"(anonymous_2)","line":63,"loc":{"start":{"line":63,"column":6},"end":{"line":63,"column":17}}},"3":{"name":"(anonymous_3)","line":75,"loc":{"start":{"line":75,"column":31},"end":{"line":75,"column":42}}},"4":{"name":"(anonymous_4)","line":105,"loc":{"start":{"line":105,"column":14},"end":{"line":105,"column":29}}},"5":{"name":"(anonymous_5)","line":110,"loc":{"start":{"line":110,"column":34},"end":{"line":110,"column":45}}},"6":{"name":"(anonymous_6)","line":114,"loc":{"start":{"line":114,"column":13},"end":{"line":114,"column":28}}},"7":{"name":"(anonymous_7)","line":126,"loc":{"start":{"line":126,"column":10},"end":{"line":126,"column":21}}},"8":{"name":"(anonymous_8)","line":134,"loc":{"start":{"line":134,"column":9},"end":{"line":134,"column":20}}},"9":{"name":"(anonymous_9)","line":142,"loc":{"start":{"line":142,"column":10},"end":{"line":142,"column":21}}},"10":{"name":"(anonymous_10)","line":145,"loc":{"start":{"line":145,"column":71},"end":{"line":145,"column":89}}},"11":{"name":"(anonymous_11)","line":151,"loc":{"start":{"line":151,"column":23},"end":{"line":151,"column":41}}},"12":{"name":"(anonymous_12)","line":156,"loc":{"start":{"line":156,"column":14},"end":{"line":156,"column":37}}},"13":{"name":"(anonymous_13)","line":170,"loc":{"start":{"line":170,"column":26},"end":{"line":170,"column":41}}},"14":{"name":"(anonymous_14)","line":184,"loc":{"start":{"line":184,"column":32},"end":{"line":184,"column":43}}},"15":{"name":"(anonymous_15)","line":195,"loc":{"start":{"line":195,"column":30},"end":{"line":195,"column":45}}},"16":{"name":"(anonymous_16)","line":206,"loc":{"start":{"line":206,"column":33},"end":{"line":206,"column":48}}},"17":{"name":"(anonymous_17)","line":232,"loc":{"start":{"line":232,"column":21},"end":{"line":232,"column":48}}},"18":{"name":"(anonymous_18)","line":245,"loc":{"start":{"line":245,"column":41},"end":{"line":245,"column":55}}},"19":{"name":"(anonymous_19)","line":247,"loc":{"start":{"line":247,"column":22},"end":{"line":247,"column":36}}},"20":{"name":"(anonymous_20)","line":265,"loc":{"start":{"line":265,"column":22},"end":{"line":265,"column":50}}},"21":{"name":"(anonymous_21)","line":272,"loc":{"start":{"line":272,"column":17},"end":{"line":272,"column":38}}},"22":{"name":"(anonymous_22)","line":276,"loc":{"start":{"line":276,"column":18},"end":{"line":276,"column":35}}},"23":{"name":"(anonymous_23)","line":293,"loc":{"start":{"line":293,"column":35},"end":{"line":293,"column":66}}},"24":{"name":"(anonymous_24)","line":309,"loc":{"start":{"line":309,"column":26},"end":{"line":309,"column":43}}},"25":{"name":"(anonymous_25)","line":330,"loc":{"start":{"line":330,"column":28},"end":{"line":330,"column":45}}},"26":{"name":"(anonymous_26)","line":344,"loc":{"start":{"line":344,"column":25},"end":{"line":344,"column":42}}},"27":{"name":"(anonymous_27)","line":372,"loc":{"start":{"line":372,"column":30},"end":{"line":372,"column":69}}},"28":{"name":"(anonymous_28)","line":391,"loc":{"start":{"line":391,"column":16},"end":{"line":391,"column":27}}},"29":{"name":"(anonymous_29)","line":403,"loc":{"start":{"line":403,"column":81},"end":{"line":403,"column":100}}},"30":{"name":"(anonymous_30)","line":435,"loc":{"start":{"line":435,"column":41},"end":{"line":435,"column":55}}},"31":{"name":"(anonymous_31)","line":453,"loc":{"start":{"line":453,"column":37},"end":{"line":453,"column":74}}},"32":{"name":"(anonymous_32)","line":464,"loc":{"start":{"line":464,"column":24},"end":{"line":464,"column":35}}},"33":{"name":"(anonymous_33)","line":466,"loc":{"start":{"line":466,"column":8},"end":{"line":466,"column":19}}},"34":{"name":"(anonymous_34)","line":493,"loc":{"start":{"line":493,"column":33},"end":{"line":493,"column":70}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":13,"column":29}},"2":{"start":{"line":21,"column":0},"end":{"line":50,"column":1}},"3":{"start":{"line":22,"column":1},"end":{"line":23,"column":28}},"4":{"start":{"line":24,"column":1},"end":{"line":24,"column":52}},"5":{"start":{"line":25,"column":1},"end":{"line":25,"column":26}},"6":{"start":{"line":28,"column":1},"end":{"line":28,"column":25}},"7":{"start":{"line":31,"column":1},"end":{"line":34,"column":2}},"8":{"start":{"line":32,"column":2},"end":{"line":33,"column":109}},"9":{"start":{"line":36,"column":1},"end":{"line":36,"column":47}},"10":{"start":{"line":39,"column":1},"end":{"line":43,"column":2}},"11":{"start":{"line":40,"column":2},"end":{"line":42,"column":94}},"12":{"start":{"line":46,"column":1},"end":{"line":48,"column":2}},"13":{"start":{"line":47,"column":2},"end":{"line":47,"column":41}},"14":{"start":{"line":56,"column":0},"end":{"line":56,"column":30}},"15":{"start":{"line":62,"column":0},"end":{"line":66,"column":3}},"16":{"start":{"line":64,"column":2},"end":{"line":64,"column":60}},"17":{"start":{"line":75,"column":0},"end":{"line":161,"column":2}},"18":{"start":{"line":77,"column":1},"end":{"line":78,"column":28}},"19":{"start":{"line":80,"column":1},"end":{"line":92,"column":3}},"20":{"start":{"line":94,"column":1},"end":{"line":101,"column":4}},"21":{"start":{"line":103,"column":1},"end":{"line":103,"column":25}},"22":{"start":{"line":105,"column":1},"end":{"line":107,"column":3}},"23":{"start":{"line":106,"column":2},"end":{"line":106,"column":46}},"24":{"start":{"line":110,"column":1},"end":{"line":112,"column":4}},"25":{"start":{"line":111,"column":2},"end":{"line":111,"column":42}},"26":{"start":{"line":114,"column":1},"end":{"line":123,"column":3}},"27":{"start":{"line":115,"column":2},"end":{"line":122,"column":5}},"28":{"start":{"line":125,"column":1},"end":{"line":149,"column":3}},"29":{"start":{"line":127,"column":3},"end":{"line":127,"column":23}},"30":{"start":{"line":135,"column":3},"end":{"line":135,"column":15}},"31":{"start":{"line":143,"column":3},"end":{"line":146,"column":16}},"32":{"start":{"line":144,"column":4},"end":{"line":144,"column":51}},"33":{"start":{"line":145,"column":4},"end":{"line":145,"column":129}},"34":{"start":{"line":145,"column":91},"end":{"line":145,"column":125}},"35":{"start":{"line":147,"column":3},"end":{"line":147,"column":15}},"36":{"start":{"line":151,"column":1},"end":{"line":153,"column":4}},"37":{"start":{"line":152,"column":2},"end":{"line":152,"column":34}},"38":{"start":{"line":156,"column":1},"end":{"line":158,"column":3}},"39":{"start":{"line":157,"column":2},"end":{"line":157,"column":85}},"40":{"start":{"line":160,"column":1},"end":{"line":160,"column":30}},"41":{"start":{"line":170,"column":0},"end":{"line":175,"column":2}},"42":{"start":{"line":171,"column":1},"end":{"line":173,"column":2}},"43":{"start":{"line":172,"column":2},"end":{"line":172,"column":52}},"44":{"start":{"line":174,"column":1},"end":{"line":174,"column":33}},"45":{"start":{"line":184,"column":0},"end":{"line":186,"column":2}},"46":{"start":{"line":185,"column":1},"end":{"line":185,"column":50}},"47":{"start":{"line":195,"column":0},"end":{"line":197,"column":2}},"48":{"start":{"line":196,"column":1},"end":{"line":196,"column":40}},"49":{"start":{"line":206,"column":0},"end":{"line":209,"column":2}},"50":{"start":{"line":208,"column":1},"end":{"line":208,"column":13}},"51":{"start":{"line":232,"column":0},"end":{"line":254,"column":2}},"52":{"start":{"line":233,"column":1},"end":{"line":236,"column":15}},"53":{"start":{"line":238,"column":1},"end":{"line":240,"column":2}},"54":{"start":{"line":239,"column":2},"end":{"line":239,"column":135}},"55":{"start":{"line":241,"column":1},"end":{"line":243,"column":2}},"56":{"start":{"line":242,"column":2},"end":{"line":242,"column":136}},"57":{"start":{"line":245,"column":1},"end":{"line":245,"column":99}},"58":{"start":{"line":245,"column":57},"end":{"line":245,"column":95}},"59":{"start":{"line":247,"column":1},"end":{"line":251,"column":4}},"60":{"start":{"line":248,"column":2},"end":{"line":250,"column":3}},"61":{"start":{"line":249,"column":3},"end":{"line":249,"column":132}},"62":{"start":{"line":253,"column":1},"end":{"line":253,"column":13}},"63":{"start":{"line":265,"column":0},"end":{"line":281,"column":2}},"64":{"start":{"line":266,"column":1},"end":{"line":266,"column":19}},"65":{"start":{"line":268,"column":1},"end":{"line":270,"column":2}},"66":{"start":{"line":269,"column":2},"end":{"line":269,"column":112}},"67":{"start":{"line":272,"column":1},"end":{"line":274,"column":4}},"68":{"start":{"line":273,"column":2},"end":{"line":273,"column":45}},"69":{"start":{"line":276,"column":1},"end":{"line":278,"column":4}},"70":{"start":{"line":277,"column":2},"end":{"line":277,"column":35}},"71":{"start":{"line":280,"column":1},"end":{"line":280,"column":13}},"72":{"start":{"line":293,"column":0},"end":{"line":362,"column":2}},"73":{"start":{"line":294,"column":1},"end":{"line":303,"column":17}},"74":{"start":{"line":306,"column":1},"end":{"line":321,"column":2}},"75":{"start":{"line":307,"column":2},"end":{"line":307,"column":53}},"76":{"start":{"line":308,"column":2},"end":{"line":320,"column":3}},"77":{"start":{"line":309,"column":3},"end":{"line":315,"column":6}},"78":{"start":{"line":310,"column":4},"end":{"line":310,"column":21}},"79":{"start":{"line":311,"column":4},"end":{"line":314,"column":5}},"80":{"start":{"line":312,"column":5},"end":{"line":312,"column":41}},"81":{"start":{"line":313,"column":5},"end":{"line":313,"column":54}},"82":{"start":{"line":316,"column":9},"end":{"line":320,"column":3}},"83":{"start":{"line":317,"column":3},"end":{"line":317,"column":59}},"84":{"start":{"line":319,"column":3},"end":{"line":319,"column":145}},"85":{"start":{"line":323,"column":1},"end":{"line":354,"column":2}},"86":{"start":{"line":324,"column":2},"end":{"line":324,"column":40}},"87":{"start":{"line":326,"column":2},"end":{"line":353,"column":3}},"88":{"start":{"line":327,"column":3},"end":{"line":327,"column":59}},"89":{"start":{"line":329,"column":3},"end":{"line":341,"column":4}},"90":{"start":{"line":330,"column":4},"end":{"line":336,"column":7}},"91":{"start":{"line":331,"column":5},"end":{"line":331,"column":22}},"92":{"start":{"line":332,"column":5},"end":{"line":335,"column":6}},"93":{"start":{"line":333,"column":6},"end":{"line":333,"column":42}},"94":{"start":{"line":334,"column":6},"end":{"line":334,"column":55}},"95":{"start":{"line":337,"column":10},"end":{"line":341,"column":4}},"96":{"start":{"line":338,"column":4},"end":{"line":338,"column":61}},"97":{"start":{"line":340,"column":4},"end":{"line":340,"column":147}},"98":{"start":{"line":343,"column":9},"end":{"line":353,"column":3}},"99":{"start":{"line":344,"column":3},"end":{"line":350,"column":6}},"100":{"start":{"line":345,"column":4},"end":{"line":345,"column":21}},"101":{"start":{"line":346,"column":4},"end":{"line":349,"column":5}},"102":{"start":{"line":347,"column":5},"end":{"line":347,"column":41}},"103":{"start":{"line":348,"column":5},"end":{"line":348,"column":54}},"104":{"start":{"line":351,"column":9},"end":{"line":353,"column":3}},"105":{"start":{"line":352,"column":3},"end":{"line":352,"column":58}},"106":{"start":{"line":356,"column":1},"end":{"line":358,"column":2}},"107":{"start":{"line":357,"column":2},"end":{"line":357,"column":45}},"108":{"start":{"line":360,"column":1},"end":{"line":360,"column":16}},"109":{"start":{"line":372,"column":0},"end":{"line":440,"column":2}},"110":{"start":{"line":374,"column":1},"end":{"line":380,"column":10}},"111":{"start":{"line":382,"column":1},"end":{"line":385,"column":2}},"112":{"start":{"line":383,"column":2},"end":{"line":383,"column":20}},"113":{"start":{"line":384,"column":2},"end":{"line":384,"column":17}},"114":{"start":{"line":387,"column":1},"end":{"line":389,"column":2}},"115":{"start":{"line":388,"column":2},"end":{"line":388,"column":67}},"116":{"start":{"line":391,"column":1},"end":{"line":433,"column":3}},"117":{"start":{"line":393,"column":2},"end":{"line":395,"column":3}},"118":{"start":{"line":394,"column":3},"end":{"line":394,"column":41}},"119":{"start":{"line":397,"column":2},"end":{"line":399,"column":3}},"120":{"start":{"line":398,"column":3},"end":{"line":398,"column":67}},"121":{"start":{"line":401,"column":2},"end":{"line":401,"column":56}},"122":{"start":{"line":403,"column":2},"end":{"line":432,"column":5}},"123":{"start":{"line":405,"column":3},"end":{"line":405,"column":33}},"124":{"start":{"line":405,"column":12},"end":{"line":405,"column":33}},"125":{"start":{"line":406,"column":3},"end":{"line":412,"column":4}},"126":{"start":{"line":407,"column":4},"end":{"line":411,"column":5}},"127":{"start":{"line":408,"column":5},"end":{"line":408,"column":80}},"128":{"start":{"line":410,"column":5},"end":{"line":410,"column":18}},"129":{"start":{"line":414,"column":3},"end":{"line":415,"column":53}},"130":{"start":{"line":417,"column":3},"end":{"line":424,"column":5}},"131":{"start":{"line":426,"column":3},"end":{"line":428,"column":4}},"132":{"start":{"line":427,"column":4},"end":{"line":427,"column":35}},"133":{"start":{"line":430,"column":3},"end":{"line":430,"column":28}},"134":{"start":{"line":435,"column":1},"end":{"line":438,"column":4}},"135":{"start":{"line":436,"column":2},"end":{"line":436,"column":32}},"136":{"start":{"line":436,"column":11},"end":{"line":436,"column":32}},"137":{"start":{"line":437,"column":2},"end":{"line":437,"column":13}},"138":{"start":{"line":453,"column":0},"end":{"line":484,"column":2}},"139":{"start":{"line":455,"column":1},"end":{"line":455,"column":18}},"140":{"start":{"line":457,"column":1},"end":{"line":462,"column":2}},"141":{"start":{"line":458,"column":2},"end":{"line":458,"column":19}},"142":{"start":{"line":459,"column":2},"end":{"line":459,"column":22}},"143":{"start":{"line":460,"column":8},"end":{"line":462,"column":2}},"144":{"start":{"line":461,"column":2},"end":{"line":461,"column":22}},"145":{"start":{"line":464,"column":1},"end":{"line":464,"column":38}},"146":{"start":{"line":466,"column":1},"end":{"line":482,"column":3}},"147":{"start":{"line":468,"column":2},"end":{"line":474,"column":3}},"148":{"start":{"line":469,"column":3},"end":{"line":469,"column":39}},"149":{"start":{"line":471,"column":3},"end":{"line":473,"column":4}},"150":{"start":{"line":472,"column":4},"end":{"line":472,"column":30}},"151":{"start":{"line":476,"column":2},"end":{"line":478,"column":3}},"152":{"start":{"line":477,"column":3},"end":{"line":477,"column":74}},"153":{"start":{"line":480,"column":2},"end":{"line":480,"column":20}},"154":{"start":{"line":493,"column":0},"end":{"line":495,"column":2}},"155":{"start":{"line":494,"column":1},"end":{"line":494,"column":54}},"156":{"start":{"line":502,"column":0},"end":{"line":502,"column":34}}},"branchMap":{"1":{"line":31,"type":"if","locations":[{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},{"start":{"line":31,"column":1},"end":{"line":31,"column":1}}]},"2":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},{"start":{"line":39,"column":1},"end":{"line":39,"column":1}}]},"3":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},{"start":{"line":46,"column":1},"end":{"line":46,"column":1}}]},"4":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":5},"end":{"line":46,"column":16}},{"start":{"line":46,"column":20},"end":{"line":46,"column":38}}]},"5":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":9},"end":{"line":64,"column":30}},{"start":{"line":64,"column":34},"end":{"line":64,"column":59}}]},"6":{"line":106,"type":"cond-expr","locations":[{"start":{"line":106,"column":32},"end":{"line":106,"column":36}},{"start":{"line":106,"column":39},"end":{"line":106,"column":44}}]},"7":{"line":145,"type":"cond-expr","locations":[{"start":{"line":145,"column":104},"end":{"line":145,"column":116}},{"start":{"line":145,"column":119},"end":{"line":145,"column":124}}]},"8":{"line":171,"type":"if","locations":[{"start":{"line":171,"column":1},"end":{"line":171,"column":1}},{"start":{"line":171,"column":1},"end":{"line":171,"column":1}}]},"9":{"line":238,"type":"if","locations":[{"start":{"line":238,"column":1},"end":{"line":238,"column":1}},{"start":{"line":238,"column":1},"end":{"line":238,"column":1}}]},"10":{"line":241,"type":"if","locations":[{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},{"start":{"line":241,"column":1},"end":{"line":241,"column":1}}]},"11":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":2},"end":{"line":248,"column":2}},{"start":{"line":248,"column":2},"end":{"line":248,"column":2}}]},"12":{"line":268,"type":"if","locations":[{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},{"start":{"line":268,"column":1},"end":{"line":268,"column":1}}]},"13":{"line":295,"type":"binary-expr","locations":[{"start":{"line":295,"column":13},"end":{"line":295,"column":26}},{"start":{"line":295,"column":30},"end":{"line":295,"column":39}}]},"14":{"line":306,"type":"if","locations":[{"start":{"line":306,"column":1},"end":{"line":306,"column":1}},{"start":{"line":306,"column":1},"end":{"line":306,"column":1}}]},"15":{"line":308,"type":"if","locations":[{"start":{"line":308,"column":2},"end":{"line":308,"column":2}},{"start":{"line":308,"column":2},"end":{"line":308,"column":2}}]},"16":{"line":311,"type":"if","locations":[{"start":{"line":311,"column":4},"end":{"line":311,"column":4}},{"start":{"line":311,"column":4},"end":{"line":311,"column":4}}]},"17":{"line":316,"type":"if","locations":[{"start":{"line":316,"column":9},"end":{"line":316,"column":9}},{"start":{"line":316,"column":9},"end":{"line":316,"column":9}}]},"18":{"line":323,"type":"if","locations":[{"start":{"line":323,"column":1},"end":{"line":323,"column":1}},{"start":{"line":323,"column":1},"end":{"line":323,"column":1}}]},"19":{"line":326,"type":"if","locations":[{"start":{"line":326,"column":2},"end":{"line":326,"column":2}},{"start":{"line":326,"column":2},"end":{"line":326,"column":2}}]},"20":{"line":329,"type":"if","locations":[{"start":{"line":329,"column":3},"end":{"line":329,"column":3}},{"start":{"line":329,"column":3},"end":{"line":329,"column":3}}]},"21":{"line":332,"type":"if","locations":[{"start":{"line":332,"column":5},"end":{"line":332,"column":5}},{"start":{"line":332,"column":5},"end":{"line":332,"column":5}}]},"22":{"line":337,"type":"if","locations":[{"start":{"line":337,"column":10},"end":{"line":337,"column":10}},{"start":{"line":337,"column":10},"end":{"line":337,"column":10}}]},"23":{"line":343,"type":"if","locations":[{"start":{"line":343,"column":9},"end":{"line":343,"column":9}},{"start":{"line":343,"column":9},"end":{"line":343,"column":9}}]},"24":{"line":346,"type":"if","locations":[{"start":{"line":346,"column":4},"end":{"line":346,"column":4}},{"start":{"line":346,"column":4},"end":{"line":346,"column":4}}]},"25":{"line":351,"type":"if","locations":[{"start":{"line":351,"column":9},"end":{"line":351,"column":9}},{"start":{"line":351,"column":9},"end":{"line":351,"column":9}}]},"26":{"line":356,"type":"if","locations":[{"start":{"line":356,"column":1},"end":{"line":356,"column":1}},{"start":{"line":356,"column":1},"end":{"line":356,"column":1}}]},"27":{"line":375,"type":"cond-expr","locations":[{"start":{"line":375,"column":32},"end":{"line":375,"column":58}},{"start":{"line":375,"column":61},"end":{"line":375,"column":63}}]},"28":{"line":376,"type":"cond-expr","locations":[{"start":{"line":376,"column":38},"end":{"line":376,"column":85}},{"start":{"line":376,"column":88},"end":{"line":376,"column":90}}]},"29":{"line":379,"type":"binary-expr","locations":[{"start":{"line":379,"column":13},"end":{"line":379,"column":26}},{"start":{"line":379,"column":30},"end":{"line":379,"column":39}}]},"30":{"line":382,"type":"if","locations":[{"start":{"line":382,"column":1},"end":{"line":382,"column":1}},{"start":{"line":382,"column":1},"end":{"line":382,"column":1}}]},"31":{"line":387,"type":"if","locations":[{"start":{"line":387,"column":1},"end":{"line":387,"column":1}},{"start":{"line":387,"column":1},"end":{"line":387,"column":1}}]},"32":{"line":387,"type":"binary-expr","locations":[{"start":{"line":387,"column":5},"end":{"line":387,"column":31}},{"start":{"line":387,"column":35},"end":{"line":387,"column":84}}]},"33":{"line":393,"type":"if","locations":[{"start":{"line":393,"column":2},"end":{"line":393,"column":2}},{"start":{"line":393,"column":2},"end":{"line":393,"column":2}}]},"34":{"line":397,"type":"if","locations":[{"start":{"line":397,"column":2},"end":{"line":397,"column":2}},{"start":{"line":397,"column":2},"end":{"line":397,"column":2}}]},"35":{"line":405,"type":"if","locations":[{"start":{"line":405,"column":3},"end":{"line":405,"column":3}},{"start":{"line":405,"column":3},"end":{"line":405,"column":3}}]},"36":{"line":406,"type":"if","locations":[{"start":{"line":406,"column":3},"end":{"line":406,"column":3}},{"start":{"line":406,"column":3},"end":{"line":406,"column":3}}]},"37":{"line":407,"type":"if","locations":[{"start":{"line":407,"column":4},"end":{"line":407,"column":4}},{"start":{"line":407,"column":4},"end":{"line":407,"column":4}}]},"38":{"line":414,"type":"binary-expr","locations":[{"start":{"line":414,"column":19},"end":{"line":414,"column":42}},{"start":{"line":414,"column":46},"end":{"line":414,"column":75}},{"start":{"line":414,"column":80},"end":{"line":414,"column":82}}]},"39":{"line":426,"type":"if","locations":[{"start":{"line":426,"column":3},"end":{"line":426,"column":3}},{"start":{"line":426,"column":3},"end":{"line":426,"column":3}}]},"40":{"line":436,"type":"if","locations":[{"start":{"line":436,"column":2},"end":{"line":436,"column":2}},{"start":{"line":436,"column":2},"end":{"line":436,"column":2}}]},"41":{"line":457,"type":"if","locations":[{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},{"start":{"line":457,"column":1},"end":{"line":457,"column":1}}]},"42":{"line":460,"type":"if","locations":[{"start":{"line":460,"column":8},"end":{"line":460,"column":8}},{"start":{"line":460,"column":8},"end":{"line":460,"column":8}}]},"43":{"line":464,"type":"binary-expr","locations":[{"start":{"line":464,"column":12},"end":{"line":464,"column":20}},{"start":{"line":464,"column":24},"end":{"line":464,"column":37}}]},"44":{"line":468,"type":"if","locations":[{"start":{"line":468,"column":2},"end":{"line":468,"column":2}},{"start":{"line":468,"column":2},"end":{"line":468,"column":2}}]},"45":{"line":471,"type":"if","locations":[{"start":{"line":471,"column":3},"end":{"line":471,"column":3}},{"start":{"line":471,"column":3},"end":{"line":471,"column":3}}]},"46":{"line":476,"type":"if","locations":[{"start":{"line":476,"column":2},"end":{"line":476,"column":2}},{"start":{"line":476,"column":2},"end":{"line":476,"column":2}}]},"47":{"line":476,"type":"binary-expr","locations":[{"start":{"line":476,"column":6},"end":{"line":476,"column":15}},{"start":{"line":476,"column":19},"end":{"line":476,"column":42}},{"start":{"line":476,"column":46},"end":{"line":476,"column":74}}]}},"code":["/*!"," * Module dependencies."," */","","var _ = require('underscore'),","\tmoment = require('moment'),","\tkeystone = require('../../../'),","\tutil = require('util'),","\tknox = require('knox'),","\t// s3 = require('s3'),","\tutils = require('keystone-utils'),","\tgrappling = require('grappling-hook'),","\tsuper_ = require('../Type');","","/**"," * S3File FieldType Constructor"," * @extends Field"," * @api public"," */","","function s3file(list, path, options) {","\tgrappling.mixin(this)","\t\t.allowHooks('pre:upload');","\tthis._underscoreMethods = ['format', 'uploadFile'];","\tthis._fixedSize = 'full';","","\t// TODO: implement filtering, usage disabled for now","\toptions.nofilter = true;","","\t// TODO: implement initial form, usage disabled for now","\tif (options.initial) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'S3File fields (' + list.key + '.' + path + ') do not currently support being used as initial fields.\\n');","\t}","","\ts3file.super_.call(this, list, path, options);","","\t// validate s3 config (has to happen after super_.call)","\tif (!this.s3config) {","\t\tthrow new Error('Invalid Configuration\\n\\n' +","\t\t\t'S3File fields (' + list.key + '.' + path + ') require the \"s3 config\" option to be set.\\n\\n' +","\t\t\t'See http://keystonejs.com/docs/configuration/#services-amazons3 for more information.\\n');","\t}","","\t// Could be more pre- hooks, just upload for now","\tif (options.pre && options.pre.upload) {","\t\tthis.pre('upload', options.pre.upload);","\t}","","}","","/*!"," * Inherit from Field"," */","","util.inherits(s3file, super_);","","/**"," * Exposes the custom or keystone s3 config settings"," */","","Object.defineProperty(s3file.prototype, 's3config', {","\tget: function() {","\t\treturn this.options.s3config || keystone.get('s3 config');","\t}","});","","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * @api public"," */","","s3file.prototype.addToSchema = function() {","","\tvar field = this,","\t\tschema = this.list.schema;","","\tvar paths = this.paths = {","\t\t// fields","\t\tfilename:   this._path.append('.filename'),","\t\toriginalname: this._path.append('.originalname'),","\t\tpath:     this._path.append('.path'),","\t\tsize:     this._path.append('.size'),","\t\tfiletype:   this._path.append('.filetype'),","\t\turl:      this._path.append('.url'),","\t\t// virtuals","\t\texists:     this._path.append('.exists'),","\t\tupload:     this._path.append('_upload'),","\t\taction:     this._path.append('_action')","\t};","","\tvar schemaPaths = this._path.addTo({}, {","\t\tfilename:   String,","\t\toriginalname: String,","\t\tpath:     String,","\t\tsize:     Number,","\t\tfiletype:   String,","\t\turl:      String","\t});","","\tschema.add(schemaPaths);","","\tvar exists = function(item) {","\t\treturn (item.get(paths.url) ? true : false);","\t};","","\t// The .exists virtual indicates whether a file is stored","\tschema.virtual(paths.exists).get(function() {","\t\treturn schemaMethods.exists.apply(this);","\t});","","\tvar reset = function(item) {","\t\titem.set(field.path, {","\t\t\tfilename: '',","\t\t\toriginalname: '',","\t\t\tpath: '',","\t\t\tsize: 0,","\t\t\tfiletype: '',","\t\t\turl: ''","\t\t});","\t};","","\tvar schemaMethods = {","\t\texists: function() {","\t\t\treturn exists(this);","\t\t},","\t\t/**","\t\t * Resets the value of the field","\t\t *","\t\t * @api public","\t\t */","\t\treset: function() {","\t\t\treset(this);","\t\t},","\t\t/**","\t\t * Deletes the file from S3File and resets the field","\t\t *","\t\t * @api public","\t\t */","\t\tdelete: function() {","\t\t\ttry {","\t\t\t\tvar client = knox.createClient(field.s3config);","\t\t\t\tclient.deleteFile(this.get(paths.path) + this.get(paths.filename), function(err, res){ return res ? res.resume() : false; });//eslint-disable-line handle-callback-err","\t\t\t} catch(e) {}// eslint-disable-line no-empty","\t\t\treset(this);","\t\t}","\t};","","\t_.each(schemaMethods, function(fn, key) {","\t\tfield.underscoreMethod(key, fn);","\t});","","\t// expose a method on the field to call schema methods","\tthis.apply = function(item, method) {","\t\treturn schemaMethods[method].apply(item, Array.prototype.slice.call(arguments, 2));","\t};","","\tthis.bindUnderscoreMethods();","};","","","/**"," * Formats the field value"," *"," * @api public"," */","","s3file.prototype.format = function(item) {","\tif (this.hasFormatter()) {","\t\treturn this.options.format(item, item[this.path]);","\t}","\treturn item.get(this.paths.url);","};","","","/**"," * Detects the field have formatter function"," *"," * @api public"," */","","s3file.prototype.hasFormatter = function() {","\treturn 'function' === typeof this.options.format;","};","","","/**"," * Detects whether the field has been modified"," *"," * @api public"," */","","s3file.prototype.isModified = function(item) {","\treturn item.isModified(this.paths.url);","};","","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","s3file.prototype.validateInput = function(data) {//eslint-disable-line no-unused-vars","\t// TODO - how should file field input be validated?","\treturn true;","};","","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","// s3file.prototype.updateItem = function(item, data) {//eslint-disable-line no-unused-vars","\t// TODO - direct updating of data (not via upload)","\t// commented out for now so super's updateItem will be called and S3FileType can be seeded with an application update","// };","","","/**"," * Validates a header option value provided for this item, throwing an error otherwise"," * @param header {Object} the header object to validate"," * @param callback {Function} a callback function to call when validation is complete"," * @return {Boolean}"," * @api private"," */","","var validateHeader = function(header, callback) {","\tvar HEADER_NAME_KEY = 'name',","\t\tHEADER_VALUE_KEY = 'value',","\t\tvalidKeys = [HEADER_NAME_KEY, HEADER_VALUE_KEY],","\t\tfilteredKeys;","","\tif (!_.has(header, HEADER_NAME_KEY)){","\t\treturn callback(new Error('Unsupported Header option: missing required key \"' + HEADER_NAME_KEY + '\" in ' + JSON.stringify(header)));","\t}","\tif (!_.has(header, HEADER_VALUE_KEY)){","\t\treturn callback(new Error('Unsupported Header option: missing required key \"' + HEADER_VALUE_KEY + '\" in ' + JSON.stringify(header)));","\t}","","\tfilteredKeys = _.filter(_.keys(header), function (key){ return _.indexOf(validKeys, key) > -1; });","","\t_.each(filteredKeys, function (key){","\t\tif (!_.isString(header[key])){","\t\t\treturn callback(new Error('Unsupported Header option: value for ' + key + ' header must be a String ' + header[key].toString()));","\t\t}","\t});","","\treturn true;","};","","","/**"," * Convenience method to validate a headers object"," * @param headers {Object} the headers object to validate"," * @param callback {Function} a callback function to call when validation is complete"," * @return {Boolean}"," * @api private"," */","","var validateHeaders = function(headers, callback) {","\tvar _headers = [];","","\tif (!_.isObject(headers)){","\t\treturn callback(new Error('Unsupported Header option: headers must be an Object ' + JSON.stringify(headers)));","\t}","","\t_.each(headers, function (value, key){","\t\t_headers.push({ name: key, value: value });","\t});","","\t_.each(_headers, function (header){","\t\tvalidateHeader(header, callback);","\t});","","\treturn true;","};","","","/**"," * Generates a headers object for this item to use during upload"," * @param item {Object} the list item"," * @param file {Object} the uploaded file"," * @param callback {Function} a callback function to call when validation is complete"," * @return {Object}"," * @api public"," */","","s3file.prototype.generateHeaders = function (item, file, callback){","\tvar field = this,","\t\tfiletype = file.mimetype || file.type,","\t\theaders = {","\t\t\t'Content-Type': filetype,","\t\t\t'x-amz-acl': 'public-read'","\t\t},","\t\tcustomHeaders = {},","\t\theadersOption = {},","\t\tcomputedHeaders,","\t\tdefaultHeaders;","","","\tif (_.has(field.s3config, 'default headers')){","\t\tdefaultHeaders = field.s3config['default headers'];","\t\tif (_.isArray(defaultHeaders)){","\t\t\t_.each(defaultHeaders, function (header){","\t\t\t\tvar _header = {};","\t\t\t\tif (validateHeader(header, callback)){","\t\t\t\t\t_header[header.name] = header.value;","\t\t\t\t\tcustomHeaders = _.extend(customHeaders, _header);","\t\t\t\t}","\t\t\t});","\t\t} else if (_.isObject(defaultHeaders)){","\t\t\tcustomHeaders = _.extend(customHeaders, defaultHeaders);","\t\t} else {","\t\t\treturn callback(new Error('Unsupported Header option: defaults headers must be either an Object or Array ' + JSON.stringify(defaultHeaders)));","\t\t}","\t}","","\tif (field.options.headers){","\t\theadersOption = field.options.headers;","","\t\tif (_.isFunction(headersOption)){","\t\t\tcomputedHeaders = headersOption.call(field, item, file);","","\t\t\tif (_.isArray(computedHeaders)){","\t\t\t\t_.each(computedHeaders, function (header){","\t\t\t\t\tvar _header = {};","\t\t\t\t\tif (validateHeader(header, callback)){","\t\t\t\t\t\t_header[header.name] = header.value;","\t\t\t\t\t\tcustomHeaders = _.extend(customHeaders, _header);","\t\t\t\t\t}","\t\t\t\t});","\t\t\t} else if (_.isObject(computedHeaders)){","\t\t\t\tcustomHeaders = _.extend(customHeaders, computedHeaders);","\t\t\t} else {","\t\t\t\treturn callback(new Error('Unsupported Header option: computed headers must be either an Object or Array ' + JSON.stringify(computedHeaders)));","\t\t\t}","","\t\t} else if (_.isArray(headersOption)){","\t\t\t_.each(headersOption, function (header){","\t\t\t\tvar _header = {};","\t\t\t\tif (validateHeader(header, callback)){","\t\t\t\t\t_header[header.name] = header.value;","\t\t\t\t\tcustomHeaders = _.extend(customHeaders, _header);","\t\t\t\t}","\t\t\t});","\t\t} else if (_.isObject(headersOption)){","\t\t\tcustomHeaders = _.extend(customHeaders, headersOption);","\t\t}","\t}","","\tif (validateHeaders(customHeaders, callback)){","\t\theaders = _.extend(headers, customHeaders);","\t}","","\treturn headers;","","};","","","","/**"," * Uploads the file for this field"," *"," * @api public"," */","","s3file.prototype.uploadFile = function(item, file, update, callback) {","","\tvar field = this,","\t\tpath = field.options.s3path ? field.options.s3path + '/' : '',","\t\tprefix = field.options.datePrefix ? moment().format(field.options.datePrefix) + '-' : '',","\t\tfilename = prefix + file.name,","\t\toriginalname = file.originalname,","\t\tfiletype = file.mimetype || file.type,","\t\theaders;","","\tif ('function' === typeof update) {","\t\tcallback = update;","\t\tupdate = false;","\t}","","\tif (field.options.allowedTypes && !_.contains(field.options.allowedTypes, filetype)) {","\t\treturn callback(new Error('Unsupported File Type: ' + filetype));","\t}","","\tvar doUpload = function() {","","\t\tif ('function' === typeof field.options.path) {","\t\t\tpath = field.options.path(item, path);","\t\t}","","\t\tif ('function' === typeof field.options.filename) {","\t\t\tfilename = field.options.filename(item, filename, originalname);","\t\t}","","\t\theaders = field.generateHeaders(item, file, callback);","","\t\tknox.createClient(field.s3config).putFile(file.path, path + filename, headers, function(err, res) {","","\t\t\tif (err) return callback(err);","\t\t\tif (res) {","\t\t\t\tif (res.statusCode !== 200) {","\t\t\t\t\treturn callback(new Error('Amazon returned Http Code: ' + res.statusCode));","\t\t\t\t} else {","\t\t\t\t\tres.resume();","\t\t\t\t}","\t\t\t}","","\t\t\tvar protocol = (field.s3config.protocol && field.s3config.protocol + ':') || '',","\t\t\t\turl = res.req.url.replace(/^https?:/i, protocol);","","\t\t\tvar fileData = {","\t\t\t\tfilename: filename,","\t\t\t\toriginalname: originalname,","\t\t\t\tpath: path,","\t\t\t\tsize: file.size,","\t\t\t\tfiletype: filetype,","\t\t\t\turl: url","\t\t\t};","","\t\t\tif (update) {","\t\t\t\titem.set(field.path, fileData);","\t\t\t}","","\t\t\tcallback(null, fileData);","","\t\t});","\t};","","\tthis.callHook('pre:upload', item, file, function(err) {","\t\tif (err) return callback(err);","\t\tdoUpload();","\t});","","};","","","/**"," * Returns a callback that handles a standard form submission for the field"," *"," * Expected form parts are"," * - `field.paths.action` in `req.body` (`clear` or `delete`)"," * - `field.paths.upload` in `req.files` (uploads the file to s3file)"," *"," * @api public"," */","","s3file.prototype.getRequestHandler = function(item, req, paths, callback) {","","\tvar field = this;","","\tif (utils.isFunction(paths)) {","\t\tcallback = paths;","\t\tpaths = field.paths;","\t} else if (!paths) {","\t\tpaths = field.paths;","\t}","","\tcallback = callback || function() {};","","\treturn function() {","","\t\tif (req.body) {","\t\t\tvar action = req.body[paths.action];","","\t\t\tif (/^(delete|reset)$/.test(action)) {","\t\t\t\tfield.apply(item, action);","\t\t\t}","\t\t}","","\t\tif (req.files && req.files[paths.upload] && req.files[paths.upload].size) {","\t\t\treturn field.uploadFile(item, req.files[paths.upload], true, callback);","\t\t}","","\t\treturn callback();","","\t};","","};","","","/**"," * Immediately handles a standard form submission for the field (see `getRequestHandler()`)"," *"," * @api public"," */","","s3file.prototype.handleRequest = function(item, req, paths, callback) {","\tthis.getRequestHandler(item, req, paths, callback)();","};","","","/*!"," * Export class"," */","","exports = module.exports = s3file;",""],"l":{"5":1,"21":1,"22":0,"24":0,"25":0,"28":0,"31":0,"32":0,"36":0,"39":0,"40":0,"46":0,"47":0,"56":1,"62":1,"64":0,"75":1,"77":0,"80":0,"94":0,"103":0,"105":0,"106":0,"110":0,"111":0,"114":0,"115":0,"125":0,"127":0,"135":0,"143":0,"144":0,"145":0,"147":0,"151":0,"152":0,"156":0,"157":0,"160":0,"170":1,"171":0,"172":0,"174":0,"184":1,"185":0,"195":1,"196":0,"206":1,"208":0,"232":1,"233":0,"238":0,"239":0,"241":0,"242":0,"245":0,"247":0,"248":0,"249":0,"253":0,"265":1,"266":0,"268":0,"269":0,"272":0,"273":0,"276":0,"277":0,"280":0,"293":1,"294":0,"306":0,"307":0,"308":0,"309":0,"310":0,"311":0,"312":0,"313":0,"316":0,"317":0,"319":0,"323":0,"324":0,"326":0,"327":0,"329":0,"330":0,"331":0,"332":0,"333":0,"334":0,"337":0,"338":0,"340":0,"343":0,"344":0,"345":0,"346":0,"347":0,"348":0,"351":0,"352":0,"356":0,"357":0,"360":0,"372":1,"374":0,"382":0,"383":0,"384":0,"387":0,"388":0,"391":0,"393":0,"394":0,"397":0,"398":0,"401":0,"403":0,"405":0,"406":0,"407":0,"408":0,"410":0,"414":0,"417":0,"426":0,"427":0,"430":0,"435":0,"436":0,"437":0,"453":1,"455":0,"457":0,"458":0,"459":0,"460":0,"461":0,"464":0,"466":0,"468":0,"469":0,"471":0,"472":0,"476":0,"477":0,"480":0,"493":1,"494":0,"502":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/select/SelectType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/select/SelectType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":1,"30":1,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":1,"49":0,"50":1,"51":0,"52":1,"53":0,"54":0,"55":0,"56":0,"57":0,"58":1,"59":0,"60":0,"61":0,"62":1,"63":0,"64":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0,0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"select","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":37}}},"2":{"name":"(anonymous_2)","line":23,"loc":{"start":{"line":23,"column":32},"end":{"line":23,"column":44}}},"3":{"name":"(anonymous_3)","line":54,"loc":{"start":{"line":54,"column":31},"end":{"line":54,"column":42}}},"4":{"name":"(anonymous_4)","line":66,"loc":{"start":{"line":66,"column":7},"end":{"line":66,"column":21}}},"5":{"name":"(anonymous_5)","line":70,"loc":{"start":{"line":70,"column":37},"end":{"line":70,"column":49}}},"6":{"name":"(anonymous_6)","line":73,"loc":{"start":{"line":73,"column":38},"end":{"line":73,"column":50}}},"7":{"name":"(anonymous_7)","line":76,"loc":{"start":{"line":76,"column":40},"end":{"line":76,"column":51}}},"8":{"name":"(anonymous_8)","line":79,"loc":{"start":{"line":79,"column":36},"end":{"line":79,"column":47}}},"9":{"name":"(anonymous_9)","line":82,"loc":{"start":{"line":82,"column":32},"end":{"line":82,"column":54}}},"10":{"name":"(anonymous_10)","line":92,"loc":{"start":{"line":92,"column":28},"end":{"line":92,"column":39}}},"11":{"name":"(anonymous_11)","line":99,"loc":{"start":{"line":99,"column":28},"end":{"line":99,"column":39}}},"12":{"name":"(anonymous_12)","line":106,"loc":{"start":{"line":106,"column":36},"end":{"line":106,"column":60}}},"13":{"name":"(anonymous_13)","line":119,"loc":{"start":{"line":119,"column":33},"end":{"line":119,"column":64}}},"14":{"name":"(anonymous_14)","line":130,"loc":{"start":{"line":130,"column":26},"end":{"line":130,"column":41}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":35}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":11,"column":0},"end":{"line":44,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":34}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":47}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":56}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":38}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":39}},"11":{"start":{"line":17,"column":1},"end":{"line":19,"column":2}},"12":{"start":{"line":18,"column":2},"end":{"line":18,"column":47}},"13":{"start":{"line":20,"column":1},"end":{"line":22,"column":2}},"14":{"start":{"line":21,"column":2},"end":{"line":21,"column":61}},"15":{"start":{"line":23,"column":1},"end":{"line":32,"column":4}},"16":{"start":{"line":24,"column":2},"end":{"line":24,"column":79}},"17":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"18":{"start":{"line":26,"column":3},"end":{"line":26,"column":41}},"19":{"start":{"line":28,"column":2},"end":{"line":30,"column":3}},"20":{"start":{"line":29,"column":3},"end":{"line":29,"column":31}},"21":{"start":{"line":31,"column":2},"end":{"line":31,"column":12}},"22":{"start":{"line":34,"column":1},"end":{"line":36,"column":2}},"23":{"start":{"line":35,"column":2},"end":{"line":35,"column":29}},"24":{"start":{"line":38,"column":1},"end":{"line":38,"column":55}},"25":{"start":{"line":40,"column":1},"end":{"line":40,"column":39}},"26":{"start":{"line":41,"column":1},"end":{"line":41,"column":51}},"27":{"start":{"line":42,"column":1},"end":{"line":42,"column":42}},"28":{"start":{"line":43,"column":1},"end":{"line":43,"column":47}},"29":{"start":{"line":45,"column":0},"end":{"line":45,"column":33}},"30":{"start":{"line":54,"column":0},"end":{"line":87,"column":2}},"31":{"start":{"line":55,"column":1},"end":{"line":55,"column":18}},"32":{"start":{"line":56,"column":1},"end":{"line":56,"column":31}},"33":{"start":{"line":57,"column":1},"end":{"line":62,"column":3}},"34":{"start":{"line":63,"column":1},"end":{"line":69,"column":19}},"35":{"start":{"line":67,"column":3},"end":{"line":67,"column":74}},"36":{"start":{"line":70,"column":1},"end":{"line":72,"column":4}},"37":{"start":{"line":71,"column":2},"end":{"line":71,"column":41}},"38":{"start":{"line":73,"column":1},"end":{"line":75,"column":4}},"39":{"start":{"line":74,"column":2},"end":{"line":74,"column":44}},"40":{"start":{"line":76,"column":1},"end":{"line":78,"column":4}},"41":{"start":{"line":77,"column":2},"end":{"line":77,"column":19}},"42":{"start":{"line":79,"column":1},"end":{"line":81,"column":4}},"43":{"start":{"line":80,"column":2},"end":{"line":80,"column":19}},"44":{"start":{"line":82,"column":1},"end":{"line":85,"column":4}},"45":{"start":{"line":83,"column":2},"end":{"line":83,"column":42}},"46":{"start":{"line":84,"column":2},"end":{"line":84,"column":41}},"47":{"start":{"line":86,"column":1},"end":{"line":86,"column":30}},"48":{"start":{"line":92,"column":0},"end":{"line":94,"column":2}},"49":{"start":{"line":93,"column":1},"end":{"line":93,"column":33}},"50":{"start":{"line":99,"column":0},"end":{"line":101,"column":2}},"51":{"start":{"line":100,"column":1},"end":{"line":100,"column":41}},"52":{"start":{"line":106,"column":0},"end":{"line":114,"column":2}},"53":{"start":{"line":107,"column":1},"end":{"line":107,"column":21}},"54":{"start":{"line":108,"column":1},"end":{"line":112,"column":2}},"55":{"start":{"line":109,"column":2},"end":{"line":109,"column":76}},"56":{"start":{"line":111,"column":2},"end":{"line":111,"column":83}},"57":{"start":{"line":113,"column":1},"end":{"line":113,"column":14}},"58":{"start":{"line":119,"column":0},"end":{"line":125,"column":2}},"59":{"start":{"line":120,"column":1},"end":{"line":124,"column":2}},"60":{"start":{"line":121,"column":2},"end":{"line":121,"column":54}},"61":{"start":{"line":123,"column":2},"end":{"line":123,"column":93}},"62":{"start":{"line":130,"column":0},"end":{"line":132,"column":2}},"63":{"start":{"line":131,"column":1},"end":{"line":131,"column":41}},"64":{"start":{"line":135,"column":0},"end":{"line":135,"column":34}}},"branchMap":{"1":{"line":12,"type":"binary-expr","locations":[{"start":{"line":12,"column":11},"end":{"line":12,"column":21}},{"start":{"line":12,"column":25},"end":{"line":12,"column":33}}]},"2":{"line":13,"type":"cond-expr","locations":[{"start":{"line":13,"column":34},"end":{"line":13,"column":38}},{"start":{"line":13,"column":41},"end":{"line":13,"column":46}}]},"3":{"line":14,"type":"cond-expr","locations":[{"start":{"line":14,"column":40},"end":{"line":14,"column":46}},{"start":{"line":14,"column":49},"end":{"line":14,"column":55}}]},"4":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},{"start":{"line":17,"column":1},"end":{"line":17,"column":1}}]},"5":{"line":20,"type":"if","locations":[{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},{"start":{"line":20,"column":1},"end":{"line":20,"column":1}}]},"6":{"line":24,"type":"cond-expr","locations":[{"start":{"line":24,"column":27},"end":{"line":24,"column":74}},{"start":{"line":24,"column":77},"end":{"line":24,"column":78}}]},"7":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"8":{"line":28,"type":"if","locations":[{"start":{"line":28,"column":2},"end":{"line":28,"column":2}},{"start":{"line":28,"column":2},"end":{"line":28,"column":2}}]},"9":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":6},"end":{"line":28,"column":21}},{"start":{"line":28,"column":25},"end":{"line":28,"column":46}}]},"10":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},{"start":{"line":34,"column":1},"end":{"line":34,"column":1}}]},"11":{"line":38,"type":"cond-expr","locations":[{"start":{"line":38,"column":42},"end":{"line":38,"column":46}},{"start":{"line":38,"column":49},"end":{"line":38,"column":54}}]},"12":{"line":58,"type":"binary-expr","locations":[{"start":{"line":58,"column":8},"end":{"line":58,"column":29}},{"start":{"line":58,"column":33},"end":{"line":58,"column":58}}]},"13":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":9},"end":{"line":59,"column":31}},{"start":{"line":59,"column":35},"end":{"line":59,"column":61}}]},"14":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":11},"end":{"line":60,"column":35}},{"start":{"line":60,"column":39},"end":{"line":60,"column":67}}]},"15":{"line":61,"type":"binary-expr","locations":[{"start":{"line":61,"column":7},"end":{"line":61,"column":34}},{"start":{"line":61,"column":38},"end":{"line":61,"column":69}}]},"16":{"line":67,"type":"cond-expr","locations":[{"start":{"line":67,"column":58},"end":{"line":67,"column":67}},{"start":{"line":67,"column":70},"end":{"line":67,"column":73}}]},"17":{"line":67,"type":"binary-expr","locations":[{"start":{"line":67,"column":11},"end":{"line":67,"column":21}},{"start":{"line":67,"column":25},"end":{"line":67,"column":37}},{"start":{"line":67,"column":41},"end":{"line":67,"column":54}}]},"18":{"line":84,"type":"cond-expr","locations":[{"start":{"line":84,"column":20},"end":{"line":84,"column":36}},{"start":{"line":84,"column":39},"end":{"line":84,"column":40}}]},"19":{"line":107,"type":"binary-expr","locations":[{"start":{"line":107,"column":9},"end":{"line":107,"column":14}},{"start":{"line":107,"column":18},"end":{"line":107,"column":20}}]},"20":{"line":108,"type":"if","locations":[{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},{"start":{"line":108,"column":1},"end":{"line":108,"column":1}}]},"21":{"line":109,"type":"cond-expr","locations":[{"start":{"line":109,"column":39},"end":{"line":109,"column":60}},{"start":{"line":109,"column":63},"end":{"line":109,"column":75}}]},"22":{"line":111,"type":"cond-expr","locations":[{"start":{"line":111,"column":40},"end":{"line":111,"column":60}},{"start":{"line":111,"column":63},"end":{"line":111,"column":82}}]},"23":{"line":120,"type":"if","locations":[{"start":{"line":120,"column":1},"end":{"line":120,"column":1}},{"start":{"line":120,"column":1},"end":{"line":120,"column":1}}]},"24":{"line":121,"type":"cond-expr","locations":[{"start":{"line":121,"column":41},"end":{"line":121,"column":45}},{"start":{"line":121,"column":48},"end":{"line":121,"column":53}}]},"25":{"line":123,"type":"cond-expr","locations":[{"start":{"line":123,"column":80},"end":{"line":123,"column":84}},{"start":{"line":123,"column":87},"end":{"line":123,"column":92}}]},"26":{"line":123,"type":"binary-expr","locations":[{"start":{"line":123,"column":10},"end":{"line":123,"column":19}},{"start":{"line":123,"column":24},"end":{"line":123,"column":44}},{"start":{"line":123,"column":48},"end":{"line":123,"column":52}},{"start":{"line":123,"column":56},"end":{"line":123,"column":75}}]}},"code":["var _ = require('underscore');","var FieldType = require('../Type');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Select FieldType Constructor"," * @extends Field"," * @api public"," */","function select(list, path, options) {","\tthis.ui = options.ui || 'select';","\tthis.numeric = options.numeric ? true : false;","\tthis._nativeType = (options.numeric) ? Number : String;","\tthis._underscoreMethods = ['format'];","\tthis._properties = ['ops', 'numeric'];","\tif (typeof options.options === 'string') {","\t\toptions.options = options.options.split(',');","\t}","\tif (!Array.isArray(options.options)) {","\t\tthrow new Error('Select fields require an options array.');","\t}","\tthis.ops = options.options.map(function(i) {","\t\tvar op = _.isString(i) ? { value: i.trim(), label: utils.keyToLabel(i) } : i;","\t\tif (!_.isObject(op)) {","\t\t\top = { label: '' + i, value: '' + i };","\t\t}","\t\tif (options.numeric && !_.isNumber(op.value)) {","\t\t\top.value = Number(op.value);","\t\t}","\t\treturn op;","\t});","\t// undefined options.emptyOption defaults to true","\tif (options.emptyOption === undefined) {","\t\toptions.emptyOption = true;","\t}","\t// ensure this.emptyOption is a boolean","\tthis.emptyOption = options.emptyOption ? true : false;","\t// cached maps for options, labels and values","\tthis.map = utils.optionsMap(this.ops);","\tthis.labels = utils.optionsMap(this.ops, 'label');","\tthis.values = _.pluck(this.ops, 'value');","\tselect.super_.call(this, list, path, options);","}","util.inherits(select, FieldType);","","/**"," * Registers the field on the List's Mongoose Schema."," *"," * Adds a virtual for accessing the label of the selected value,"," * and statics to the Schema for converting a value to a label,"," * and retrieving all of the defined options."," */","select.prototype.addToSchema = function() {","\tvar field = this;","\tvar schema = this.list.schema;","\tthis.paths = {","\t\tdata: this.options.dataPath || this._path.append('Data'),","\t\tlabel: this.options.labelPath || this._path.append('Label'),","\t\toptions: this.options.optionsPath || this._path.append('Options'),","\t\tmap: this.options.optionsMapPath || this._path.append('OptionsMap')","\t};","\tschema.path(this.path, _.defaults({","\t\ttype: this._nativeType,","\t\tenum: this.values,","\t\tset: function(val) {","\t\t\treturn (val === '' || val === null || val === false) ? undefined : val;","\t\t}","\t}, this.options));","\tschema.virtual(this.paths.data).get(function () {","\t\treturn field.map[this.get(field.path)];","\t});","\tschema.virtual(this.paths.label).get(function () {","\t\treturn field.labels[this.get(field.path)];","\t});","\tschema.virtual(this.paths.options).get(function() {","\t\treturn field.ops;","\t});","\tschema.virtual(this.paths.map).get(function() {","\t\treturn field.map;","\t});","\tthis.underscoreMethod('pluck', function(property, d) {","\t\tvar option = this.get(field.paths.data);","\t\treturn (option) ? option[property] : d;","\t});","\tthis.bindUnderscoreMethods();","};","","/**"," * Retrieves a shallow clone of the options array"," */","select.prototype.cloneOps = function() {","\treturn _.map(this.ops, _.clone);","};","","/**"," * Retrieves a shallow clone of the options map"," */","select.prototype.cloneMap = function() {","\treturn utils.optionsMap(this.ops, true);","};","","/**"," * Add filters to a query"," */","select.prototype.addFilterToQuery = function(filter, query) {","\tquery = query || {};","\tif (filter.value) {","\t\tquery[this.path] = (filter.invert) ? { $ne: filter.value } : filter.value;","\t} else {","\t\tquery[this.path] = (filter.inverse) ? { $nin: ['', null] } : { $in: ['', null] };","\t}","\treturn query;","};","","/**"," * Validates that a valid option has been provided in a data object"," */","select.prototype.validateInput = function(data, required, item) {","\tif (data[this.path]) {","\t\treturn (data[this.path] in this.map) ? true : false;","\t} else {","\t\treturn (!required || (!(this.path in data) && item && item.get(this.path))) ? true : false;","\t}","};","","/**"," * Formats the field value"," */","select.prototype.format = function(item) {","\treturn this.labels[item.get(this.path)];","};","","/* Export Field Type */","exports = module.exports = select;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"20":0,"21":0,"23":0,"24":0,"25":0,"26":0,"28":0,"29":0,"31":0,"34":0,"35":0,"38":0,"40":0,"41":0,"42":0,"43":0,"45":1,"54":1,"55":0,"56":0,"57":0,"63":0,"67":0,"70":0,"71":0,"73":0,"74":0,"76":0,"77":0,"79":0,"80":0,"82":0,"83":0,"84":0,"86":0,"92":1,"93":0,"99":1,"100":0,"106":1,"107":0,"108":0,"109":0,"111":0,"113":0,"119":1,"120":0,"121":0,"123":0,"130":1,"131":0,"135":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/textarray/TextArrayType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/textarray/TextArrayType.js","s":{"1":1,"2":1,"3":0,"4":0,"5":1,"6":1,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0,0,0],"4":[0,0],"5":[0,0,0,0],"6":[0,0],"7":[0,0],"8":[0,0,0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"textarray","line":14,"loc":{"start":{"line":14,"column":0},"end":{"line":14,"column":40}}},"2":{"name":"(anonymous_2)","line":32,"loc":{"start":{"line":32,"column":36},"end":{"line":32,"column":67}}},"3":{"name":"(anonymous_3)","line":55,"loc":{"start":{"line":55,"column":33},"end":{"line":55,"column":54}}}},"statementMap":{"1":{"start":{"line":5,"column":0},"end":{"line":6,"column":29}},"2":{"start":{"line":14,"column":0},"end":{"line":18,"column":1}},"3":{"start":{"line":15,"column":1},"end":{"line":15,"column":29}},"4":{"start":{"line":17,"column":1},"end":{"line":17,"column":50}},"5":{"start":{"line":24,"column":0},"end":{"line":24,"column":33}},"6":{"start":{"line":32,"column":0},"end":{"line":47,"column":2}},"7":{"start":{"line":33,"column":1},"end":{"line":33,"column":41}},"8":{"start":{"line":35,"column":1},"end":{"line":45,"column":2}},"9":{"start":{"line":36,"column":2},"end":{"line":38,"column":3}},"10":{"start":{"line":37,"column":3},"end":{"line":37,"column":15}},"11":{"start":{"line":39,"column":2},"end":{"line":41,"column":3}},"12":{"start":{"line":40,"column":3},"end":{"line":40,"column":16}},"13":{"start":{"line":42,"column":2},"end":{"line":44,"column":3}},"14":{"start":{"line":43,"column":3},"end":{"line":43,"column":16}},"15":{"start":{"line":46,"column":1},"end":{"line":46,"column":116}},"16":{"start":{"line":55,"column":0},"end":{"line":72,"column":2}},"17":{"start":{"line":56,"column":1},"end":{"line":56,"column":41}},"18":{"start":{"line":58,"column":1},"end":{"line":71,"column":2}},"19":{"start":{"line":59,"column":2},"end":{"line":61,"column":3}},"20":{"start":{"line":60,"column":3},"end":{"line":60,"column":14}},"21":{"start":{"line":62,"column":2},"end":{"line":64,"column":3}},"22":{"start":{"line":63,"column":3},"end":{"line":63,"column":19}},"23":{"start":{"line":65,"column":2},"end":{"line":67,"column":3}},"24":{"start":{"line":66,"column":3},"end":{"line":66,"column":30}},"25":{"start":{"line":68,"column":2},"end":{"line":70,"column":3}},"26":{"start":{"line":69,"column":3},"end":{"line":69,"column":30}},"27":{"start":{"line":78,"column":0},"end":{"line":78,"column":37}}},"branchMap":{"1":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},{"start":{"line":35,"column":1},"end":{"line":35,"column":1}}]},"2":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":2},"end":{"line":36,"column":2}},{"start":{"line":36,"column":2},"end":{"line":36,"column":2}}]},"3":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":6},"end":{"line":36,"column":25}},{"start":{"line":36,"column":29},"end":{"line":36,"column":33}},{"start":{"line":36,"column":37},"end":{"line":36,"column":56}},{"start":{"line":36,"column":60},"end":{"line":36,"column":86}}]},"4":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":2},"end":{"line":39,"column":2}},{"start":{"line":39,"column":2},"end":{"line":39,"column":2}}]},"5":{"line":39,"type":"binary-expr","locations":[{"start":{"line":39,"column":6},"end":{"line":39,"column":25}},{"start":{"line":39,"column":29},"end":{"line":39,"column":50}},{"start":{"line":39,"column":55},"end":{"line":39,"column":80}},{"start":{"line":39,"column":86},"end":{"line":39,"column":111}}]},"6":{"line":42,"type":"if","locations":[{"start":{"line":42,"column":2},"end":{"line":42,"column":2}},{"start":{"line":42,"column":2},"end":{"line":42,"column":2}}]},"7":{"line":42,"type":"binary-expr","locations":[{"start":{"line":42,"column":6},"end":{"line":42,"column":26}},{"start":{"line":42,"column":30},"end":{"line":42,"column":43}}]},"8":{"line":46,"type":"binary-expr","locations":[{"start":{"line":46,"column":9},"end":{"line":46,"column":28}},{"start":{"line":46,"column":32},"end":{"line":46,"column":52}},{"start":{"line":46,"column":57},"end":{"line":46,"column":82}},{"start":{"line":46,"column":88},"end":{"line":46,"column":113}}]},"9":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},{"start":{"line":58,"column":1},"end":{"line":58,"column":1}}]},"10":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":2},"end":{"line":59,"column":2}},{"start":{"line":59,"column":2},"end":{"line":59,"column":2}}]},"11":{"line":62,"type":"if","locations":[{"start":{"line":62,"column":2},"end":{"line":62,"column":2}},{"start":{"line":62,"column":2},"end":{"line":62,"column":2}}]},"12":{"line":65,"type":"if","locations":[{"start":{"line":65,"column":2},"end":{"line":65,"column":2}},{"start":{"line":65,"column":2},"end":{"line":65,"column":2}}]},"13":{"line":68,"type":"if","locations":[{"start":{"line":68,"column":2},"end":{"line":68,"column":2}},{"start":{"line":68,"column":2},"end":{"line":68,"column":2}}]}},"code":["/*!"," * Module dependencies."," */","","var util = require('util'),","\tsuper_ = require('../Type');","","/**"," * TextArray FieldType Constructor"," * @extends Field"," * @api public"," */","","function textarray(list, path, options) {","\tthis._nativeType = [String];","","\ttextarray.super_.call(this, list, path, options);","}","","/*!"," * Inherit from Field"," */","","util.inherits(textarray, super_);","","/**"," * Validates that a value for this field has been provided in a data object"," *"," * @api public"," */","","textarray.prototype.validateInput = function(data, required, item) {","\tvar value = this.getValueFromData(data);","","\tif (required) {","\t\tif (value === undefined && item && item.get(this.path) && item.get(this.path).length) {","\t\t\treturn true;","\t\t}","\t\tif (value === undefined || !Array.isArray(value) || ('string' !== typeof value) || ('number' !== typeof value)) {","\t\t\treturn false;","\t\t}","\t\tif (Array.isArray(value) && !value.length) {","\t\t\treturn false;","\t\t}","\t}","\treturn (value === undefined || Array.isArray(value) || ('string' === typeof value) || ('number' === typeof value));","};","","/**"," * Updates the value for this field in the item from a data object"," *"," * @api public"," */","","textarray.prototype.updateItem = function(item, data) {","\tvar value = this.getValueFromData(data);","\t","\tif ('undefined' !== typeof value) {","\t\tif (value === null) {","\t\t\tvalue = [];","\t\t}","\t\tif ('string' === typeof value) {","\t\t\tvalue = [value];","\t\t}","\t\tif ('number' === typeof value) {","\t\t\tvalue = [value.toString()];","\t\t}","\t\tif (Array.isArray(value)) {","\t\t\titem.set(this.path, value);","\t\t}","\t}","};","","/*!"," * Export class"," */","","exports = module.exports = textarray;",""],"l":{"5":1,"14":1,"15":0,"17":0,"24":1,"32":1,"33":0,"35":0,"36":0,"37":0,"39":0,"40":0,"42":0,"43":0,"46":0,"55":1,"56":0,"58":0,"59":0,"60":0,"62":0,"63":0,"65":0,"66":0,"68":0,"69":0,"78":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/textarea/TextareaType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/textarea/TextareaType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":1,"12":1,"13":1,"14":1,"15":0,"16":1},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"textarea","line":11,"loc":{"start":{"line":11,"column":0},"end":{"line":11,"column":39}}},"2":{"name":"(anonymous_2)","line":28,"loc":{"start":{"line":28,"column":28},"end":{"line":28,"column":43}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":43}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":38}},"5":{"start":{"line":11,"column":0},"end":{"line":17,"column":1}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":27}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":46}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":36}},"9":{"start":{"line":15,"column":1},"end":{"line":15,"column":31}},"10":{"start":{"line":16,"column":1},"end":{"line":16,"column":49}},"11":{"start":{"line":18,"column":0},"end":{"line":18,"column":35}},"12":{"start":{"line":21,"column":0},"end":{"line":21,"column":74}},"13":{"start":{"line":22,"column":0},"end":{"line":22,"column":50}},"14":{"start":{"line":28,"column":0},"end":{"line":30,"column":2}},"15":{"start":{"line":29,"column":1},"end":{"line":29,"column":46}},"16":{"start":{"line":33,"column":0},"end":{"line":33,"column":36}}},"branchMap":{"1":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":15},"end":{"line":14,"column":29}},{"start":{"line":14,"column":33},"end":{"line":14,"column":35}}]}},"code":["var FieldType = require('../Type');","var TextType = require('../text/TextType');","var util = require('util');","var utils = require('keystone-utils');","","/**"," * Text FieldType Constructor"," * @extends Field"," * @api public"," */","function textarea(list, path, options) {","\tthis._nativeType = String;","\tthis._underscoreMethods = ['format', 'crop'];","\tthis.height = options.height || 90;","\tthis._properties = ['height'];","\ttextarea.super_.call(this, list, path, options);","}","util.inherits(textarea, FieldType);","","/* Inherit from TextType prototype */","textarea.prototype.addFilterToQuery = TextType.prototype.addFilterToQuery;","textarea.prototype.crop = TextType.prototype.crop;","","/**"," * Formats the field value"," * @api public"," */","textarea.prototype.format = function(item) {","\treturn utils.textToHTML(item.get(this.path));","};","","/* Export Field Type */","exports = module.exports = textarea;",""],"l":{"1":1,"2":1,"3":1,"4":1,"11":1,"12":0,"13":0,"14":0,"15":0,"16":0,"18":1,"21":1,"22":1,"28":1,"29":0,"33":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/url/UrlType.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/url/UrlType.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":1,"10":1,"11":1,"12":0,"13":0,"14":1,"15":0,"16":1},"b":{"1":[0,0],"2":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"url","line":10,"loc":{"start":{"line":10,"column":0},"end":{"line":10,"column":34}}},"2":{"name":"(anonymous_2)","line":25,"loc":{"start":{"line":25,"column":23},"end":{"line":25,"column":38}}},"3":{"name":"removeProtocolPrefix","line":33,"loc":{"start":{"line":33,"column":0},"end":{"line":33,"column":35}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":35}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":43}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":10,"column":0},"end":{"line":15,"column":1}},"5":{"start":{"line":11,"column":1},"end":{"line":11,"column":27}},"6":{"start":{"line":12,"column":1},"end":{"line":12,"column":38}},"7":{"start":{"line":13,"column":1},"end":{"line":13,"column":58}},"8":{"start":{"line":14,"column":1},"end":{"line":14,"column":44}},"9":{"start":{"line":16,"column":0},"end":{"line":16,"column":30}},"10":{"start":{"line":19,"column":0},"end":{"line":19,"column":69}},"11":{"start":{"line":25,"column":0},"end":{"line":28,"column":2}},"12":{"start":{"line":26,"column":1},"end":{"line":26,"column":39}},"13":{"start":{"line":27,"column":1},"end":{"line":27,"column":29}},"14":{"start":{"line":33,"column":0},"end":{"line":35,"column":1}},"15":{"start":{"line":34,"column":1},"end":{"line":34,"column":44}},"16":{"start":{"line":40,"column":0},"end":{"line":40,"column":31}}},"branchMap":{"1":{"line":13,"type":"binary-expr","locations":[{"start":{"line":13,"column":19},"end":{"line":13,"column":33}},{"start":{"line":13,"column":37},"end":{"line":13,"column":57}}]},"2":{"line":26,"type":"binary-expr","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":31}},{"start":{"line":26,"column":35},"end":{"line":26,"column":37}}]}},"code":["var FieldType = require('../Type');","var TextType = require('../text/TextType');","var util = require('util');","","/**"," * URL FieldType Constructor"," * @extends Field"," * @api public"," */","function url(list, path, options) {","\tthis._nativeType = String;","\tthis._underscoreMethods = ['format'];","\tthis._formatUrl = options.format || removeProtocolPrefix;","\turl.super_.call(this, list, path, options);","}","util.inherits(url, FieldType);","","/* Inherit from TextType prototype */","url.prototype.addFilterToQuery = TextType.prototype.addFilterToQuery;","","/**"," * Formats the field value using either a supplied format function or default"," * which strips the leading protocol from the value for simpler display"," */","url.prototype.format = function(item) {","\tvar url = (item.get(this.path) || '');","\treturn this._formatUrl(url);","};","","/**"," * Remove the protocol prefix from url"," */","function removeProtocolPrefix(url) {","\treturn url.replace(/^[a-zA-Z]+\\:\\/\\//, '');","}","","// TODO: Proper url validation","","/* Export Field Type */","exports = module.exports = url;",""],"l":{"1":1,"2":1,"3":1,"10":1,"11":0,"12":0,"13":0,"14":0,"16":1,"19":1,"25":1,"26":0,"27":0,"33":1,"34":0,"40":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/gulpfile.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/gulpfile.js","s":{"1":2,"2":2,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"(anonymous_1)","line":12,"loc":{"start":{"line":12,"column":28},"end":{"line":12,"column":39}}},"2":{"name":"(anonymous_2)","line":15,"loc":{"start":{"line":15,"column":18},"end":{"line":15,"column":30}}},"3":{"name":"(anonymous_3)","line":27,"loc":{"start":{"line":27,"column":25},"end":{"line":27,"column":40}}},"4":{"name":"(anonymous_4)","line":32,"loc":{"start":{"line":32,"column":21},"end":{"line":32,"column":36}}},"5":{"name":"(anonymous_5)","line":34,"loc":{"start":{"line":34,"column":24},"end":{"line":34,"column":39}}},"6":{"name":"(anonymous_6)","line":41,"loc":{"start":{"line":41,"column":25},"end":{"line":41,"column":40}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":39}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":30}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":27}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":44}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":42}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":36}},"7":{"start":{"line":12,"column":0},"end":{"line":21,"column":3}},"8":{"start":{"line":13,"column":1},"end":{"line":13,"column":44}},"9":{"start":{"line":14,"column":1},"end":{"line":14,"column":22}},"10":{"start":{"line":15,"column":1},"end":{"line":15,"column":49}},"11":{"start":{"line":15,"column":32},"end":{"line":15,"column":45}},"12":{"start":{"line":16,"column":1},"end":{"line":16,"column":44}},"13":{"start":{"line":17,"column":1},"end":{"line":19,"column":2}},"14":{"start":{"line":18,"column":2},"end":{"line":18,"column":30}},"15":{"start":{"line":20,"column":1},"end":{"line":20,"column":47}},"16":{"start":{"line":27,"column":0},"end":{"line":39,"column":3}},"17":{"start":{"line":28,"column":1},"end":{"line":28,"column":68}},"18":{"start":{"line":29,"column":1},"end":{"line":29,"column":27}},"19":{"start":{"line":30,"column":1},"end":{"line":30,"column":30}},"20":{"start":{"line":32,"column":1},"end":{"line":38,"column":4}},"21":{"start":{"line":33,"column":2},"end":{"line":33,"column":21}},"22":{"start":{"line":33,"column":11},"end":{"line":33,"column":21}},"23":{"start":{"line":34,"column":2},"end":{"line":37,"column":5}},"24":{"start":{"line":35,"column":3},"end":{"line":35,"column":22}},"25":{"start":{"line":35,"column":12},"end":{"line":35,"column":22}},"26":{"start":{"line":36,"column":3},"end":{"line":36,"column":10}},"27":{"start":{"line":41,"column":0},"end":{"line":45,"column":3}},"28":{"start":{"line":42,"column":1},"end":{"line":44,"column":21}},"29":{"start":{"line":47,"column":0},"end":{"line":47,"column":53}}},"branchMap":{"1":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},{"start":{"line":17,"column":1},"end":{"line":17,"column":1}}]},"2":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":2},"end":{"line":33,"column":2}},{"start":{"line":33,"column":2},"end":{"line":33,"column":2}}]},"3":{"line":35,"type":"if","locations":[{"start":{"line":35,"column":3},"end":{"line":35,"column":3}},{"start":{"line":35,"column":3},"end":{"line":35,"column":3}}]}},"code":["var browserify = require('browserify');","var git = require('gulp-git');","var gulp = require('gulp');","var source = require('vinyl-source-stream');","var streamify = require('gulp-streamify');","var uglify = require('gulp-uglify');","","/**"," * Build Tasks"," */","","gulp.task('build-packages', function() {","\tvar packages = require('./admin/packages');","\tvar b = browserify();","\tpackages.forEach(function(i) { b.require(i); });","\tb = b.bundle().pipe(source('packages.js'));","\tif (process.env.NODE_ENV === 'production') {","\t\tb.pipe(streamify(uglify()));","\t}","\treturn b.pipe(gulp.dest('./admin/public/js'));","});","","/**"," * Release Tasks"," */","","gulp.task('publish:tag', function(done) {","\tvar pkg = JSON.parse(require('fs').readFileSync('./package.json'));","\tvar v = 'v' + pkg.version;","\tvar message = 'Release ' + v;","","\tgit.tag(v, message, function (err) {","\t\tif (err) throw err;","\t\tgit.push('origin', v, function (err) {","\t\t\tif (err) throw err;","\t\t\tdone();","\t\t});","\t});","});","","gulp.task('publish:npm', function(done) {","\trequire('child_process')","\t\t.spawn('npm', ['publish'], { stdio: 'inherit' })","\t\t.on('close', done);","});","","gulp.task('release', ['publish:tag', 'publish:npm']);","",""],"l":{"1":2,"2":2,"3":0,"4":0,"5":0,"6":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"20":0,"27":0,"28":0,"29":0,"30":0,"32":0,"33":0,"34":0,"35":0,"36":0,"41":0,"42":0,"47":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/updates.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/updates.js","s":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"9":2,"10":2,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0,0],"32":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"(anonymous_1)","line":20,"loc":{"start":{"line":20,"column":16},"end":{"line":20,"column":35}}},"2":{"name":"(anonymous_2)","line":31,"loc":{"start":{"line":31,"column":16},"end":{"line":31,"column":27}}},"3":{"name":"(anonymous_3)","line":37,"loc":{"start":{"line":37,"column":19},"end":{"line":37,"column":40}}},"4":{"name":"(anonymous_4)","line":38,"loc":{"start":{"line":38,"column":32},"end":{"line":38,"column":60}}},"5":{"name":"(anonymous_5)","line":56,"loc":{"start":{"line":56,"column":14},"end":{"line":56,"column":29}}},"6":{"name":"(anonymous_6)","line":57,"loc":{"start":{"line":57,"column":39},"end":{"line":57,"column":60}}},"7":{"name":"(anonymous_7)","line":74,"loc":{"start":{"line":74,"column":25},"end":{"line":74,"column":36}}},"8":{"name":"(anonymous_8)","line":99,"loc":{"start":{"line":99,"column":12},"end":{"line":99,"column":26}}},"9":{"name":"(anonymous_9)","line":108,"loc":{"start":{"line":108,"column":12},"end":{"line":108,"column":26}}},"10":{"name":"(anonymous_10)","line":135,"loc":{"start":{"line":135,"column":7},"end":{"line":135,"column":19}}},"11":{"name":"(anonymous_11)","line":138,"loc":{"start":{"line":138,"column":12},"end":{"line":138,"column":24}}},"12":{"name":"(anonymous_12)","line":141,"loc":{"start":{"line":141,"column":10},"end":{"line":141,"column":25}}},"13":{"name":"(anonymous_13)","line":146,"loc":{"start":{"line":146,"column":40},"end":{"line":146,"column":54}}},"14":{"name":"(anonymous_14)","line":175,"loc":{"start":{"line":175,"column":20},"end":{"line":175,"column":31}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":29}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":23}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":30}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":33}},"6":{"start":{"line":6,"column":0},"end":{"line":6,"column":27}},"7":{"start":{"line":7,"column":0},"end":{"line":7,"column":31}},"8":{"start":{"line":8,"column":0},"end":{"line":8,"column":38}},"9":{"start":{"line":10,"column":0},"end":{"line":10,"column":66}},"10":{"start":{"line":13,"column":0},"end":{"line":16,"column":55}},"11":{"start":{"line":17,"column":0},"end":{"line":17,"column":42}},"12":{"start":{"line":20,"column":0},"end":{"line":182,"column":2}},"13":{"start":{"line":22,"column":1},"end":{"line":22,"column":43}},"14":{"start":{"line":23,"column":1},"end":{"line":23,"column":21}},"15":{"start":{"line":24,"column":1},"end":{"line":24,"column":20}},"16":{"start":{"line":25,"column":1},"end":{"line":25,"column":19}},"17":{"start":{"line":27,"column":1},"end":{"line":27,"column":58}},"18":{"start":{"line":31,"column":1},"end":{"line":35,"column":3}},"19":{"start":{"line":32,"column":2},"end":{"line":34,"column":3}},"20":{"start":{"line":33,"column":3},"end":{"line":33,"column":45}},"21":{"start":{"line":37,"column":1},"end":{"line":123,"column":3}},"22":{"start":{"line":38,"column":2},"end":{"line":122,"column":5}},"23":{"start":{"line":39,"column":3},"end":{"line":121,"column":4}},"24":{"start":{"line":40,"column":4},"end":{"line":40,"column":71}},"25":{"start":{"line":41,"column":4},"end":{"line":41,"column":21}},"26":{"start":{"line":42,"column":4},"end":{"line":42,"column":14}},"27":{"start":{"line":43,"column":10},"end":{"line":121,"column":4}},"28":{"start":{"line":44,"column":4},"end":{"line":44,"column":55}},"29":{"start":{"line":46,"column":4},"end":{"line":49,"column":5}},"30":{"start":{"line":47,"column":5},"end":{"line":47,"column":17}},"31":{"start":{"line":48,"column":5},"end":{"line":48,"column":19}},"32":{"start":{"line":51,"column":4},"end":{"line":80,"column":5}},"33":{"start":{"line":52,"column":5},"end":{"line":53,"column":33}},"34":{"start":{"line":54,"column":5},"end":{"line":54,"column":78}},"35":{"start":{"line":56,"column":5},"end":{"line":79,"column":7}},"36":{"start":{"line":57,"column":6},"end":{"line":78,"column":9}},"37":{"start":{"line":58,"column":7},"end":{"line":77,"column":8}},"38":{"start":{"line":59,"column":8},"end":{"line":59,"column":50}},"39":{"start":{"line":61,"column":8},"end":{"line":64,"column":15}},"40":{"start":{"line":65,"column":8},"end":{"line":65,"column":19}},"41":{"start":{"line":68,"column":8},"end":{"line":71,"column":15}},"42":{"start":{"line":74,"column":8},"end":{"line":76,"column":11}},"43":{"start":{"line":75,"column":9},"end":{"line":75,"column":19}},"44":{"start":{"line":82,"column":4},"end":{"line":85,"column":5}},"45":{"start":{"line":83,"column":5},"end":{"line":83,"column":108}},"46":{"start":{"line":84,"column":5},"end":{"line":84,"column":20}},"47":{"start":{"line":87,"column":4},"end":{"line":90,"column":5}},"48":{"start":{"line":88,"column":5},"end":{"line":88,"column":18}},"49":{"start":{"line":89,"column":5},"end":{"line":89,"column":19}},"50":{"start":{"line":92,"column":4},"end":{"line":95,"column":5}},"51":{"start":{"line":93,"column":5},"end":{"line":93,"column":17}},"52":{"start":{"line":94,"column":5},"end":{"line":94,"column":19}},"53":{"start":{"line":96,"column":4},"end":{"line":96,"column":64}},"54":{"start":{"line":97,"column":4},"end":{"line":118,"column":5}},"55":{"start":{"line":98,"column":5},"end":{"line":98,"column":19}},"56":{"start":{"line":99,"column":5},"end":{"line":105,"column":8}},"57":{"start":{"line":100,"column":6},"end":{"line":104,"column":7}},"58":{"start":{"line":101,"column":7},"end":{"line":103,"column":8}},"59":{"start":{"line":102,"column":8},"end":{"line":102,"column":41}},"60":{"start":{"line":106,"column":5},"end":{"line":106,"column":12}},"61":{"start":{"line":108,"column":5},"end":{"line":117,"column":8}},"62":{"start":{"line":109,"column":6},"end":{"line":116,"column":7}},"63":{"start":{"line":110,"column":7},"end":{"line":110,"column":21}},"64":{"start":{"line":111,"column":7},"end":{"line":115,"column":8}},"65":{"start":{"line":112,"column":8},"end":{"line":112,"column":15}},"66":{"start":{"line":114,"column":8},"end":{"line":114,"column":45}},"67":{"start":{"line":120,"column":4},"end":{"line":120,"column":11}},"68":{"start":{"line":125,"column":1},"end":{"line":132,"column":2}},"69":{"start":{"line":126,"column":2},"end":{"line":130,"column":84}},"70":{"start":{"line":131,"column":2},"end":{"line":131,"column":17}},"71":{"start":{"line":134,"column":1},"end":{"line":144,"column":5}},"72":{"start":{"line":137,"column":3},"end":{"line":137,"column":105}},"73":{"start":{"line":140,"column":3},"end":{"line":140,"column":45}},"74":{"start":{"line":143,"column":3},"end":{"line":143,"column":59}},"75":{"start":{"line":146,"column":1},"end":{"line":181,"column":4}},"76":{"start":{"line":147,"column":2},"end":{"line":166,"column":3}},"77":{"start":{"line":148,"column":3},"end":{"line":148,"column":19}},"78":{"start":{"line":149,"column":3},"end":{"line":154,"column":4}},"79":{"start":{"line":150,"column":4},"end":{"line":150,"column":78}},"80":{"start":{"line":151,"column":4},"end":{"line":153,"column":5}},"81":{"start":{"line":152,"column":5},"end":{"line":152,"column":20}},"82":{"start":{"line":155,"column":3},"end":{"line":160,"column":4}},"83":{"start":{"line":156,"column":4},"end":{"line":156,"column":65}},"84":{"start":{"line":157,"column":4},"end":{"line":159,"column":5}},"85":{"start":{"line":158,"column":5},"end":{"line":158,"column":20}},"86":{"start":{"line":161,"column":3},"end":{"line":163,"column":4}},"87":{"start":{"line":162,"column":4},"end":{"line":162,"column":63}},"88":{"start":{"line":164,"column":3},"end":{"line":164,"column":17}},"89":{"start":{"line":165,"column":3},"end":{"line":165,"column":59}},"90":{"start":{"line":167,"column":2},"end":{"line":179,"column":3}},"91":{"start":{"line":168,"column":3},"end":{"line":168,"column":98}},"92":{"start":{"line":169,"column":3},"end":{"line":171,"column":4}},"93":{"start":{"line":170,"column":4},"end":{"line":170,"column":38}},"94":{"start":{"line":172,"column":3},"end":{"line":172,"column":20}},"95":{"start":{"line":173,"column":3},"end":{"line":173,"column":17}},"96":{"start":{"line":175,"column":3},"end":{"line":177,"column":6}},"97":{"start":{"line":176,"column":4},"end":{"line":176,"column":20}},"98":{"start":{"line":178,"column":3},"end":{"line":178,"column":10}},"99":{"start":{"line":180,"column":2},"end":{"line":180,"column":25}}},"branchMap":{"1":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":3},"end":{"line":39,"column":3}},{"start":{"line":39,"column":3},"end":{"line":39,"column":3}}]},"2":{"line":43,"type":"if","locations":[{"start":{"line":43,"column":10},"end":{"line":43,"column":10}},{"start":{"line":43,"column":10},"end":{"line":43,"column":10}}]},"3":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":4},"end":{"line":46,"column":4}},{"start":{"line":46,"column":4},"end":{"line":46,"column":4}}]},"4":{"line":51,"type":"if","locations":[{"start":{"line":51,"column":4},"end":{"line":51,"column":4}},{"start":{"line":51,"column":4},"end":{"line":51,"column":4}}]},"5":{"line":53,"type":"binary-expr","locations":[{"start":{"line":53,"column":12},"end":{"line":53,"column":26}},{"start":{"line":53,"column":30},"end":{"line":53,"column":32}}]},"6":{"line":54,"type":"cond-expr","locations":[{"start":{"line":54,"column":51},"end":{"line":54,"column":72}},{"start":{"line":54,"column":75},"end":{"line":54,"column":77}}]},"7":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":7},"end":{"line":58,"column":7}},{"start":{"line":58,"column":7},"end":{"line":58,"column":7}}]},"8":{"line":59,"type":"cond-expr","locations":[{"start":{"line":59,"column":31},"end":{"line":59,"column":44}},{"start":{"line":59,"column":47},"end":{"line":59,"column":49}}]},"9":{"line":82,"type":"if","locations":[{"start":{"line":82,"column":4},"end":{"line":82,"column":4}},{"start":{"line":82,"column":4},"end":{"line":82,"column":4}}]},"10":{"line":87,"type":"if","locations":[{"start":{"line":87,"column":4},"end":{"line":87,"column":4}},{"start":{"line":87,"column":4},"end":{"line":87,"column":4}}]},"11":{"line":92,"type":"if","locations":[{"start":{"line":92,"column":4},"end":{"line":92,"column":4}},{"start":{"line":92,"column":4},"end":{"line":92,"column":4}}]},"12":{"line":97,"type":"if","locations":[{"start":{"line":97,"column":4},"end":{"line":97,"column":4}},{"start":{"line":97,"column":4},"end":{"line":97,"column":4}}]},"13":{"line":100,"type":"if","locations":[{"start":{"line":100,"column":6},"end":{"line":100,"column":6}},{"start":{"line":100,"column":6},"end":{"line":100,"column":6}}]},"14":{"line":101,"type":"if","locations":[{"start":{"line":101,"column":7},"end":{"line":101,"column":7}},{"start":{"line":101,"column":7},"end":{"line":101,"column":7}}]},"15":{"line":109,"type":"if","locations":[{"start":{"line":109,"column":6},"end":{"line":109,"column":6}},{"start":{"line":109,"column":6},"end":{"line":109,"column":6}}]},"16":{"line":111,"type":"if","locations":[{"start":{"line":111,"column":7},"end":{"line":111,"column":7}},{"start":{"line":111,"column":7},"end":{"line":111,"column":7}}]},"17":{"line":125,"type":"if","locations":[{"start":{"line":125,"column":1},"end":{"line":125,"column":1}},{"start":{"line":125,"column":1},"end":{"line":125,"column":1}}]},"18":{"line":137,"type":"cond-expr","locations":[{"start":{"line":137,"column":73},"end":{"line":137,"column":78}},{"start":{"line":137,"column":81},"end":{"line":137,"column":104}}]},"19":{"line":137,"type":"binary-expr","locations":[{"start":{"line":137,"column":11},"end":{"line":137,"column":36}},{"start":{"line":137,"column":40},"end":{"line":137,"column":69}}]},"20":{"line":140,"type":"binary-expr","locations":[{"start":{"line":140,"column":10},"end":{"line":140,"column":11}},{"start":{"line":140,"column":15},"end":{"line":140,"column":44}}]},"21":{"line":147,"type":"if","locations":[{"start":{"line":147,"column":2},"end":{"line":147,"column":2}},{"start":{"line":147,"column":2},"end":{"line":147,"column":2}}]},"22":{"line":147,"type":"binary-expr","locations":[{"start":{"line":147,"column":6},"end":{"line":147,"column":17}},{"start":{"line":147,"column":21},"end":{"line":147,"column":31}},{"start":{"line":147,"column":35},"end":{"line":147,"column":44}}]},"23":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":3},"end":{"line":149,"column":3}},{"start":{"line":149,"column":3},"end":{"line":149,"column":3}}]},"24":{"line":151,"type":"if","locations":[{"start":{"line":151,"column":4},"end":{"line":151,"column":4}},{"start":{"line":151,"column":4},"end":{"line":151,"column":4}}]},"25":{"line":151,"type":"binary-expr","locations":[{"start":{"line":151,"column":8},"end":{"line":151,"column":17}},{"start":{"line":151,"column":21},"end":{"line":151,"column":31}}]},"26":{"line":155,"type":"if","locations":[{"start":{"line":155,"column":3},"end":{"line":155,"column":3}},{"start":{"line":155,"column":3},"end":{"line":155,"column":3}}]},"27":{"line":157,"type":"if","locations":[{"start":{"line":157,"column":4},"end":{"line":157,"column":4}},{"start":{"line":157,"column":4},"end":{"line":157,"column":4}}]},"28":{"line":161,"type":"if","locations":[{"start":{"line":161,"column":3},"end":{"line":161,"column":3}},{"start":{"line":161,"column":3},"end":{"line":161,"column":3}}]},"29":{"line":167,"type":"if","locations":[{"start":{"line":167,"column":2},"end":{"line":167,"column":2}},{"start":{"line":167,"column":2},"end":{"line":167,"column":2}}]},"30":{"line":169,"type":"if","locations":[{"start":{"line":169,"column":3},"end":{"line":169,"column":3}},{"start":{"line":169,"column":3},"end":{"line":169,"column":3}}]},"31":{"line":169,"type":"binary-expr","locations":[{"start":{"line":169,"column":9},"end":{"line":169,"column":20}},{"start":{"line":169,"column":24},"end":{"line":169,"column":34}},{"start":{"line":169,"column":38},"end":{"line":169,"column":47}}]},"32":{"line":180,"type":"binary-expr","locations":[{"start":{"line":180,"column":2},"end":{"line":180,"column":10}},{"start":{"line":180,"column":14},"end":{"line":180,"column":24}}]}},"code":["var _ = require('underscore');","var async = require('async');","var fs = require('fs');","var keystone = require('../');","var mongoose = keystone.mongoose;","var path = require('path');","var semver = require('semver');","var utils = require('keystone-utils');","","var _dashes_ = '------------------------------------------------';","","// Update Schema - automatically created and managed by Keystone when updates are used","var UpdateModel = new mongoose.Schema({","\tkey: { type: String, index: true },","\tappliedOn: { type: Date, default: Date.now }","}, { collection: keystone.prefixModel('App_Update') });","mongoose.model('App_Update', UpdateModel);","","// Apply method - loads the available updates and applies any that haven't been, in order","exports.apply = function(callback) {","","\tvar Update = mongoose.model('App_Update');","\tvar updateCount = 0;","\tvar deferCount = 0;","\tvar skipCount = 0;","","\tvar updatesPath = keystone.getPath('updates', 'updates');","","\t// logError is used to log errors before the process exits since it is more synchronous than console.error.  Using ","\t// console.error gets into race condition issues with process.exit, which has higher priority.","\tvar logError = function() {","\t\tfor (var i = 0, len = arguments.length; i < len; ++i) {","\t\t\tprocess.stderr.write(arguments[i] + '\\n');","\t\t}","\t};","","\tvar applyUpdate = function(file, done) {","\t\tUpdate.findOne({ key: file }, function(err, updateRecord) {","\t\t\tif (err) {","\t\t\t\tconsole.error('Error searching database for update ' + file + ':');","\t\t\t\tconsole.dir(err);","\t\t\t\tdone(err);","\t\t\t} else if (!updateRecord) {","\t\t\t\tvar update = require(path.join(updatesPath, file));","\t\t\t\t// skip updates that export a falsy value","\t\t\t\tif (!update) {","\t\t\t\t\tskipCount++;","\t\t\t\t\treturn done();","\t\t\t\t}","\t\t\t\t// auto-wrap create scripts for a friendlier shorthand syntax","\t\t\t\tif (_.isObject(update.create)) {","\t\t\t\t\tvar items = update.create,","\t\t\t\t\t\tops = update.options || {};","\t\t\t\t\tvar background_mode = update.__background__ ? ' (background mode) ' : '';","\t\t\t\t\t","\t\t\t\t\tupdate = function(done) {","\t\t\t\t\t\tkeystone.createItems(items, ops, function(err, stats) {","\t\t\t\t\t\t\tif (!err) {","\t\t\t\t\t\t\t\tvar statsMsg = stats ? stats.message : '';","","\t\t\t\t\t\t\t\tconsole.log('\\n' + _dashes_,","\t\t\t\t\t\t\t\t\t'\\n' + keystone.get('name') + ': Successfully applied update ' + file + background_mode + '.',","\t\t\t\t\t\t\t\t\t'\\n' + statsMsg,","\t\t\t\t\t\t\t\t\t'\\n');","\t\t\t\t\t\t\t\tdone(null);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\telse {","\t\t\t\t\t\t\t\tlogError('\\n' + _dashes_,","\t\t\t\t\t\t\t\t\t'\\n' + keystone.get('name') + ': Update ' + file + background_mode + ' failed with errors:',","\t\t\t\t\t\t\t\t\t'\\n' + err,","\t\t\t\t\t\t\t\t\t'\\n');","","\t\t\t\t\t\t\t\t// give the logging some time to finish","\t\t\t\t\t\t\t\tprocess.nextTick(function() {","\t\t\t\t\t\t\t\t\tdone(err);","\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t}","\t\t\t\t\t\t});","\t\t\t\t\t};","\t\t\t\t}","\t\t\t\t// ensure type","\t\t\t\tif (!_.isFunction(update)) {","\t\t\t\t\tconsole.log('\\nError in update file ./updates/' + file + '.js\\nUpdate files must export a function\\n');","\t\t\t\t\tprocess.exit();","\t\t\t\t}","\t\t\t\t// if an update is deferred, don't process it","\t\t\t\tif (update.__defer__) {","\t\t\t\t\tdeferCount++;","\t\t\t\t\treturn done();","\t\t\t\t}","\t\t\t\t// if there are deferred updates, don't process any subsequent ones","\t\t\t\tif (deferCount) {","\t\t\t\t\tskipCount++;","\t\t\t\t\treturn done();","\t\t\t\t}","\t\t\t\tconsole.log(_dashes_ + '\\nApplying update ' + file + '...');","\t\t\t\tif (update.__background__) {","\t\t\t\t\tupdateCount++;","\t\t\t\t\tupdate(function(err) {","\t\t\t\t\t\tif (!err) {","\t\t\t\t\t\t\tif (update.__commit__ !== false) {","\t\t\t\t\t\t\t\tnew Update({ key: file }).save();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t});","\t\t\t\t\tdone();","\t\t\t\t} else {","\t\t\t\t\tupdate(function(err) {","\t\t\t\t\t\tif (!err) {","\t\t\t\t\t\t\tupdateCount++;","\t\t\t\t\t\t\tif (update.__commit__ === false) {","\t\t\t\t\t\t\t\tdone();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tnew Update({ key: file }).save(done);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t});","\t\t\t\t}","\t\t\t} else {","\t\t\t\tdone();","\t\t\t}","\t\t});","\t};","","\tif (!fs.existsSync(updatesPath)) {","\t\tconsole.log('\\nKeystoneJS Update Error:\\n\\n' +","\t\t\t'An updates folder must exist in your project root to use automatic updates.\\n' +","\t\t\t'If you want to use a custom path for your updates, set the `updates` option.\\n' +","\t\t\t'If you don\\'t want to use updates, set the `auto update` option to `false`.\\n' +","\t\t\t'See http://keystonejs.com/docs/configuration/#updates for more information.\\n');","\t\tprocess.exit();","\t}","","\tvar updates = fs.readdirSync(updatesPath)","\t\t.map(function(i) {","\t\t\t// exclude non-javascript or coffee files in the updates folder","\t\t\treturn (path.extname(i) !== '.js' && path.extname(i) !== '.coffee') ? false : path.basename(i, '.js');","\t\t}).filter(function(i) {","\t\t\t// exclude falsy values and filenames that without a valid semver","\t\t\treturn i && semver.valid(i.split('-')[0]);","\t\t}).sort(function(a, b) {","\t\t\t// exclude anything after a hyphen from the version number","\t\t\treturn semver.compare(a.split('-')[0], b.split('-')[0]);","\t\t});","","\tasync.eachSeries(updates, applyUpdate, function(err) {","\t\tif (updateCount || deferCount || skipCount) {","\t\t\tvar status = '';","\t\t\tif (updateCount) {","\t\t\t\tstatus += 'Successfully applied ' + utils.plural(updateCount, '* update');","\t\t\t\tif (skipCount || deferCount) {","\t\t\t\t\tstatus += ', ';","\t\t\t\t}","\t\t\t}","\t\t\tif (deferCount) {","\t\t\t\tstatus += 'Deferred ' + utils.plural(deferCount, '* update');","\t\t\t\tif (skipCount) {","\t\t\t\t\tstatus += ', ';","\t\t\t\t}","\t\t\t}","\t\t\tif (skipCount) {","\t\t\t\tstatus += 'Skipped ' + utils.plural(skipCount, '* update');","\t\t\t}","\t\t\tstatus += '.';","\t\t\tconsole.log(_dashes_ + '\\n' + status + '\\n' + _dashes_);","\t\t}","\t\tif (err) {","\t\t\tvar errmsg = 'An error occurred applying updates, bailing on Keystone init.\\n\\nError details:';","\t\t\tif (!(updateCount || deferCount || skipCount)) {","\t\t\t\terrmsg = _dashes_ + '\\n' + errmsg;","\t\t\t}","\t\t\tlogError(errmsg);","\t\t\tlogError(err);","\t\t\t// wait till nextTick to exit so the trace completes.","\t\t\tprocess.nextTick(function() {","\t\t\t\tprocess.exit(1);","\t\t\t});","\t\t\treturn;","\t\t}","\t\tcallback && callback();// eslint-disable-line no-unused-expressions","\t});","};",""],"l":{"1":2,"2":2,"3":2,"4":2,"5":2,"6":2,"7":2,"8":2,"10":2,"13":2,"17":0,"20":0,"22":0,"23":0,"24":0,"25":0,"27":0,"31":0,"32":0,"33":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"46":0,"47":0,"48":0,"51":0,"52":0,"54":0,"56":0,"57":0,"58":0,"59":0,"61":0,"65":0,"68":0,"74":0,"75":0,"82":0,"83":0,"84":0,"87":0,"88":0,"89":0,"92":0,"93":0,"94":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"106":0,"108":0,"109":0,"110":0,"111":0,"112":0,"114":0,"120":0,"125":0,"126":0,"131":0,"134":0,"137":0,"140":0,"143":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":0,"155":0,"156":0,"157":0,"158":0,"161":0,"162":0,"164":0,"165":0,"167":0,"168":0,"169":0,"170":0,"172":0,"173":0,"175":0,"176":0,"178":0,"180":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/server/startLetsEncrypt.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/server/startLetsEncrypt.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":1,"9":1,"10":1,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":1,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":1,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},"b":{"1":[0,0],"2":[0,0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},"fnMap":{"1":{"name":"makeSslRedirect","line":25,"loc":{"start":{"line":25,"column":0},"end":{"line":25,"column":31}}},"2":{"name":"sslRedirect","line":26,"loc":{"start":{"line":26,"column":8},"end":{"line":26,"column":40}}},"3":{"name":"autoRegister","line":39,"loc":{"start":{"line":39,"column":0},"end":{"line":39,"column":39}}},"4":{"name":"(anonymous_4)","line":43,"loc":{"start":{"line":43,"column":8},"end":{"line":43,"column":37}}},"5":{"name":"(anonymous_5)","line":57,"loc":{"start":{"line":57,"column":17},"end":{"line":57,"column":52}}},"6":{"name":"(anonymous_6)","line":86,"loc":{"start":{"line":86,"column":2},"end":{"line":86,"column":18}}},"7":{"name":"(anonymous_7)","line":92,"loc":{"start":{"line":92,"column":2},"end":{"line":92,"column":18}}},"8":{"name":"ready","line":98,"loc":{"start":{"line":98,"column":5},"end":{"line":98,"column":26}}}},"statementMap":{"1":{"start":{"line":12,"column":0},"end":{"line":12,"column":29}},"2":{"start":{"line":13,"column":0},"end":{"line":13,"column":27}},"3":{"start":{"line":14,"column":0},"end":{"line":14,"column":10}},"4":{"start":{"line":15,"column":0},"end":{"line":20,"column":1}},"5":{"start":{"line":17,"column":1},"end":{"line":17,"column":25}},"6":{"start":{"line":19,"column":1},"end":{"line":19,"column":26}},"7":{"start":{"line":21,"column":0},"end":{"line":21,"column":27}},"8":{"start":{"line":22,"column":0},"end":{"line":22,"column":49}},"9":{"start":{"line":23,"column":0},"end":{"line":23,"column":78}},"10":{"start":{"line":25,"column":0},"end":{"line":37,"column":1}},"11":{"start":{"line":26,"column":1},"end":{"line":36,"column":2}},"12":{"start":{"line":28,"column":2},"end":{"line":28,"column":22}},"13":{"start":{"line":29,"column":2},"end":{"line":35,"column":3}},"14":{"start":{"line":30,"column":3},"end":{"line":30,"column":24}},"15":{"start":{"line":32,"column":3},"end":{"line":32,"column":70}},"16":{"start":{"line":33,"column":3},"end":{"line":33,"column":24}},"17":{"start":{"line":34,"column":3},"end":{"line":34,"column":13}},"18":{"start":{"line":39,"column":0},"end":{"line":56,"column":1}},"19":{"start":{"line":40,"column":1},"end":{"line":42,"column":2}},"20":{"start":{"line":41,"column":2},"end":{"line":41,"column":22}},"21":{"start":{"line":43,"column":1},"end":{"line":55,"column":3}},"22":{"start":{"line":44,"column":2},"end":{"line":54,"column":3}},"23":{"start":{"line":45,"column":3},"end":{"line":45,"column":82}},"24":{"start":{"line":46,"column":3},"end":{"line":50,"column":6}},"25":{"start":{"line":52,"column":3},"end":{"line":52,"column":79}},"26":{"start":{"line":53,"column":3},"end":{"line":53,"column":20}},"27":{"start":{"line":57,"column":0},"end":{"line":108,"column":2}},"28":{"start":{"line":59,"column":1},"end":{"line":59,"column":33}},"29":{"start":{"line":60,"column":1},"end":{"line":60,"column":46}},"30":{"start":{"line":61,"column":1},"end":{"line":61,"column":41}},"31":{"start":{"line":62,"column":1},"end":{"line":62,"column":50}},"32":{"start":{"line":63,"column":1},"end":{"line":63,"column":48}},"33":{"start":{"line":64,"column":1},"end":{"line":64,"column":52}},"34":{"start":{"line":66,"column":1},"end":{"line":66,"column":43}},"35":{"start":{"line":67,"column":1},"end":{"line":67,"column":27}},"36":{"start":{"line":68,"column":1},"end":{"line":68,"column":31}},"37":{"start":{"line":69,"column":1},"end":{"line":69,"column":25}},"38":{"start":{"line":70,"column":1},"end":{"line":77,"column":2}},"39":{"start":{"line":71,"column":2},"end":{"line":76,"column":3}},"40":{"start":{"line":72,"column":3},"end":{"line":72,"column":54}},"41":{"start":{"line":74,"column":3},"end":{"line":74,"column":125}},"42":{"start":{"line":75,"column":3},"end":{"line":75,"column":10}},"43":{"start":{"line":78,"column":1},"end":{"line":83,"column":4}},"44":{"start":{"line":85,"column":1},"end":{"line":106,"column":4}},"45":{"start":{"line":87,"column":3},"end":{"line":87,"column":55}},"46":{"start":{"line":88,"column":3},"end":{"line":90,"column":30}},"47":{"start":{"line":93,"column":3},"end":{"line":96,"column":36}},"48":{"start":{"line":99,"column":2},"end":{"line":99,"column":36}},"49":{"start":{"line":99,"column":13},"end":{"line":99,"column":34}},"50":{"start":{"line":101,"column":2},"end":{"line":104,"column":51}},"51":{"start":{"line":105,"column":2},"end":{"line":105,"column":26}}},"branchMap":{"1":{"line":29,"type":"if","locations":[{"start":{"line":29,"column":2},"end":{"line":29,"column":2}},{"start":{"line":29,"column":2},"end":{"line":29,"column":2}}]},"2":{"line":29,"type":"binary-expr","locations":[{"start":{"line":29,"column":6},"end":{"line":29,"column":7}},{"start":{"line":29,"column":11},"end":{"line":29,"column":42}},{"start":{"line":29,"column":46},"end":{"line":29,"column":76}},{"start":{"line":29,"column":80},"end":{"line":29,"column":111}}]},"3":{"line":40,"type":"if","locations":[{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},{"start":{"line":40,"column":1},"end":{"line":40,"column":1}}]},"4":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":2},"end":{"line":44,"column":2}},{"start":{"line":44,"column":2},"end":{"line":44,"column":2}}]},"5":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":12},"end":{"line":60,"column":32}},{"start":{"line":60,"column":36},"end":{"line":60,"column":45}}]},"6":{"line":61,"type":"binary-expr","locations":[{"start":{"line":61,"column":12},"end":{"line":61,"column":32}},{"start":{"line":61,"column":36},"end":{"line":61,"column":40}}]},"7":{"line":63,"type":"binary-expr","locations":[{"start":{"line":63,"column":15},"end":{"line":63,"column":39}},{"start":{"line":63,"column":43},"end":{"line":63,"column":47}}]},"8":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":15},"end":{"line":64,"column":39}},{"start":{"line":64,"column":43},"end":{"line":64,"column":51}}]},"9":{"line":70,"type":"if","locations":[{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},{"start":{"line":70,"column":1},"end":{"line":70,"column":1}}]},"10":{"line":71,"type":"if","locations":[{"start":{"line":71,"column":2},"end":{"line":71,"column":2}},{"start":{"line":71,"column":2},"end":{"line":71,"column":2}}]},"11":{"line":71,"type":"binary-expr","locations":[{"start":{"line":71,"column":6},"end":{"line":71,"column":17}},{"start":{"line":71,"column":21},"end":{"line":71,"column":26}},{"start":{"line":71,"column":30},"end":{"line":71,"column":37}}]},"12":{"line":79,"type":"binary-expr","locations":[{"start":{"line":79,"column":13},"end":{"line":79,"column":30}},{"start":{"line":79,"column":34},"end":{"line":79,"column":48}}]},"13":{"line":87,"type":"cond-expr","locations":[{"start":{"line":87,"column":28},"end":{"line":87,"column":48}},{"start":{"line":87,"column":51},"end":{"line":87,"column":54}}]},"14":{"line":99,"type":"if","locations":[{"start":{"line":99,"column":2},"end":{"line":99,"column":2}},{"start":{"line":99,"column":2},"end":{"line":99,"column":2}}]},"15":{"line":103,"type":"cond-expr","locations":[{"start":{"line":103,"column":16},"end":{"line":103,"column":33}},{"start":{"line":103,"column":36},"end":{"line":103,"column":38}}]}},"code":["/**"," * Configures and starts express server via Let's Encrypt."," *"," * Events are fired during initialisation to allow customisation, including:"," *   - onHttpServerCreated"," *"," * consumed by lib/core/start.js"," *"," * @api private"," */","","var async = require('async');","var http = require('http');","var https;","try {","\t// Use spdy if available","\thttps = require('spdy');","} catch (e) {","\thttps = require('https');","}","var path = require('path');","var letsencrypt = require('letsencrypt-express');","var letsencryptDir = path.join(require('os').homedir(), 'letsencrypt', 'etc');","","function makeSslRedirect (app) {","\treturn function sslRedirect (req, res) {","\t\t// This runs outside Express, so use pure NodeJS only","\t\tconst s = req.socket","\t\tif (s && s.remoteAddress === '127.0.0.1' && s.localAddress === '127.0.0.1' && !req.headers['x-forwarded-for']) {","\t\t\treturn app(req, res);","\t\t} else {","\t\t\tres.setHeader('Location', 'https://' + req.headers.host + req.url);","\t\t\tres.statusCode = 302;","\t\t\tres.end();","\t\t}","\t}","}","","function autoRegister (domains, email) {","\tif (!Array.isArray(domains)) {","\t\tdomains = [domains];","\t}","\treturn function (hostname, approve) {","\t\tif (domains.indexOf(hostname) !== -1) {","\t\t\tconsole.warn(\"Keystone Let's Encrypt: Approving registration for \" + hostname);","\t\t\tapprove(null, {","\t\t\t\tdomains: domains,","\t\t\t\temail: email,","\t\t\t\tagreeTos: true,","\t\t\t});","\t\t} else {","\t\t\tconsole.log(\"Keystone Let's Encrypt: Denying registration for \" + hostname);","\t\t\tapprove('Nope.');","\t\t}","\t};","}","module.exports = function (keystone, app, callback) {","","\tvar name = keystone.get('name');","\tvar host = keystone.get('host') || '0.0.0.0';","\tvar port = keystone.get('port') || 3000;","\tvar forceSsl = (keystone.get('ssl') === 'force');","\tvar sslHost = keystone.get('ssl host') || host;","\tvar sslPort = keystone.get('ssl port') || port + 1;","","\tvar options = keystone.get('letsencrypt');","\tvar email = options.email;","\tvar domains = options.domains;","\tvar approveRegistration;","\tif (options.register) {","\t\tif (options.tos && email && domains) {","\t\t\tapproveRegistration = autoRegister(domains, email);","\t\t} else {","\t\t\tcallback(\"For auto registation with Let's Encrypt you should agree to the TOS, provide domains and a domain owner email\");","\t\t\treturn;","\t\t}","\t}","\tvar instance = letsencrypt.create({","\t\tconfigDir: options.configDir || letsencryptDir,","\t\tonRequest: app,","\t\tapproveRegistration: approveRegistration,","\t\t// TODO handleRenewFailure","\t});","","\tasync.parallel([","\t\tfunction (done) {","\t\t\tvar serve = (forceSsl) ? makeSslRedirect(app) : app;","\t\t\tkeystone.httpServer = http.createServer(","\t\t\t\tletsencrypt.createAcmeResponder(instance, serve)","\t\t\t).listen(port, host, done);","\t\t},","\t\tfunction (done) {","\t\t\tkeystone.httpsServer = https.createServer(","\t\t\t\tinstance.httpsOptions,","\t\t\t\tletsencrypt.createAcmeResponder(instance, app)","\t\t\t).listen(sslPort, sslHost, done);","\t\t},","\t], \tfunction ready (err) {","\t\tif (err) { return callback(err); }","","\t\tvar message = name + ' is ready on '","\t\t+ 'http://' + host + ':' + port","\t\t+ (forceSsl ? ' (SSL redirect)' : '')","\t\t+ ' and ' + 'https://' + sslHost + ':' + sslPort;","\t\tcallback(null, message);","\t});","","};",""],"l":{"12":1,"13":1,"14":1,"15":1,"17":1,"19":1,"21":1,"22":1,"23":1,"25":1,"26":0,"28":0,"29":0,"30":0,"32":0,"33":0,"34":0,"39":1,"40":0,"41":0,"43":0,"44":0,"45":0,"46":0,"52":0,"53":0,"57":1,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"74":0,"75":0,"78":0,"85":0,"87":0,"88":0,"93":0,"99":0,"101":0,"105":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/cloudinary.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/cloudinary.js","s":{"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"fnMap":{"1":{"name":"(anonymous_1)","line":6,"loc":{"start":{"line":6,"column":9},"end":{"line":6,"column":28}}},"2":{"name":"(anonymous_2)","line":14,"loc":{"start":{"line":14,"column":51},"end":{"line":14,"column":68}}},"3":{"name":"(anonymous_3)","line":15,"loc":{"start":{"line":15,"column":21},"end":{"line":15,"column":33}}},"4":{"name":"(anonymous_4)","line":35,"loc":{"start":{"line":35,"column":15},"end":{"line":35,"column":34}}},"5":{"name":"(anonymous_5)","line":40,"loc":{"start":{"line":40,"column":27},"end":{"line":40,"column":44}}},"6":{"name":"(anonymous_6)","line":57,"loc":{"start":{"line":57,"column":6},"end":{"line":57,"column":25}}},"7":{"name":"(anonymous_7)","line":58,"loc":{"start":{"line":58,"column":40},"end":{"line":58,"column":57}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":39}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":33}},"3":{"start":{"line":4,"column":0},"end":{"line":66,"column":2}},"4":{"start":{"line":7,"column":2},"end":{"line":32,"column":3}},"5":{"start":{"line":8,"column":3},"end":{"line":8,"column":20}},"6":{"start":{"line":10,"column":3},"end":{"line":12,"column":4}},"7":{"start":{"line":11,"column":4},"end":{"line":11,"column":111}},"8":{"start":{"line":14,"column":3},"end":{"line":29,"column":15}},"9":{"start":{"line":15,"column":4},"end":{"line":21,"column":6}},"10":{"start":{"line":16,"column":5},"end":{"line":20,"column":6}},"11":{"start":{"line":17,"column":6},"end":{"line":17,"column":61}},"12":{"start":{"line":19,"column":6},"end":{"line":19,"column":47}},"13":{"start":{"line":25,"column":4},"end":{"line":28,"column":7}},"14":{"start":{"line":31,"column":3},"end":{"line":31,"column":57}},"15":{"start":{"line":36,"column":2},"end":{"line":36,"column":32}},"16":{"start":{"line":37,"column":2},"end":{"line":37,"column":38}},"17":{"start":{"line":38,"column":2},"end":{"line":38,"column":36}},"18":{"start":{"line":40,"column":2},"end":{"line":54,"column":5}},"19":{"start":{"line":41,"column":3},"end":{"line":48,"column":4}},"20":{"start":{"line":42,"column":4},"end":{"line":42,"column":59}},"21":{"start":{"line":44,"column":4},"end":{"line":47,"column":7}},"22":{"start":{"line":58,"column":2},"end":{"line":64,"column":5}},"23":{"start":{"line":59,"column":3},"end":{"line":63,"column":4}},"24":{"start":{"line":60,"column":4},"end":{"line":60,"column":59}},"25":{"start":{"line":62,"column":4},"end":{"line":62,"column":31}}},"branchMap":{"1":{"line":7,"type":"if","locations":[{"start":{"line":7,"column":2},"end":{"line":7,"column":2}},{"start":{"line":7,"column":2},"end":{"line":7,"column":2}}]},"2":{"line":7,"type":"binary-expr","locations":[{"start":{"line":7,"column":5},"end":{"line":7,"column":14}},{"start":{"line":7,"column":18},"end":{"line":7,"column":32}}]},"3":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":3},"end":{"line":10,"column":3}},{"start":{"line":10,"column":3},"end":{"line":10,"column":3}}]},"4":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":5},"end":{"line":16,"column":5}},{"start":{"line":16,"column":5},"end":{"line":16,"column":5}}]},"5":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":12},"end":{"line":36,"column":25}},{"start":{"line":36,"column":29},"end":{"line":36,"column":31}}]},"6":{"line":37,"type":"binary-expr","locations":[{"start":{"line":37,"column":15},"end":{"line":37,"column":31}},{"start":{"line":37,"column":35},"end":{"line":37,"column":37}}]},"7":{"line":38,"type":"binary-expr","locations":[{"start":{"line":38,"column":13},"end":{"line":38,"column":27}},{"start":{"line":38,"column":31},"end":{"line":38,"column":35}}]},"8":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":3},"end":{"line":41,"column":3}},{"start":{"line":41,"column":3},"end":{"line":41,"column":3}}]},"9":{"line":59,"type":"if","locations":[{"start":{"line":59,"column":3},"end":{"line":59,"column":3}},{"start":{"line":59,"column":3},"end":{"line":59,"column":3}}]}},"code":["var cloudinary = require('cloudinary');","var keystone = require('../../');","","exports = module.exports = {","","\tupload: function(req, res) {","\t\tif(req.files && req.files.file){","\t\t\tvar options = {};","","\t\t\tif (keystone.get('wysiwyg cloudinary images filenameAsPublicID')) {","\t\t\t\toptions.public_id = req.files.file.originalname.substring(0, req.files.file.originalname.lastIndexOf('.'));","\t\t\t}","","\t\t\tcloudinary.uploader.upload(req.files.file.path, function(result) {","\t\t\t\tvar sendResult = function () {","\t\t\t\t\tif (result.error) {","\t\t\t\t\t\tres.send({ error: { message: result.error.message } });","\t\t\t\t\t} else {","\t\t\t\t\t\tres.send({ image: { url: result.url } });","\t\t\t\t\t}","\t\t\t\t};","\t\t\t\t","\t\t\t\t// TinyMCE upload plugin uses the iframe transport technique","\t\t\t\t// so the response type must be text/html","\t\t\t\tres.format({","\t\t\t\t\thtml: sendResult,","\t\t\t\t\tjson: sendResult","\t\t\t\t});","\t\t\t}, options);","\t\t} else {","\t\t\tres.json({ error: { message: 'No image selected' } });","\t\t}","\t},","","\tautocomplete: function(req, res) {","\t\tvar max = req.query.max || 10;","\t\tvar prefix = req.query.prefix || '';","\t\tvar next = req.query.next || null;","","\t\tcloudinary.api.resources(function(result) {","\t\t\tif (result.error) {","\t\t\t\tres.json({ error: { message: result.error.message } });","\t\t\t} else {","\t\t\t\tres.json({","\t\t\t\t\tnext: result.next_cursor,","\t\t\t\t\titems: result.resources","\t\t\t\t});","\t\t\t}","\t\t}, { ","\t\t\ttype: 'upload',","\t\t\tprefix: prefix,","\t\t\tmax_results: max,","\t\t\tnext_cursor: next","\t\t});","\t},","","\tget: function(req, res) {","\t\tcloudinary.api.resource(req.query.id, function(result) {","\t\t\tif (result.error) {","\t\t\t\tres.json({ error: { message: result.error.message } });","\t\t\t} else {","\t\t\t\tres.json({ item: result });\t","\t\t\t}","\t\t});","\t}","};",""],"l":{"1":1,"2":1,"4":1,"7":0,"8":0,"10":0,"11":0,"14":0,"15":0,"16":0,"17":0,"19":0,"25":0,"31":0,"36":0,"37":0,"38":0,"40":0,"41":0,"42":0,"44":0,"58":0,"59":0,"60":0,"62":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/download.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/download.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"(anonymous_1)","line":9,"loc":{"start":{"line":9,"column":27},"end":{"line":9,"column":46}}},"2":{"name":"(anonymous_2)","line":15,"loc":{"start":{"line":15,"column":25},"end":{"line":15,"column":41}}},"3":{"name":"getRowData","line":21,"loc":{"start":{"line":21,"column":18},"end":{"line":21,"column":41}}},"4":{"name":"(anonymous_4)","line":29,"loc":{"start":{"line":29,"column":26},"end":{"line":29,"column":42}}},"5":{"name":"(anonymous_5)","line":37,"loc":{"start":{"line":37,"column":25},"end":{"line":37,"column":37}}},"6":{"name":"(anonymous_6)","line":67,"loc":{"start":{"line":67,"column":12},"end":{"line":67,"column":35}}},"7":{"name":"(anonymous_7)","line":71,"loc":{"start":{"line":71,"column":16},"end":{"line":71,"column":31}}},"8":{"name":"(anonymous_8)","line":103,"loc":{"start":{"line":103,"column":78},"end":{"line":103,"column":90}}},"9":{"name":"(anonymous_9)","line":112,"loc":{"start":{"line":112,"column":19},"end":{"line":112,"column":45}}},"10":{"name":"(anonymous_10)","line":113,"loc":{"start":{"line":113,"column":27},"end":{"line":113,"column":41}}},"11":{"name":"(anonymous_11)","line":121,"loc":{"start":{"line":121,"column":30},"end":{"line":121,"column":52}}},"12":{"name":"(anonymous_12)","line":128,"loc":{"start":{"line":128,"column":7},"end":{"line":128,"column":30}}},"13":{"name":"(anonymous_13)","line":141,"loc":{"start":{"line":141,"column":20},"end":{"line":141,"column":32}}},"14":{"name":"(anonymous_14)","line":148,"loc":{"start":{"line":148,"column":21},"end":{"line":148,"column":33}}},"15":{"name":"(anonymous_15)","line":165,"loc":{"start":{"line":165,"column":19},"end":{"line":165,"column":31}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":29}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":32}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":33}},"5":{"start":{"line":5,"column":0},"end":{"line":5,"column":31}},"6":{"start":{"line":7,"column":0},"end":{"line":7,"column":51}},"7":{"start":{"line":9,"column":0},"end":{"line":173,"column":2}},"8":{"start":{"line":11,"column":1},"end":{"line":11,"column":52}},"9":{"start":{"line":12,"column":1},"end":{"line":12,"column":73}},"10":{"start":{"line":13,"column":1},"end":{"line":13,"column":20}},"11":{"start":{"line":15,"column":1},"end":{"line":19,"column":4}},"12":{"start":{"line":16,"column":2},"end":{"line":18,"column":3}},"13":{"start":{"line":17,"column":3},"end":{"line":17,"column":30}},"14":{"start":{"line":21,"column":1},"end":{"line":61,"column":3}},"15":{"start":{"line":23,"column":2},"end":{"line":23,"column":29}},"16":{"start":{"line":25,"column":2},"end":{"line":27,"column":3}},"17":{"start":{"line":26,"column":3},"end":{"line":26,"column":79}},"18":{"start":{"line":29,"column":2},"end":{"line":57,"column":5}},"19":{"start":{"line":30,"column":3},"end":{"line":56,"column":4}},"20":{"start":{"line":31,"column":4},"end":{"line":31,"column":63}},"21":{"start":{"line":32,"column":10},"end":{"line":56,"column":4}},"22":{"start":{"line":33,"column":4},"end":{"line":33,"column":36}},"23":{"start":{"line":34,"column":4},"end":{"line":53,"column":5}},"24":{"start":{"line":35,"column":5},"end":{"line":35,"column":21}},"25":{"start":{"line":36,"column":5},"end":{"line":44,"column":6}},"26":{"start":{"line":37,"column":6},"end":{"line":43,"column":9}},"27":{"start":{"line":38,"column":7},"end":{"line":38,"column":51}},"28":{"start":{"line":39,"column":7},"end":{"line":41,"column":8}},"29":{"start":{"line":40,"column":8},"end":{"line":40,"column":45}},"30":{"start":{"line":42,"column":7},"end":{"line":42,"column":25}},"31":{"start":{"line":45,"column":5},"end":{"line":45,"column":45}},"32":{"start":{"line":47,"column":5},"end":{"line":52,"column":6}},"33":{"start":{"line":48,"column":6},"end":{"line":48,"column":62}},"34":{"start":{"line":49,"column":6},"end":{"line":49,"column":105}},"35":{"start":{"line":51,"column":6},"end":{"line":51,"column":95}},"36":{"start":{"line":55,"column":4},"end":{"line":55,"column":42}},"37":{"start":{"line":59,"column":2},"end":{"line":59,"column":17}},"38":{"start":{"line":63,"column":1},"end":{"line":63,"column":47}},"39":{"start":{"line":64,"column":1},"end":{"line":66,"column":2}},"40":{"start":{"line":65,"column":2},"end":{"line":65,"column":38}},"41":{"start":{"line":67,"column":1},"end":{"line":171,"column":4}},"42":{"start":{"line":69,"column":2},"end":{"line":69,"column":44}},"43":{"start":{"line":69,"column":11},"end":{"line":69,"column":44}},"44":{"start":{"line":71,"column":2},"end":{"line":81,"column":4}},"45":{"start":{"line":73,"column":3},"end":{"line":73,"column":85}},"46":{"start":{"line":74,"column":3},"end":{"line":74,"column":61}},"47":{"start":{"line":76,"column":3},"end":{"line":78,"column":6}},"48":{"start":{"line":80,"column":3},"end":{"line":80,"column":29}},"49":{"start":{"line":83,"column":2},"end":{"line":86,"column":3}},"50":{"start":{"line":85,"column":3},"end":{"line":85,"column":22}},"51":{"start":{"line":87,"column":2},"end":{"line":87,"column":11}},"52":{"start":{"line":89,"column":2},"end":{"line":169,"column":3}},"53":{"start":{"line":103,"column":3},"end":{"line":103,"column":112}},"54":{"start":{"line":103,"column":92},"end":{"line":103,"column":108}},"55":{"start":{"line":105,"column":3},"end":{"line":105,"column":51}},"56":{"start":{"line":107,"column":3},"end":{"line":110,"column":5}},"57":{"start":{"line":112,"column":3},"end":{"line":117,"column":5}},"58":{"start":{"line":113,"column":4},"end":{"line":115,"column":7}},"59":{"start":{"line":114,"column":5},"end":{"line":114,"column":22}},"60":{"start":{"line":116,"column":4},"end":{"line":116,"column":33}},"61":{"start":{"line":119,"column":3},"end":{"line":153,"column":4}},"62":{"start":{"line":121,"column":4},"end":{"line":135,"column":7}},"63":{"start":{"line":122,"column":5},"end":{"line":122,"column":29}},"64":{"start":{"line":123,"column":5},"end":{"line":123,"column":30}},"65":{"start":{"line":124,"column":5},"end":{"line":126,"column":6}},"66":{"start":{"line":125,"column":6},"end":{"line":125,"column":31}},"67":{"start":{"line":127,"column":5},"end":{"line":127,"column":33}},"68":{"start":{"line":129,"column":5},"end":{"line":133,"column":6}},"69":{"start":{"line":130,"column":6},"end":{"line":130,"column":67}},"70":{"start":{"line":131,"column":6},"end":{"line":131,"column":23}},"71":{"start":{"line":132,"column":6},"end":{"line":132,"column":132}},"72":{"start":{"line":134,"column":5},"end":{"line":134,"column":22}},"73":{"start":{"line":138,"column":4},"end":{"line":138,"column":14}},"74":{"start":{"line":139,"column":4},"end":{"line":151,"column":5}},"75":{"start":{"line":141,"column":4},"end":{"line":145,"column":8}},"76":{"start":{"line":142,"column":6},"end":{"line":142,"column":30}},"77":{"start":{"line":143,"column":6},"end":{"line":143,"column":31}},"78":{"start":{"line":144,"column":6},"end":{"line":144,"column":45}},"79":{"start":{"line":148,"column":5},"end":{"line":150,"column":7}},"80":{"start":{"line":149,"column":5},"end":{"line":149,"column":43}},"81":{"start":{"line":152,"column":4},"end":{"line":152,"column":25}},"82":{"start":{"line":164,"column":3},"end":{"line":164,"column":13}},"83":{"start":{"line":165,"column":3},"end":{"line":167,"column":6}},"84":{"start":{"line":166,"column":4},"end":{"line":166,"column":29}},"85":{"start":{"line":168,"column":3},"end":{"line":168,"column":24}}},"branchMap":{"1":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":2},"end":{"line":16,"column":2}},{"start":{"line":16,"column":2},"end":{"line":16,"column":2}}]},"2":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"3":{"line":30,"type":"if","locations":[{"start":{"line":30,"column":3},"end":{"line":30,"column":3}},{"start":{"line":30,"column":3},"end":{"line":30,"column":3}}]},"4":{"line":31,"type":"cond-expr","locations":[{"start":{"line":31,"column":46},"end":{"line":31,"column":52}},{"start":{"line":31,"column":55},"end":{"line":31,"column":62}}]},"5":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":10},"end":{"line":32,"column":10}},{"start":{"line":32,"column":10},"end":{"line":32,"column":10}}]},"6":{"line":34,"type":"if","locations":[{"start":{"line":34,"column":4},"end":{"line":34,"column":4}},{"start":{"line":34,"column":4},"end":{"line":34,"column":4}}]},"7":{"line":36,"type":"if","locations":[{"start":{"line":36,"column":5},"end":{"line":36,"column":5}},{"start":{"line":36,"column":5},"end":{"line":36,"column":5}}]},"8":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":9},"end":{"line":36,"column":31}},{"start":{"line":36,"column":35},"end":{"line":36,"column":49}}]},"9":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":7},"end":{"line":39,"column":7}},{"start":{"line":39,"column":7},"end":{"line":39,"column":7}}]},"10":{"line":47,"type":"if","locations":[{"start":{"line":47,"column":5},"end":{"line":47,"column":5}},{"start":{"line":47,"column":5},"end":{"line":47,"column":5}}]},"11":{"line":48,"type":"cond-expr","locations":[{"start":{"line":48,"column":46},"end":{"line":48,"column":56}},{"start":{"line":48,"column":59},"end":{"line":48,"column":61}}]},"12":{"line":49,"type":"cond-expr","locations":[{"start":{"line":49,"column":48},"end":{"line":49,"column":86}},{"start":{"line":49,"column":89},"end":{"line":49,"column":104}}]},"13":{"line":51,"type":"cond-expr","locations":[{"start":{"line":51,"column":38},"end":{"line":51,"column":76}},{"start":{"line":51,"column":79},"end":{"line":51,"column":94}}]},"14":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},{"start":{"line":64,"column":1},"end":{"line":64,"column":1}}]},"15":{"line":69,"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":69,"column":2}},{"start":{"line":69,"column":2},"end":{"line":69,"column":2}}]},"16":{"line":77,"type":"binary-expr","locations":[{"start":{"line":77,"column":15},"end":{"line":77,"column":50}},{"start":{"line":77,"column":54},"end":{"line":77,"column":57}}]},"17":{"line":83,"type":"if","locations":[{"start":{"line":83,"column":2},"end":{"line":83,"column":2}},{"start":{"line":83,"column":2},"end":{"line":83,"column":2}}]},"18":{"line":89,"type":"if","locations":[{"start":{"line":89,"column":2},"end":{"line":89,"column":2}},{"start":{"line":89,"column":2},"end":{"line":89,"column":2}}]},"19":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":3},"end":{"line":119,"column":3}},{"start":{"line":119,"column":3},"end":{"line":119,"column":3}}]},"20":{"line":124,"type":"if","locations":[{"start":{"line":124,"column":5},"end":{"line":124,"column":5}},{"start":{"line":124,"column":5},"end":{"line":124,"column":5}}]},"21":{"line":129,"type":"if","locations":[{"start":{"line":129,"column":5},"end":{"line":129,"column":5}},{"start":{"line":129,"column":5},"end":{"line":129,"column":5}}]},"22":{"line":139,"type":"if","locations":[{"start":{"line":139,"column":4},"end":{"line":139,"column":4}},{"start":{"line":139,"column":4},"end":{"line":139,"column":4}}]}},"code":["var _ = require('underscore');","var async = require('async');","var baby = require('babyparse');","var keystone = require('../../');","var moment = require('moment');","","var FN_ARGS = /^function\\s*[^\\(]*\\(\\s*([^\\)]*)\\)/m;","","exports = module.exports = function(req, res) {","","\tvar filters = req.list.processFilters(req.query.q);","\tvar queryFilters = req.list.getSearchFilters(req.query.search, filters);","\tvar relFields = [];","","\t_.each(req.list.fields, function(field) {","\t\tif (field.type === 'relationship') {","\t\t\trelFields.push(field.path);","\t\t}","\t});","","\tvar getRowData = function getRowData(i) {","","\t\tvar rowData = { id: i.id };","","\t\tif (req.list.get('autokey')) {","\t\t\trowData[req.list.get('autokey').path] = i.get(req.list.get('autokey').path);","\t\t}","","\t\t_.each(req.list.fields, function(field) {","\t\t\tif (field.type === 'boolean') {","\t\t\t\trowData[field.path] = i.get(field.path) ? 'true' : 'false';","\t\t\t} else if (field.type === 'relationship') {","\t\t\t\tvar refData = i.get(field.path);","\t\t\t\tif (field.many) {","\t\t\t\t\tvar values = [];","\t\t\t\t\tif (Array.isArray(refData) && refData.length) {","\t\t\t\t\t\t_.forEach(refData, function(i) {","\t\t\t\t\t\t\tvar name = field.refList.getDocumentName(i);","\t\t\t\t\t\t\tif(keystone.get('csv expanded')){","\t\t\t\t\t\t\t\tname = '[' + i.id + ',' + name + ']';","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvalues.push(name);","\t\t\t\t\t\t});","\t\t\t\t\t}","\t\t\t\t\trowData[field.path] = values.join(', ');","\t\t\t\t} else {","\t\t\t\t\tif (keystone.get('csv expanded')) {","\t\t\t\t\t\trowData[field.path + '_id'] = refData ? refData.id : '';","\t\t\t\t\t\trowData[field.path + '_name'] = refData ? field.refList.getDocumentName(refData) : field.format(i);","\t\t\t\t\t} else {","\t\t\t\t\t\trowData[field.path] = refData ? field.refList.getDocumentName(refData) : field.format(i);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t} else {","\t\t\t\trowData[field.path] = field.format(i);","\t\t\t}","\t\t});","","\t\treturn rowData;","","\t};","","\tvar query = req.list.model.find(queryFilters);","\tif (relFields) {","\t\tquery.populate(relFields.join(' '));","\t}","\tquery.exec(function(err, results) {","","\t\tif (err) return res.status(500).json(err);","","\t\tvar sendCSV = function(data) {","","\t\t\tres.attachment(req.list.path + '-' + moment().format('YYYYMMDD-HHMMSS') + '.csv');","\t\t\tres.setHeader('Content-Type', 'application/octet-stream');","","\t\t\tvar content = baby.unparse(data, {","\t\t\t\tdelimiter: keystone.get('csv field delimiter') || ','","\t\t\t});","\t\t\t","\t\t\tres.end(content, 'utf-8');","\t\t};","","\t\tif (!results.length) {","\t\t\t// fast bail on no results","\t\t\treturn sendCSV([]);","\t\t}","\t\tvar data;","","\t\tif (results[0].toCSV) {","","\t\t\t/**","\t\t\t * Custom toCSV Method present","\t\t\t *","\t\t\t * Detect dependencies and call it. If the last dependency is `callback`, call it asynchronously.","\t\t\t *","\t\t\t * Support dependencies are:","\t\t\t *   - req (current express request object)","\t\t\t *   - user (currently authenticated user)","\t\t\t *   - row (default row data, as generated without custom toCSV())","\t\t\t *   - callback (invokes async mode, must be provided last)","\t\t\t */","","\t\t\tvar deps = _.map(results[0].toCSV.toString().match(FN_ARGS)[1].split(','), function(i) { return i.trim(); });","","\t\t\tvar includeRowData = (deps.indexOf('row') > -1);","","\t\t\tvar map = {","\t\t\t\treq: req,","\t\t\t\tuser: req.user","\t\t\t};","","\t\t\tvar applyDeps = function(fn, _this, _map) {","\t\t\t\tvar args = _.map(deps, function(key) {","\t\t\t\t\treturn _map[key];","\t\t\t\t});","\t\t\t\treturn fn.apply(_this, args);","\t\t\t};","","\t\t\tif (_.last(deps) === 'callback') {","\t\t\t\t// Allow async toCSV by detecting the last argument is callback","\t\t\t\treturn async.map(results, function(i, callback) {","\t\t\t\t\tvar _map = _.clone(map);","\t\t\t\t\t_map.callback = callback;","\t\t\t\t\tif (includeRowData) {","\t\t\t\t\t\t_map.row = getRowData(i);","\t\t\t\t\t}","\t\t\t\t\tapplyDeps(i.toCSV, i, _map);","\t\t\t\t}, function(err, results) {","\t\t\t\t\tif (err) {","\t\t\t\t\t\tconsole.log('Error generating CSV for list ' + req.list.key);","\t\t\t\t\t\tconsole.log(err);","\t\t\t\t\t\treturn res.send(keystone.wrapHTMLError('Error generating CSV', 'Please check the log for more details, or contact support.'));","\t\t\t\t\t}","\t\t\t\t\tsendCSV(results);","\t\t\t\t});","\t\t\t} else {","\t\t\t\t// Without a callback, toCSV must return the value","\t\t\t\tdata = [];","\t\t\t\tif (includeRowData) {","\t\t\t\t\t// if row data is required, add it to the map for each iteration","\t\t\t\t_.each(results, function(i) {","\t\t\t\t\t\tvar _map = _.clone(map);","\t\t\t\t\t\t_map.row = getRowData(i);","\t\t\t\t\t\tdata.push(applyDeps(i.toCSV, i, _map));","\t\t\t\t\t});","\t\t\t\t} else {","\t\t\t\t\t// fast path: use the same map for each iteration","\t\t\t\t\t_.each(results, function(i) {","\t\t\t\t\tdata.push(applyDeps(i.toCSV, i, map));","\t\t\t\t});","\t\t\t\t}","\t\t\t\treturn sendCSV(data);","\t\t\t}","","\t\t} else {","","\t\t\t/**","\t\t\t * Generic conversion to CSV","\t\t\t *","\t\t\t * Loops through each of the fields in the List and uses each field's `format` method","\t\t\t * to generate the data","\t\t\t */","","\t\t\tdata = [];","\t\t\t_.each(results, function(i) {","\t\t\t\tdata.push(getRowData(i));","\t\t\t});","\t\t\treturn sendCSV(data);","\t\t}","","\t});","","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"5":1,"7":1,"9":1,"11":0,"12":0,"13":0,"15":0,"16":0,"17":0,"21":0,"23":0,"25":0,"26":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"42":0,"45":0,"47":0,"48":0,"49":0,"51":0,"55":0,"59":0,"63":0,"64":0,"65":0,"67":0,"69":0,"71":0,"73":0,"74":0,"76":0,"80":0,"83":0,"85":0,"87":0,"89":0,"103":0,"105":0,"107":0,"112":0,"113":0,"114":0,"116":0,"119":0,"121":0,"122":0,"123":0,"124":0,"125":0,"127":0,"129":0,"130":0,"131":0,"132":0,"134":0,"138":0,"139":0,"141":0,"142":0,"143":0,"144":0,"148":0,"149":0,"152":0,"164":0,"165":0,"166":0,"168":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/list.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/list.js","s":{"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},"fnMap":{"1":{"name":"(anonymous_1)","line":6,"loc":{"start":{"line":6,"column":27},"end":{"line":6,"column":46}}},"2":{"name":"(anonymous_2)","line":8,"loc":{"start":{"line":8,"column":20},"end":{"line":8,"column":37}}},"3":{"name":"(anonymous_3)","line":12,"loc":{"start":{"line":12,"column":17},"end":{"line":12,"column":41}}},"4":{"name":"(anonymous_4)","line":46,"loc":{"start":{"line":46,"column":30},"end":{"line":46,"column":51}}},"5":{"name":"(anonymous_5)","line":52,"loc":{"start":{"line":52,"column":14},"end":{"line":52,"column":35}}},"6":{"name":"(anonymous_6)","line":56,"loc":{"start":{"line":56,"column":15},"end":{"line":56,"column":36}}},"7":{"name":"(anonymous_7)","line":62,"loc":{"start":{"line":62,"column":23},"end":{"line":62,"column":35}}},"8":{"name":"(anonymous_8)","line":90,"loc":{"start":{"line":90,"column":17},"end":{"line":90,"column":33}}},"9":{"name":"(anonymous_9)","line":91,"loc":{"start":{"line":91,"column":15},"end":{"line":91,"column":30}}},"10":{"name":"(anonymous_10)","line":96,"loc":{"start":{"line":96,"column":25},"end":{"line":96,"column":39}}},"11":{"name":"(anonymous_11)","line":130,"loc":{"start":{"line":130,"column":6},"end":{"line":130,"column":20}}},"12":{"name":"(anonymous_12)","line":153,"loc":{"start":{"line":153,"column":4},"end":{"line":153,"column":15}}},"13":{"name":"(anonymous_13)","line":158,"loc":{"start":{"line":158,"column":18},"end":{"line":158,"column":35}}},"14":{"name":"(anonymous_14)","line":177,"loc":{"start":{"line":177,"column":15},"end":{"line":177,"column":36}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":29}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":33}},"4":{"start":{"line":4,"column":0},"end":{"line":4,"column":27}},"5":{"start":{"line":6,"column":0},"end":{"line":204,"column":2}},"6":{"start":{"line":8,"column":1},"end":{"line":10,"column":3}},"7":{"start":{"line":9,"column":2},"end":{"line":9,"column":19}},"8":{"start":{"line":12,"column":1},"end":{"line":22,"column":3}},"9":{"start":{"line":13,"column":2},"end":{"line":13,"column":27}},"10":{"start":{"line":14,"column":2},"end":{"line":14,"column":31}},"11":{"start":{"line":15,"column":2},"end":{"line":15,"column":26}},"12":{"start":{"line":16,"column":2},"end":{"line":16,"column":38}},"13":{"start":{"line":17,"column":2},"end":{"line":19,"column":3}},"14":{"start":{"line":18,"column":3},"end":{"line":18,"column":20}},"15":{"start":{"line":20,"column":2},"end":{"line":20,"column":18}},"16":{"start":{"line":21,"column":2},"end":{"line":21,"column":74}},"17":{"start":{"line":24,"column":1},"end":{"line":202,"column":2}},"18":{"start":{"line":27,"column":3},"end":{"line":27,"column":45}},"19":{"start":{"line":28,"column":3},"end":{"line":28,"column":42}},"20":{"start":{"line":29,"column":3},"end":{"line":29,"column":33}},"21":{"start":{"line":31,"column":3},"end":{"line":31,"column":56}},"22":{"start":{"line":33,"column":3},"end":{"line":33,"column":45}},"23":{"start":{"line":34,"column":3},"end":{"line":37,"column":32}},"24":{"start":{"line":39,"column":3},"end":{"line":50,"column":4}},"25":{"start":{"line":40,"column":4},"end":{"line":40,"column":48}},"26":{"start":{"line":41,"column":4},"end":{"line":41,"column":60}},"27":{"start":{"line":41,"column":18},"end":{"line":41,"column":60}},"28":{"start":{"line":43,"column":4},"end":{"line":43,"column":48}},"29":{"start":{"line":44,"column":4},"end":{"line":44,"column":59}},"30":{"start":{"line":44,"column":16},"end":{"line":44,"column":59}},"31":{"start":{"line":46,"column":4},"end":{"line":49,"column":7}},"32":{"start":{"line":47,"column":5},"end":{"line":47,"column":51}},"33":{"start":{"line":48,"column":5},"end":{"line":48,"column":51}},"34":{"start":{"line":52,"column":3},"end":{"line":72,"column":6}},"35":{"start":{"line":54,"column":4},"end":{"line":54,"column":53}},"36":{"start":{"line":54,"column":13},"end":{"line":54,"column":53}},"37":{"start":{"line":56,"column":4},"end":{"line":70,"column":7}},"38":{"start":{"line":58,"column":5},"end":{"line":58,"column":54}},"39":{"start":{"line":58,"column":14},"end":{"line":58,"column":54}},"40":{"start":{"line":60,"column":5},"end":{"line":68,"column":8}},"41":{"start":{"line":63,"column":7},"end":{"line":66,"column":9}},"42":{"start":{"line":75,"column":2},"end":{"line":75,"column":8}},"43":{"start":{"line":79,"column":3},"end":{"line":81,"column":4}},"44":{"start":{"line":80,"column":4},"end":{"line":80,"column":37}},"45":{"start":{"line":83,"column":3},"end":{"line":83,"column":49}},"46":{"start":{"line":84,"column":3},"end":{"line":84,"column":18}},"47":{"start":{"line":86,"column":3},"end":{"line":88,"column":4}},"48":{"start":{"line":87,"column":4},"end":{"line":87,"column":29}},"49":{"start":{"line":90,"column":3},"end":{"line":94,"column":6}},"50":{"start":{"line":91,"column":4},"end":{"line":93,"column":7}},"51":{"start":{"line":92,"column":5},"end":{"line":92,"column":74}},"52":{"start":{"line":96,"column":3},"end":{"line":104,"column":6}},"53":{"start":{"line":98,"column":4},"end":{"line":98,"column":53}},"54":{"start":{"line":98,"column":13},"end":{"line":98,"column":53}},"55":{"start":{"line":100,"column":4},"end":{"line":102,"column":7}},"56":{"start":{"line":106,"column":2},"end":{"line":106,"column":8}},"57":{"start":{"line":110,"column":3},"end":{"line":112,"column":4}},"58":{"start":{"line":111,"column":4},"end":{"line":111,"column":37}},"59":{"start":{"line":114,"column":3},"end":{"line":114,"column":35}},"60":{"start":{"line":115,"column":3},"end":{"line":115,"column":50}},"61":{"start":{"line":116,"column":3},"end":{"line":116,"column":61}},"62":{"start":{"line":118,"column":3},"end":{"line":124,"column":4}},"63":{"start":{"line":119,"column":4},"end":{"line":123,"column":5}},"64":{"start":{"line":120,"column":5},"end":{"line":120,"column":47}},"65":{"start":{"line":122,"column":5},"end":{"line":122,"column":84}},"66":{"start":{"line":126,"column":3},"end":{"line":143,"column":6}},"67":{"start":{"line":131,"column":4},"end":{"line":142,"column":5}},"68":{"start":{"line":132,"column":5},"end":{"line":135,"column":8}},"69":{"start":{"line":137,"column":5},"end":{"line":141,"column":8}},"70":{"start":{"line":145,"column":2},"end":{"line":145,"column":8}},"71":{"start":{"line":149,"column":3},"end":{"line":151,"column":4}},"72":{"start":{"line":150,"column":4},"end":{"line":150,"column":37}},"73":{"start":{"line":153,"column":3},"end":{"line":198,"column":8}},"74":{"start":{"line":155,"column":4},"end":{"line":155,"column":86}},"75":{"start":{"line":156,"column":4},"end":{"line":156,"column":48}},"76":{"start":{"line":157,"column":4},"end":{"line":157,"column":45}},"77":{"start":{"line":158,"column":4},"end":{"line":170,"column":7}},"78":{"start":{"line":159,"column":6},"end":{"line":159,"column":32}},"79":{"start":{"line":160,"column":6},"end":{"line":160,"column":25}},"80":{"start":{"line":161,"column":6},"end":{"line":161,"column":45}},"81":{"start":{"line":162,"column":6},"end":{"line":167,"column":7}},"82":{"start":{"line":163,"column":7},"end":{"line":166,"column":8}},"83":{"start":{"line":164,"column":8},"end":{"line":164,"column":25}},"84":{"start":{"line":165,"column":8},"end":{"line":165,"column":30}},"85":{"start":{"line":168,"column":6},"end":{"line":168,"column":70}},"86":{"start":{"line":169,"column":6},"end":{"line":169,"column":94}},"87":{"start":{"line":172,"column":4},"end":{"line":172,"column":91}},"88":{"start":{"line":173,"column":4},"end":{"line":173,"column":57}},"89":{"start":{"line":175,"column":4},"end":{"line":175,"column":43}},"90":{"start":{"line":177,"column":4},"end":{"line":196,"column":7}},"91":{"start":{"line":178,"column":5},"end":{"line":178,"column":54}},"92":{"start":{"line":178,"column":14},"end":{"line":178,"column":54}},"93":{"start":{"line":179,"column":5},"end":{"line":179,"column":47}},"94":{"start":{"line":179,"column":17},"end":{"line":179,"column":47}},"95":{"start":{"line":181,"column":5},"end":{"line":181,"column":33}},"96":{"start":{"line":183,"column":5},"end":{"line":183,"column":70}},"97":{"start":{"line":185,"column":5},"end":{"line":185,"column":106}},"98":{"start":{"line":186,"column":5},"end":{"line":186,"column":85}},"99":{"start":{"line":187,"column":5},"end":{"line":187,"column":137}},"100":{"start":{"line":189,"column":5},"end":{"line":195,"column":8}},"101":{"start":{"line":200,"column":2},"end":{"line":200,"column":8}}},"branchMap":{"1":{"line":13,"type":"binary-expr","locations":[{"start":{"line":13,"column":8},"end":{"line":13,"column":11}},{"start":{"line":13,"column":15},"end":{"line":13,"column":26}}]},"2":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":8},"end":{"line":14,"column":11}},{"start":{"line":14,"column":15},"end":{"line":14,"column":30}}]},"3":{"line":16,"type":"cond-expr","locations":[{"start":{"line":16,"column":27},"end":{"line":16,"column":30}},{"start":{"line":16,"column":33},"end":{"line":16,"column":35}}]},"4":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":2},"end":{"line":17,"column":2}},{"start":{"line":17,"column":2},"end":{"line":17,"column":2}}]},"5":{"line":21,"type":"binary-expr","locations":[{"start":{"line":21,"column":24},"end":{"line":21,"column":27}},{"start":{"line":21,"column":31},"end":{"line":21,"column":38}}]},"6":{"line":21,"type":"cond-expr","locations":[{"start":{"line":21,"column":54},"end":{"line":21,"column":65}},{"start":{"line":21,"column":68},"end":{"line":21,"column":70}}]},"7":{"line":24,"type":"switch","locations":[{"start":{"line":26,"column":2},"end":{"line":75,"column":8}},{"start":{"line":77,"column":2},"end":{"line":106,"column":8}},{"start":{"line":108,"column":2},"end":{"line":145,"column":8}},{"start":{"line":147,"column":2},"end":{"line":200,"column":8}}]},"8":{"line":27,"type":"binary-expr","locations":[{"start":{"line":27,"column":15},"end":{"line":27,"column":38}},{"start":{"line":27,"column":42},"end":{"line":27,"column":44}}]},"9":{"line":28,"type":"binary-expr","locations":[{"start":{"line":28,"column":14},"end":{"line":28,"column":36}},{"start":{"line":28,"column":40},"end":{"line":28,"column":41}}]},"10":{"line":39,"type":"if","locations":[{"start":{"line":39,"column":3},"end":{"line":39,"column":3}},{"start":{"line":39,"column":3},"end":{"line":39,"column":3}}]},"11":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":4},"end":{"line":41,"column":4}},{"start":{"line":41,"column":4},"end":{"line":41,"column":4}}]},"12":{"line":44,"type":"if","locations":[{"start":{"line":44,"column":4},"end":{"line":44,"column":4}},{"start":{"line":44,"column":4},"end":{"line":44,"column":4}}]},"13":{"line":47,"type":"cond-expr","locations":[{"start":{"line":47,"column":37},"end":{"line":47,"column":42}},{"start":{"line":47,"column":45},"end":{"line":47,"column":49}}]},"14":{"line":48,"type":"cond-expr","locations":[{"start":{"line":48,"column":37},"end":{"line":48,"column":42}},{"start":{"line":48,"column":45},"end":{"line":48,"column":49}}]},"15":{"line":54,"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":54,"column":4}},{"start":{"line":54,"column":4},"end":{"line":54,"column":4}}]},"16":{"line":58,"type":"if","locations":[{"start":{"line":58,"column":5},"end":{"line":58,"column":5}},{"start":{"line":58,"column":5},"end":{"line":58,"column":5}}]},"17":{"line":64,"type":"binary-expr","locations":[{"start":{"line":64,"column":14},"end":{"line":64,"column":48}},{"start":{"line":64,"column":52},"end":{"line":64,"column":68}}]},"18":{"line":79,"type":"if","locations":[{"start":{"line":79,"column":3},"end":{"line":79,"column":3}},{"start":{"line":79,"column":3},"end":{"line":79,"column":3}}]},"19":{"line":83,"type":"binary-expr","locations":[{"start":{"line":83,"column":15},"end":{"line":83,"column":30}},{"start":{"line":83,"column":34},"end":{"line":83,"column":48}}]},"20":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":3},"end":{"line":86,"column":3}},{"start":{"line":86,"column":3},"end":{"line":86,"column":3}}]},"21":{"line":98,"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":98,"column":4}},{"start":{"line":98,"column":4},"end":{"line":98,"column":4}}]},"22":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":3},"end":{"line":110,"column":3}},{"start":{"line":110,"column":3},"end":{"line":110,"column":3}}]},"23":{"line":116,"type":"cond-expr","locations":[{"start":{"line":116,"column":40},"end":{"line":116,"column":48}},{"start":{"line":116,"column":51},"end":{"line":116,"column":60}}]},"24":{"line":118,"type":"if","locations":[{"start":{"line":118,"column":3},"end":{"line":118,"column":3}},{"start":{"line":118,"column":3},"end":{"line":118,"column":3}}]},"25":{"line":119,"type":"if","locations":[{"start":{"line":119,"column":4},"end":{"line":119,"column":4}},{"start":{"line":119,"column":4},"end":{"line":119,"column":4}}]},"26":{"line":131,"type":"if","locations":[{"start":{"line":131,"column":4},"end":{"line":131,"column":4}},{"start":{"line":131,"column":4},"end":{"line":131,"column":4}}]},"27":{"line":149,"type":"if","locations":[{"start":{"line":149,"column":3},"end":{"line":149,"column":3}},{"start":{"line":149,"column":3},"end":{"line":149,"column":3}}]},"28":{"line":159,"type":"binary-expr","locations":[{"start":{"line":159,"column":14},"end":{"line":159,"column":25}},{"start":{"line":159,"column":29},"end":{"line":159,"column":31}}]},"29":{"line":163,"type":"if","locations":[{"start":{"line":163,"column":7},"end":{"line":163,"column":7}},{"start":{"line":163,"column":7},"end":{"line":163,"column":7}}]},"30":{"line":169,"type":"cond-expr","locations":[{"start":{"line":169,"column":49},"end":{"line":169,"column":56}},{"start":{"line":169,"column":59},"end":{"line":169,"column":61}}]},"31":{"line":169,"type":"cond-expr","locations":[{"start":{"line":169,"column":75},"end":{"line":169,"column":87}},{"start":{"line":169,"column":90},"end":{"line":169,"column":92}}]},"32":{"line":178,"type":"if","locations":[{"start":{"line":178,"column":5},"end":{"line":178,"column":5}},{"start":{"line":178,"column":5},"end":{"line":178,"column":5}}]},"33":{"line":179,"type":"if","locations":[{"start":{"line":179,"column":5},"end":{"line":179,"column":5}},{"start":{"line":179,"column":5},"end":{"line":179,"column":5}}]}},"code":["var _ = require('underscore');","var async = require('async');","var keystone = require('../../');","var jade = require('jade');","","exports = module.exports = function(req, res) {","","\tvar sendResponse = function(status) {","\t\tres.json(status);","\t};","","\tvar sendError = function(key, err, msg) {","\t\tmsg = msg || 'API Error';","\t\tkey = key || 'unknown error';","\t\tmsg += ' (' + key + ')';","\t\tconsole.log(msg + (err ? ':' : ''));","\t\tif (err) {","\t\t\tconsole.log(err);","\t\t}","\t\tres.status(500);","\t\tsendResponse({ error: key || 'error', detail: err ? err.message : '' });","\t};","","\tswitch (req.params.action) {","","\t\tcase 'autocomplete':","\t\t\tvar limit = Number(req.query.limit) || 50;","\t\t\tvar page = Number(req.query.page) || 1;","\t\t\tvar skip = limit * (page - 1);","\t\t\t\t","\t\t\tvar filters = req.list.getSearchFilters(req.query.q);","","\t\t\tvar count = req.list.model.count(filters);","\t\t\tvar query = req.list.model.find(filters)","\t\t\t\t.limit(limit)","\t\t\t\t.skip(skip)","\t\t\t\t.sort(req.list.defaultSort);","","\t\t\tif (req.query.context === 'relationship') {","\t\t\t\tvar srcList = keystone.list(req.query.list);","\t\t\t\tif (!srcList) return sendError('invalid list provided');","","\t\t\t\tvar field = srcList.fields[req.query.field];","\t\t\t\tif (!field) return sendError('invalid field provided');","","\t\t\t\t_.each(req.query.filters, function(value, key) {","\t\t\t\t\tquery.where(key).equals(value ? value : null);","\t\t\t\t\tcount.where(key).equals(value ? value : null);","\t\t\t\t});","\t\t\t}","\t\t\t","\t\t\tcount.exec(function(err, total) {","","\t\t\t\tif (err) return sendError('database error', err);","","\t\t\t\tquery.exec(function(err, items) {","","\t\t\t\t\tif (err) return sendError('database error', err);","","\t\t\t\t\tsendResponse({","\t\t\t\t\t\ttotal: total,","\t\t\t\t\t\titems: items.map(function(i) {","\t\t\t\t\t\t\treturn {","\t\t\t\t\t\t\t\tname: req.list.getDocumentName(i, false) || '(' + i.id + ')',","\t\t\t\t\t\t\t\tid: i.id","\t\t\t\t\t\t\t};","\t\t\t\t\t\t})","\t\t\t\t\t});","","\t\t\t\t});","","\t\t\t});","","","\t\tbreak;","","\t\tcase 'order':","","\t\t\tif (!keystone.security.csrf.validate(req)) {","\t\t\t\treturn sendError('invalid csrf');","\t\t\t}","","\t\t\tvar order = req.query.order || req.body.order;","\t\t\tvar queue = [];","","\t\t\tif ('string' === typeof order) {","\t\t\t\torder = order.split(',');","\t\t\t}","","\t\t\t_.each(order, function(id, i) {","\t\t\t\tqueue.push(function(done) {","\t\t\t\t\treq.list.model.update({ _id: id }, { $set: { sortOrder: i } }, done);","\t\t\t\t});","\t\t\t});","","\t\t\tasync.parallel(queue, function(err) {","","\t\t\t\tif (err) return sendError('database error', err);","","\t\t\t\treturn sendResponse({","\t\t\t\t\tsuccess: true","\t\t\t\t});","","\t\t\t});","","\t\tbreak;","","\t\tcase 'create':","","\t\t\tif (!keystone.security.csrf.validate(req)) {","\t\t\t\treturn sendError('invalid csrf');","\t\t\t}","","\t\t\tvar item = new req.list.model();","\t\t\tvar updateHandler = item.getUpdateHandler(req);","\t\t\tvar data = (req.method === 'POST') ? req.body : req.query;","","\t\t\tif (req.list.nameIsInitial) {","\t\t\t\tif (req.list.nameField.validateInput(data)) {","\t\t\t\t\treq.list.nameField.updateItem(item, data);","\t\t\t\t} else {","\t\t\t\t\tupdateHandler.addValidationError(req.list.nameField.path, 'Name is required.');","\t\t\t\t}","\t\t\t}","","\t\t\tupdateHandler.process(data, {","\t\t\t\tflashErrors: true,","\t\t\t\tlogErrors: true,","\t\t\t\tfields: req.list.initialFields","\t\t\t}, function(err) {","\t\t\t\tif (err) {","\t\t\t\t\treturn sendResponse({","\t\t\t\t\t\tsuccess: false,","\t\t\t\t\t\terr: err","\t\t\t\t\t});","\t\t\t\t} else {","\t\t\t\t\treturn sendResponse({","\t\t\t\t\t\tsuccess: true,","\t\t\t\t\t\tname: req.list.getDocumentName(item, false),","\t\t\t\t\t\tid: item.id","\t\t\t\t\t});","\t\t\t\t}","\t\t\t});","","\t\tbreak;","","\t\tcase 'fetch':","\t\t","\t\t\tif (!keystone.security.csrf.validate(req)) {","\t\t\t\treturn sendError('invalid csrf');","\t\t\t}","\t\t\t","\t\t\t(function() {","","\t\t\t\tvar queryFilters = req.list.getSearchFilters(req.query.search, req.query.filters);","\t\t\t\tvar skip = Number(req.query.items.last) - 1;","\t\t\t\tvar querystring = require('querystring');","\t\t\t\tvar link_to = function(params) {","\t\t\t\t\t\tvar p = params.page || '';","\t\t\t\t\t\tdelete params.page;","\t\t\t\t\t\tvar queryParams = _.clone(req.query.q);","\t\t\t\t\t\tfor (var i in params) {","\t\t\t\t\t\t\tif (params[i] === undefined) {","\t\t\t\t\t\t\t\tdelete params[i];","\t\t\t\t\t\t\t\tdelete queryParams[i];","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tparams = querystring.stringify(_.defaults(params, queryParams));","\t\t\t\t\t\treturn '/keystone/' + req.list.path + (p ? '/' + p : '') + (params ? '?' + params : '');","\t\t\t\t\t};","","\t\t\t\tvar query = req.list.model.find(queryFilters).sort(req.query.sort).skip(skip).limit(1);","\t\t\t\tvar columns = req.list.expandColumns(req.query.cols);","","\t\t\t\treq.list.selectColumns(query, columns);","","\t\t\t\tquery.exec(function(err, items) {","\t\t\t\t\tif (err) return sendError('database error', err);","\t\t\t\t\tif (!items) return sendError('not found');","","\t\t\t\t\tvar locals, row, pagination;","","\t\t\t\t\treq.list.getPages(req.query.items, req.list.pagination.maxPages);","","\t\t\t\t\tlocals = { list: req.list, columns: columns, item: items[0], csrf_query: req.query.csrf_query, _:_ };","\t\t\t\t\trow = jade.renderFile(__dirname + '/../../templates/partials/row.jade', locals);","\t\t\t\t\tpagination = jade.renderFile(__dirname + '/../../templates/partials/pagination.jade', { items: req.query.items, link_to: link_to });","","\t\t\t\t\treturn sendResponse({","\t\t\t\t\t\titem: items[0],","\t\t\t\t\t\trow: row,","\t\t\t\t\t\tpagination: pagination,","\t\t\t\t\t\tsuccess: true,","\t\t\t\t\t\tcount: 1","\t\t\t\t\t});","\t\t\t\t});","\t\t\t","\t\t\t})();","","\t\tbreak;","","\t}","","};",""],"l":{"1":1,"2":1,"3":1,"4":1,"6":1,"8":0,"9":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"20":0,"21":0,"24":0,"27":0,"28":0,"29":0,"31":0,"33":0,"34":0,"39":0,"40":0,"41":0,"43":0,"44":0,"46":0,"47":0,"48":0,"52":0,"54":0,"56":0,"58":0,"60":0,"63":0,"75":0,"79":0,"80":0,"83":0,"84":0,"86":0,"87":0,"90":0,"91":0,"92":0,"96":0,"98":0,"100":0,"106":0,"110":0,"111":0,"114":0,"115":0,"116":0,"118":0,"119":0,"120":0,"122":0,"126":0,"131":0,"132":0,"137":0,"145":0,"149":0,"150":0,"153":0,"155":0,"156":0,"157":0,"158":0,"159":0,"160":0,"161":0,"162":0,"163":0,"164":0,"165":0,"168":0,"169":0,"172":0,"173":0,"175":0,"177":0,"178":0,"179":0,"181":0,"183":0,"185":0,"186":0,"187":0,"189":0,"200":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/src/fields.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/src/fields.js","s":{"1":2},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":32,"column":2}}},"branchMap":{},"code":["module.exports = {","\tazurefile:        require('../../fields/types/azurefile/AzureFileField'),","\tboolean:          require('../../fields/types/boolean/BooleanField'),","\tcloudinaryimage:  require('../../fields/types/cloudinaryimage/CloudinaryImageField'),","\tcloudinaryimages: require('../../fields/types/cloudinaryimages/CloudinaryImagesField'),","\tcode:             require('../../fields/types/code/CodeField'),","\tcolor:            require('../../fields/types/color/ColorField'),","\tdate:             require('../../fields/types/date/DateField'),","\tdatearray:        require('../../fields/types/datearray/DateArrayField'),","\tdatetime:         require('../../fields/types/datetime/DatetimeField'),","\temail:            require('../../fields/types/email/EmailField'),","\tembedly:          require('../../fields/types/embedly/EmbedlyField'),","\tgeopoint:         require('../../fields/types/geopoint/GeoPointField'),","\thtml:             require('../../fields/types/html/HtmlField'),","\tkey:              require('../../fields/types/key/KeyField'),","\tlocalfile:  \t  require('../../fields/types/localfile/LocalFileField'),","\tlocalfiles:       require('../../fields/types/localfiles/LocalFilesField'),","\tlocation:         require('../../fields/types/location/LocationField'),","\tmarkdown:         require('../../fields/types/markdown/MarkdownField'),","\tmoney:            require('../../fields/types/money/MoneyField'),","\tname:             require('../../fields/types/name/NameField'),","\tnumber:           require('../../fields/types/number/NumberField'),","\tnumberarray:      require('../../fields/types/numberarray/NumberArrayField'),","\tpassword:         require('../../fields/types/password/PasswordField'),","\trelationship:     require('../../fields/types/relationship/RelationshipField'),","\ts3file:           require('../../fields/types/s3file/S3FileField'),","\tselect:           require('../../fields/types/select/SelectField'),","\ttext:             require('../../fields/types/text/TextField'),","\ttextarea:         require('../../fields/types/textarea/TextareaField'),","\ttextarray:        require('../../fields/types/textarray/TextArrayField'),","\turl:              require('../../fields/types/url/UrlField')","};",""],"l":{"1":2}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/azurefile/AzureFileField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/azurefile/AzureFileField.js","s":{"1":4},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":56}}},"branchMap":{},"code":["module.exports = require('../localfile/LocalFileField');",""],"l":{"1":4}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/utils/evalDependsOn.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/utils/evalDependsOn.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"evalDependsOn","line":1,"loc":{"start":{"line":1,"column":17},"end":{"line":1,"column":59}}},"2":{"name":"(anonymous_2)","line":4,"loc":{"start":{"line":4,"column":38},"end":{"line":4,"column":52}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":16,"column":2}},"2":{"start":{"line":2,"column":1},"end":{"line":2,"column":41}},"3":{"start":{"line":2,"column":29},"end":{"line":2,"column":41}},"4":{"start":{"line":3,"column":1},"end":{"line":3,"column":30}},"5":{"start":{"line":4,"column":1},"end":{"line":15,"column":17}},"6":{"start":{"line":5,"column":2},"end":{"line":5,"column":36}},"7":{"start":{"line":6,"column":2},"end":{"line":12,"column":3}},"8":{"start":{"line":7,"column":3},"end":{"line":11,"column":4}},"9":{"start":{"line":8,"column":4},"end":{"line":8,"column":40}},"10":{"start":{"line":10,"column":4},"end":{"line":10,"column":51}},"11":{"start":{"line":13,"column":2},"end":{"line":13,"column":72}},"12":{"start":{"line":14,"column":2},"end":{"line":14,"column":42}}},"branchMap":{"1":{"line":2,"type":"if","locations":[{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},{"start":{"line":2,"column":1},"end":{"line":2,"column":1}}]},"2":{"line":4,"type":"cond-expr","locations":[{"start":{"line":4,"column":24},"end":{"line":15,"column":9}},{"start":{"line":15,"column":12},"end":{"line":15,"column":16}}]},"3":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":2},"end":{"line":6,"column":2}},{"start":{"line":6,"column":2},"end":{"line":6,"column":2}}]},"4":{"line":7,"type":"if","locations":[{"start":{"line":7,"column":3},"end":{"line":7,"column":3}},{"start":{"line":7,"column":3},"end":{"line":7,"column":3}}]},"5":{"line":13,"type":"cond-expr","locations":[{"start":{"line":13,"column":42},"end":{"line":13,"column":54}},{"start":{"line":13,"column":57},"end":{"line":13,"column":71}}]}},"code":["module.exports = function evalDependsOn(dependsOn, values) {","\tif (!_.isObject(dependsOn)) return true;","\tvar keys = _.keys(dependsOn);","\treturn (keys.length) ? _.every(keys, function(key) {","\t\tvar dependsValue = dependsOn[key];","\t\tif (_.isBoolean(dependsValue)) {","\t\t\tif (_.isBoolean(values[key])) {","\t\t\t\treturn dependsValue === values[key];","\t\t\t} else {","\t\t\t\treturn dependsValue !== _.isEmpty(values[key]);","\t\t\t}","\t\t}","\t\tvar matches = _.isArray(dependsValue) ? dependsValue : [dependsValue];","\t\treturn _.contains(matches, values[key]);","\t}, this) : true;","};",""],"l":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"10":0,"13":0,"14":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/security/frameGuard.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/security/frameGuard.js","s":{"1":1,"2":0,"3":0,"4":0,"5":0,"6":0},"b":{"1":[0,0]},"f":{"1":0,"2":0},"fnMap":{"1":{"name":"(anonymous_1)","line":14,"loc":{"start":{"line":14,"column":27},"end":{"line":14,"column":46}}},"2":{"name":"frameGuard","line":15,"loc":{"start":{"line":15,"column":8},"end":{"line":15,"column":44}}}},"statementMap":{"1":{"start":{"line":14,"column":0},"end":{"line":24,"column":2}},"2":{"start":{"line":15,"column":1},"end":{"line":23,"column":3}},"3":{"start":{"line":16,"column":2},"end":{"line":16,"column":44}},"4":{"start":{"line":18,"column":2},"end":{"line":20,"column":3}},"5":{"start":{"line":19,"column":3},"end":{"line":19,"column":42}},"6":{"start":{"line":22,"column":2},"end":{"line":22,"column":9}}},"branchMap":{"1":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":2},"end":{"line":18,"column":2}},{"start":{"line":18,"column":2},"end":{"line":18,"column":2}}]}},"code":["/**"," * Adds iframe protection headers to the response"," *"," * ####Example:"," *"," *     app.use(keystone.security.frameGuard(keystone));"," *"," * @param {app.request} req"," * @param {app.response} res"," * @param {function} next"," * @api public"," */","","exports = module.exports = function(keystone) {","\treturn function frameGuard(req, res, next) {","\t\tvar options = keystone.get('frame guard');","","\t\tif (options) {","\t\t\tres.header('x-frame-options', options);","\t\t}","\t\t","\t\tnext();","\t};","};",""],"l":{"14":1,"15":0,"16":0,"18":0,"19":0,"22":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/security/ipRangeRestrict.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/lib/security/ipRangeRestrict.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":25,"loc":{"start":{"line":25,"column":27},"end":{"line":25,"column":61}}},"2":{"name":"(anonymous_2)","line":34,"loc":{"start":{"line":34,"column":8},"end":{"line":34,"column":34}}},"3":{"name":"(anonymous_3)","line":49,"loc":{"start":{"line":49,"column":42},"end":{"line":49,"column":61}}}},"statementMap":{"1":{"start":{"line":3,"column":0},"end":{"line":3,"column":30}},"2":{"start":{"line":4,"column":0},"end":{"line":4,"column":41}},"3":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}},"4":{"start":{"line":25,"column":0},"end":{"line":82,"column":2}},"5":{"start":{"line":34,"column":1},"end":{"line":80,"column":3}},"6":{"start":{"line":37,"column":2},"end":{"line":39,"column":3}},"7":{"start":{"line":38,"column":3},"end":{"line":38,"column":54}},"8":{"start":{"line":43,"column":2},"end":{"line":43,"column":46}},"9":{"start":{"line":46,"column":2},"end":{"line":46,"column":144}},"10":{"start":{"line":49,"column":2},"end":{"line":51,"column":5}},"11":{"start":{"line":50,"column":3},"end":{"line":50,"column":53}},"12":{"start":{"line":52,"column":2},"end":{"line":54,"column":3}},"13":{"start":{"line":53,"column":3},"end":{"line":53,"column":58}},"14":{"start":{"line":60,"column":2},"end":{"line":60,"column":72}},"15":{"start":{"line":64,"column":2},"end":{"line":64,"column":70}},"16":{"start":{"line":66,"column":2},"end":{"line":76,"column":3}},"17":{"start":{"line":67,"column":3},"end":{"line":67,"column":68}},"18":{"start":{"line":68,"column":3},"end":{"line":68,"column":41}},"19":{"start":{"line":71,"column":3},"end":{"line":71,"column":61}},"20":{"start":{"line":72,"column":3},"end":{"line":72,"column":76}},"21":{"start":{"line":73,"column":3},"end":{"line":73,"column":49}},"22":{"start":{"line":75,"column":3},"end":{"line":75,"column":42}},"23":{"start":{"line":78,"column":2},"end":{"line":78,"column":9}}},"branchMap":{"1":{"line":37,"type":"if","locations":[{"start":{"line":37,"column":2},"end":{"line":37,"column":2}},{"start":{"line":37,"column":2},"end":{"line":37,"column":2}}]},"2":{"line":50,"type":"binary-expr","locations":[{"start":{"line":50,"column":10},"end":{"line":50,"column":29}},{"start":{"line":50,"column":33},"end":{"line":50,"column":52}}]},"3":{"line":52,"type":"if","locations":[{"start":{"line":52,"column":2},"end":{"line":52,"column":2}},{"start":{"line":52,"column":2},"end":{"line":52,"column":2}}]},"4":{"line":60,"type":"cond-expr","locations":[{"start":{"line":60,"column":41},"end":{"line":60,"column":62}},{"start":{"line":60,"column":65},"end":{"line":60,"column":71}}]},"5":{"line":66,"type":"if","locations":[{"start":{"line":66,"column":2},"end":{"line":66,"column":2}},{"start":{"line":66,"column":2},"end":{"line":66,"column":2}}]}},"code":["'use strict';","","var _ = require('underscore');","var range_check = require('range_check');","var util = require('util');","","/**"," * Implement IP range-based access control."," *"," * Returns a middleware that restricts requests to those originating"," * from the IP ranges described by 'ipRanges'. IP ranges are specified"," * using CIDR format, e.g. 127.0.0.0/8. Multiple ranges must be"," * separated by space characters or a comma:"," *"," * 192.168.0.0/16,127.0.0.0/8"," *"," * Requests from outside an allowed range receive a 403 response."," *"," * NB: the express 'trust proxy' setting must be enabled for this to"," * work."," *"," * @param {string} ipRanges"," * @param {function} wrapHTMLError"," */","exports = module.exports = function(ipRanges, wrapHTMLError) {","\t","\t/**","\t * Returns an Express middleware.","\t *","\t * @param {app.request} req","\t * @param {app.response} res","\t * @param {function} next","\t */","\treturn function (req, res, next) {","\t\t","\t\t// Require that at least one IP range has been provided.","\t\tif (_.isUndefined(ipRanges) ) {","\t\t\tthrow new Error('Allowed IP range is not defined');","\t\t}","\t\t","\t\t// The set of allowed ranges has to be separated by space","\t\t// characters or a comma.","\t\tvar allowedRanges = ipRanges.split(/\\s+|,/);","\t\t","\t\t// Regular expression for matching IPv4 CIDR ranges.","\t\tvar cidr = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/(\\d|[1-2]\\d|3[0-2]))$/;","\t\t","\t\t// Keep only those ranges that match CIDR format.","\t\tallowedRanges = _.filter(allowedRanges, function (ipRange) {","\t\t\treturn _.isString(ipRange) && ipRange.match(cidr);","\t\t});","\t\tif (allowedRanges.length <= 0) {","\t\t\tthrow new Error('No valid CIDR ranges were specified');","\t\t}","\t\t","\t\t// Using req.ips requires that express 'trust proxy' setting is","\t\t// true. When it *is* set the value for ips is extracted from the","\t\t// X-Forwarded-For request header. The originating IP address is","\t\t// the last one in the array.","\t\tvar requestIP = (req.ips.length > 0) ? req.ips.slice().pop() : req.ip;","\t\t","\t\t// Deny the request if request IP is not in one of the allowed","\t\t// IP address ranges.","\t\tvar requestAllowed = range_check.in_range(requestIP, allowedRanges);","\t\t","\t\tif (!requestAllowed) {","\t\t\tvar msg = '-> blocked request from %s (not in allowed IP range)';","\t\t\tconsole.log(util.format(msg, req.ip));","\t\t\t","\t\t\t// Display error page to the user.","\t\t\tvar title = 'Sorry, your request is not authorized (403)';","\t\t\tvar message = 'Requests from outside permitted IP range are not allowed';","\t\t\tvar htmlError = wrapHTMLError(title, message);","\t\t\t","\t\t\treturn res.status(403).send(htmlError);","\t\t}","\t\t","\t\tnext();","\t\t","\t};","\t","};",""],"l":{"3":1,"4":1,"5":1,"25":1,"34":0,"37":0,"38":0,"43":0,"46":0,"49":0,"50":0,"52":0,"53":0,"60":0,"64":0,"66":0,"67":0,"68":0,"71":0,"72":0,"73":0,"75":0,"78":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/item/delete.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/item/delete.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},"f":{"1":0,"2":0,"3":0},"fnMap":{"1":{"name":"(anonymous_1)","line":3,"loc":{"start":{"line":3,"column":17},"end":{"line":3,"column":36}}},"2":{"name":"(anonymous_2)","line":13,"loc":{"start":{"line":13,"column":45},"end":{"line":13,"column":66}}},"3":{"name":"(anonymous_3)","line":20,"loc":{"start":{"line":20,"column":14},"end":{"line":20,"column":29}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":36}},"2":{"start":{"line":3,"column":0},"end":{"line":28,"column":2}},"3":{"start":{"line":4,"column":1},"end":{"line":6,"column":2}},"4":{"start":{"line":5,"column":2},"end":{"line":5,"column":38}},"5":{"start":{"line":7,"column":1},"end":{"line":9,"column":2}},"6":{"start":{"line":8,"column":2},"end":{"line":8,"column":34}},"7":{"start":{"line":10,"column":1},"end":{"line":12,"column":2}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":68}},"9":{"start":{"line":13,"column":1},"end":{"line":27,"column":4}},"10":{"start":{"line":14,"column":2},"end":{"line":16,"column":3}},"11":{"start":{"line":15,"column":3},"end":{"line":15,"column":46}},"12":{"start":{"line":17,"column":2},"end":{"line":19,"column":3}},"13":{"start":{"line":18,"column":3},"end":{"line":18,"column":28}},"14":{"start":{"line":20,"column":2},"end":{"line":26,"column":5}},"15":{"start":{"line":21,"column":3},"end":{"line":21,"column":55}},"16":{"start":{"line":21,"column":12},"end":{"line":21,"column":55}},"17":{"start":{"line":22,"column":3},"end":{"line":25,"column":6}}},"branchMap":{"1":{"line":4,"type":"if","locations":[{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},{"start":{"line":4,"column":1},"end":{"line":4,"column":1}}]},"2":{"line":7,"type":"if","locations":[{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},{"start":{"line":7,"column":1},"end":{"line":7,"column":1}}]},"3":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},{"start":{"line":10,"column":1},"end":{"line":10,"column":1}}]},"4":{"line":10,"type":"binary-expr","locations":[{"start":{"line":10,"column":5},"end":{"line":10,"column":13}},{"start":{"line":10,"column":17},"end":{"line":10,"column":46}}]},"5":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":2},"end":{"line":14,"column":2}},{"start":{"line":14,"column":2},"end":{"line":14,"column":2}}]},"6":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":2},"end":{"line":17,"column":2}},{"start":{"line":17,"column":2},"end":{"line":17,"column":2}}]},"7":{"line":21,"type":"if","locations":[{"start":{"line":21,"column":3},"end":{"line":21,"column":3}},{"start":{"line":21,"column":3},"end":{"line":21,"column":3}}]}},"code":["var keystone = require('../../../');","","module.exports = function(req, res) {","\tif (!keystone.security.csrf.validate(req)) {","\t\treturn res.apiError('invalid csrf');","\t}","\tif (req.list.get('nodelete')) {","\t\treturn res.apiError('nodelete');","\t}","\tif (req.user && req.params.id === req.user.id) {","\t\treturn res.apiError('not allowed', 'You can not delete yourself');","\t}","\treq.list.model.findById(req.params.id).exec(function (err, item) {","\t\tif (err) {","\t\t\treturn res.apiError('database error', err);","\t\t}","\t\tif (!item) {","\t\t\treturn res.apiError(404);","\t\t}","\t\titem.remove(function (err) {","\t\t\tif (err) return res.apiError('database error', err);","\t\t\treturn res.json({","\t\t\t\tsuccess: true,","\t\t\t\tid: req.params.id","\t\t\t});","\t\t});","\t});","};",""],"l":{"1":1,"3":1,"4":0,"5":0,"7":0,"8":0,"10":0,"11":0,"13":0,"14":0,"15":0,"17":0,"18":0,"20":0,"21":0,"22":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/item/get.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/item/get.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0},"fnMap":{"1":{"name":"(anonymous_1)","line":5,"loc":{"start":{"line":5,"column":17},"end":{"line":5,"column":36}}},"2":{"name":"(anonymous_2)","line":22,"loc":{"start":{"line":22,"column":12},"end":{"line":22,"column":32}}},"3":{"name":"(anonymous_3)","line":38,"loc":{"start":{"line":38,"column":14},"end":{"line":38,"column":27}}},"4":{"name":"(anonymous_4)","line":45,"loc":{"start":{"line":45,"column":36},"end":{"line":45,"column":57}}},"5":{"name":"(anonymous_5)","line":59,"loc":{"start":{"line":59,"column":79},"end":{"line":59,"column":102}}},"6":{"name":"(anonymous_6)","line":68,"loc":{"start":{"line":68,"column":31},"end":{"line":68,"column":43}}},"7":{"name":"(anonymous_7)","line":83,"loc":{"start":{"line":83,"column":56},"end":{"line":83,"column":78}}},"8":{"name":"(anonymous_8)","line":98,"loc":{"start":{"line":98,"column":7},"end":{"line":98,"column":21}}},"9":{"name":"(anonymous_9)","line":111,"loc":{"start":{"line":111,"column":14},"end":{"line":111,"column":27}}},"10":{"name":"(anonymous_10)","line":113,"loc":{"start":{"line":113,"column":69},"end":{"line":113,"column":81}}},"11":{"name":"(anonymous_11)","line":122,"loc":{"start":{"line":122,"column":30},"end":{"line":122,"column":50}}},"12":{"name":"(anonymous_12)","line":137,"loc":{"start":{"line":137,"column":12},"end":{"line":137,"column":35}}},"13":{"name":"(anonymous_13)","line":147,"loc":{"start":{"line":147,"column":24},"end":{"line":147,"column":38}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":30}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":29}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":36}},"4":{"start":{"line":5,"column":0},"end":{"line":160,"column":2}},"5":{"start":{"line":7,"column":1},"end":{"line":7,"column":52}},"6":{"start":{"line":9,"column":1},"end":{"line":9,"column":31}},"7":{"start":{"line":10,"column":1},"end":{"line":12,"column":2}},"8":{"start":{"line":11,"column":2},"end":{"line":11,"column":17}},"9":{"start":{"line":14,"column":1},"end":{"line":16,"column":2}},"10":{"start":{"line":15,"column":2},"end":{"line":15,"column":46}},"11":{"start":{"line":18,"column":1},"end":{"line":20,"column":2}},"12":{"start":{"line":19,"column":2},"end":{"line":19,"column":46}},"13":{"start":{"line":22,"column":1},"end":{"line":159,"column":4}},"14":{"start":{"line":24,"column":2},"end":{"line":24,"column":79}},"15":{"start":{"line":24,"column":11},"end":{"line":24,"column":79}},"16":{"start":{"line":25,"column":2},"end":{"line":25,"column":82}},"17":{"start":{"line":25,"column":13},"end":{"line":25,"column":82}},"18":{"start":{"line":27,"column":2},"end":{"line":27,"column":17}},"19":{"start":{"line":28,"column":2},"end":{"line":28,"column":16}},"20":{"start":{"line":29,"column":2},"end":{"line":29,"column":20}},"21":{"start":{"line":32,"column":2},"end":{"line":106,"column":3}},"22":{"start":{"line":33,"column":3},"end":{"line":36,"column":5}},"23":{"start":{"line":38,"column":3},"end":{"line":105,"column":6}},"24":{"start":{"line":43,"column":4},"end":{"line":43,"column":55}},"25":{"start":{"line":45,"column":4},"end":{"line":103,"column":7}},"26":{"start":{"line":47,"column":5},"end":{"line":47,"column":39}},"27":{"start":{"line":49,"column":5},"end":{"line":51,"column":6}},"28":{"start":{"line":50,"column":6},"end":{"line":50,"column":122}},"29":{"start":{"line":53,"column":5},"end":{"line":53,"column":33}},"30":{"start":{"line":55,"column":5},"end":{"line":96,"column":6}},"31":{"start":{"line":56,"column":6},"end":{"line":58,"column":7}},"32":{"start":{"line":57,"column":7},"end":{"line":57,"column":21}},"33":{"start":{"line":59,"column":6},"end":{"line":78,"column":9}},"34":{"start":{"line":60,"column":7},"end":{"line":62,"column":8}},"35":{"start":{"line":61,"column":8},"end":{"line":61,"column":18}},"36":{"start":{"line":63,"column":7},"end":{"line":63,"column":65}},"37":{"start":{"line":64,"column":7},"end":{"line":76,"column":8}},"38":{"start":{"line":66,"column":8},"end":{"line":75,"column":11}},"39":{"start":{"line":69,"column":10},"end":{"line":72,"column":12}},"40":{"start":{"line":77,"column":7},"end":{"line":77,"column":14}},"41":{"start":{"line":80,"column":6},"end":{"line":82,"column":7}},"42":{"start":{"line":81,"column":7},"end":{"line":81,"column":21}},"43":{"start":{"line":83,"column":6},"end":{"line":95,"column":9}},"44":{"start":{"line":84,"column":7},"end":{"line":93,"column":8}},"45":{"start":{"line":86,"column":8},"end":{"line":92,"column":11}},"46":{"start":{"line":94,"column":7},"end":{"line":94,"column":17}},"47":{"start":{"line":100,"column":5},"end":{"line":100,"column":29}},"48":{"start":{"line":101,"column":5},"end":{"line":101,"column":31}},"49":{"start":{"line":102,"column":5},"end":{"line":102,"column":13}},"50":{"start":{"line":110,"column":2},"end":{"line":144,"column":3}},"51":{"start":{"line":111,"column":3},"end":{"line":143,"column":6}},"52":{"start":{"line":113,"column":4},"end":{"line":120,"column":9}},"53":{"start":{"line":114,"column":5},"end":{"line":119,"column":6}},"54":{"start":{"line":115,"column":6},"end":{"line":115,"column":24}},"55":{"start":{"line":117,"column":6},"end":{"line":117,"column":160}},"56":{"start":{"line":118,"column":6},"end":{"line":118,"column":18}},"57":{"start":{"line":122,"column":4},"end":{"line":142,"column":11}},"58":{"start":{"line":125,"column":5},"end":{"line":125,"column":39}},"59":{"start":{"line":126,"column":5},"end":{"line":126,"column":112}},"60":{"start":{"line":129,"column":5},"end":{"line":131,"column":34}},"61":{"start":{"line":134,"column":5},"end":{"line":134,"column":43}},"62":{"start":{"line":135,"column":5},"end":{"line":135,"column":44}},"63":{"start":{"line":137,"column":5},"end":{"line":140,"column":8}},"64":{"start":{"line":138,"column":6},"end":{"line":138,"column":26}},"65":{"start":{"line":139,"column":6},"end":{"line":139,"column":16}},"66":{"start":{"line":147,"column":2},"end":{"line":158,"column":5}},"67":{"start":{"line":148,"column":3},"end":{"line":153,"column":4}},"68":{"start":{"line":149,"column":4},"end":{"line":152,"column":7}},"69":{"start":{"line":154,"column":3},"end":{"line":157,"column":7}}},"branchMap":{"1":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},{"start":{"line":10,"column":1},"end":{"line":10,"column":1}}]},"2":{"line":14,"type":"if","locations":[{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},{"start":{"line":14,"column":1},"end":{"line":14,"column":1}}]},"3":{"line":14,"type":"binary-expr","locations":[{"start":{"line":14,"column":5},"end":{"line":14,"column":22}},{"start":{"line":14,"column":26},"end":{"line":14,"column":53}}]},"4":{"line":18,"type":"if","locations":[{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},{"start":{"line":18,"column":1},"end":{"line":18,"column":1}}]},"5":{"line":18,"type":"binary-expr","locations":[{"start":{"line":18,"column":5},"end":{"line":18,"column":22}},{"start":{"line":18,"column":26},"end":{"line":18,"column":53}}]},"6":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":2},"end":{"line":24,"column":2}},{"start":{"line":24,"column":2},"end":{"line":24,"column":2}}]},"7":{"line":25,"type":"if","locations":[{"start":{"line":25,"column":2},"end":{"line":25,"column":2}},{"start":{"line":25,"column":2},"end":{"line":25,"column":2}}]},"8":{"line":32,"type":"if","locations":[{"start":{"line":32,"column":2},"end":{"line":32,"column":2}},{"start":{"line":32,"column":2},"end":{"line":32,"column":2}}]},"9":{"line":32,"type":"binary-expr","locations":[{"start":{"line":32,"column":6},"end":{"line":32,"column":36}},{"start":{"line":32,"column":40},"end":{"line":32,"column":65}}]},"10":{"line":49,"type":"if","locations":[{"start":{"line":49,"column":5},"end":{"line":49,"column":5}},{"start":{"line":49,"column":5},"end":{"line":49,"column":5}}]},"11":{"line":49,"type":"binary-expr","locations":[{"start":{"line":49,"column":9},"end":{"line":49,"column":15}},{"start":{"line":49,"column":19},"end":{"line":49,"column":48}}]},"12":{"line":55,"type":"if","locations":[{"start":{"line":55,"column":5},"end":{"line":55,"column":5}},{"start":{"line":55,"column":5},"end":{"line":55,"column":5}}]},"13":{"line":56,"type":"if","locations":[{"start":{"line":56,"column":6},"end":{"line":56,"column":6}},{"start":{"line":56,"column":6},"end":{"line":56,"column":6}}]},"14":{"line":60,"type":"if","locations":[{"start":{"line":60,"column":7},"end":{"line":60,"column":7}},{"start":{"line":60,"column":7},"end":{"line":60,"column":7}}]},"15":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":11},"end":{"line":60,"column":14}},{"start":{"line":60,"column":18},"end":{"line":60,"column":26}}]},"16":{"line":63,"type":"cond-expr","locations":[{"start":{"line":63,"column":43},"end":{"line":63,"column":56}},{"start":{"line":63,"column":59},"end":{"line":63,"column":64}}]},"17":{"line":64,"type":"if","locations":[{"start":{"line":64,"column":7},"end":{"line":64,"column":7}},{"start":{"line":64,"column":7},"end":{"line":64,"column":7}}]},"18":{"line":74,"type":"cond-expr","locations":[{"start":{"line":74,"column":24},"end":{"line":74,"column":28}},{"start":{"line":74,"column":31},"end":{"line":74,"column":36}}]},"19":{"line":80,"type":"if","locations":[{"start":{"line":80,"column":6},"end":{"line":80,"column":6}},{"start":{"line":80,"column":6},"end":{"line":80,"column":6}}]},"20":{"line":84,"type":"if","locations":[{"start":{"line":84,"column":7},"end":{"line":84,"column":7}},{"start":{"line":84,"column":7},"end":{"line":84,"column":7}}]},"21":{"line":110,"type":"if","locations":[{"start":{"line":110,"column":2},"end":{"line":110,"column":2}},{"start":{"line":110,"column":2},"end":{"line":110,"column":2}}]},"22":{"line":114,"type":"if","locations":[{"start":{"line":114,"column":5},"end":{"line":114,"column":5}},{"start":{"line":114,"column":5},"end":{"line":114,"column":5}}]},"23":{"line":126,"type":"binary-expr","locations":[{"start":{"line":126,"column":21},"end":{"line":126,"column":45}},{"start":{"line":126,"column":49},"end":{"line":126,"column":110}}]},"24":{"line":148,"type":"if","locations":[{"start":{"line":148,"column":3},"end":{"line":148,"column":3}},{"start":{"line":148,"column":3},"end":{"line":148,"column":3}}]}},"code":["var _ = require('underscore');","var async = require('async');","var keystone = require('../../../');","","module.exports = function(req, res) {","","\tvar query = req.list.model.findById(req.params.id);","","\tvar fields = req.query.fields;","\tif (req.query.basic !== undefined) {","\t\tfields = false;","\t}","","\tif (req.list.tracking && req.list.tracking.createdBy) {","\t\tquery.populate(req.list.tracking.createdBy);","\t}","","\tif (req.list.tracking && req.list.tracking.updatedBy) {","\t\tquery.populate(req.list.tracking.updatedBy);","\t}","","\tquery.exec(function(err, item) {","","\t\tif (err) return res.status(500).json({ err: 'database error', detail: err });","\t\tif (!item) return res.status(404).json({ err: 'not found', id: req.params.id });","","\t\tvar tasks = [];","\t\tvar drilldown;","\t\tvar relationships;","","\t\t/* Drilldown (optional, provided if ?drilldown=true in querystring) */","\t\tif (req.query.drilldown === 'true' && req.list.get('drilldown')) {","\t\t\tdrilldown = {","\t\t\t\tdef: req.list.get('drilldown'),","\t\t\t\titems: []","\t\t\t};","","\t\t\ttasks.push(function(cb) {","","\t\t\t\t// TODO: proper support for nested relationships in drilldown","\t\t\t\t","\t\t\t\t// step back through the drilldown list and load in reverse order to support nested relationships","\t\t\t\tdrilldown.def = drilldown.def.split(' ').reverse();","","\t\t\t\tasync.eachSeries(drilldown.def, function(path, done) {","","\t\t\t\t\tvar field = req.list.fields[path];","","\t\t\t\t\tif (!field || field.type !== 'relationship') {","\t\t\t\t\t\tthrow new Error('Drilldown for ' + req.list.key + ' is invalid: field at path ' + path + ' is not a relationship.');","\t\t\t\t\t}","","\t\t\t\t\tvar refList = field.refList;","","\t\t\t\t\tif (field.many) {","\t\t\t\t\t\tif (!item.get(field.path).length) {","\t\t\t\t\t\t\treturn done();","\t\t\t\t\t\t}","\t\t\t\t\t\trefList.model.find().where('_id').in(item.get(field.path)).limit(4).exec(function(err, results) {","\t\t\t\t\t\t\tif (err || !results) {","\t\t\t\t\t\t\t\tdone(err);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar more = (results.length === 4) ? results.pop() : false;","\t\t\t\t\t\t\tif (results.length) {","\t\t\t\t\t\t\t\t// drilldown.data[path] = results;","\t\t\t\t\t\t\t\tdrilldown.items.push({","\t\t\t\t\t\t\t\t\tlist: refList.getOptions(),","\t\t\t\t\t\t\t\t\titems: _.map(results, function(i) {","\t\t\t\t\t\t\t\t\t\treturn {","\t\t\t\t\t\t\t\t\t\t\tlabel: refList.getDocumentName(i),","\t\t\t\t\t\t\t\t\t\t\thref: '/keystone/' + refList.path + '/' + i.id","\t\t\t\t\t\t\t\t\t\t};","\t\t\t\t\t\t\t\t\t}),","\t\t\t\t\t\t\t\t\tmore: (more) ? true : false","\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdone();","\t\t\t\t\t\t});","\t\t\t\t\t} else {","\t\t\t\t\t\tif (!item.get(field.path)) {","\t\t\t\t\t\t\treturn done();","\t\t\t\t\t\t}","\t\t\t\t\t\trefList.model.findById(item.get(field.path)).exec(function(err, result) {","\t\t\t\t\t\t\tif (result) {","\t\t\t\t\t\t\t\t// drilldown.data[path] = result;","\t\t\t\t\t\t\t\tdrilldown.items.push({","\t\t\t\t\t\t\t\t\tlist: refList.getOptions(),","\t\t\t\t\t\t\t\t\titems: [{","\t\t\t\t\t\t\t\t\t\tlabel: refList.getDocumentName(result),","\t\t\t\t\t\t\t\t\t\thref: '/keystone/' + refList.path + '/' + result.id","\t\t\t\t\t\t\t\t\t}]","\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdone(err);","\t\t\t\t\t\t});","\t\t\t\t\t}","","\t\t\t\t}, function(err) {","\t\t\t\t\t// put the drilldown list back in the right order","\t\t\t\t\tdrilldown.def.reverse();","\t\t\t\t\tdrilldown.items.reverse();","\t\t\t\t\tcb(err);","\t\t\t\t});","","\t\t\t});","\t\t}","","\t\t/* Relationships (optional, provided if ?relationships=true in querystring) */","","\t\tif (req.query.relationships === 'true') {","\t\t\ttasks.push(function(cb) {","","\t\t\t\trelationships = _.values(_.compact(_.map(req.list.relationships, function(i) {","\t\t\t\t\tif (i.isValid) {","\t\t\t\t\t\treturn _.clone(i);","\t\t\t\t\t} else {","\t\t\t\t\t\tkeystone.console.err('Relationship Configuration Error', 'Relationship: ' + i.path + ' on list: ' + req.list.key + ' links to an invalid list: ' + i.ref);","\t\t\t\t\t\treturn null;","\t\t\t\t\t}","\t\t\t\t})));","","\t\t\t\tasync.each(relationships, function(rel, done) {","","\t\t\t\t\t// TODO: Handle invalid relationship config","\t\t\t\t\trel.list = keystone.list(rel.ref);","\t\t\t\t\trel.sortable = (rel.list.get('sortable') && rel.list.get('sortContext') === req.list.key + ':' + rel.path);","","\t\t\t\t\t// TODO: Handle relationships with more than 1 page of results","\t\t\t\t\tvar q = rel.list.paginate({ page: 1, perPage: 100 })","\t\t\t\t\t\t.where(rel.refPath).equals(item.id)","\t\t\t\t\t\t.sort(rel.list.defaultSort);","","\t\t\t\t\t// rel.columns = _.reject(rel.list.defaultColumns, function(col) { return (col.type == 'relationship' && col.refList == req.list) });","\t\t\t\t\trel.columns = rel.list.defaultColumns;","\t\t\t\t\trel.list.selectColumns(q, rel.columns);","","\t\t\t\t\tq.exec(function(err, results) {","\t\t\t\t\t\trel.items = results;","\t\t\t\t\t\tdone(err);","\t\t\t\t\t});","","\t\t\t\t}, cb);","\t\t\t});","\t\t}","","\t\t/* Process tasks & return */","\t\tasync.parallel(tasks, function(err) {","\t\t\tif (err) {","\t\t\t\treturn res.status(500).json({","\t\t\t\t\terr: 'database error',","\t\t\t\t\tdetail: err","\t\t\t\t});","\t\t\t}","\t\t\tres.json(_.assign(req.list.getData(item, fields), {","\t\t\t\tdrilldown: drilldown,","\t\t\t\trelationships: relationships","\t\t\t}));","\t\t});","\t});","};",""],"l":{"1":1,"2":1,"3":1,"5":1,"7":0,"9":0,"10":0,"11":0,"14":0,"15":0,"18":0,"19":0,"22":0,"24":0,"25":0,"27":0,"28":0,"29":0,"32":0,"33":0,"38":0,"43":0,"45":0,"47":0,"49":0,"50":0,"53":0,"55":0,"56":0,"57":0,"59":0,"60":0,"61":0,"63":0,"64":0,"66":0,"69":0,"77":0,"80":0,"81":0,"83":0,"84":0,"86":0,"94":0,"100":0,"101":0,"102":0,"110":0,"111":0,"113":0,"114":0,"115":0,"117":0,"118":0,"122":0,"125":0,"126":0,"129":0,"134":0,"135":0,"137":0,"138":0,"139":0,"147":0,"148":0,"149":0,"154":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/session/signin.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/session/signin.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"fnMap":{"1":{"name":"signin","line":5,"loc":{"start":{"line":5,"column":0},"end":{"line":5,"column":27}}},"2":{"name":"(anonymous_2)","line":14,"loc":{"start":{"line":14,"column":49},"end":{"line":14,"column":70}}},"3":{"name":"(anonymous_3)","line":16,"loc":{"start":{"line":16,"column":41},"end":{"line":16,"column":56}}},"4":{"name":"(anonymous_4)","line":18,"loc":{"start":{"line":18,"column":47},"end":{"line":18,"column":71}}},"5":{"name":"(anonymous_5)","line":20,"loc":{"start":{"line":20,"column":45},"end":{"line":20,"column":57}}},"6":{"name":"(anonymous_6)","line":21,"loc":{"start":{"line":21,"column":46},"end":{"line":21,"column":61}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":38}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":36}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":46}},"4":{"start":{"line":5,"column":0},"end":{"line":39,"column":1}},"5":{"start":{"line":6,"column":1},"end":{"line":8,"column":2}},"6":{"start":{"line":7,"column":2},"end":{"line":7,"column":57}},"7":{"start":{"line":9,"column":1},"end":{"line":11,"column":2}},"8":{"start":{"line":10,"column":2},"end":{"line":10,"column":72}},"9":{"start":{"line":12,"column":1},"end":{"line":12,"column":54}},"10":{"start":{"line":13,"column":1},"end":{"line":13,"column":83}},"11":{"start":{"line":14,"column":1},"end":{"line":38,"column":4}},"12":{"start":{"line":15,"column":2},"end":{"line":37,"column":3}},"13":{"start":{"line":16,"column":3},"end":{"line":32,"column":6}},"14":{"start":{"line":17,"column":4},"end":{"line":17,"column":73}},"15":{"start":{"line":17,"column":13},"end":{"line":17,"column":73}},"16":{"start":{"line":18,"column":4},"end":{"line":31,"column":7}},"17":{"start":{"line":19,"column":5},"end":{"line":30,"column":6}},"18":{"start":{"line":20,"column":6},"end":{"line":25,"column":9}},"19":{"start":{"line":21,"column":7},"end":{"line":24,"column":10}},"20":{"start":{"line":22,"column":8},"end":{"line":22,"column":78}},"21":{"start":{"line":22,"column":17},"end":{"line":22,"column":78}},"22":{"start":{"line":23,"column":8},"end":{"line":23,"column":48}},"23":{"start":{"line":26,"column":12},"end":{"line":30,"column":6}},"24":{"start":{"line":27,"column":6},"end":{"line":27,"column":74}},"25":{"start":{"line":29,"column":6},"end":{"line":29,"column":52}},"26":{"start":{"line":33,"column":9},"end":{"line":37,"column":3}},"27":{"start":{"line":34,"column":3},"end":{"line":34,"column":73}},"28":{"start":{"line":36,"column":3},"end":{"line":36,"column":49}},"29":{"start":{"line":41,"column":0},"end":{"line":41,"column":24}}},"branchMap":{"1":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},{"start":{"line":6,"column":1},"end":{"line":6,"column":1}}]},"2":{"line":9,"type":"if","locations":[{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},{"start":{"line":9,"column":1},"end":{"line":9,"column":1}}]},"3":{"line":9,"type":"binary-expr","locations":[{"start":{"line":9,"column":5},"end":{"line":9,"column":20}},{"start":{"line":9,"column":24},"end":{"line":9,"column":42}}]},"4":{"line":15,"type":"if","locations":[{"start":{"line":15,"column":2},"end":{"line":15,"column":2}},{"start":{"line":15,"column":2},"end":{"line":15,"column":2}}]},"5":{"line":17,"type":"if","locations":[{"start":{"line":17,"column":4},"end":{"line":17,"column":4}},{"start":{"line":17,"column":4},"end":{"line":17,"column":4}}]},"6":{"line":19,"type":"if","locations":[{"start":{"line":19,"column":5},"end":{"line":19,"column":5}},{"start":{"line":19,"column":5},"end":{"line":19,"column":5}}]},"7":{"line":22,"type":"if","locations":[{"start":{"line":22,"column":8},"end":{"line":22,"column":8}},{"start":{"line":22,"column":8},"end":{"line":22,"column":8}}]},"8":{"line":26,"type":"if","locations":[{"start":{"line":26,"column":12},"end":{"line":26,"column":12}},{"start":{"line":26,"column":12},"end":{"line":26,"column":12}}]},"9":{"line":33,"type":"if","locations":[{"start":{"line":33,"column":9},"end":{"line":33,"column":9}},{"start":{"line":33,"column":9},"end":{"line":33,"column":9}}]}},"code":["var utils = require('keystone-utils');","var keystone = require('../../../');","var session = require('../../../lib/session');","","function signin (req, res) {","\tif (!keystone.security.csrf.validate(req)) {","\t\treturn res.status(403).json({ error: 'invalid csrf' });","\t}","\tif (!req.body.email || !req.body.password) {","\t\treturn res.status(401).json({ error: 'email and password required' });","\t}","\tvar User = keystone.list(keystone.get('user model'));","\tvar emailRegExp = new RegExp('^' + utils.escapeRegExp(req.body.email) + '$', 'i');","\tUser.model.findOne({ email: emailRegExp }).exec(function (err, user) {","\t\tif (user) {","\t\t\tkeystone.callHook(user, 'pre:signin', function (err) {","\t\t\t\tif (err) return res.json({ error: 'pre:signin error', detail: err });","\t\t\t\tuser._.password.compare(req.body.password, function (err, isMatch) {","\t\t\t\t\tif (isMatch) {","\t\t\t\t\t\tsession.signinWithUser(user, req, res, function () {","\t\t\t\t\t\t\tkeystone.callHook(user, 'post:signin', function (err) {","\t\t\t\t\t\t\t\tif (err) return res.json({ error: 'post:signin error', detail: err });","\t\t\t\t\t\t\t\tres.json({ success: true, user: user });","\t\t\t\t\t\t\t});","\t\t\t\t\t\t});","\t\t\t\t\t} else if (err) {","\t\t\t\t\t\treturn res.status(500).json({ error: 'bcrypt error', detail: err });","\t\t\t\t\t} else {","\t\t\t\t\t\treturn res.json({ error: 'invalid details' });","\t\t\t\t\t}","\t\t\t\t});","\t\t\t});","\t\t} else if (err) {","\t\t\treturn res.status(500).json({ error: 'database error', detail: err });","\t\t} else {","\t\t\treturn res.json({ error: 'invalid details' });","\t\t}","\t});","}","","module.exports = signin;",""],"l":{"1":1,"2":1,"3":1,"5":1,"6":0,"7":0,"9":0,"10":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"26":0,"27":0,"29":0,"33":0,"34":0,"36":0,"41":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/session/signout.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/api/session/signout.js","s":{"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":1},"b":{"1":[0,0],"2":[0,0],"3":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0},"fnMap":{"1":{"name":"signout","line":3,"loc":{"start":{"line":3,"column":0},"end":{"line":3,"column":28}}},"2":{"name":"(anonymous_2)","line":5,"loc":{"start":{"line":5,"column":40},"end":{"line":5,"column":54}}},"3":{"name":"(anonymous_3)","line":9,"loc":{"start":{"line":9,"column":25},"end":{"line":9,"column":39}}},"4":{"name":"(anonymous_4)","line":11,"loc":{"start":{"line":11,"column":43},"end":{"line":11,"column":57}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":36}},"2":{"start":{"line":3,"column":0},"end":{"line":17,"column":1}},"3":{"start":{"line":4,"column":1},"end":{"line":4,"column":21}},"4":{"start":{"line":5,"column":1},"end":{"line":16,"column":4}},"5":{"start":{"line":6,"column":2},"end":{"line":6,"column":72}},"6":{"start":{"line":6,"column":11},"end":{"line":6,"column":72}},"7":{"start":{"line":7,"column":2},"end":{"line":7,"column":34}},"8":{"start":{"line":8,"column":2},"end":{"line":8,"column":18}},"9":{"start":{"line":9,"column":2},"end":{"line":15,"column":5}},"10":{"start":{"line":10,"column":3},"end":{"line":10,"column":69}},"11":{"start":{"line":10,"column":12},"end":{"line":10,"column":69}},"12":{"start":{"line":11,"column":3},"end":{"line":14,"column":6}},"13":{"start":{"line":12,"column":4},"end":{"line":12,"column":74}},"14":{"start":{"line":12,"column":13},"end":{"line":12,"column":74}},"15":{"start":{"line":13,"column":4},"end":{"line":13,"column":32}},"16":{"start":{"line":19,"column":0},"end":{"line":19,"column":25}}},"branchMap":{"1":{"line":6,"type":"if","locations":[{"start":{"line":6,"column":2},"end":{"line":6,"column":2}},{"start":{"line":6,"column":2},"end":{"line":6,"column":2}}]},"2":{"line":10,"type":"if","locations":[{"start":{"line":10,"column":3},"end":{"line":10,"column":3}},{"start":{"line":10,"column":3},"end":{"line":10,"column":3}}]},"3":{"line":12,"type":"if","locations":[{"start":{"line":12,"column":4},"end":{"line":12,"column":4}},{"start":{"line":12,"column":4},"end":{"line":12,"column":4}}]}},"code":["var keystone = require('../../../');","","function signout (req, res) {","\tvar user = req.user;","\tkeystone.callHook(user, 'pre:signout', function(err) {","\t\tif (err) return res.json({ error: 'pre:signout error', detail: err });","\t\tres.clearCookie('keystone.uid');","\t\treq.user = null;","\t\treq.session.regenerate(function(err) {","\t\t\tif (err) return res.json({ error: 'session error', detail: err });","\t\t\tkeystone.callHook(user, 'post:signout', function(err) {","\t\t\t\tif (err) return res.json({ error: 'pre:signout error', detail: err });","\t\t\t\tres.json({ success: true });","\t\t\t});","\t\t});","\t});","}","","module.exports = signout;",""],"l":{"1":1,"3":1,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"19":1}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/routes/views/home.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/routes/views/home.js","s":{"1":1,"2":1,"3":0},"b":{"1":[0,0]},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":3,"loc":{"start":{"line":3,"column":27},"end":{"line":3,"column":46}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":36}},"2":{"start":{"line":3,"column":0},"end":{"line":12,"column":2}},"3":{"start":{"line":5,"column":1},"end":{"line":10,"column":4}}},"branchMap":{"1":{"line":8,"type":"binary-expr","locations":[{"start":{"line":8,"column":9},"end":{"line":8,"column":29}},{"start":{"line":8,"column":33},"end":{"line":8,"column":43}}]}},"code":["var keystone = require('../../../');","","exports = module.exports = function(req, res) {","","\tkeystone.render(req, res, 'home', {","\t\tsection: 'home',","\t\tpage: 'home',","\t\ttitle: keystone.get('name') || 'Keystone',","\t\torphanedLists: keystone.getOrphanedLists()","\t});","","};",""],"l":{"1":1,"3":1,"5":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/routes/views/item.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/admin/routes/views/item.js","s":{"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0,0],"9":[0,0],"10":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},"fnMap":{"1":{"name":"(anonymous_1)","line":5,"loc":{"start":{"line":5,"column":27},"end":{"line":5,"column":46}}},"2":{"name":"(anonymous_2)","line":9,"loc":{"start":{"line":9,"column":16},"end":{"line":9,"column":36}}},"3":{"name":"(anonymous_3)","line":21,"loc":{"start":{"line":21,"column":19},"end":{"line":21,"column":30}}},"4":{"name":"(anonymous_4)","line":23,"loc":{"start":{"line":23,"column":72},"end":{"line":23,"column":84}}},"5":{"name":"(anonymous_5)","line":32,"loc":{"start":{"line":32,"column":29},"end":{"line":32,"column":49}}},"6":{"name":"(anonymous_6)","line":47,"loc":{"start":{"line":47,"column":11},"end":{"line":47,"column":34}}},"7":{"name":"(anonymous_7)","line":52,"loc":{"start":{"line":52,"column":6},"end":{"line":52,"column":20}}},"8":{"name":"(anonymous_8)","line":56,"loc":{"start":{"line":56,"column":50},"end":{"line":56,"column":64}}},"9":{"name":"(anonymous_9)","line":84,"loc":{"start":{"line":84,"column":88},"end":{"line":84,"column":102}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":36}},"2":{"start":{"line":2,"column":0},"end":{"line":2,"column":30}},"3":{"start":{"line":3,"column":0},"end":{"line":3,"column":29}},"4":{"start":{"line":5,"column":0},"end":{"line":99,"column":2}},"5":{"start":{"line":7,"column":1},"end":{"line":7,"column":67}},"6":{"start":{"line":9,"column":1},"end":{"line":97,"column":4}},"7":{"start":{"line":11,"column":2},"end":{"line":14,"column":3}},"8":{"start":{"line":12,"column":3},"end":{"line":12,"column":52}},"9":{"start":{"line":13,"column":3},"end":{"line":13,"column":53}},"10":{"start":{"line":16,"column":2},"end":{"line":19,"column":3}},"11":{"start":{"line":17,"column":3},"end":{"line":17,"column":74}},"12":{"start":{"line":18,"column":3},"end":{"line":18,"column":53}},"13":{"start":{"line":21,"column":2},"end":{"line":74,"column":4}},"14":{"start":{"line":23,"column":3},"end":{"line":30,"column":8}},"15":{"start":{"line":24,"column":4},"end":{"line":29,"column":5}},"16":{"start":{"line":25,"column":5},"end":{"line":25,"column":23}},"17":{"start":{"line":27,"column":5},"end":{"line":27,"column":159}},"18":{"start":{"line":28,"column":5},"end":{"line":28,"column":17}},"19":{"start":{"line":32,"column":3},"end":{"line":72,"column":6}},"20":{"start":{"line":35,"column":4},"end":{"line":35,"column":38}},"21":{"start":{"line":36,"column":4},"end":{"line":36,"column":111}},"22":{"start":{"line":39,"column":4},"end":{"line":41,"column":33}},"23":{"start":{"line":44,"column":4},"end":{"line":44,"column":42}},"24":{"start":{"line":45,"column":4},"end":{"line":45,"column":43}},"25":{"start":{"line":47,"column":4},"end":{"line":50,"column":7}},"26":{"start":{"line":48,"column":5},"end":{"line":48,"column":25}},"27":{"start":{"line":49,"column":5},"end":{"line":49,"column":15}},"28":{"start":{"line":56,"column":4},"end":{"line":58,"column":7}},"29":{"start":{"line":57,"column":5},"end":{"line":57,"column":37}},"30":{"start":{"line":60,"column":4},"end":{"line":60,"column":53}},"31":{"start":{"line":62,"column":4},"end":{"line":70,"column":7}},"32":{"start":{"line":76,"column":2},"end":{"line":95,"column":3}},"33":{"start":{"line":78,"column":3},"end":{"line":82,"column":4}},"34":{"start":{"line":79,"column":4},"end":{"line":79,"column":56}},"35":{"start":{"line":80,"column":4},"end":{"line":80,"column":83}},"36":{"start":{"line":81,"column":4},"end":{"line":81,"column":24}},"37":{"start":{"line":84,"column":3},"end":{"line":90,"column":6}},"38":{"start":{"line":85,"column":4},"end":{"line":87,"column":5}},"39":{"start":{"line":86,"column":5},"end":{"line":86,"column":25}},"40":{"start":{"line":88,"column":4},"end":{"line":88,"column":58}},"41":{"start":{"line":89,"column":4},"end":{"line":89,"column":70}},"42":{"start":{"line":94,"column":3},"end":{"line":94,"column":16}}},"branchMap":{"1":{"line":11,"type":"if","locations":[{"start":{"line":11,"column":2},"end":{"line":11,"column":2}},{"start":{"line":11,"column":2},"end":{"line":11,"column":2}}]},"2":{"line":16,"type":"if","locations":[{"start":{"line":16,"column":2},"end":{"line":16,"column":2}},{"start":{"line":16,"column":2},"end":{"line":16,"column":2}}]},"3":{"line":24,"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":24,"column":4}},{"start":{"line":24,"column":4},"end":{"line":24,"column":4}}]},"4":{"line":36,"type":"binary-expr","locations":[{"start":{"line":36,"column":20},"end":{"line":36,"column":44}},{"start":{"line":36,"column":48},"end":{"line":36,"column":109}}]},"5":{"line":60,"type":"binary-expr","locations":[{"start":{"line":60,"column":18},"end":{"line":60,"column":38}},{"start":{"line":60,"column":42},"end":{"line":60,"column":52}}]},"6":{"line":63,"type":"binary-expr","locations":[{"start":{"line":63,"column":14},"end":{"line":63,"column":48}},{"start":{"line":63,"column":52},"end":{"line":63,"column":54}}]},"7":{"line":76,"type":"if","locations":[{"start":{"line":76,"column":2},"end":{"line":76,"column":2}},{"start":{"line":76,"column":2},"end":{"line":76,"column":2}}]},"8":{"line":76,"type":"binary-expr","locations":[{"start":{"line":76,"column":6},"end":{"line":76,"column":27}},{"start":{"line":76,"column":31},"end":{"line":76,"column":63}},{"start":{"line":76,"column":67},"end":{"line":76,"column":90}}]},"9":{"line":78,"type":"if","locations":[{"start":{"line":78,"column":3},"end":{"line":78,"column":3}},{"start":{"line":78,"column":3},"end":{"line":78,"column":3}}]},"10":{"line":85,"type":"if","locations":[{"start":{"line":85,"column":4},"end":{"line":85,"column":4}},{"start":{"line":85,"column":4},"end":{"line":85,"column":4}}]}},"code":["var keystone = require('../../../');","var _ = require('underscore');","var async = require('async');","","exports = module.exports = function(req, res) {","","\tvar itemQuery = req.list.model.findById(req.params.item).select();","","\titemQuery.exec(function(err, item) {","","\t\tif (err) {","\t\t\treq.flash('error', 'A database error occurred.');","\t\t\treturn res.redirect('/keystone/' + req.list.path);","\t\t}","","\t\tif (!item) {","\t\t\treq.flash('error', 'Item ' + req.params.item + ' could not be found.');","\t\t\treturn res.redirect('/keystone/' + req.list.path);","\t\t}","","\t\tvar renderView = function() {","","\t\t\tvar relationships = _.values(_.compact(_.map(req.list.relationships, function(i) {","\t\t\t\tif (i.isValid) {","\t\t\t\t\treturn _.clone(i);","\t\t\t\t} else {","\t\t\t\t\tkeystone.console.err('Relationship Configuration Error', 'Relationship: ' + i.path + ' on list: ' + req.list.key + ' links to an invalid list: ' + i.ref);","\t\t\t\t\treturn null;","\t\t\t\t}","\t\t\t})));","","\t\t\tasync.each(relationships, function(rel, done) {","","\t\t\t\t// TODO: Handle invalid relationship config","\t\t\t\trel.list = keystone.list(rel.ref);","\t\t\t\trel.sortable = (rel.list.get('sortable') && rel.list.get('sortContext') === req.list.key + ':' + rel.path);","","\t\t\t\t// TODO: Handle relationships with more than 1 page of results","\t\t\t\tvar q = rel.list.paginate({ page: 1, perPage: 100 })","\t\t\t\t\t.where(rel.refPath).equals(item.id)","\t\t\t\t\t.sort(rel.list.defaultSort);","","\t\t\t\t// rel.columns = _.reject(rel.list.defaultColumns, function(col) { return (col.type == 'relationship' && col.refList == req.list) });","\t\t\t\trel.columns = rel.list.defaultColumns;","\t\t\t\trel.list.selectColumns(q, rel.columns);","","\t\t\t\tq.exec(function(err, results) {","\t\t\t\t\trel.items = results;","\t\t\t\t\tdone(err);","\t\t\t\t});","","\t\t\t}, function(err) { //eslint-disable-line no-unused-vars, handle-callback-err","","\t\t\t\t// TODO: Handle err","","\t\t\t\tvar showRelationships = _.some(relationships, function(rel) {","\t\t\t\t\treturn rel.items.results.length;","\t\t\t\t});","","\t\t\t\tvar appName = keystone.get('name') || 'Keystone';","","\t\t\t\tkeystone.render(req, res, 'item', {","\t\t\t\t\tsection: keystone.nav.by.list[req.list.key] || {},","\t\t\t\t\ttitle: appName + ': ' + req.list.singular + ': ' + req.list.getDocumentName(item),","\t\t\t\t\tpage: 'item',","\t\t\t\t\tlist: req.list,","\t\t\t\t\titem: item,","\t\t\t\t\trelationships: relationships,","\t\t\t\t\tshowRelationships: showRelationships","\t\t\t\t});","","\t\t\t});","","\t\t};","","\t\tif (req.method === 'POST' && req.body.action === 'updateItem' && !req.list.get('noedit')) {","","\t\t\tif (!keystone.security.csrf.validate(req)) {","\t\t\t\tconsole.error('CSRF failure', req.method, req.body);","\t\t\t\treq.flash('error', 'There was a problem with your request, please try again.');","\t\t\t\treturn renderView();","\t\t\t}","","\t\t\titem.getUpdateHandler(req).process(req.body, { flashErrors: true, logErrors: true }, function(err) {","\t\t\t\tif (err) {","\t\t\t\t\treturn renderView();","\t\t\t\t}","\t\t\t\treq.flash('success', 'Your changes have been saved.');","\t\t\t\treturn res.redirect('/keystone/' + req.list.path + '/' + item.id);","\t\t\t});","","","\t\t} else {","\t\t\trenderView();","\t\t}","","\t});","","};",""],"l":{"1":1,"2":1,"3":1,"5":1,"7":0,"9":0,"11":0,"12":0,"13":0,"16":0,"17":0,"18":0,"21":0,"23":0,"24":0,"25":0,"27":0,"28":0,"32":0,"35":0,"36":0,"39":0,"44":0,"45":0,"47":0,"48":0,"49":0,"56":0,"57":0,"60":0,"62":0,"76":0,"78":0,"79":0,"80":0,"81":0,"84":0,"85":0,"86":0,"88":0,"89":0,"94":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/datearray/DateArrayField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/datearray/DateArrayField.js","s":{"1":2,"2":0},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":2,"column":58}},"2":{"start":{"line":4,"column":0},"end":{"line":10,"column":3}}},"branchMap":{},"code":["var Field = require('../Field'),","\tArrayFieldMixin = require('../../mixins/DateArrayField');","","module.exports = Field.create({","\t","\tdisplayName: 'DateArrayField',","\t","\tmixins: [ArrayFieldMixin]","\t","});",""],"l":{"1":2,"4":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/key/KeyField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/key/KeyField.js","s":{"1":2,"2":0},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":32}},"2":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}}},"branchMap":{},"code":["var Field = require('../Field');","","module.exports = Field.create({","\tdisplayName: 'KeyField'","});",""],"l":{"1":2,"3":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/numberarray/NumberArrayField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/numberarray/NumberArrayField.js","s":{"1":2,"2":0,"3":0},"b":{},"f":{"1":0},"fnMap":{"1":{"name":"(anonymous_1)","line":10,"loc":{"start":{"line":10,"column":13},"end":{"line":10,"column":29}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":2,"column":54}},"2":{"start":{"line":4,"column":0},"end":{"line":14,"column":3}},"3":{"start":{"line":11,"column":2},"end":{"line":11,"column":37}}},"branchMap":{},"code":["var Field = require('../Field'),","\tArrayFieldMixin = require('../../mixins/ArrayField');","","module.exports = Field.create({","\t","\tdisplayName: 'NumberArrayField',","\t","\tmixins: [ArrayFieldMixin],","\t","\tcleanInput: function(input) {","\t\treturn input.replace(/[^\\d]/g, '');","\t}","\t","});",""],"l":{"1":2,"4":0,"11":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/s3file/S3FileField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/s3file/S3FileField.js","s":{"1":2},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":56}}},"branchMap":{},"code":["module.exports = require('../localfile/LocalFileField');",""],"l":{"1":2}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/textarray/TextArrayField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/textarray/TextArrayField.js","s":{"1":2,"2":0},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":2,"column":54}},"2":{"start":{"line":4,"column":0},"end":{"line":10,"column":3}}},"branchMap":{},"code":["var Field = require('../Field'),","\tArrayFieldMixin = require('../../mixins/ArrayField');","","module.exports = Field.create({","\t","\tdisplayName: 'TextArrayField',","\t","\tmixins: [ArrayFieldMixin]","\t","});",""],"l":{"1":2,"4":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/text/TextField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/text/TextField.js","s":{"1":2,"2":0},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":32}},"2":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}}},"branchMap":{},"code":["var Field = require('../Field');","","module.exports = Field.create({","\tdisplayName: 'TextField'","});",""],"l":{"1":2,"3":0}},"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/url/UrlField.js":{"path":"/home/travis/build/npmtest/node-npmtest-keystone/node_modules/keystone/fields/types/url/UrlField.js","s":{"1":2,"2":0},"b":{},"f":{},"fnMap":{},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":1,"column":32}},"2":{"start":{"line":3,"column":0},"end":{"line":5,"column":3}}},"branchMap":{},"code":["var Field = require('../Field');","","module.exports = Field.create({","\tdisplayName: 'UrlField'","});",""],"l":{"1":2,"3":0}}}